From f6b1214c7c3660f8106e582b72351eddf6e068d8 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Mon, 10 Oct 2016 21:46:52 -0200
Subject: [PATCH 001/292] Step 1.1: Remove both, client and server

---
 both/collections/demo-collection.ts               |  4 -
 both/models/demo-data-object.ts                   |  4 -
 client/imports/app/app.component.html             |  4 -
 client/imports/app/app.component.scss             |  5 --
 client/imports/app/app.component.ts               | 12 ---
 client/imports/app/app.module.ts                  | 28 -------
 client/imports/app/demo/demo-data.service.test.ts | 19 -----
 client/imports/app/demo/demo-data.service.ts      | 18 -----
 client/imports/app/demo/demo.component.html       |  8 --
 client/imports/app/demo/demo.component.scss       |  3 -
 client/imports/app/demo/demo.component.test.ts    | 95 -----------------------
 client/imports/app/demo/demo.component.ts         | 25 ------
 client/imports/app/index.ts                       |  2 -
 client/index.html                                 |  6 --
 client/init.test.ts                               | 12 ---
 client/main.ts                                    | 12 ---
 server/imports/server-main/main.test.ts           | 40 ----------
 server/imports/server-main/main.ts                | 27 -------
 server/main.ts                                    |  4 -
 19 files changed, 328 deletions(-)
 delete mode 100644 both/collections/demo-collection.ts
 delete mode 100644 both/models/demo-data-object.ts
 delete mode 100644 client/imports/app/app.component.html
 delete mode 100644 client/imports/app/app.component.scss
 delete mode 100644 client/imports/app/app.component.ts
 delete mode 100644 client/imports/app/app.module.ts
 delete mode 100644 client/imports/app/demo/demo-data.service.test.ts
 delete mode 100644 client/imports/app/demo/demo-data.service.ts
 delete mode 100644 client/imports/app/demo/demo.component.html
 delete mode 100644 client/imports/app/demo/demo.component.scss
 delete mode 100644 client/imports/app/demo/demo.component.test.ts
 delete mode 100644 client/imports/app/demo/demo.component.ts
 delete mode 100644 client/imports/app/index.ts
 delete mode 100644 client/index.html
 delete mode 100644 client/init.test.ts
 delete mode 100644 client/main.ts
 delete mode 100644 server/imports/server-main/main.test.ts
 delete mode 100644 server/imports/server-main/main.ts
 delete mode 100644 server/main.ts

diff --git a/both/collections/demo-collection.ts b/both/collections/demo-collection.ts
deleted file mode 100644
index 371b609..0000000
--- a/both/collections/demo-collection.ts
+++ /dev/null
@@ -1,4 +0,0 @@
-import { MongoObservable } from 'meteor-rxjs';
-import { DemoDataObject } from '../models/demo-data-object';
-
-export const DemoCollection = new MongoObservable.Collection<DemoDataObject>('demo-collection');
\ No newline at end of file
diff --git a/both/models/demo-data-object.ts b/both/models/demo-data-object.ts
deleted file mode 100644
index 64846d7..0000000
--- a/both/models/demo-data-object.ts
+++ /dev/null
@@ -1,4 +0,0 @@
-export interface DemoDataObject {
-  name: string;
-  age: number;
-}
\ No newline at end of file
diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
deleted file mode 100644
index 1d40faa..0000000
--- a/client/imports/app/app.component.html
+++ /dev/null
@@ -1,4 +0,0 @@
-<div>
-    <h1>Hello Angular2-Meteor!</h1>
-    <demo></demo>
-</div>
diff --git a/client/imports/app/app.component.scss b/client/imports/app/app.component.scss
deleted file mode 100644
index 4c02b72..0000000
--- a/client/imports/app/app.component.scss
+++ /dev/null
@@ -1,5 +0,0 @@
-body {
-
-}
-
-@import "./imports/demo/demo.component";
diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
deleted file mode 100644
index ca2fb29..0000000
--- a/client/imports/app/app.component.ts
+++ /dev/null
@@ -1,12 +0,0 @@
-import { Component } from '@angular/core';
-
-import template from './app.component.html';
-
-@Component({
-  selector: 'app',
-  template
-})
-export class AppComponent {
-  constructor() {
-  }
-}
diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
deleted file mode 100644
index 1a3c354..0000000
--- a/client/imports/app/app.module.ts
+++ /dev/null
@@ -1,28 +0,0 @@
-import { NgModule } from '@angular/core';
-import { BrowserModule } from '@angular/platform-browser';
-import { AppComponent } from './app.component';
-import { DemoComponent } from './demo/demo.component';
-import { DemoDataService } from './demo/demo-data.service';
-
-@NgModule({
-  // Components, Pipes, Directive
-  declarations: [
-    AppComponent,
-    DemoComponent
-  ],
-  // Entry Components
-  entryComponents: [
-    AppComponent
-  ],
-  // Providers
-  providers: [
-    DemoDataService
-  ],
-  // Modules
-  imports: [
-    BrowserModule
-  ],
-  // Main Component
-  bootstrap: [ AppComponent ]
-})
-export class AppModule {}
diff --git a/client/imports/app/demo/demo-data.service.test.ts b/client/imports/app/demo/demo-data.service.test.ts
deleted file mode 100644
index 4320d63..0000000
--- a/client/imports/app/demo/demo-data.service.test.ts
+++ /dev/null
@@ -1,19 +0,0 @@
-// chai uses as asset library
-import { assert } from 'chai';
-import { Mongo } from 'meteor/mongo';
-
-// Project imports
-import { DemoDataService } from './demo-data.service';
-
-describe('DemoDataService', () => {
-  let demoDataService:DemoDataService;
-
-  beforeEach(() => {
-    // Create the service instance
-    demoDataService = new DemoDataService();
-  });
-
-  it('Should return MongoDB Cursor when requesting the data', () => {
-    assert.isTrue(demoDataService.getData() instanceof Mongo.Cursor);
-  });
-});
diff --git a/client/imports/app/demo/demo-data.service.ts b/client/imports/app/demo/demo-data.service.ts
deleted file mode 100644
index 357aaf7..0000000
--- a/client/imports/app/demo/demo-data.service.ts
+++ /dev/null
@@ -1,18 +0,0 @@
-import { Injectable } from '@angular/core';
-import { ObservableCursor } from 'meteor-rxjs';
-
-import { DemoDataObject } from '../../../../both/models/demo-data-object';
-import { DemoCollection } from '../../../../both/collections/demo-collection';
-
-@Injectable()
-export class DemoDataService {
-  private data : ObservableCursor<DemoDataObject>;
-
-  constructor() {
-    this.data = DemoCollection.find({});
-  }
-
-  public getData() : ObservableCursor<DemoDataObject> {
-    return this.data;
-  }
-}
diff --git a/client/imports/app/demo/demo.component.html b/client/imports/app/demo/demo.component.html
deleted file mode 100644
index 38180c6..0000000
--- a/client/imports/app/demo/demo.component.html
+++ /dev/null
@@ -1,8 +0,0 @@
-<h2>{{greeting}}</h2>
-
-This is the available data:
-<ul>
-    <li *ngFor="let item of data | async">
-        {{item.name}} ({{item.age}})
-    </li>
-</ul>
diff --git a/client/imports/app/demo/demo.component.scss b/client/imports/app/demo/demo.component.scss
deleted file mode 100644
index 9e27489..0000000
--- a/client/imports/app/demo/demo.component.scss
+++ /dev/null
@@ -1,3 +0,0 @@
-demo {
-
-}
diff --git a/client/imports/app/demo/demo.component.test.ts b/client/imports/app/demo/demo.component.test.ts
deleted file mode 100644
index 39221cd..0000000
--- a/client/imports/app/demo/demo.component.test.ts
+++ /dev/null
@@ -1,95 +0,0 @@
-// chai uses as asset library
-import { assert } from 'chai';
-
-// Angular 2 tests imports
-import { inject } from '@angular/core';
-import { provide } from '@angular/core';
-import { TestComponentBuilder } from '@angular/compiler';
-
-// Project imports
-import { DemoComponent } from './demo.component';
-import { DemoDataService } from './demo-data.service';
-import { DemoDataObject } from '../../../../both/models/demo-data-object';
-
-describe('DemoComponent', () => {
-  let demoComponentInstance:DemoComponent;
-  let demoComponentElement;
-  let componentFixture;
-
-  let mockDataArray = [
-    <DemoDataObject>{
-      name: 'Test',
-      age: 10
-    }
-  ];
-
-  let mockDataService = {
-    getData: () => mockDataArray
-  };
-
-  beforeEach(inject([TestComponentBuilder], (tcb:TestComponentBuilder) => {
-    // We inject TestComponentBuilder that provides use the ability to control the injections of the component
-    // Then we will request to get DemoComponent with a mock service instead of the real DemoDataService
-    // The fixture created contain the element and the instance of the Component class
-    // Finally, we need to save 'detectChanges' and call it to flush the changes into the view.
-    return tcb.overrideProviders(DemoComponent, [
-      provide(DemoDataService, {useValue: mockDataService})
-    ]).createAsync(DemoComponent).then((fixture) => {
-      componentFixture = fixture;
-
-      demoComponentInstance = componentFixture.componentInstance;
-      demoComponentElement = componentFixture.nativeElement;
-
-      componentFixture.detectChanges();
-    });
-  }));
-
-  describe('@Component instance', () => {
-    it('Should have a greeting string on the component', () => {
-      assert.typeOf(demoComponentInstance.greeting, 'string', 'Greeting should be a string!');
-    });
-
-    it('Should say hello to the component on the greeting string', () => {
-      assert.equal(demoComponentInstance.greeting, 'Hello Demo Component!');
-    });
-
-    it('Should have an array (from the mock) of the instance', () => {
-      assert.typeOf(demoComponentInstance.getData(), 'array');
-    });
-
-    it('Should have an items in the array', () => {
-      assert.typeOf(demoComponentInstance.getData(), 'array');
-      assert.equal((<Array>demoComponentInstance.getData()).length, 1);
-    });
-  });
-
-  describe('@Component view', () => {
-    it('Should print the greeting to the screen', () => {
-      assert.include(demoComponentElement.innerHTML, 'Hello Demo Component');
-    });
-
-    it('Should change the greeting when it changes', () => {
-      assert.include(demoComponentElement.innerHTML, 'Hello Demo Component');
-      demoComponentInstance.greeting = 'New Test Greeting';
-      componentFixture.detectChanges();
-      assert.include(demoComponentElement.innerHTML, 'New Test Greeting');
-    });
-
-    it('Should display a list of items in the screen', () => {
-      assert.isNotNull(demoComponentElement.querySelector('ul'));
-    });
-
-    it('Should add item to the list when modifying the data in the service', () => {
-      assert.equal(demoComponentElement.querySelectorAll('li').length, 1);
-
-      mockDataArray.push({
-        name: 'Dotan',
-        age: 20
-      });
-
-      componentFixture.detectChanges();
-
-      assert.equal(demoComponentElement.querySelectorAll('li').length, 2);
-    });
-  });
-});
diff --git a/client/imports/app/demo/demo.component.ts b/client/imports/app/demo/demo.component.ts
deleted file mode 100644
index 9a4df43..0000000
--- a/client/imports/app/demo/demo.component.ts
+++ /dev/null
@@ -1,25 +0,0 @@
-import { Component, OnInit } from '@angular/core';
-import { ObservableCursor } from 'meteor-rxjs';
-import { Observable } from 'rxjs/Observable';
-
-import { DemoDataService } from './demo-data.service';
-import { DemoDataObject } from '../../../../both/models/demo-data-object';
-
-import template from './demo.component.html';
-
-@Component({
-  selector: 'demo',
-  template
-})
-export class DemoComponent implements OnInit {
-  greeting: string;
-  data: Observable<DemoDataObject[]>;
-
-  constructor(private demoDataService: DemoDataService) {
-    this.greeting = 'Hello Demo Component!';
-  }
-
-  ngOnInit() {
-    this.data = this.demoDataService.getData().zone();
-  }
-}
diff --git a/client/imports/app/index.ts b/client/imports/app/index.ts
deleted file mode 100644
index 875bdb2..0000000
--- a/client/imports/app/index.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-export * from './app.component';
-export * from './app.module';
diff --git a/client/index.html b/client/index.html
deleted file mode 100644
index d3675e5..0000000
--- a/client/index.html
+++ /dev/null
@@ -1,6 +0,0 @@
-<head>
-    <base href="/">
-</head>
-<body>
-  <app>Loading...</app>
-</body>
diff --git a/client/init.test.ts b/client/init.test.ts
deleted file mode 100644
index cd07c0b..0000000
--- a/client/init.test.ts
+++ /dev/null
@@ -1,12 +0,0 @@
-// angular2-meteor polyfills required for testing
-import 'angular2-meteor-tests-polyfills';
-
-// Angular 2 tests imports
-import { platformBrowserDynamicTesting, BrowserDynamicTestingModule } from '@angular/platform-browser-dynamic';
-import { TestBed } from '@angular/core';
-
-// Init the test framework
-TestBed.initTestEnvironment(
-  BrowserDynamicTestingModule,
-  platformBrowserDynamicTesting()
-);
diff --git a/client/main.ts b/client/main.ts
deleted file mode 100644
index 8f35a92..0000000
--- a/client/main.ts
+++ /dev/null
@@ -1,12 +0,0 @@
-import 'angular2-meteor-polyfills';
-
-import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
-import { enableProdMode } from '@angular/core';
-import { Meteor } from "meteor/meteor";
-import { AppModule } from './imports/app';
-
-enableProdMode();
-
-Meteor.startup(() => {
-   platformBrowserDynamic().bootstrapModule(AppModule);
-});
diff --git a/server/imports/server-main/main.test.ts b/server/imports/server-main/main.test.ts
deleted file mode 100644
index e050427..0000000
--- a/server/imports/server-main/main.test.ts
+++ /dev/null
@@ -1,40 +0,0 @@
-// chai uses as asset library
-import * as chai from 'chai';
-import * as spies from 'chai-spies';
-import StubCollections from 'meteor/hwillson:stub-collections';
-
-import { DemoCollection } from '../../../both/collections/demo-collection';
-import { Main } from './main';
-
-chai.use(spies);
-
-describe('Server Main', () => {
-  let mainInstance : Main;
-
-  beforeEach(() => {
-    // Creating database mock
-    StubCollections.stub(DemoCollection);
-
-    // Create instance of main class
-    mainInstance = new Main();
-  });
-
-  afterEach(() => {
-    // Restore database
-    StubCollections.restore();
-  });
-
-  it('Should call initFakeData on startup', () => {
-    mainInstance.initFakeData = chai.spy();
-    mainInstance.start();
-
-    chai.expect(mainInstance.initFakeData).to.have.been.called();
-  });
-
-  it('Should call insert 3 times when init fake data', () => {
-    DemoCollection.insert = chai.spy();
-    mainInstance.initFakeData();
-
-    chai.expect(DemoCollection.insert).to.have.been.called.exactly(3);
-  });
-});
diff --git a/server/imports/server-main/main.ts b/server/imports/server-main/main.ts
deleted file mode 100644
index d4b1cda..0000000
--- a/server/imports/server-main/main.ts
+++ /dev/null
@@ -1,27 +0,0 @@
-import { DemoCollection } from '../../../both/collections/demo-collection';
-import { DemoDataObject } from '../../../both/models/demo-data-object';
-
-export class Main {
-  start(): void {
-    this.initFakeData();
-  }
-
-  initFakeData(): void {
-    if (DemoCollection.find({}).cursor.count() === 0) {
-      const data: DemoDataObject[] = [{
-        name: 'Dotan',
-        age: 25
-      }, {
-        name: 'Liran',
-        age: 26
-      }, {
-        name: 'Uri',
-        age: 30
-      }];
-      
-      data.forEach((obj: DemoDataObject) => {
-        DemoCollection.insert(obj);
-      });
-    }
-  }
-}
diff --git a/server/main.ts b/server/main.ts
deleted file mode 100644
index de5d825..0000000
--- a/server/main.ts
+++ /dev/null
@@ -1,4 +0,0 @@
-import { Main } from './imports/server-main/main';
-
-const mainInstance = new Main();
-mainInstance.start();
-- 
2.7.4


From 8d2d5130cb5694a79845da27fae80092a235d4d1 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:13:29 +0200
Subject: [PATCH 002/292] Step 1.2: Create index.html

---
 client/index.html | 6 ++++++
 1 file changed, 6 insertions(+)
 create mode 100644 client/index.html

diff --git a/client/index.html b/client/index.html
new file mode 100644
index 0000000..292767b
--- /dev/null
+++ b/client/index.html
@@ -0,0 +1,6 @@
+<head>
+  <base href="/">
+</head>
+<body>
+  Hello World!
+</body>
\ No newline at end of file
-- 
2.7.4


From baebcd24e6ef49254d5f4c824a16b5319dcff152 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:14:27 +0200
Subject: [PATCH 003/292] Step 1.3: Create App component

---
 client/imports/app/app.component.ts | 6 ++++++
 1 file changed, 6 insertions(+)
 create mode 100644 client/imports/app/app.component.ts

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
new file mode 100644
index 0000000..9c5caf4
--- /dev/null
+++ b/client/imports/app/app.component.ts
@@ -0,0 +1,6 @@
+import { Component } from '@angular/core';
+
+@Component({
+  selector: 'app'
+})
+export class AppComponent {}
-- 
2.7.4


From 3d0a3b82a7e81a5dba7798f26b03412da12adb1f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:14:59 +0200
Subject: [PATCH 004/292] Step 1.4: Create template for the App component

---
 client/imports/app/app.component.html | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 client/imports/app/app.component.html

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
new file mode 100644
index 0000000..c57eff5
--- /dev/null
+++ b/client/imports/app/app.component.html
@@ -0,0 +1 @@
+Hello World!
\ No newline at end of file
-- 
2.7.4


From 4c7bb9e552b5159fcaf25f8308a079277b51bb0a Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:15:41 +0200
Subject: [PATCH 005/292] Step 1.5: Implement template

---
 client/imports/app/app.component.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index 9c5caf4..91e1a06 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -1,6 +1,9 @@
 import { Component } from '@angular/core';
 
+import template from './app.component.html';
+
 @Component({
-  selector: 'app'
+  selector: 'app',
+  template
 })
 export class AppComponent {}
-- 
2.7.4


From 8a8eb072322427c74f13c0c063354b34b0caed6f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:16:18 +0200
Subject: [PATCH 006/292] Step 1.6: Add App component to index.html

---
 client/index.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/index.html b/client/index.html
index 292767b..4e8596c 100644
--- a/client/index.html
+++ b/client/index.html
@@ -2,5 +2,5 @@
   <base href="/">
 </head>
 <body>
-  Hello World!
+  <app>Loading...</app>
 </body>
\ No newline at end of file
-- 
2.7.4


From 6e79a61c2931770dc8c1713d730fa297be88dbeb Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:19:05 +0200
Subject: [PATCH 007/292] Step 1.7: Create AppModule

---
 client/imports/app/app.module.ts | 9 +++++++++
 1 file changed, 9 insertions(+)
 create mode 100644 client/imports/app/app.module.ts

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
new file mode 100644
index 0000000..6eda2d2
--- /dev/null
+++ b/client/imports/app/app.module.ts
@@ -0,0 +1,9 @@
+import { NgModule } from '@angular/core';
+import { BrowserModule } from '@angular/platform-browser';
+
+@NgModule({
+  imports: [
+    BrowserModule
+  ]
+})
+export class AppModule {}
\ No newline at end of file
-- 
2.7.4


From e48f334d8d30cd8c8ee358dddc83a39c830ecd86 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:20:10 +0200
Subject: [PATCH 008/292] Step 1.8: Add App component to App module

---
 client/imports/app/app.module.ts | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 6eda2d2..50a22d6 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -1,9 +1,17 @@
 import { NgModule } from '@angular/core';
 import { BrowserModule } from '@angular/platform-browser';
 
+import { AppComponent } from './app.component';
+
 @NgModule({
   imports: [
     BrowserModule
+  ],
+  declarations: [
+    AppComponent
+  ],
+  bootstrap: [
+    AppComponent
   ]
 })
 export class AppModule {}
\ No newline at end of file
-- 
2.7.4


From ff7083f6270385d1ffc556940d80b3ecbbfa0ec3 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 16:22:46 +0200
Subject: [PATCH 009/292] Step 1.9: Create main entry point

---
 client/main.ts | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 client/main.ts

diff --git a/client/main.ts b/client/main.ts
new file mode 100644
index 0000000..c5323fd
--- /dev/null
+++ b/client/main.ts
@@ -0,0 +1,8 @@
+import 'angular2-meteor-polyfills';
+
+import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
+
+import { AppModule } from './imports/app/app.module';
+
+const platform = platformBrowserDynamic();
+platform.bootstrapModule(AppModule);
\ No newline at end of file
-- 
2.7.4


From b288d617ca1097e8869129ef0b89e431ca23a6b4 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Mon, 10 Oct 2016 21:50:06 -0200
Subject: [PATCH 010/292] Step 1: Bootstrapping

---
 steps/step1.md | 355 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 355 insertions(+)
 create mode 100644 steps/step1.md

diff --git a/steps/step1.md b/steps/step1.md
new file mode 100644
index 0000000..b68e1b4
--- /dev/null
+++ b/steps/step1.md
@@ -0,0 +1,355 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Bootstrapping
+
+Let's start building our Angular 2.0 Meteor Socially app.
+
+In this step, we will:
+
+- Setup Meteor and create a working app
+- Become familiar with the app's structure
+- Connect an Angular 2 front end
+- Run the application in the browser
+
+# Meteor Setup
+
+First step — let's install Meteor!
+
+Open your command line and paste this command:
+
+    $ curl https://install.meteor.com/ | sh
+
+
+> If you are on a Windows machine, go [here](https://www.meteor.com/install) to install Meteor.
+
+Now let's create our app — write this in the command line:
+
+    $ meteor create --example angular2-boilerplate socially
+
+> Alternatively, use your web browser to access the link:
+>
+>    https://github.com/bsliran/angular2-meteor-base
+>
+> Download the template application, and unzip the files inside. Rename the folder to "socially" and place it into the default directory.
+
+Now let's see what we've got. Go into the new folder:
+
+    $ cd socially
+
+Now, we install npm packages:
+
+    $ meteor npm install
+
+(Note: More explanation on NPM packages on the bottom of the page)
+
+Run the app like so:
+
+    $ meteor
+
+    => Started proxy
+    => Started MongoDB.
+    => Started your app.
+    >=> App running at: http://localhost:3000/
+
+Now go to [http://localhost:3000/](http://localhost:3000/)
+and look at the amazing app that's running on your computer!
+
+We now have a fully functional app which includes both a server and a client!
+
+We are going to add our own files for this tutorial. So let's start by deleting all the contents in these three folders:
+
+    - /client             (delete)
+    - /both               (delete)
+    - /server             (delete)
+
+Now we can start building our app.
+
+Create a new `index.html` file in the client folder, and place this code inside. Then run the app again.
+
+[{]: <helper> (diff_step 1.2)
+#### Step 1.2: Create index.html
+
+##### Added client/index.html
+```diff
+@@ -0,0 +1,6 @@
++┊ ┊1┊<head>
++┊ ┊2┊  <base href="/">
++┊ ┊3┊</head>
++┊ ┊4┊<body>
++┊ ┊5┊  Hello World!
++┊ ┊6┊</body>🚫↵
+```
+[}]: #
+
+And Meteor build tool refreshes automatically and our app is updated in the browser.
+
+Note that there is no `<html>` tag in our code.
+
+This is because of how Meteor structures and serves files to the client.
+
+Meteor scans all the HTML files in your application and concatenates them together to make it simpler for us.
+
+Concatenation means merging the content of all `HTML`, `HEAD` and `BODY` tags found inside these HTML files together.
+
+So in our case, Meteor found our `index.html` file, recognized it was meant for the client only (because it's inside the `client` folder), found the `BODY` tag inside and added it's content to the `BODY` tag of the main generated file.
+
+> (`right-click` -> `inspect element` on the page to see the generated file Meteor served to the client)
+
+## Typescript
+
+An Angular 2 Meteor app can be written in regular JavaScript (ES5), the new JavaScript (ES2015 aka ES6) or TypeScript on both the server and the client.
+
+TypeScript is the recommended choice by the Angular team so in this tutorial, we'll be using TypeScript.
+
+Don't worry if you're not familiar with TypeScript. Valid ES6 or ES5 JavaScript is a valid TypeScript and we will explain new concepts when we would need them in the tutorial.
+
+> If you'd like to deep dive into TypeScript, we recommend the [official tutorial](http://www.typescriptlang.org/Tutorial).
+
+To start, we need to make sure our `tsconfig.json` file (in our root directory) has the basic configurations below which are required to run an Angular 2.0 Meteor app.
+
+```json
+{
+  "compilerOptions": {
+    "target": "es5",
+    "module": "commonjs",
+    "isolatedModules": false,
+    "moduleResolution": "node",
+    "experimentalDecorators": true,
+    "emitDecoratorMetadata": true,
+    "removeComments": false,
+    "noImplicitAny": false,
+    "sourceMap": true
+  },
+  "exclude": [
+    "node_modules"
+  ],
+  "compileOnSave": false
+}
+```
+
+To learn more about Typescript compiler options, [click here](http://www.typescriptlang.org/docs/handbook/compiler-options.html).
+
+### TypeScript Typings
+
+We need to let Typescript know about all the types in the libraries we depend upon.
+
+In order to do that — thus adding full type-checking support at this stage — we'll use a special tool for typings installation
+and management called `typings`. You can find more information about it [here](https://github.com/typings/typings).
+
+If you look into the typings folder, you'll find there a definition file called `index.d.ts`.
+
+This is a top level definition file that links all other definition files installed by `typings`.
+
+> Note that in some cases, your IDE can mark your code as "error" or "warning" because of missing Typings - this will not prevent you from running your app, but it is highly recommended to resolve those errors.
+
+> Also in order to be able to use typings properly, it is recommended to install [node.js](https://nodejs.org).
+
+# Root Component
+
+Angular 2 code is structured as a tree of components.
+
+Each component is a controller with an attached view.
+
+Since it's a tree, there should be a root component and branch components
+that stem out of it. So let's create our root component.
+
+Create a new `app.component.ts` file inside of the `client` folder.
+
+[{]: <helper> (diff_step 1.3)
+#### Step 1.3: Create App component
+
+##### Added client/imports/app/app.component.ts
+```diff
+@@ -0,0 +1,6 @@
++┊ ┊1┊import { Component } from '@angular/core';
++┊ ┊2┊
++┊ ┊3┊@Component({
++┊ ┊4┊  selector: 'app'
++┊ ┊5┊})
++┊ ┊6┊export class AppComponent {}
+```
+[}]: #
+
+First we're importing the dependency we needed from `@angular/core`.
+
+Notice, the Component's selector matches the `<app>` tag we will provide in `index.html` below, and the View template creates the view.
+
+The class, AppComponent, inherits from `@Component` which is part of Angular 2.
+
+We have defined the component, let's create the template:
+
+[{]: <helper> (diff_step 1.4)
+#### Step 1.4: Create template for the App component
+
+##### Added client/imports/app/app.component.html
+```diff
+@@ -0,0 +1 @@
++┊ ┊1┊Hello World!🚫↵
+```
+[}]: #
+
+Now, we can use it inside of the component:
+
+[{]: <helper> (diff_step 1.5)
+#### Step 1.5: Implement template
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -1,6 +1,9 @@
+ ┊1┊1┊import { Component } from '@angular/core';
+ ┊2┊2┊
++┊ ┊3┊import template from './app.component.html';
++┊ ┊4┊
+ ┊3┊5┊@Component({
+-┊4┊ ┊  selector: 'app'
++┊ ┊6┊  selector: 'app',
++┊ ┊7┊  template
+ ┊5┊8┊})
+ ┊6┊9┊export class AppComponent {}
+```
+[}]: #
+
+**About templates**
+
+Thanks to `angular2-compilers` package, we can import any html file into TypeScript space as a module.
+"But what we get from that module?" You ask. The answer is simply, it's a string. `angular2-compilers` converts html file's contents into string.
+
+> Since a component doesn't exist without its template, **we recommend** you to use a ***template as a string*** method, instead of loading it asynchronously (`templateUrl`).
+
+> In our opinion, this is the best practice of creating components.
+
+Finally, we can `bootstrap` our component, thus, marking it as the root component.
+
+First thing to do is to add `<app/>` element to the `<body/>`:
+
+[{]: <helper> (diff_step 1.6)
+#### Step 1.6: Add App component to index.html
+
+##### Changed client/index.html
+```diff
+@@ -2,5 +2,5 @@
+ ┊2┊2┊  <base href="/">
+ ┊3┊3┊</head>
+ ┊4┊4┊<body>
+-┊5┊ ┊  Hello World!
++┊ ┊5┊  <app>Loading...</app>
+ ┊6┊6┊</body>🚫↵
+```
+[}]: #
+
+Great! Now we have our root component, we will need to create NgModule.
+
+NgModule defines the Angular2 module - it's external modules that in use, declarations, providers, exports and defines the main component to bootstrap.
+
+You can read more about NgModule in [Angular 2 documentation](https://angular.io/docs/ts/latest/guide/ngmodule.html).
+
+Let's create our NgModule:
+
+[{]: <helper> (diff_step 1.7)
+#### Step 1.7: Create AppModule
+
+##### Added client/imports/app/app.module.ts
+```diff
+@@ -0,0 +1,9 @@
++┊ ┊1┊import { NgModule } from '@angular/core';
++┊ ┊2┊import { BrowserModule } from '@angular/platform-browser';
++┊ ┊3┊
++┊ ┊4┊@NgModule({
++┊ ┊5┊  imports: [
++┊ ┊6┊    BrowserModule
++┊ ┊7┊  ]
++┊ ┊8┊})
++┊ ┊9┊export class AppModule {}🚫↵
+```
+[}]: #
+
+> We will import `BrowserModule` which is the basic and internal Component we will use later in our view templates.
+
+And let's declare our `AppComponent` and add it as root component that needed to be bootstraped:
+
+[{]: <helper> (diff_step 1.8)
+#### Step 1.8: Add App component to App module
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -1,9 +1,17 @@
+ ┊ 1┊ 1┊import { NgModule } from '@angular/core';
+ ┊ 2┊ 2┊import { BrowserModule } from '@angular/platform-browser';
+ ┊ 3┊ 3┊
++┊  ┊ 4┊import { AppComponent } from './app.component';
++┊  ┊ 5┊
+ ┊ 4┊ 6┊@NgModule({
+ ┊ 5┊ 7┊  imports: [
+ ┊ 6┊ 8┊    BrowserModule
++┊  ┊ 9┊  ],
++┊  ┊10┊  declarations: [
++┊  ┊11┊    AppComponent
++┊  ┊12┊  ],
++┊  ┊13┊  bootstrap: [
++┊  ┊14┊    AppComponent
+ ┊ 7┊15┊  ]
+ ┊ 8┊16┊})
+ ┊ 9┊17┊export class AppModule {}🚫↵
+```
+[}]: #
+
+Now we need to create an entry point for project - we will create it directly under `client` directory, because we wan't this file to be loaded when Meteor start's our project.
+
+The main entry file uses Angular 2 `bootstrapModule` with our new NgModule:
+
+[{]: <helper> (diff_step 1.9)
+#### Step 1.9: Create main entry point
+
+##### Added client/main.ts
+```diff
+@@ -0,0 +1,8 @@
++┊ ┊1┊import 'angular2-meteor-polyfills';
++┊ ┊2┊
++┊ ┊3┊import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
++┊ ┊4┊
++┊ ┊5┊import { AppModule } from './imports/app/app.module';
++┊ ┊6┊
++┊ ┊7┊const platform = platformBrowserDynamic();
++┊ ┊8┊platform.bootstrapModule(AppModule);🚫↵
+```
+[}]: #
+
+Now let's run the app:
+
+    $ meteor
+
+> If the template doesn't change, it may be because your browser is caching the original template.
+> Learn [how to disable caching during development](https://developer.chrome.com/devtools/docs/settings) in Chrome.
+
+And we have our first Angular 2.0 Meteor app working!
+
+Let's go through some of the technologies we used till now:
+
+# npm
+
+Npm stands for Node Packages Manager, which manages your dependencies and external packages.
+
+Meteor supports NPM packages (starting from 1.3), and when we created our project - a file named `package.json` was created - this file contains the project's npm dependencies and some other metadata.
+
+To install the current project dependencies, type in the command line `npm install`.
+
+We also used Meteor packages (`meteor add ...`).  Meteor packages have some abilities that npm packages don't have yet so we will use some packages from there as well.
+
+## ES6 Modules and CommonJS
+
+Meteor supports [ES6 modules](https://developer.mozilla.org/en/docs/web/javascript/reference/statements/import) out of the box.
+
+This feature provides the ability to use `import` / `export` statements and gives you a full control for modules loading and dependencies.
+
+You can read more about how modules work and how it's based on CommonJS [on the Meteor docs](http://docs.meteor.com/#/full/modules).
+
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Intro](../README.md) | [Next Step >](step2.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 236ce573928ca593bd2729cd6bd83b0185bfff4a Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:02:38 +0200
Subject: [PATCH 011/292] Step 2.1: Add static HTML to the main component view

---
 client/imports/app/app.component.html | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index c57eff5..9ea318e 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1 +1,14 @@
-Hello World!
\ No newline at end of file
+<ul>
+  <li>
+    <span>Dubstep-Free Zone</span>
+    <p>
+      Can we please just for an evening not listen to dubstep.
+    </p>
+  </li>
+  <li>
+    <span>All dubstep all the time</span>
+    <p>
+      Get it on!
+    </p>
+  </li>
+</ul>
\ No newline at end of file
-- 
2.7.4


From e2393d96bc8041e1c75c08067bd9a75bc56015ce Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Mon, 10 Oct 2016 22:02:54 -0200
Subject: [PATCH 012/292] Step 2: Static Template

---
 steps/step2.md | 43 +++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 43 insertions(+)
 create mode 100644 steps/step2.md

diff --git a/steps/step2.md b/steps/step2.md
new file mode 100644
index 0000000..2dd6aec
--- /dev/null
+++ b/steps/step2.md
@@ -0,0 +1,43 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Static Template
+
+Let's create a purely static HTML page and then examine how we can turn this HTML code into a template that Angular will use to dynamically display the same result with any set of data.
+
+Add this template HTML to `app.html`:
+
+[{]: <helper> (diff_step 2.1)
+#### Step 2.1: Add static HTML to the main component view
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1 +1,14 @@
+-┊ 1┊  ┊Hello World!🚫↵
++┊  ┊ 1┊<ul>
++┊  ┊ 2┊  <li>
++┊  ┊ 3┊    <span>Dubstep-Free Zone</span>
++┊  ┊ 4┊    <p>
++┊  ┊ 5┊      Can we please just for an evening not listen to dubstep.
++┊  ┊ 6┊    </p>
++┊  ┊ 7┊  </li>
++┊  ┊ 8┊  <li>
++┊  ┊ 9┊    <span>All dubstep all the time</span>
++┊  ┊10┊    <p>
++┊  ┊11┊      Get it on!
++┊  ┊12┊    </p>
++┊  ┊13┊  </li>
++┊  ┊14┊</ul>🚫↵
+```
+[}]: #
+
+In the next step we will learn how to dynamically generate the same list using Angular 2.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step1.md) | [Next Step >](step3.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 74a27418b73a53e9b8ed28b1fc535190a899f8e6 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:04:31 +0200
Subject: [PATCH 013/292] Step 3.1: Add dynamic html to the App component

---
 client/imports/app/app.component.html | 23 +++++++++--------------
 1 file changed, 9 insertions(+), 14 deletions(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index 9ea318e..b750655 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,14 +1,9 @@
-<ul>
-  <li>
-    <span>Dubstep-Free Zone</span>
-    <p>
-      Can we please just for an evening not listen to dubstep.
-    </p>
-  </li>
-  <li>
-    <span>All dubstep all the time</span>
-    <p>
-      Get it on!
-    </p>
-  </li>
-</ul>
\ No newline at end of file
+<div>
+  <ul>
+    <li *ngFor="let party of parties">
+      {{party.name}}
+      <p>{{party.description}}</p>
+      <p>{{party.location}}</p>
+    </li>
+  </ul>
+</div>
\ No newline at end of file
-- 
2.7.4


From 6ab6febfd4f3aa8e26b6aed6196fc3b19bd5176c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:05:17 +0200
Subject: [PATCH 014/292] Step 3.2: Load parties data into app

---
 client/imports/app/app.component.ts | 21 ++++++++++++++++++++-
 1 file changed, 20 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index 91e1a06..834d1ea 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -6,4 +6,23 @@ import template from './app.component.html';
   selector: 'app',
   template
 })
-export class AppComponent {}
+export class AppComponent {
+  parties: any[];
+
+  constructor() {
+    this.parties = [
+      {'name': 'Dubstep-Free Zone',
+        'description': 'Can we please just for an evening not listen to dubstep.',
+        'location': 'Palo Alto'
+      },
+      {'name': 'All dubstep all the time',
+        'description': 'Get it on!',
+        'location': 'Palo Alto'
+      },
+      {'name': 'Savage lounging',
+        'description': 'Leisure suit required. And only fiercest manners.',
+        'location': 'San Francisco'
+      }
+    ];
+  }
+}
-- 
2.7.4


From 2caf38d9a41b0b3ff89d60c95b59964413c67469 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 10:01:29 -0200
Subject: [PATCH 015/292] Step 3: Dynamic Template

---
 steps/step3.md | 128 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 128 insertions(+)
 create mode 100644 steps/step3.md

diff --git a/steps/step3.md b/steps/step3.md
new file mode 100644
index 0000000..e7dc0bd
--- /dev/null
+++ b/steps/step3.md
@@ -0,0 +1,128 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Dynamic Template
+
+Now it's time to make the web page dynamic — with Angular 2.
+
+This step will still be focusing on client side Angular tools. The next one will show you how to get the full stack power of Meteor.
+
+# Data in the View
+
+In Angular, the view is a projection of the model through the HTML template. This means that whenever the model changes, Angular refreshes the appropriate binding points, which updates the view.
+
+Let's change our template to be dynamic:
+
+[{]: <helper> (diff_step 3.1)
+#### Step 3.1: Add dynamic html to the App component
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,14 +1,9 @@
+-┊ 1┊  ┊<ul>
+-┊ 2┊  ┊  <li>
+-┊ 3┊  ┊    <span>Dubstep-Free Zone</span>
+-┊ 4┊  ┊    <p>
+-┊ 5┊  ┊      Can we please just for an evening not listen to dubstep.
+-┊ 6┊  ┊    </p>
+-┊ 7┊  ┊  </li>
+-┊ 8┊  ┊  <li>
+-┊ 9┊  ┊    <span>All dubstep all the time</span>
+-┊10┊  ┊    <p>
+-┊11┊  ┊      Get it on!
+-┊12┊  ┊    </p>
+-┊13┊  ┊  </li>
+-┊14┊  ┊</ul>🚫↵
++┊  ┊ 1┊<div>
++┊  ┊ 2┊  <ul>
++┊  ┊ 3┊    <li *ngFor="let party of parties">
++┊  ┊ 4┊      undefined
++┊  ┊ 5┊      <p>undefined</p>
++┊  ┊ 6┊      <p>undefined</p>
++┊  ┊ 7┊    </li>
++┊  ┊ 8┊  </ul>
++┊  ┊ 9┊</div>🚫↵
+```
+[}]: #
+
+We replaced the hard-coded party list with the [NgFor](https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html) directive and two Angular expressions:
+
+- The `*ngFor="let party of parties"` attribute in the `li` tag is an Angular repeater directive. The repeater tells Angular to create a `li` element for each party in the list using the `li` tag as the template.
+- The expressions wrapped in the double curly braces ( `undefinedparty.name}}` and `undefinedparty.description}}` ) will be replaced by the value of the expressions.
+
+Angular 2 has _common_ directives that provide additional functionality to HTML. These include `ngFor`, `ngIf`, `ngClass`, _form_ directives (which will be heavily used on the 4th step) and more found in the [`@angular/common`](https://angular.io/docs/ts/latest/api/common/) package. Those common directives are globally available in every component template so you don't need to import them manually into the component's view, in comparison to a custom directive or routing directives.
+
+# Component data
+
+Now we are going to create our initial data model and render it in the view.
+This code will go inside of our AppComponent class [`constructor`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor). A constructor is a function that runs when a class is loaded, thus it loads the initial data for the class.
+
+We can attach data with the context `this`, referring to the AppComponent class.
+
+[{]: <helper> (diff_step 3.2)
+#### Step 3.2: Load parties data into app
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -6,4 +6,23 @@
+ ┊ 6┊ 6┊  selector: 'app',
+ ┊ 7┊ 7┊  template
+ ┊ 8┊ 8┊})
+-┊ 9┊  ┊export class AppComponent {}
++┊  ┊ 9┊export class AppComponent {
++┊  ┊10┊  parties: any[];
++┊  ┊11┊
++┊  ┊12┊  constructor() {
++┊  ┊13┊    this.parties = [
++┊  ┊14┊      {'name': 'Dubstep-Free Zone',
++┊  ┊15┊        'description': 'Can we please just for an evening not listen to dubstep.',
++┊  ┊16┊        'location': 'Palo Alto'
++┊  ┊17┊      },
++┊  ┊18┊      {'name': 'All dubstep all the time',
++┊  ┊19┊        'description': 'Get it on!',
++┊  ┊20┊        'location': 'Palo Alto'
++┊  ┊21┊      },
++┊  ┊22┊      {'name': 'Savage lounging',
++┊  ┊23┊        'description': 'Leisure suit required. And only fiercest manners.',
++┊  ┊24┊        'location': 'San Francisco'
++┊  ┊25┊      }
++┊  ┊26┊    ];
++┊  ┊27┊  }
++┊  ┊28┊}
+```
+[}]: #
+
+Run the app again.
+
+    $ meteor
+
+You'll see the data model, parties, is now instantiated within the AppComponent component.
+
+As you probably noticed, we defined `parties` with a `any[]`. Little disclaimer. That's a TypeScript specific thing and it's called Type.
+
+What `parties: any[]` means? It tells to your IDE and TypeScript compiler that `parties` property is an array of any value. It could be an Object, Number etc.
+
+In one of next chapters we will explain to you a lot more about [Types](http://www.typescriptlang.org/Handbook#basic-types).
+
+Without this your IDE or console would say something like:
+
+    client/app.ts (13, 8): Property 'parties' does not exist on type 'AppComponent'.
+
+Although we haven't done much, we connected the dots between the presentation, the data, and the business logic.
+
+# Summary
+
+You now have a dynamic app that features a full component.
+
+But, this is still all client side — which is nice for tutorials, but in a real application we need to persist the data on the server and sync all the clients with it.
+
+So, let's go to the next step to learn how to bind our application to the great power of Meteor.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step2.md) | [Next Step >](step4.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 5ddc37af3a49f1390ddcd744bb2c00aaa1f31355 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:35:10 +0200
Subject: [PATCH 016/292] Step 4.1: Add Parties collection

---
 both/collections/parties.collection.ts | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 both/collections/parties.collection.ts

diff --git a/both/collections/parties.collection.ts b/both/collections/parties.collection.ts
new file mode 100644
index 0000000..65011f1
--- /dev/null
+++ b/both/collections/parties.collection.ts
@@ -0,0 +1,3 @@
+import { MongoObservable } from 'meteor-rxjs';
+
+export const Parties = new MongoObservable.Collection('parties');
-- 
2.7.4


From fb1d1044503a55f6c65014f912631497fa2e6036 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:36:03 +0200
Subject: [PATCH 017/292] Step 4.2: Import Parties collection

---
 client/imports/app/app.component.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index 834d1ea..b41b7c6 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -1,5 +1,7 @@
 import { Component } from '@angular/core';
 
+import { Parties } from '../../both/collections/parties.collection';
+
 import template from './app.component.html';
 
 @Component({
-- 
2.7.4


From 9fa945e36fb458607f8d9ec57df37d4708f41f3d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:38:50 +0200
Subject: [PATCH 018/292] Step 4.3: Bind MongoObservable to Angular

---
 client/imports/app/app.component.ts | 18 +++---------------
 1 file changed, 3 insertions(+), 15 deletions(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index b41b7c6..ef11c40 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -1,4 +1,5 @@
 import { Component } from '@angular/core';
+import { Observable } from 'rxjs/Observable';
 
 import { Parties } from '../../both/collections/parties.collection';
 
@@ -9,22 +10,9 @@ import template from './app.component.html';
   template
 })
 export class AppComponent {
-  parties: any[];
+  parties: Observable<any[]>;
 
   constructor() {
-    this.parties = [
-      {'name': 'Dubstep-Free Zone',
-        'description': 'Can we please just for an evening not listen to dubstep.',
-        'location': 'Palo Alto'
-      },
-      {'name': 'All dubstep all the time',
-        'description': 'Get it on!',
-        'location': 'Palo Alto'
-      },
-      {'name': 'Savage lounging',
-        'description': 'Leisure suit required. And only fiercest manners.',
-        'location': 'San Francisco'
-      }
-    ];
+    this.parties = Parties.find({}).zone();
   }
 }
-- 
2.7.4


From 6acfce2b0c867e46329865c2dda35e6b0bc56d90 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:42:21 +0200
Subject: [PATCH 019/292] Step 4.4: Use AsyncPipe

---
 client/imports/app/app.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index b750655..cc8d5c5 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,6 +1,6 @@
 <div>
   <ul>
-    <li *ngFor="let party of parties">
+    <li *ngFor="let party of parties | async">
       {{party.name}}
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
-- 
2.7.4


From 8dce4963845e08b93bbf415c7fcfefb63bec89a4 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:40:42 +0200
Subject: [PATCH 020/292] Step 4.5: Add initial Parties

---
 server/imports/fixtures/parties.ts | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)
 create mode 100644 server/imports/fixtures/parties.ts

diff --git a/server/imports/fixtures/parties.ts b/server/imports/fixtures/parties.ts
new file mode 100644
index 0000000..63b055b
--- /dev/null
+++ b/server/imports/fixtures/parties.ts
@@ -0,0 +1,21 @@
+import { Parties } from '../../../both/collections/parties.collection';
+
+export function loadParties() {
+  if (Parties.find().cursor.count() === 0) {
+    const parties = [{
+      name: 'Dubstep-Free Zone',
+      description: 'Can we please just for an evening not listen to dubstep.',
+      location: 'Palo Alto'
+    }, {
+      name: 'All dubstep all the time',
+      description: 'Get it on!',
+      location: 'Palo Alto'
+    }, {
+      name: 'Savage lounging',
+      description: 'Leisure suit required. And only fiercest manners.',
+      location: 'San Francisco'
+    }];
+
+    parties.forEach((party) => Parties.insert(party));
+  }
+}
\ No newline at end of file
-- 
2.7.4


From f654d9ffa7cc43edd60f897d7fa839c9c0cf9273 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:41:39 +0200
Subject: [PATCH 021/292] Step 4.6: Load initial Parties

---
 server/main.ts | 7 +++++++
 1 file changed, 7 insertions(+)
 create mode 100644 server/main.ts

diff --git a/server/main.ts b/server/main.ts
new file mode 100644
index 0000000..cf58a8d
--- /dev/null
+++ b/server/main.ts
@@ -0,0 +1,7 @@
+import { Meteor } from 'meteor/meteor';
+
+import { loadParties } from './imports/fixtures/parties';
+
+Meteor.startup(() => {
+  loadParties();
+});
-- 
2.7.4


From 6be2d81f25ca716c067aca8acc85f015de2cef43 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:51:56 +0200
Subject: [PATCH 022/292] Step 4.7: Define Party interface

---
 both/models/party.model.ts | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 both/models/party.model.ts

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
new file mode 100644
index 0000000..388567d
--- /dev/null
+++ b/both/models/party.model.ts
@@ -0,0 +1,5 @@
+export interface Party {
+  name: string;
+  description: string;
+  location: string;
+}
-- 
2.7.4


From 271759323f8058d06d9f3a6931eece1722083e88 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:53:05 +0200
Subject: [PATCH 023/292] Step 4.8: Add Party type to Parties collection

---
 both/collections/parties.collection.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/both/collections/parties.collection.ts b/both/collections/parties.collection.ts
index 65011f1..8146c60 100644
--- a/both/collections/parties.collection.ts
+++ b/both/collections/parties.collection.ts
@@ -1,3 +1,5 @@
 import { MongoObservable } from 'meteor-rxjs';
 
-export const Parties = new MongoObservable.Collection('parties');
+import { Party } from '../models/party.model';
+
+export const Parties = new MongoObservable.Collection<Party>('parties');
-- 
2.7.4


From fda25e4e0eaeeab3d13e05f848e29b0e3486e113 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:53:54 +0200
Subject: [PATCH 024/292] Step 4.9: Add Party type to data fixtures

---
 server/imports/fixtures/parties.ts | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/server/imports/fixtures/parties.ts b/server/imports/fixtures/parties.ts
index 63b055b..4f6d555 100644
--- a/server/imports/fixtures/parties.ts
+++ b/server/imports/fixtures/parties.ts
@@ -1,8 +1,9 @@
 import { Parties } from '../../../both/collections/parties.collection';
+import { Party } from '../../../both/models/party.model';
 
 export function loadParties() {
   if (Parties.find().cursor.count() === 0) {
-    const parties = [{
+    const parties: Party[] = [{
       name: 'Dubstep-Free Zone',
       description: 'Can we please just for an evening not listen to dubstep.',
       location: 'Palo Alto'
@@ -16,6 +17,6 @@ export function loadParties() {
       location: 'San Francisco'
     }];
 
-    parties.forEach((party) => Parties.insert(party));
+    parties.forEach((party: Party) => Parties.insert(party));
   }
 }
\ No newline at end of file
-- 
2.7.4


From bca7674979024d9baa1ef3ab40084e7f7c7b8195 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 17:54:22 +0200
Subject: [PATCH 025/292] Step 4.10: Add Party type to App component

---
 client/imports/app/app.component.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index ef11c40..dde38a4 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -2,6 +2,7 @@ import { Component } from '@angular/core';
 import { Observable } from 'rxjs/Observable';
 
 import { Parties } from '../../both/collections/parties.collection';
+import { Party } from '../../both/models/party.model';
 
 import template from './app.component.html';
 
@@ -10,7 +11,7 @@ import template from './app.component.html';
   template
 })
 export class AppComponent {
-  parties: Observable<any[]>;
+  parties: Observable<Party[]>;
 
   constructor() {
     this.parties = Parties.find({}).zone();
-- 
2.7.4


From 4c3e80d21baf63dd7afa267aeb383a1c2fca669c Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 11:03:00 -0200
Subject: [PATCH 026/292] Step 4: 3-way data binding

---
 steps/step4.md | 401 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 401 insertions(+)
 create mode 100644 steps/step4.md

diff --git a/steps/step4.md b/steps/step4.md
new file mode 100644
index 0000000..58f5f1e
--- /dev/null
+++ b/steps/step4.md
@@ -0,0 +1,401 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# 3-way data binding
+
+Now we have a client side application that creates and renders its own data.
+
+So, if we were in any framework other than Meteor, we would likely start implementing a series of REST endpoints to connect the server to the client.
+We would also need to create a database and functions to connect to it.
+
+And we haven't even talked about real-time, in which case we would need to add sockets, a local DB for cache and handle latency compensation (or just ignore those features and create a not-so-good or less modern app...)
+
+But luckily, we use Meteor!
+
+# Data Model and Reactivity in Meteor
+
+Meteor makes writing distributed client code as simple as talking to a local database.
+
+Every Meteor client includes an in-memory database cache. To manage the client cache, the server publishes sets of JSON documents, and the client subscribes to these sets. As documents in a set change, the server patches each client's cache automatically.
+
+That introduces us to a new concept — *Full Stack Reactivity*.
+
+In an Angular-ish language we might call it *3 way data binding*.
+
+The way to handle data in Meteor is through the [`Mongo.Collection`](http://docs.meteor.com/#/full/mongo_collection) class. It is used to declare MongoDB collections and manipulate them.
+
+Thanks to [MiniMongo](https://atmospherejs.com/meteor/minimongo), Meteor's client-side Mongo emulator, `Mongo.Collection` can be used from both client and server code.
+
+In short, Meteor core's setup has:
+
+- real-time reactivity through web sockets
+- two databases. One on the client for fast changes, another behind the server for official changes
+- a special protocol (called DDP) that synchronizes data between two databases
+- a bunch of small things that make creating an app with Meteor easier and more developer friendly!
+
+# RxJS and MongoObservable
+
+Angular2-Meteor team also provides an additional package called `meteor-rxjs` which wraps Meteor's original API, and returns RxJs `Observable` instead of using callbacks or promises.
+
+`Observable` is very similar to `Promise`, only it has a continuation flow - which means a multiple `resolve`s.
+
+The lifecycle of `Observable` is built on three parts:
+
+- `next` - called each time the Observable changes.
+- `error` - called on error.
+- `complete` - calls when the data flow is done.
+
+If we try to connect it to our Meteor world and the world of Mongo Collection, so each time a Collection changes - the `next` callback called, and `complete` should not be called because we are using reactive data and we will always waiting for more updates.
+
+We will use this package instead of Meteor's API, because Angular 2 supports RxJS `Observable`s, and provides great features for those who uses it for their application - starting from iterating on object and a faster change detection.
+
+You can read more about `Observable`s and RxJS [here](http://reactivex.io/documentation/observable.html).
+
+> Note that RxJS documentation might be a little intimidating at the beginning - if you having difficult with it - try to read the examples we use in this tutorials and it's might help you.
+
+# Declare a Collection
+
+So first, let's define our first parties collection that will store all our parties.
+
+We will use `MongoObservable` static methods to declare the Collection:
+
+So add a file `both/collections/parties.collection.ts`:
+
+[{]: <helper> (diff_step 4.1)
+#### Step 4.10: Add Party type to App component
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -2,6 +2,7 @@
+ ┊2┊2┊import { Observable } from 'rxjs/Observable';
+ ┊3┊3┊
+ ┊4┊4┊import { Parties } from '../../both/collections/parties.collection';
++┊ ┊5┊import { Party } from '../../both/models/party.model';
+ ┊5┊6┊
+ ┊6┊7┊import template from './app.component.html';
+ ┊7┊8┊
+```
+```diff
+@@ -10,7 +11,7 @@
+ ┊10┊11┊  template
+ ┊11┊12┊})
+ ┊12┊13┊export class AppComponent {
+-┊13┊  ┊  parties: Observable<any[]>;
++┊  ┊14┊  parties: Observable<Party[]>;
+ ┊14┊15┊
+ ┊15┊16┊  constructor() {
+ ┊16┊17┊    this.parties = Parties.find({}).zone();
+```
+[}]: #
+
+We've just created a file called `parties.collection.ts`, that contains a CommonJS module called `both/collections/parties`.
+
+This work is done by the TypeScript compiler behind the scenes.
+
+The TypeScript compiler converts `.ts` files to ES5, then registers a CommonJS module with the same name as the relative path to the file in the app.
+
+That's why we use the special word `export`. We are telling CommonJS that we are allowing the object to be exported from this module into the outside world.
+
+Meteor has a series of special folder names, including the `client` folder. All files within a folder named `client` are loaded on the client only. Likewise, files in a folder called `server` are loaded on the server only.
+
+Placing the `both` folder outside of any special folder, makes its contents available to both the client and the server. Therefore, the `parties` collection (and the actions on it) will run on both the client (minimongo) and the server (Mongo).
+
+Though we only declared our model once, we have two modules that declare two versions of our parties collection:
+one for client-side and one for server-side. This is often referred to as "isomorphic" or "universal javascript". All synchronization between these two versions of collections is handled by Meteor.
+
+# Binding Meteor to Angular
+
+Now that we've created the collection, our client needs to subscribe to it's changes and bind it to our `this.parties` array.
+
+Because we use `MongoObservable.Collection` instead of regular Meteor Collection, Angular 2 can easily support this type of data object, and iterate it without any modifications.
+
+Let's import the `Parties` from collections:
+
+[{]: <helper> (diff_step 4.2)
+#### Step 4.2: Import Parties collection
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -1,5 +1,7 @@
+ ┊1┊1┊import { Component } from '@angular/core';
+ ┊2┊2┊
++┊ ┊3┊import { Parties } from '../../both/collections/parties.collection';
++┊ ┊4┊
+ ┊3┊5┊import template from './app.component.html';
+ ┊4┊6┊
+ ┊5┊7┊@Component({
+```
+[}]: #
+
+And now we will create a query on our Collection, and because we used `MongoObservable`, the return value of `find` will be a `Observable<any[]>` - which is an `Observable` that contains an array of Objects.
+
+And let's bind to the `Observable`:
+
+[{]: <helper> (diff_step 4.3)
+#### Step 4.3: Bind MongoObservable to Angular
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -1,4 +1,5 @@
+ ┊1┊1┊import { Component } from '@angular/core';
++┊ ┊2┊import { Observable } from 'rxjs/Observable';
+ ┊2┊3┊
+ ┊3┊4┊import { Parties } from '../../both/collections/parties.collection';
+ ┊4┊5┊
+```
+```diff
+@@ -9,22 +10,9 @@
+ ┊ 9┊10┊  template
+ ┊10┊11┊})
+ ┊11┊12┊export class AppComponent {
+-┊12┊  ┊  parties: any[];
++┊  ┊13┊  parties: Observable<any[]>;
+ ┊13┊14┊
+ ┊14┊15┊  constructor() {
+-┊15┊  ┊    this.parties = [
+-┊16┊  ┊      {'name': 'Dubstep-Free Zone',
+-┊17┊  ┊        'description': 'Can we please just for an evening not listen to dubstep.',
+-┊18┊  ┊        'location': 'Palo Alto'
+-┊19┊  ┊      },
+-┊20┊  ┊      {'name': 'All dubstep all the time',
+-┊21┊  ┊        'description': 'Get it on!',
+-┊22┊  ┊        'location': 'Palo Alto'
+-┊23┊  ┊      },
+-┊24┊  ┊      {'name': 'Savage lounging',
+-┊25┊  ┊        'description': 'Leisure suit required. And only fiercest manners.',
+-┊26┊  ┊        'location': 'San Francisco'
+-┊27┊  ┊      }
+-┊28┊  ┊    ];
++┊  ┊16┊    this.parties = Parties.find({}).zone();
+ ┊29┊17┊  }
+ ┊30┊18┊}
+```
+[}]: #
+
+> We used `zone()` method which is a wrapper for the regular `Observable` that do some *Magic* and connects the collection changes into our view using our Component's `Zone`.
+
+Because of that, we now need to add `AsyncPipe`:
+
+[{]: <helper> (diff_step 4.4)
+#### Step 4.4: Use AsyncPipe
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,6 +1,6 @@
+ ┊1┊1┊<div>
+ ┊2┊2┊  <ul>
+-┊3┊ ┊    <li *ngFor="let party of parties">
++┊ ┊3┊    <li *ngFor="let party of parties | async">
+ ┊4┊4┊      undefined
+ ┊5┊5┊      <p>undefined</p>
+ ┊6┊6┊      <p>undefined</p>
+```
+[}]: #
+
+# Inserting Parties from the Console
+
+At this point we've implemented a rendering of a list of parties on the page.
+Now it's time to check if the code above really works; it shouldn't just render that list, but also render all
+changes to the database on the page reactively.
+
+In Mongo terminology, items inside collections are called documents. So, let's insert some documents into our collection by using the server database console.
+
+In a new terminal tab, go to your app directory and type:
+
+    meteor mongo
+
+This opens a console into your app's local development database using [Mongo shell](https://docs.mongodb.org/manual/reference/mongo-shell/). At the prompt, type:
+
+    db.parties.insert({ name: "A new party", description: "From the mongo console!", location: "In the DB" });
+
+In your web browser, you will see the UI of your app immediately update to show the new party.
+You can see that we didn't have to write any code to connect the server-side database to our front-end code — it just happened automatically.
+
+Insert a few more parties from the database console with different text.
+
+Now let's do the same but with "remove". At the prompt, type the following command to look at all the parties and their properties:
+
+    db.parties.find({});
+
+Choose one party you want to remove and copy its 'id' property.
+Then, remove it using that id (replace 'N4KzMEvtm4dYvk2TF' with your party's id value):
+
+    db.parties.remove({"_id": ObjectId("N4KzMEvtm4dYvk2TF")});
+
+Again, you will see the UI of your app immediately updates with that party removed.
+
+Feel free to try running more actions like updating an object from the console, and so on.
+
+# Initializing Data on Server Side
+
+Until now we've been inserting party documents to our collection using the Mongo console.
+
+It would be convenient though to have some initial data pre-loaded into our database.
+
+So, let's initialize our server with the same parties as we had before.
+
+Let's create a file `server/imports/fixtures/parties.ts` and implement `loadParties` method inside to load parties:
+
+[{]: <helper> (diff_step 4.5)
+#### Step 4.5: Add initial Parties
+
+##### Added server/imports/fixtures/parties.ts
+```diff
+@@ -0,0 +1,21 @@
++┊  ┊ 1┊import { Parties } from '../../../both/collections/parties.collection';
++┊  ┊ 2┊
++┊  ┊ 3┊export function loadParties() {
++┊  ┊ 4┊  if (Parties.find().cursor.count() === 0) {
++┊  ┊ 5┊    const parties = [{
++┊  ┊ 6┊      name: 'Dubstep-Free Zone',
++┊  ┊ 7┊      description: 'Can we please just for an evening not listen to dubstep.',
++┊  ┊ 8┊      location: 'Palo Alto'
++┊  ┊ 9┊    }, {
++┊  ┊10┊      name: 'All dubstep all the time',
++┊  ┊11┊      description: 'Get it on!',
++┊  ┊12┊      location: 'Palo Alto'
++┊  ┊13┊    }, {
++┊  ┊14┊      name: 'Savage lounging',
++┊  ┊15┊      description: 'Leisure suit required. And only fiercest manners.',
++┊  ┊16┊      location: 'San Francisco'
++┊  ┊17┊    }];
++┊  ┊18┊
++┊  ┊19┊    parties.forEach((party) => Parties.insert(party));
++┊  ┊20┊  }
++┊  ┊21┊}🚫↵
+```
+[}]: #
+
+Then create `main.ts` to run this method on Meteor startup:
+
+[{]: <helper> (diff_step 4.6)
+#### Step 4.6: Load initial Parties
+
+##### Added server/main.ts
+```diff
+@@ -0,0 +1,7 @@
++┊ ┊1┊import { Meteor } from 'meteor/meteor';
++┊ ┊2┊
++┊ ┊3┊import { loadParties } from './imports/fixtures/parties';
++┊ ┊4┊
++┊ ┊5┊Meteor.startup(() => {
++┊ ┊6┊  loadParties();
++┊ ┊7┊});
+```
+[}]: #
+
+To make it fully TypeScript compatible, we need to define `Party` interface:
+
+[{]: <helper> (diff_step 4.7)
+#### Step 4.7: Define Party interface
+
+##### Added both/models/party.model.ts
+```diff
+@@ -0,0 +1,5 @@
++┊ ┊1┊export interface Party {
++┊ ┊2┊  name: string;
++┊ ┊3┊  description: string;
++┊ ┊4┊  location: string;
++┊ ┊5┊}
+```
+[}]: #
+
+And add it in few places:
+
+[{]: <helper> (diff_step 4.8)
+#### Step 4.8: Add Party type to Parties collection
+
+##### Changed both/collections/parties.collection.ts
+```diff
+@@ -1,3 +1,5 @@
+ ┊1┊1┊import { MongoObservable } from 'meteor-rxjs';
+ ┊2┊2┊
+-┊3┊ ┊export const Parties = new MongoObservable.Collection('parties');
++┊ ┊3┊import { Party } from '../models/party.model';
++┊ ┊4┊
++┊ ┊5┊export const Parties = new MongoObservable.Collection<Party>('parties');
+```
+[}]: #
+
+[{]: <helper> (diff_step 4.9)
+#### Step 4.9: Add Party type to data fixtures
+
+##### Changed server/imports/fixtures/parties.ts
+```diff
+@@ -1,8 +1,9 @@
+ ┊1┊1┊import { Parties } from '../../../both/collections/parties.collection';
++┊ ┊2┊import { Party } from '../../../both/models/party.model';
+ ┊2┊3┊
+ ┊3┊4┊export function loadParties() {
+ ┊4┊5┊  if (Parties.find().cursor.count() === 0) {
+-┊5┊ ┊    const parties = [{
++┊ ┊6┊    const parties: Party[] = [{
+ ┊6┊7┊      name: 'Dubstep-Free Zone',
+ ┊7┊8┊      description: 'Can we please just for an evening not listen to dubstep.',
+ ┊8┊9┊      location: 'Palo Alto'
+```
+```diff
+@@ -16,6 +17,6 @@
+ ┊16┊17┊      location: 'San Francisco'
+ ┊17┊18┊    }];
+ ┊18┊19┊
+-┊19┊  ┊    parties.forEach((party) => Parties.insert(party));
++┊  ┊20┊    parties.forEach((party: Party) => Parties.insert(party));
+ ┊20┊21┊  }
+ ┊21┊22┊}🚫↵
+```
+[}]: #
+
+[{]: <helper> (diff_step 4.10)
+#### Step 4.10: Add Party type to App component
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -2,6 +2,7 @@
+ ┊2┊2┊import { Observable } from 'rxjs/Observable';
+ ┊3┊3┊
+ ┊4┊4┊import { Parties } from '../../both/collections/parties.collection';
++┊ ┊5┊import { Party } from '../../both/models/party.model';
+ ┊5┊6┊
+ ┊6┊7┊import template from './app.component.html';
+ ┊7┊8┊
+```
+```diff
+@@ -10,7 +11,7 @@
+ ┊10┊11┊  template
+ ┊11┊12┊})
+ ┊12┊13┊export class AppComponent {
+-┊13┊  ┊  parties: Observable<any[]>;
++┊  ┊14┊  parties: Observable<Party[]>;
+ ┊14┊15┊
+ ┊15┊16┊  constructor() {
+ ┊16┊17┊    this.parties = Parties.find({}).zone();
+```
+[}]: #
+
+Now run the app and you should see the list of parties on the screen.
+
+If not, please, run
+
+    meteor reset
+
+in order to remove all previous parties added before via the terminal.
+
+In the next step, we'll see how to add functionality to our app's UI so that we can add parties on the page.
+
+# Summary
+
+In this chapter you saw how easy and fast it is:
+
+- to create a full connection between our client data and the server using Meteor
+- to create a simple Angular 2 UI and render a Mongo collection on the page with the help of `Angular2-Meteor`
+- to load initial parties on the server side when the app launches
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step3.md) | [Next Step >](step5.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 8c0a28c402b0d114e5c22ab8f6461260029f68db Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:08:58 +0200
Subject: [PATCH 027/292] Step 5.1: Create PartiesForm component

---
 client/imports/app/parties/parties-form.component.ts | 9 +++++++++
 1 file changed, 9 insertions(+)
 create mode 100644 client/imports/app/parties/parties-form.component.ts

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
new file mode 100644
index 0000000..36df898
--- /dev/null
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -0,0 +1,9 @@
+import { Component } from '@angular/core';
+
+import template from './parties-form.component.html';
+
+@Component({
+  selector: 'parties-form',
+  template
+})
+export class PartiesFormComponent {}
-- 
2.7.4


From 08f7fc30f86355c8ff550de6408de99ca9bd1b07 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:10:01 +0200
Subject: [PATCH 028/292] Step 5.2: Create template of PartiesForm

---
 client/imports/app/parties/parties-form.component.html | 12 ++++++++++++
 1 file changed, 12 insertions(+)
 create mode 100644 client/imports/app/parties/parties-form.component.html

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
new file mode 100644
index 0000000..4f908e7
--- /dev/null
+++ b/client/imports/app/parties/parties-form.component.html
@@ -0,0 +1,12 @@
+<form>
+  <label>Name</label>
+  <input type="text">
+
+  <label>Description</label>
+  <input type="text">
+
+  <label>Location</label>
+  <input type="text">
+  
+  <button>Add</button>
+</form>
\ No newline at end of file
-- 
2.7.4


From da65eba4c6bc98325406b5e97aef87a47f13b530 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:10:46 +0200
Subject: [PATCH 029/292] Step 5.3: Add PartiesForm to App

---
 client/imports/app/app.component.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index cc8d5c5..9e780a4 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,4 +1,6 @@
 <div>
+  <parties-form></parties-form>
+  
   <ul>
     <li *ngFor="let party of parties | async">
       {{party.name}}
-- 
2.7.4


From fa807969d24549a0765245f636bef89fe9405c21 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:13:04 +0200
Subject: [PATCH 030/292] Step 5.4: Create index for parties with declarations

---
 client/imports/app/parties/index.ts | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 client/imports/app/parties/index.ts

diff --git a/client/imports/app/parties/index.ts b/client/imports/app/parties/index.ts
new file mode 100644
index 0000000..c5e7e18
--- /dev/null
+++ b/client/imports/app/parties/index.ts
@@ -0,0 +1,5 @@
+import { PartiesFormComponent } from './parties-form.component';
+
+export const PARTIES_DECLARATIONS = [
+  PartiesFormComponent
+];
-- 
2.7.4


From 4a4fc3f1f0e9d9e8b437753c9a365cc530d80ced Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:13:23 +0200
Subject: [PATCH 031/292] Step 5.5: Add parties declarations to AppModule

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 50a22d6..e3a487a 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -2,13 +2,15 @@ import { NgModule } from '@angular/core';
 import { BrowserModule } from '@angular/platform-browser';
 
 import { AppComponent } from './app.component';
+import { PARTIES_DECLARATIONS } from './parties';
 
 @NgModule({
   imports: [
     BrowserModule
   ],
   declarations: [
-    AppComponent
+    AppComponent,
+    ...PARTIES_DECLARATIONS
   ],
   bootstrap: [
     AppComponent
-- 
2.7.4


From a4fdbcdf50e189befe65406357f6d888807476e9 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:14:46 +0200
Subject: [PATCH 032/292] Step 5.6: Import Forms modules

---
 client/imports/app/app.module.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index e3a487a..8e8c303 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -1,12 +1,15 @@
 import { NgModule } from '@angular/core';
 import { BrowserModule } from '@angular/platform-browser';
+import { FormsModule, ReactiveFormsModule } from '@angular/forms';
 
 import { AppComponent } from './app.component';
 import { PARTIES_DECLARATIONS } from './parties';
 
 @NgModule({
   imports: [
-    BrowserModule
+    BrowserModule,
+    FormsModule,
+    ReactiveFormsModule
   ],
   declarations: [
     AppComponent,
-- 
2.7.4


From 43b3b8b3a099e183b86234d17a8a657544997eea Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:17:31 +0200
Subject: [PATCH 033/292] Step 5.7: Create form model

---
 client/imports/app/parties/parties-form.component.ts | 19 +++++++++++++++++--
 1 file changed, 17 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index 36df898..d98ae60 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -1,4 +1,5 @@
-import { Component } from '@angular/core';
+import { Component, OnInit } from '@angular/core';
+import { FormGroup, FormBuilder } from '@angular/forms';
 
 import template from './parties-form.component.html';
 
@@ -6,4 +7,18 @@ import template from './parties-form.component.html';
   selector: 'parties-form',
   template
 })
-export class PartiesFormComponent {}
+export class PartiesFormComponent implements OnInit {
+  addForm: FormGroup;
+
+  constructor(
+    private formBuilder: FormBuilder
+  ) {}
+
+  ngOnInit() {
+    this.addForm = this.formBuilder.group({
+      name: [],
+      description: [],
+      location: []
+    });
+  }
+}
-- 
2.7.4


From ff55ff4a1a44798778be07d31672f3a5538c7edf Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:18:39 +0200
Subject: [PATCH 034/292] Step 5.8: Implement form directives

---
 client/imports/app/parties/parties-form.component.html | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index 4f908e7..d707240 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -1,12 +1,12 @@
-<form>
+<form [formGroup]="addForm">
   <label>Name</label>
-  <input type="text">
+  <input type="text" formControlName="name">
 
   <label>Description</label>
-  <input type="text">
+  <input type="text" formControlName="description">
 
   <label>Location</label>
-  <input type="text">
+  <input type="text" formControlName="location">
   
-  <button>Add</button>
+  <button type="submit">Add</button>
 </form>
\ No newline at end of file
-- 
2.7.4


From ce81a52de81d0cf5a1591050c6da3ad1991e06e6 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:19:25 +0200
Subject: [PATCH 035/292] Step 5.9: Add validators

---
 client/imports/app/parties/parties-form.component.ts | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index d98ae60..bb47f4b 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -1,5 +1,5 @@
 import { Component, OnInit } from '@angular/core';
-import { FormGroup, FormBuilder } from '@angular/forms';
+import { FormGroup, FormBuilder, Validators } from '@angular/forms';
 
 import template from './parties-form.component.html';
 
@@ -16,9 +16,9 @@ export class PartiesFormComponent implements OnInit {
 
   ngOnInit() {
     this.addForm = this.formBuilder.group({
-      name: [],
+      name: ['', Validators.required],
       description: [],
-      location: []
+      location: ['', Validators.required]
     });
   }
 }
-- 
2.7.4


From 824270b6ddff7974621d5a3260ac80633bb5e230 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:20:00 +0200
Subject: [PATCH 036/292] Step 5.10: Add ngSubmit to the form

---
 client/imports/app/parties/parties-form.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index d707240..98f90ca 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -1,4 +1,4 @@
-<form [formGroup]="addForm">
+<form [formGroup]="addForm" (ngSubmit)="addParty()">
   <label>Name</label>
   <input type="text" formControlName="name">
 
-- 
2.7.4


From 61cdc2f95b9f9692339870e1b18cdf1cca96a79a Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:23:47 +0200
Subject: [PATCH 037/292] Step 5.11: Add addParty method

---
 client/imports/app/parties/parties-form.component.ts | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index bb47f4b..511812d 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -1,6 +1,8 @@
 import { Component, OnInit } from '@angular/core';
 import { FormGroup, FormBuilder, Validators } from '@angular/forms';
 
+import { Parties } from '../../../../both/collections/parties.collection';
+
 import template from './parties-form.component.html';
 
 @Component({
@@ -21,4 +23,12 @@ export class PartiesFormComponent implements OnInit {
       location: ['', Validators.required]
     });
   }
+
+  addParty(): void {
+    if (this.addForm.valid) {
+      Parties.insert(this.addForm.value);
+
+      this.addForm.reset();
+    }
+  }
 }
-- 
2.7.4


From 95a35f59c2df79b787ae406fae6e6ae11f15c601 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:24:18 +0200
Subject: [PATCH 038/292] Step 5.12: Add remove button

---
 client/imports/app/app.component.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index 9e780a4..0820d66 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -6,6 +6,7 @@
       {{party.name}}
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
+      <button (click)="removeParty(party)">X</button>
     </li>
   </ul>
 </div>
\ No newline at end of file
-- 
2.7.4


From aa21763420849d9ab953638a484d0c93f871d37f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:25:25 +0200
Subject: [PATCH 039/292] Step 5.13: Implement removeParty method

---
 client/imports/app/app.component.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index dde38a4..dbff991 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -16,4 +16,8 @@ export class AppComponent {
   constructor() {
     this.parties = Parties.find({}).zone();
   }
+
+  removeParty(party: Party): void {
+    Parties.remove(party._id);
+  }
 }
-- 
2.7.4


From 9824ab0b5bb370e82469ab2ec34069a896b8a660 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:26:25 +0200
Subject: [PATCH 040/292] Step 5.14: Create CollectionObject model

---
 both/models/collection-object.model.ts | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 both/models/collection-object.model.ts

diff --git a/both/models/collection-object.model.ts b/both/models/collection-object.model.ts
new file mode 100644
index 0000000..f83638e
--- /dev/null
+++ b/both/models/collection-object.model.ts
@@ -0,0 +1,3 @@
+export interface CollectionObject {
+  _id?: string;
+}
\ No newline at end of file
-- 
2.7.4


From 927135e1802b1756ddcb6fb4c1331023183f5d66 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:27:11 +0200
Subject: [PATCH 041/292] Step 5.15: Extend Party by CollectionObject model

---
 both/models/party.model.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
index 388567d..fd5a709 100644
--- a/both/models/party.model.ts
+++ b/both/models/party.model.ts
@@ -1,4 +1,6 @@
-export interface Party {
+import { CollectionObject } from './collection-object.model';
+
+export interface Party extends CollectionObject {
   name: string;
   description: string;
   location: string;
-- 
2.7.4


From 3fd3e4c47450b2b587198350e68e6809d2bc97fb Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 11:36:52 -0200
Subject: [PATCH 042/292] Step 5: Adding/removing objects and Angular event
 handling

---
 steps/step5.md | 515 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 515 insertions(+)
 create mode 100644 steps/step5.md

diff --git a/steps/step5.md b/steps/step5.md
new file mode 100644
index 0000000..dcf6964
--- /dev/null
+++ b/steps/step5.md
@@ -0,0 +1,515 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Adding/removing objects and Angular event handling
+
+Now that we have full data binding from server to client, let's interact with the data and see the updates in action.
+
+In this chapter we are going to:
+
+- create a new component to add or remove a party
+- learn about model-driven forms and create one
+- learn how to hook up form events to component methods
+- implement adding & removing party event handlers
+
+First, let's create a simple form with a button that will add a new party.
+
+# Component Architecture
+
+In Angular 2, we build a tree of components with the root `App` component and
+child components stemming out of it down to the leaves.
+
+Let's make a new component called `PartiesFormComponent`, and put it inside `parties` directory on the client-side (`client/imports/app/parties`).
+
+> Notice that we are placing the file inside the `imports` folder.  
+> That is another Meteor special folder name that tells Meteor to load the modules inside it just when some other module is importing it.  
+
+[{]: <helper> (diff_step 5.1)
+#### Step 5.15: Extend Party by CollectionObject model
+
+##### Changed both/models/party.model.ts
+```diff
+@@ -1,4 +1,6 @@
+-┊1┊ ┊export interface Party {
++┊ ┊1┊import { CollectionObject } from './collection-object.model';
++┊ ┊2┊
++┊ ┊3┊export interface Party extends CollectionObject {
+ ┊2┊4┊  name: string;
+ ┊3┊5┊  description: string;
+ ┊4┊6┊  location: string;
+```
+[}]: #
+
+Notice that we are exporting the class `PartiesFormComponent` using ES6 module syntax.
+As a result, you'll be able to import `PartiesFormComponent` in any other component as follows:
+
+    import { PartiesFormComponent } from 'client/imports/app/parties/parties-form.component';
+
+By exporting and importing different modules, you create a modular structure of your app in ES6,
+which is similar to the modules in other script languages like Python.
+This is what makes programming in ES6 really awesome since application structure comes out rigid and clear.
+
+Let's add a template for the new component.
+
+Add a file with the following form:
+
+[{]: <helper> (diff_step 5.2)
+#### Step 5.2: Create template of PartiesForm
+
+##### Added client/imports/app/parties/parties-form.component.html
+```diff
+@@ -0,0 +1,12 @@
++┊  ┊ 1┊<form>
++┊  ┊ 2┊  <label>Name</label>
++┊  ┊ 3┊  <input type="text">
++┊  ┊ 4┊
++┊  ┊ 5┊  <label>Description</label>
++┊  ┊ 6┊  <input type="text">
++┊  ┊ 7┊
++┊  ┊ 8┊  <label>Location</label>
++┊  ┊ 9┊  <input type="text">
++┊  ┊10┊  
++┊  ┊11┊  <button>Add</button>
++┊  ┊12┊</form>🚫↵
+```
+[}]: #
+
+We can load the new `PartiesForm` component on the page by placing the `<parties-form>` tag in the root template `app.html`:
+
+[{]: <helper> (diff_step 5.3)
+#### Step 5.3: Add PartiesForm to App
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,4 +1,6 @@
+ ┊1┊1┊<div>
++┊ ┊2┊  <parties-form></parties-form>
++┊ ┊3┊  
+ ┊2┊4┊  <ul>
+ ┊3┊5┊    <li *ngFor="let party of parties | async">
+ ┊4┊6┊      undefined
+```
+[}]: #
+
+There is one more required step in Angular 2 to load a component - we need to declare it in the our `NgModule` so other Components know it existing and can use it.
+
+We will create a new file that `export`s an Array of `Component`s that needed to be declared in the `NgModule`:
+
+[{]: <helper> (diff_step 5.4)
+#### Step 5.4: Create index for parties with declarations
+
+##### Added client/imports/app/parties/index.ts
+```diff
+@@ -0,0 +1,5 @@
++┊ ┊1┊import { PartiesFormComponent } from './parties-form.component';
++┊ ┊2┊
++┊ ┊3┊export const PARTIES_DECLARATIONS = [
++┊ ┊4┊  PartiesFormComponent
++┊ ┊5┊];
+```
+[}]: #
+
+And now let's load this Array of `Component`s into our `NgModule`:
+
+[{]: <helper> (diff_step 5.5)
+#### Step 5.5: Add parties declarations to AppModule
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -2,13 +2,15 @@
+ ┊ 2┊ 2┊import { BrowserModule } from '@angular/platform-browser';
+ ┊ 3┊ 3┊
+ ┊ 4┊ 4┊import { AppComponent } from './app.component';
++┊  ┊ 5┊import { PARTIES_DECLARATIONS } from './parties';
+ ┊ 5┊ 6┊
+ ┊ 6┊ 7┊@NgModule({
+ ┊ 7┊ 8┊  imports: [
+ ┊ 8┊ 9┊    BrowserModule
+ ┊ 9┊10┊  ],
+ ┊10┊11┊  declarations: [
+-┊11┊  ┊    AppComponent
++┊  ┊12┊    AppComponent,
++┊  ┊13┊    ...PARTIES_DECLARATIONS
+ ┊12┊14┊  ],
+ ┊13┊15┊  bootstrap: [
+ ┊14┊16┊    AppComponent
+```
+[}]: #
+
+> The `...` is part of ES2016 language - it spreads the array like it was not an array, you can read more about it [here](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Operators/Spread_operator).
+
+Now we have our parties-form directive showing on our app.
+
+# Angular 2 Forms
+
+Now let's get back to the form and make it functional.
+
+## Model-Driven Forms
+
+In order to use features of Angular 2 for Forms - we need to import `FormsModule` into our `NgModule`, so let's do it:
+
+[{]: <helper> (diff_step 5.6)
+#### Step 5.6: Import Forms modules
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -1,12 +1,15 @@
+ ┊ 1┊ 1┊import { NgModule } from '@angular/core';
+ ┊ 2┊ 2┊import { BrowserModule } from '@angular/platform-browser';
++┊  ┊ 3┊import { FormsModule, ReactiveFormsModule } from '@angular/forms';
+ ┊ 3┊ 4┊
+ ┊ 4┊ 5┊import { AppComponent } from './app.component';
+ ┊ 5┊ 6┊import { PARTIES_DECLARATIONS } from './parties';
+ ┊ 6┊ 7┊
+ ┊ 7┊ 8┊@NgModule({
+ ┊ 8┊ 9┊  imports: [
+-┊ 9┊  ┊    BrowserModule
++┊  ┊10┊    BrowserModule,
++┊  ┊11┊    FormsModule,
++┊  ┊12┊    ReactiveFormsModule
+ ┊10┊13┊  ],
+ ┊11┊14┊  declarations: [
+ ┊12┊15┊    AppComponent,
+```
+[}]: #
+
+> Full documentation of `FormsModule` and a comprehensive tutorial is located [here](https://angular.io/docs/ts/latest/guide/forms.html).
+
+Let's construct our form model. There is a special class for this called [`FormBuilder`](https://angular.io/docs/ts/latest/api/common/FormBuilder-class.html).
+
+First, we should import necessary dependencies, then build the model and its future fields with help of the `FormBuilder` instance:
+
+[{]: <helper> (diff_step 5.7)
+#### Step 5.7: Create form model
+
+##### Changed client/imports/app/parties/parties-form.component.ts
+```diff
+@@ -1,4 +1,5 @@
+-┊1┊ ┊import { Component } from '@angular/core';
++┊ ┊1┊import { Component, OnInit } from '@angular/core';
++┊ ┊2┊import { FormGroup, FormBuilder } from '@angular/forms';
+ ┊2┊3┊
+ ┊3┊4┊import template from './parties-form.component.html';
+ ┊4┊5┊
+```
+```diff
+@@ -6,4 +7,18 @@
+ ┊ 6┊ 7┊  selector: 'parties-form',
+ ┊ 7┊ 8┊  template
+ ┊ 8┊ 9┊})
+-┊ 9┊  ┊export class PartiesFormComponent {}
++┊  ┊10┊export class PartiesFormComponent implements OnInit {
++┊  ┊11┊  addForm: FormGroup;
++┊  ┊12┊
++┊  ┊13┊  constructor(
++┊  ┊14┊    private formBuilder: FormBuilder
++┊  ┊15┊  ) {}
++┊  ┊16┊
++┊  ┊17┊  ngOnInit() {
++┊  ┊18┊    this.addForm = this.formBuilder.group({
++┊  ┊19┊      name: [],
++┊  ┊20┊      description: [],
++┊  ┊21┊      location: []
++┊  ┊22┊    });
++┊  ┊23┊  }
++┊  ┊24┊}
+```
+[}]: #
+
+  > As you probably noticed, we used OnInit interface. It brings the ngOnInit method.
+  It initialize the directive/component after Angular initializes the data-bound input properties.
+  Angular will find and call methods like ngOnInit(), with or without the interfaces.
+  Nonetheless, we strongly recommend adding interfaces to TypeScript directive classes in order to benefit from strong typing and editor tooling.
+
+`FormGroup` is a set of `FormControl`s.
+
+Alternatively, we could write:
+
+    this.addForm = new FormGroup({
+      name: new FormControl()
+    });
+
+The first value provided is the initial value for the form control. For example:
+
+    this.addForm = this.formBuilder.group({
+      name: ['Bob']
+    });
+
+will initialize name to _Bob_ value.
+
+We can use `addForm.value` to access current state of the model:
+
+    console.log(this.addForm.value);
+    > { name: '', description: '', location: ''}
+
+We could also access the control values individually.
+
+    console.log(this.addForm.controls.name.value);
+    > ''
+
+Now let's move to the template. We have to bind to `formGroup` and add `formControlName` directives to our inputs.
+
+[{]: <helper> (diff_step 5.8)
+#### Step 5.8: Implement form directives
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -1,12 +1,12 @@
+-┊ 1┊  ┊<form>
++┊  ┊ 1┊<form [formGroup]="addForm">
+ ┊ 2┊ 2┊  <label>Name</label>
+-┊ 3┊  ┊  <input type="text">
++┊  ┊ 3┊  <input type="text" formControlName="name">
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊  <label>Description</label>
+-┊ 6┊  ┊  <input type="text">
++┊  ┊ 6┊  <input type="text" formControlName="description">
+ ┊ 7┊ 7┊
+ ┊ 8┊ 8┊  <label>Location</label>
+-┊ 9┊  ┊  <input type="text">
++┊  ┊ 9┊  <input type="text" formControlName="location">
+ ┊10┊10┊  
+-┊11┊  ┊  <button>Add</button>
++┊  ┊11┊  <button type="submit">Add</button>
+ ┊12┊12┊</form>🚫↵
+```
+[}]: #
+
+By `formGroup` we provide an instance of the `FormGroup`, in our case this is the `addForm`.
+
+But what about those `formControlName` directives? As you can see, we implemented them with values that match our `addForm` structure. Each `formControlName` binds value of a form element to the model.
+
+Now each time the user types inside these inputs, the value of the `addForm` and its controls will be automatically updated.
+
+Conversely, if `addForm` is changed outside of the HTML, the input values will be updated accordingly.
+
+Since `name` and `location` are required fields in our model, let's set up validation.
+
+In Angular2, it's less then easy, just add [`Validators.required`](https://angular.io/docs/ts/latest/api/common/Validators-class.html) as a second parameter to a required control:
+
+[{]: <helper> (diff_step 5.9)
+#### Step 5.9: Add validators
+
+##### Changed client/imports/app/parties/parties-form.component.ts
+```diff
+@@ -1,5 +1,5 @@
+ ┊1┊1┊import { Component, OnInit } from '@angular/core';
+-┊2┊ ┊import { FormGroup, FormBuilder } from '@angular/forms';
++┊ ┊2┊import { FormGroup, FormBuilder, Validators } from '@angular/forms';
+ ┊3┊3┊
+ ┊4┊4┊import template from './parties-form.component.html';
+ ┊5┊5┊
+```
+```diff
+@@ -16,9 +16,9 @@
+ ┊16┊16┊
+ ┊17┊17┊  ngOnInit() {
+ ┊18┊18┊    this.addForm = this.formBuilder.group({
+-┊19┊  ┊      name: [],
++┊  ┊19┊      name: ['', Validators.required],
+ ┊20┊20┊      description: [],
+-┊21┊  ┊      location: []
++┊  ┊21┊      location: ['', Validators.required]
+ ┊22┊22┊    });
+ ┊23┊23┊  }
+ ┊24┊24┊}
+```
+[}]: #
+
+We can check `addForm.valid` property to determine if the form is valid:  
+
+    console.log(this.addForm.valid)
+    > false
+
+
+## Event Handlers
+
+### (ngSubmit)
+
+We just set up the form and synchronized it with the form model.
+
+Let's start adding new parties to the `Parties` collection.
+Before we start, we create a new submit button and a form submit event handler.
+
+It's worth mentioning one more great feature that appeared in Angular 2.
+It's possible now to define and use local variables in a template.
+
+For example, if we were using `Template-driven Forms`, to add a party we would need to take the
+current state of the form and pass it to an event handler.
+We could take the form and print it inside the template:
+
+    <form #f="ngForm">
+        ...
+        undefined
+    </form>
+
+you'll see something like:
+
+    {name: '', description: '', location: ''}
+
+which is exactly what we would need — the form model object.
+
+Since we decided to use `Model-driven Forms` we won't use it, but I think it's worth to mention because of its simplicity and power.
+
+Back to the tutorial!
+
+Let's bind a submit event to the add button.
+
+This event will trigger if the button is clicked, or if the user presses enter on the final field.
+
+[{]: <helper> (diff_step 5.10)
+#### Step 5.10: Add ngSubmit to the form
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -1,4 +1,4 @@
+-┊1┊ ┊<form [formGroup]="addForm">
++┊ ┊1┊<form [formGroup]="addForm" (ngSubmit)="addParty()">
+ ┊2┊2┊  <label>Name</label>
+ ┊3┊3┊  <input type="text" formControlName="name">
+```
+[}]: #
+
+In Angular 2, events are indicated by the round bracket () syntax. Here we are telling Angular to call a method `addParty` on submit. Let's add the addParty method to our PartiesFormComponent class.
+
+[{]: <helper> (diff_step 5.11)
+#### Step 5.11: Add addParty method
+
+##### Changed client/imports/app/parties/parties-form.component.ts
+```diff
+@@ -1,6 +1,8 @@
+ ┊1┊1┊import { Component, OnInit } from '@angular/core';
+ ┊2┊2┊import { FormGroup, FormBuilder, Validators } from '@angular/forms';
+ ┊3┊3┊
++┊ ┊4┊import { Parties } from '../../../../both/collections/parties.collection';
++┊ ┊5┊
+ ┊4┊6┊import template from './parties-form.component.html';
+ ┊5┊7┊
+ ┊6┊8┊@Component({
+```
+```diff
+@@ -21,4 +23,12 @@
+ ┊21┊23┊      location: ['', Validators.required]
+ ┊22┊24┊    });
+ ┊23┊25┊  }
++┊  ┊26┊
++┊  ┊27┊  addParty(): void {
++┊  ┊28┊    if (this.addForm.valid) {
++┊  ┊29┊      Parties.insert(this.addForm.value);
++┊  ┊30┊
++┊  ┊31┊      this.addForm.reset();
++┊  ┊32┊    }
++┊  ┊33┊  }
+ ┊24┊34┊}
+```
+[}]: #
+
+> Note: TypeScript doesn't know which controls properties are available so we have to put them in the squery brackets.
+
+Open a different browser, fill out the form, submit and see how the party is added on both clients.
+
+## Types
+
+In order to get a better coded application, we will use the power of TypeScript and declare our types, models and interfaces of the database objects.
+
+First, we will get warning and errors from the TypeScript compiler, and we also get great IDE support if you uses WebStorm or VSCode.
+
+So first, let's create a base model for our database entities, which contains the `_id` field:
+
+[{]: <helper> (diff_step 5.14)
+#### Step 5.14: Create CollectionObject model
+
+##### Added both/models/collection-object.model.ts
+```diff
+@@ -0,0 +1,3 @@
++┊ ┊1┊export interface CollectionObject {
++┊ ┊2┊  _id?: string;
++┊ ┊3┊}🚫↵
+```
+[}]: #
+
+And let's create a model for a single `Party` object:
+
+[{]: <helper> (diff_step 5.15)
+#### Step 5.15: Extend Party by CollectionObject model
+
+##### Changed both/models/party.model.ts
+```diff
+@@ -1,4 +1,6 @@
+-┊1┊ ┊export interface Party {
++┊ ┊1┊import { CollectionObject } from './collection-object.model';
++┊ ┊2┊
++┊ ┊3┊export interface Party extends CollectionObject {
+ ┊2┊4┊  name: string;
+ ┊3┊5┊  description: string;
+ ┊4┊6┊  location: string;
+```
+[}]: #
+
+We will later use those to indicate the types of our collection and objects in the UI.
+
+### (click)
+
+Now, let's add the ability to delete parties.
+
+Let's add an X button to each party in our party list:
+
+[{]: <helper> (diff_step 5.12)
+#### Step 5.12: Add remove button
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -6,6 +6,7 @@
+ ┊ 6┊ 6┊      undefined
+ ┊ 7┊ 7┊      <p>undefined</p>
+ ┊ 8┊ 8┊      <p>undefined</p>
++┊  ┊ 9┊      <button (click)="removeParty(party)">X</button>
+ ┊ 9┊10┊    </li>
+ ┊10┊11┊  </ul>
+ ┊11┊12┊</div>🚫↵
+```
+[}]: #
+
+Here again, we are binding an event to the class context and passing in the party as a parameter.
+
+Let's go into the class and add that method.
+
+Add the method inside the AppComponent class in `app.component.ts`:
+
+[{]: <helper> (diff_step 5.13)
+#### Step 5.13: Implement removeParty method
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -16,4 +16,8 @@
+ ┊16┊16┊  constructor() {
+ ┊17┊17┊    this.parties = Parties.find({}).zone();
+ ┊18┊18┊  }
++┊  ┊19┊
++┊  ┊20┊  removeParty(party: Party): void {
++┊  ┊21┊    Parties.remove(party._id);
++┊  ┊22┊  }
+ ┊19┊23┊}
+```
+[}]: #
+
+The Mongo Collection Parties has a method called "remove". We search for the relevant party by its identifier, `_id`, and delete it.
+
+Now try to delete a few parties. Since Meteor syncs data between clients, you can also watch them being removed from other browser clients.
+
+# Summary
+
+In this chapter we've seen:
+
+- How easy it is to create a form and access its data using Angular 2's power.
+- How easy it is to save that data to the storage using Meteor's power.
+- How to declare TypeScript interfaces and models.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step4.md) | [Next Step >](step6.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 5706a087af130e6b4f83d933077af1b4b56088c8 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:31:20 +0200
Subject: [PATCH 043/292] Step 6.1: Create PartiesList component

---
 .../imports/app/parties/parties-list.component.ts  | 23 ++++++++++++++++++++++
 1 file changed, 23 insertions(+)
 create mode 100644 client/imports/app/parties/parties-list.component.ts

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
new file mode 100644
index 0000000..bb09b1c
--- /dev/null
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -0,0 +1,23 @@
+import { Component } from '@angular/core';
+import { Observable } from 'rxjs/Observable';
+
+import { Parties } from '../../../../both/collections/parties.collection';
+import { Party } from '../../../../both/models/party.model';
+
+import template from './parties-list.component.html';
+
+@Component({
+  selector: 'parties-list',
+  template
+})
+export class PartiesListComponent {
+  parties: Observable<Party[]>;
+
+  constructor() {
+    this.parties = Parties.find({}).zone();
+  }
+
+  removeParty(party: Party): void {
+    Parties.remove(party._id);
+  }
+}
-- 
2.7.4


From 6affc9d71fec6c54d084d2ad3017e541b50bb2de Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:32:21 +0200
Subject: [PATCH 044/292] Step 6.2: Copy contents of app.html to PartiesList
 template

---
 client/imports/app/parties/parties-list.component.html | 12 ++++++++++++
 1 file changed, 12 insertions(+)
 create mode 100644 client/imports/app/parties/parties-list.component.html

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
new file mode 100644
index 0000000..49136a9
--- /dev/null
+++ b/client/imports/app/parties/parties-list.component.html
@@ -0,0 +1,12 @@
+<div>
+  <parties-form></parties-form>
+
+  <ul>
+    <li *ngFor="let party of parties | async">
+      {{party.name}}
+      <p>{{party.description}}</p>
+      <p>{{party.location}}</p>
+      <button (click)="removeParty(party)">X</button>
+    </li>
+  </ul>
+</div>
\ No newline at end of file
-- 
2.7.4


From 0500c7fb64499d7a17814959b5aed10a8ba64132 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:33:04 +0200
Subject: [PATCH 045/292] Step 6.3: Clean up App component

---
 client/imports/app/app.component.ts | 16 +---------------
 1 file changed, 1 insertion(+), 15 deletions(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index dbff991..91e1a06 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -1,8 +1,4 @@
 import { Component } from '@angular/core';
-import { Observable } from 'rxjs/Observable';
-
-import { Parties } from '../../both/collections/parties.collection';
-import { Party } from '../../both/models/party.model';
 
 import template from './app.component.html';
 
@@ -10,14 +6,4 @@ import template from './app.component.html';
   selector: 'app',
   template
 })
-export class AppComponent {
-  parties: Observable<Party[]>;
-
-  constructor() {
-    this.parties = Parties.find({}).zone();
-  }
-
-  removeParty(party: Party): void {
-    Parties.remove(party._id);
-  }
-}
+export class AppComponent {}
-- 
2.7.4


From 512b0b3a351110b90f8ee561c09690ffad4cc68c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:33:33 +0200
Subject: [PATCH 046/292] Step 6.4: Clean up App template

---
 client/imports/app/app.component.html | 13 +------------
 1 file changed, 1 insertion(+), 12 deletions(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index 0820d66..281c686 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,12 +1 @@
-<div>
-  <parties-form></parties-form>
-  
-  <ul>
-    <li *ngFor="let party of parties | async">
-      {{party.name}}
-      <p>{{party.description}}</p>
-      <p>{{party.location}}</p>
-      <button (click)="removeParty(party)">X</button>
-    </li>
-  </ul>
-</div>
\ No newline at end of file
+<div></div>
\ No newline at end of file
-- 
2.7.4


From 4bab6924fe93b13777537cf3a79d005910225bd7 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:34:43 +0200
Subject: [PATCH 047/292] Step 6.5: Add PartiesList to parties declarations

---
 client/imports/app/parties/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/index.ts b/client/imports/app/parties/index.ts
index c5e7e18..06ca4d7 100644
--- a/client/imports/app/parties/index.ts
+++ b/client/imports/app/parties/index.ts
@@ -1,5 +1,7 @@
 import { PartiesFormComponent } from './parties-form.component';
+import { PartiesListComponent } from './parties-list.component';
 
 export const PARTIES_DECLARATIONS = [
-  PartiesFormComponent
+  PartiesFormComponent,
+  PartiesListComponent
 ];
-- 
2.7.4


From a628ae7e95bb5d72a32f2b3734cb73d3a4b571be Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:36:34 +0200
Subject: [PATCH 048/292] Step 6.6: Define routes

---
 client/imports/app/app.routes.ts | 7 +++++++
 1 file changed, 7 insertions(+)
 create mode 100644 client/imports/app/app.routes.ts

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
new file mode 100644
index 0000000..8f6b8bb
--- /dev/null
+++ b/client/imports/app/app.routes.ts
@@ -0,0 +1,7 @@
+import { Route } from '@angular/router';
+
+import { PartiesListComponent } from './parties/parties-list.component';
+
+export const routes: Route[] = [
+  { path: '', component: PartiesListComponent }
+];
-- 
2.7.4


From eaef8f354d362af79c9e0e21939feeb878f173e3 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:37:43 +0200
Subject: [PATCH 049/292] Step 6.7: Register RouterModule

---
 client/imports/app/app.module.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 8e8c303..192c630 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -1,15 +1,18 @@
 import { NgModule } from '@angular/core';
 import { BrowserModule } from '@angular/platform-browser';
 import { FormsModule, ReactiveFormsModule } from '@angular/forms';
+import { RouterModule } from '@angular/router';
 
 import { AppComponent } from './app.component';
+import { routes } from './app.routes';
 import { PARTIES_DECLARATIONS } from './parties';
 
 @NgModule({
   imports: [
     BrowserModule,
     FormsModule,
-    ReactiveFormsModule
+    ReactiveFormsModule,
+    RouterModule.forRoot(routes)
   ],
   declarations: [
     AppComponent,
-- 
2.7.4


From 04d1ac867fa834ea6db1fb2c5261f5dd30459c18 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:39:51 +0200
Subject: [PATCH 050/292] Step 6.8: Implement routerOutlet

---
 client/imports/app/app.component.html | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index 281c686..b426778 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1 +1,3 @@
-<div></div>
\ No newline at end of file
+<div>
+  <router-outlet></router-outlet>
+</div>
\ No newline at end of file
-- 
2.7.4


From 3e3b03d1f1ae75c833970c4619fb202fed10ed58 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:46:44 +0200
Subject: [PATCH 051/292] Step 6.9: Add PartyDetails component

---
 client/imports/app/parties/party-details.component.ts | 9 +++++++++
 1 file changed, 9 insertions(+)
 create mode 100644 client/imports/app/parties/party-details.component.ts

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
new file mode 100644
index 0000000..67c86ab
--- /dev/null
+++ b/client/imports/app/parties/party-details.component.ts
@@ -0,0 +1,9 @@
+import { Component } from '@angular/core';
+
+import template from './party-details.component.html';
+
+@Component({
+  selector: 'party-details',
+  template
+})
+export class PartyDetailsComponent {}
-- 
2.7.4


From 9e2c320ecc2d81303d05ebe5d21a329e9322108c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:47:24 +0200
Subject: [PATCH 052/292] Step 6.10: Create template for PartyDetails

---
 client/imports/app/parties/party-details.component.html | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 client/imports/app/parties/party-details.component.html

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
new file mode 100644
index 0000000..a3da9f4
--- /dev/null
+++ b/client/imports/app/parties/party-details.component.html
@@ -0,0 +1,5 @@
+<header>
+  <h2>PARTY_NAME</h2>
+
+  <p>PARTY_DESCRIPTION</p>
+</header>
\ No newline at end of file
-- 
2.7.4


From 6c6f898c6c2fb0dd705adb8d4c9435c477873d97 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:48:22 +0200
Subject: [PATCH 053/292] Step 6.11: Add component to declarations

---
 client/imports/app/app.routes.ts    | 4 +++-
 client/imports/app/parties/index.ts | 4 +++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
index 8f6b8bb..fef7277 100644
--- a/client/imports/app/app.routes.ts
+++ b/client/imports/app/app.routes.ts
@@ -1,7 +1,9 @@
 import { Route } from '@angular/router';
 
 import { PartiesListComponent } from './parties/parties-list.component';
+import { PartyDetailsComponent } from './parties/party-details.component';
 
 export const routes: Route[] = [
-  { path: '', component: PartiesListComponent }
+  { path: '', component: PartiesListComponent },
+  { path: 'party/:partyId', component: PartyDetailsComponent }
 ];
diff --git a/client/imports/app/parties/index.ts b/client/imports/app/parties/index.ts
index 06ca4d7..ae09066 100644
--- a/client/imports/app/parties/index.ts
+++ b/client/imports/app/parties/index.ts
@@ -1,7 +1,9 @@
 import { PartiesFormComponent } from './parties-form.component';
 import { PartiesListComponent } from './parties-list.component';
+import { PartyDetailsComponent } from './party-details.component';
 
 export const PARTIES_DECLARATIONS = [
   PartiesFormComponent,
-  PartiesListComponent
+  PartiesListComponent,
+  PartyDetailsComponent
 ];
-- 
2.7.4


From ecc07f71e79a2d56a355af36d28cd77dddb4d33b Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:49:46 +0200
Subject: [PATCH 054/292] Step 6.12: Use routerLink in PartiesList component

---
 client/imports/app/parties/parties-list.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 49136a9..488ba09 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -3,7 +3,7 @@
 
   <ul>
     <li *ngFor="let party of parties | async">
-      {{party.name}}
+      <a [routerLink]="['/party', party._id]">{{party.name}}</a>
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
       <button (click)="removeParty(party)">X</button>
-- 
2.7.4


From 6e710d31071c89c11b9785e7c70b7dca5667cb69 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:52:55 +0200
Subject: [PATCH 055/292] Step 6.13: Subscribe to get the partyId

---
 client/imports/app/parties/party-details.component.ts | 19 +++++++++++++++++--
 1 file changed, 17 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 67c86ab..55c5b8b 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -1,4 +1,7 @@
-import { Component } from '@angular/core';
+import { Component, OnInit } from '@angular/core';
+import { ActivatedRoute } from '@angular/router';
+
+import 'rxjs/add/operator/map';
 
 import template from './party-details.component.html';
 
@@ -6,4 +9,16 @@ import template from './party-details.component.html';
   selector: 'party-details',
   template
 })
-export class PartyDetailsComponent {}
+export class PartyDetailsComponent implements OnInit {
+  partyId: string;
+
+  constructor(
+    private route: ActivatedRoute
+  ) {}
+
+  ngOnInit() {
+    this.route.params
+      .map(params => params['partyId'])
+      .subscribe(partyId => this.partyId = partyId);
+  }
+}
-- 
2.7.4


From 481aa2a41efe05a82528ed9174d6c258bd431249 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:54:26 +0200
Subject: [PATCH 056/292] Step 6.14: Unsubscribe when component is being
 destroyed

---
 client/imports/app/parties/party-details.component.ts | 12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 55c5b8b..1f2562b 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -1,5 +1,6 @@
-import { Component, OnInit } from '@angular/core';
+import { Component, OnInit, OnDestroy } from '@angular/core';
 import { ActivatedRoute } from '@angular/router';
+import { Subscription } from 'rxjs/Subscription';
 
 import 'rxjs/add/operator/map';
 
@@ -9,16 +10,21 @@ import template from './party-details.component.html';
   selector: 'party-details',
   template
 })
-export class PartyDetailsComponent implements OnInit {
+export class PartyDetailsComponent implements OnInit, OnDestroy {
   partyId: string;
+  paramsSub: Subscription;
 
   constructor(
     private route: ActivatedRoute
   ) {}
 
   ngOnInit() {
-    this.route.params
+    this.paramsSub = this.route.params
       .map(params => params['partyId'])
       .subscribe(partyId => this.partyId = partyId);
   }
+
+  ngOnDestroy() {
+    this.paramsSub.unsubscribe();
+  }
 }
-- 
2.7.4


From cf60fcbb4ac623e93733f7593362b84735cbb0da Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:57:48 +0200
Subject: [PATCH 057/292] Step 6.15: Load party details

---
 client/imports/app/parties/party-details.component.ts | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 1f2562b..6c53448 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -1,9 +1,12 @@
 import { Component, OnInit, OnDestroy } from '@angular/core';
 import { ActivatedRoute } from '@angular/router';
-import { Subscription } from 'rxjs/Subscription';
+import { Subscription } from 'rxjs/Subscription'; 
 
 import 'rxjs/add/operator/map';
 
+import { Parties } from '../../../../both/collections/parties.collection';
+import { Party } from '../../../../both/models/party.model';
+
 import template from './party-details.component.html';
 
 @Component({
@@ -13,6 +16,7 @@ import template from './party-details.component.html';
 export class PartyDetailsComponent implements OnInit, OnDestroy {
   partyId: string;
   paramsSub: Subscription;
+  party: Party;
 
   constructor(
     private route: ActivatedRoute
@@ -21,7 +25,11 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
   ngOnInit() {
     this.paramsSub = this.route.params
       .map(params => params['partyId'])
-      .subscribe(partyId => this.partyId = partyId);
+      .subscribe(partyId => {
+        this.partyId = partyId
+        
+        this.party = Parties.findOne(this.partyId);
+      });
   }
 
   ngOnDestroy() {
-- 
2.7.4


From 5b753c9871593fbf633e8381b8e6cb6e598a5108 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 11:56:08 -0200
Subject: [PATCH 058/292] Step 6: Routing & Multiple Views

---
 steps/step6.md | 557 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 557 insertions(+)
 create mode 100644 steps/step6.md

diff --git a/steps/step6.md b/steps/step6.md
new file mode 100644
index 0000000..1cee10e
--- /dev/null
+++ b/steps/step6.md
@@ -0,0 +1,557 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Routing & Multiple Views
+
+In this step, you will learn:
+
+-  how to create a layout template
+-  how to build an app that has multiple views with the new Angular router.
+
+The goal for this step is to add one more page to the app that shows the details of the selected party.
+
+By default we have a list of parties shown on the page, but when a user clicks on a list item, the app should navigate to the new page and show selected party details.
+
+
+## Parties List
+
+Since we want to have multiple views in our app we have to move the current list of parties into the separate component.
+
+Let's move the content of AppComponent in `app.component.ts` out into a `PartiesList` component.
+
+Create a new file called `parties-list.component.ts` and put it in `client/imports/app/parties` directory.
+
+[{]: <helper> (diff_step 6.1)
+#### Step 6.15: Load party details
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -1,9 +1,12 @@
+ ┊ 1┊ 1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊ 2┊ 2┊import { ActivatedRoute } from '@angular/router';
+-┊ 3┊  ┊import { Subscription } from 'rxjs/Subscription';
++┊  ┊ 3┊import { Subscription } from 'rxjs/Subscription'; 
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊import 'rxjs/add/operator/map';
+ ┊ 6┊ 6┊
++┊  ┊ 7┊import { Parties } from '../../../../both/collections/parties.collection';
++┊  ┊ 8┊import { Party } from '../../../../both/models/party.model';
++┊  ┊ 9┊
+ ┊ 7┊10┊import template from './party-details.component.html';
+ ┊ 8┊11┊
+ ┊ 9┊12┊@Component({
+```
+```diff
+@@ -13,6 +16,7 @@
+ ┊13┊16┊export class PartyDetailsComponent implements OnInit, OnDestroy {
+ ┊14┊17┊  partyId: string;
+ ┊15┊18┊  paramsSub: Subscription;
++┊  ┊19┊  party: Party;
+ ┊16┊20┊
+ ┊17┊21┊  constructor(
+ ┊18┊22┊    private route: ActivatedRoute
+```
+```diff
+@@ -21,7 +25,11 @@
+ ┊21┊25┊  ngOnInit() {
+ ┊22┊26┊    this.paramsSub = this.route.params
+ ┊23┊27┊      .map(params => params['partyId'])
+-┊24┊  ┊      .subscribe(partyId => this.partyId = partyId);
++┊  ┊28┊      .subscribe(partyId => {
++┊  ┊29┊        this.partyId = partyId
++┊  ┊30┊        
++┊  ┊31┊        this.party = Parties.findOne(this.partyId);
++┊  ┊32┊      });
+ ┊25┊33┊  }
+ ┊26┊34┊
+ ┊27┊35┊  ngOnDestroy() {
+```
+[}]: #
+
+There are few things we did in that step:
+
+- Updated path of the module with `Parties` collection
+- Changed the name of the template
+- Used `parties-list` as the selector instead of `app`
+- Renamed the class
+
+Now we can copy `app.component.html` into the `parties` directory and rename it `parties-list.component.html`:
+
+[{]: <helper> (diff_step 6.2)
+#### Step 6.2: Copy contents of app.html to PartiesList template
+
+##### Added client/imports/app/parties/parties-list.component.html
+```diff
+@@ -0,0 +1,12 @@
++┊  ┊ 1┊<div>
++┊  ┊ 2┊  <parties-form></parties-form>
++┊  ┊ 3┊
++┊  ┊ 4┊  <ul>
++┊  ┊ 5┊    <li *ngFor="let party of parties | async">
++┊  ┊ 6┊      undefined
++┊  ┊ 7┊      <p>undefined</p>
++┊  ┊ 8┊      <p>undefined</p>
++┊  ┊ 9┊      <button (click)="removeParty(party)">X</button>
++┊  ┊10┊    </li>
++┊  ┊11┊  </ul>
++┊  ┊12┊</div>🚫↵
+```
+[}]: #
+
+Also, let's clean-up `app.component.ts` to prepare it for the next steps:
+
+[{]: <helper> (diff_step 6.3)
+#### Step 6.3: Clean up App component
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -1,8 +1,4 @@
+ ┊1┊1┊import { Component } from '@angular/core';
+-┊2┊ ┊import { Observable } from 'rxjs/Observable';
+-┊3┊ ┊
+-┊4┊ ┊import { Parties } from '../../both/collections/parties.collection';
+-┊5┊ ┊import { Party } from '../../both/models/party.model';
+ ┊6┊2┊
+ ┊7┊3┊import template from './app.component.html';
+ ┊8┊4┊
+```
+```diff
+@@ -10,14 +6,4 @@
+ ┊10┊ 6┊  selector: 'app',
+ ┊11┊ 7┊  template
+ ┊12┊ 8┊})
+-┊13┊  ┊export class AppComponent {
+-┊14┊  ┊  parties: Observable<Party[]>;
+-┊15┊  ┊
+-┊16┊  ┊  constructor() {
+-┊17┊  ┊    this.parties = Parties.find({}).zone();
+-┊18┊  ┊  }
+-┊19┊  ┊
+-┊20┊  ┊  removeParty(party: Party): void {
+-┊21┊  ┊    Parties.remove(party._id);
+-┊22┊  ┊  }
+-┊23┊  ┊}
++┊  ┊ 9┊export class AppComponent {}
+```
+[}]: #
+
+and the template for it, which is `app.component.html`:
+
+> You will notice that the interface of your app has disappeared. But don't worry! It will come back later on.
+
+[{]: <helper> (diff_step 6.4)
+#### Step 6.4: Clean up App template
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,12 +1 @@
+-┊ 1┊  ┊<div>
+-┊ 2┊  ┊  <parties-form></parties-form>
+-┊ 3┊  ┊  
+-┊ 4┊  ┊  <ul>
+-┊ 5┊  ┊    <li *ngFor="let party of parties | async">
+-┊ 6┊  ┊      undefined
+-┊ 7┊  ┊      <p>undefined</p>
+-┊ 8┊  ┊      <p>undefined</p>
+-┊ 9┊  ┊      <button (click)="removeParty(party)">X</button>
+-┊10┊  ┊    </li>
+-┊11┊  ┊  </ul>
+-┊12┊  ┊</div>🚫↵
++┊  ┊ 1┊<div></div>🚫↵
+```
+[}]: #
+
+And let's add the new Component to the index file:
+
+[{]: <helper> (diff_step 6.5)
+#### Step 6.5: Add PartiesList to parties declarations
+
+##### Changed client/imports/app/parties/index.ts
+```diff
+@@ -1,5 +1,7 @@
+ ┊1┊1┊import { PartiesFormComponent } from './parties-form.component';
++┊ ┊2┊import { PartiesListComponent } from './parties-list.component';
+ ┊2┊3┊
+ ┊3┊4┊export const PARTIES_DECLARATIONS = [
+-┊4┊ ┊  PartiesFormComponent
++┊ ┊5┊  PartiesFormComponent,
++┊ ┊6┊  PartiesListComponent
+ ┊5┊7┊];
+```
+[}]: #
+
+# Routing
+
+
+`@angular/router` is the package in charge of Routing in Angular 2, and we will learn how to use it now.
+
+This package provides utils to define our routes, and get them as `NgModule` object we just include in our application.
+
+**Defining routes**
+
+We need to create an array of route definitions. The `Route` interface comes with help. This way we can be sure that properties of that object are correctly used.
+
+The very basic two properties are `path` and `component`. The path is to define the url and the other one is to bind a component to it.
+
+We will export our routes using `routes` variable.
+
+Let's warp it in the `app.routes.ts` file, here's what it suppose to look like:
+
+[{]: <helper> (diff_step 6.6)
+#### Step 6.6: Define routes
+
+##### Added client/imports/app/app.routes.ts
+```diff
+@@ -0,0 +1,7 @@
++┊ ┊1┊import { Route } from '@angular/router';
++┊ ┊2┊
++┊ ┊3┊import { PartiesListComponent } from './parties/parties-list.component';
++┊ ┊4┊
++┊ ┊5┊export const routes: Route[] = [
++┊ ┊6┊  { path: '', component: PartiesListComponent }
++┊ ┊7┊];
+```
+[}]: #
+
+Now we can use `routes` in the `NgModule`, with the `RouteModule` provided by Angular 2:
+
+[{]: <helper> (diff_step 6.7)
+#### Step 6.7: Register RouterModule
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -1,15 +1,18 @@
+ ┊ 1┊ 1┊import { NgModule } from '@angular/core';
+ ┊ 2┊ 2┊import { BrowserModule } from '@angular/platform-browser';
+ ┊ 3┊ 3┊import { FormsModule, ReactiveFormsModule } from '@angular/forms';
++┊  ┊ 4┊import { RouterModule } from '@angular/router';
+ ┊ 4┊ 5┊
+ ┊ 5┊ 6┊import { AppComponent } from './app.component';
++┊  ┊ 7┊import { routes } from './app.routes';
+ ┊ 6┊ 8┊import { PARTIES_DECLARATIONS } from './parties';
+ ┊ 7┊ 9┊
+ ┊ 8┊10┊@NgModule({
+ ┊ 9┊11┊  imports: [
+ ┊10┊12┊    BrowserModule,
+ ┊11┊13┊    FormsModule,
+-┊12┊  ┊    ReactiveFormsModule
++┊  ┊14┊    ReactiveFormsModule,
++┊  ┊15┊    RouterModule.forRoot(routes)
+ ┊13┊16┊  ],
+ ┊14┊17┊  declarations: [
+ ┊15┊18┊    AppComponent,
+```
+[}]: #
+
+Our app still has to display the view somewhere. We'll use `routerOutlet` component to do this.
+
+[{]: <helper> (diff_step 6.8)
+#### Step 6.8: Implement routerOutlet
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1 +1,3 @@
+-┊1┊ ┊<div></div>🚫↵
++┊ ┊1┊<div>
++┊ ┊2┊  <router-outlet></router-outlet>
++┊ ┊3┊</div>🚫↵
+```
+[}]: #
+
+Now, because we use a router that based on the browser path and URL - we need to tell Angular 2 router which path is the base path.
+
+We already have it because we used the Angular 2 boilerplate, but if you are looking for it - you can find it in `client/index.html` file:
+
+    <base href="/">
+
+# Parties details
+
+Let's add another view to the app: `PartyDetailsComponent`. Since it's not possible yet to get party details in this component, we are only going to make stubs.
+
+When we're finished, clicking on a party in the list should redirect us to the PartyDetailsComponent for more information.
+
+[{]: <helper> (diff_step 6.9)
+#### Step 6.9: Add PartyDetails component
+
+##### Added client/imports/app/parties/party-details.component.ts
+```diff
+@@ -0,0 +1,9 @@
++┊ ┊1┊import { Component } from '@angular/core';
++┊ ┊2┊
++┊ ┊3┊import template from './party-details.component.html';
++┊ ┊4┊
++┊ ┊5┊@Component({
++┊ ┊6┊  selector: 'party-details',
++┊ ┊7┊  template
++┊ ┊8┊})
++┊ ┊9┊export class PartyDetailsComponent {}
+```
+[}]: #
+
+And add a simple template outline for the party details:
+
+[{]: <helper> (diff_step 6.10)
+#### Step 6.10: Create template for PartyDetails
+
+##### Added client/imports/app/parties/party-details.component.html
+```diff
+@@ -0,0 +1,5 @@
++┊ ┊1┊<header>
++┊ ┊2┊  <h2>PARTY_NAME</h2>
++┊ ┊3┊
++┊ ┊4┊  <p>PARTY_DESCRIPTION</p>
++┊ ┊5┊</header>🚫↵
+```
+[}]: #
+
+And let's add the new Component to the index file and define the route:
+
+[{]: <helper> (diff_step 6.11)
+#### Step 6.11: Add component to declarations
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -1,7 +1,9 @@
+ ┊1┊1┊import { Route } from '@angular/router';
+ ┊2┊2┊
+ ┊3┊3┊import { PartiesListComponent } from './parties/parties-list.component';
++┊ ┊4┊import { PartyDetailsComponent } from './parties/party-details.component';
+ ┊4┊5┊
+ ┊5┊6┊export const routes: Route[] = [
+-┊6┊ ┊  { path: '', component: PartiesListComponent }
++┊ ┊7┊  { path: '', component: PartiesListComponent },
++┊ ┊8┊  { path: 'party/:partyId', component: PartyDetailsComponent }
+ ┊7┊9┊];
+```
+
+##### Changed client/imports/app/parties/index.ts
+```diff
+@@ -1,7 +1,9 @@
+ ┊1┊1┊import { PartiesFormComponent } from './parties-form.component';
+ ┊2┊2┊import { PartiesListComponent } from './parties-list.component';
++┊ ┊3┊import { PartyDetailsComponent } from './party-details.component';
+ ┊3┊4┊
+ ┊4┊5┊export const PARTIES_DECLARATIONS = [
+ ┊5┊6┊  PartiesFormComponent,
+-┊6┊ ┊  PartiesListComponent
++┊ ┊7┊  PartiesListComponent,
++┊ ┊8┊  PartyDetailsComponent
+ ┊7┊9┊];
+```
+[}]: #
+
+As you can see, we used `:partyId` inside of the path string. This way we define parameters. For example, `localhost:3000/party/12` will point to the PartyDetailsComponent with `12` as the value of the `partyId` parameter.
+
+We still have to add a link that redirects to party details.
+
+# RouterLink
+
+Let's add links to the new router details view from the list of parties.
+
+As we've already seen, each party link consists of two parts: the base `PartyDetailsComponent` URL and a party ID, represented by the `partyId` in the configuration. There is a special directive called `routerLink` that will help us to compose each URL.
+
+Now we can wrap our party in a `routerLink` and pass in the _id as a parameter. Note that the id is auto-generated when an item is inserted into a Mongo Collection.
+
+[{]: <helper> (diff_step 6.12)
+#### Step 6.12: Use routerLink in PartiesList component
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -3,7 +3,7 @@
+ ┊3┊3┊
+ ┊4┊4┊  <ul>
+ ┊5┊5┊    <li *ngFor="let party of parties | async">
+-┊6┊ ┊      undefined
++┊ ┊6┊      <a [routerLink]="['/party', party._id]">undefined</a>
+ ┊7┊7┊      <p>undefined</p>
+ ┊8┊8┊      <p>undefined</p>
+ ┊9┊9┊      <button (click)="removeParty(party)">X</button>
+```
+[}]: #
+
+As you can see, we used an array. The first element is a path that we want to use and the next one is to provide a value of a parameter.
+
+> You can provide more than one parameter by adding more elements into an array.
+
+# Injecting Route Params
+
+We've just added links to the `PartyDetails` view.
+
+The next thing is to grab the `partyId` route parameter in order to load the correct party in the `PartyDetails` view.
+
+In Angular 2, it's as simple as passing the `ActivatedRoute` argument to the `PartyDetails` constructor:
+
+[{]: <helper> (diff_step 6.13)
+#### Step 6.13: Subscribe to get the partyId
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -1,4 +1,7 @@
+-┊1┊ ┊import { Component } from '@angular/core';
++┊ ┊1┊import { Component, OnInit } from '@angular/core';
++┊ ┊2┊import { ActivatedRoute } from '@angular/router';
++┊ ┊3┊
++┊ ┊4┊import 'rxjs/add/operator/map';
+ ┊2┊5┊
+ ┊3┊6┊import template from './party-details.component.html';
+ ┊4┊7┊
+```
+```diff
+@@ -6,4 +9,16 @@
+ ┊ 6┊ 9┊  selector: 'party-details',
+ ┊ 7┊10┊  template
+ ┊ 8┊11┊})
+-┊ 9┊  ┊export class PartyDetailsComponent {}
++┊  ┊12┊export class PartyDetailsComponent implements OnInit {
++┊  ┊13┊  partyId: string;
++┊  ┊14┊
++┊  ┊15┊  constructor(
++┊  ┊16┊    private route: ActivatedRoute
++┊  ┊17┊  ) {}
++┊  ┊18┊
++┊  ┊19┊  ngOnInit() {
++┊  ┊20┊    this.route.params
++┊  ┊21┊      .map(params => params['partyId'])
++┊  ┊22┊      .subscribe(partyId => this.partyId = partyId);
++┊  ┊23┊  }
++┊  ┊24┊}
+```
+[}]: #
+
+> We used another RxJS feature called `map` - which transform the stream of data into another object - in this case, we want to get the `partyId` from the `params`, then we subscribe to the return value of this function - and the subscription will be called only with the `partyId` that we need.
+
+> As you might noticed, Angular 2 uses RxJS internally and exposes a lot of APIs using RxJS Observable!
+
+Dependency injection is employed heavily here by Angular 2 to do all the work behind the scenes.
+
+TypeScript first compiles this class with the class metadata that says what argument types this class expects in the constructor (i.e. `ActivatedRoute`),
+so Angular 2 knows what types to inject if asked to create an instance of this class.
+
+Then, when you click on a party details link, the `router-outlet` directive will create a `ActivatedRoute` provider that provides
+parameters for the current URL. Right after that moment if a `PartyDetails` instance is created by means of the dependency injection API, it's created with `ActivatedRoute` injected and equalled to the current URL inside the constructor.
+
+If you want to read more about dependency injection in Angular 2, you can find an extensive overview in this [article](http://blog.thoughtram.io/angular/2015/05/18/dependency-injection-in-angular-2.html).
+If you are curious about class metadata read more about it [here](http://blog.thoughtram.io/angular/2015/09/17/resolve-service-dependencies-in-angular-2.html).
+
+In order to avoid memory leaks and performance issues, we need to make sure that every time we use `subscribe` in our Component - we also use `unsubscribe` when the data is no longer interesting.
+
+In order to do so, we will use Angular 2 interface called `OnDestroy` and implement `ngOnDestroy` - which called when our Component is no longer in the view and removed from the DOM.
+
+So let's implement this:
+
+[{]: <helper> (diff_step 6.14)
+#### Step 6.14: Unsubscribe when component is being destroyed
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -1,5 +1,6 @@
+-┊1┊ ┊import { Component, OnInit } from '@angular/core';
++┊ ┊1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊2┊2┊import { ActivatedRoute } from '@angular/router';
++┊ ┊3┊import { Subscription } from 'rxjs/Subscription';
+ ┊3┊4┊
+ ┊4┊5┊import 'rxjs/add/operator/map';
+ ┊5┊6┊
+```
+```diff
+@@ -9,16 +10,21 @@
+ ┊ 9┊10┊  selector: 'party-details',
+ ┊10┊11┊  template
+ ┊11┊12┊})
+-┊12┊  ┊export class PartyDetailsComponent implements OnInit {
++┊  ┊13┊export class PartyDetailsComponent implements OnInit, OnDestroy {
+ ┊13┊14┊  partyId: string;
++┊  ┊15┊  paramsSub: Subscription;
+ ┊14┊16┊
+ ┊15┊17┊  constructor(
+ ┊16┊18┊    private route: ActivatedRoute
+ ┊17┊19┊  ) {}
+ ┊18┊20┊
+ ┊19┊21┊  ngOnInit() {
+-┊20┊  ┊    this.route.params
++┊  ┊22┊    this.paramsSub = this.route.params
+ ┊21┊23┊      .map(params => params['partyId'])
+ ┊22┊24┊      .subscribe(partyId => this.partyId = partyId);
+ ┊23┊25┊  }
++┊  ┊26┊
++┊  ┊27┊  ngOnDestroy() {
++┊  ┊28┊    this.paramsSub.unsubscribe();
++┊  ┊29┊  }
+ ┊24┊30┊}
+```
+[}]: #
+
+Now, we need to get the actual `Party` object with the ID we got from the Router, so let's use the `Parties` collection to get it:
+
+[{]: <helper> (diff_step 6.15)
+#### Step 6.15: Load party details
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -1,9 +1,12 @@
+ ┊ 1┊ 1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊ 2┊ 2┊import { ActivatedRoute } from '@angular/router';
+-┊ 3┊  ┊import { Subscription } from 'rxjs/Subscription';
++┊  ┊ 3┊import { Subscription } from 'rxjs/Subscription'; 
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊import 'rxjs/add/operator/map';
+ ┊ 6┊ 6┊
++┊  ┊ 7┊import { Parties } from '../../../../both/collections/parties.collection';
++┊  ┊ 8┊import { Party } from '../../../../both/models/party.model';
++┊  ┊ 9┊
+ ┊ 7┊10┊import template from './party-details.component.html';
+ ┊ 8┊11┊
+ ┊ 9┊12┊@Component({
+```
+```diff
+@@ -13,6 +16,7 @@
+ ┊13┊16┊export class PartyDetailsComponent implements OnInit, OnDestroy {
+ ┊14┊17┊  partyId: string;
+ ┊15┊18┊  paramsSub: Subscription;
++┊  ┊19┊  party: Party;
+ ┊16┊20┊
+ ┊17┊21┊  constructor(
+ ┊18┊22┊    private route: ActivatedRoute
+```
+```diff
+@@ -21,7 +25,11 @@
+ ┊21┊25┊  ngOnInit() {
+ ┊22┊26┊    this.paramsSub = this.route.params
+ ┊23┊27┊      .map(params => params['partyId'])
+-┊24┊  ┊      .subscribe(partyId => this.partyId = partyId);
++┊  ┊28┊      .subscribe(partyId => {
++┊  ┊29┊        this.partyId = partyId
++┊  ┊30┊        
++┊  ┊31┊        this.party = Parties.findOne(this.partyId);
++┊  ┊32┊      });
+ ┊25┊33┊  }
+ ┊26┊34┊
+ ┊27┊35┊  ngOnDestroy() {
+```
+[}]: #
+
+> `findOne` return the actual object instead of returning Observable or Cursor.
+
+In our next step we will display the party details inside our view!
+
+# Challenge
+
+Add a link back to the `PartiesList` component from `PartyDetails`.
+
+# Summary
+
+Let's list what we've accomplished in this step:
+
+- split our app into two main views
+- configured routing to use these views and created a layout template
+- learned briefly how dependency injection works in Angular 2
+- injected route parameters and loaded party details with the ID parameter
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step5.md) | [Next Step >](step7.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 7d9e6c6e39b074fea485066ee8722ae6fe482ee4 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:57:57 +0200
Subject: [PATCH 059/292] Step 7.1: Display party details

---
 client/imports/app/parties/party-details.component.html | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index a3da9f4..d6fd3fb 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -1,5 +1,7 @@
-<header>
-  <h2>PARTY_NAME</h2>
+<header *ngIf="party">
+  <h2>{{party.name}}</h2>
 
-  <p>PARTY_DESCRIPTION</p>
+  <p>{{party.description}}</p>
+
+  <p>{{party.location}}</p>
 </header>
\ No newline at end of file
-- 
2.7.4


From 735f9a12b8d70c710514d6db682822248686ba54 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 18:58:51 +0200
Subject: [PATCH 060/292] Step 7.2: Create form inside PartyDetails template

---
 client/imports/app/parties/party-details.component.html | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index d6fd3fb..aef5bae 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -1,7 +1,13 @@
-<header *ngIf="party">
-  <h2>{{party.name}}</h2>
+<form *ngIf="party" (submit)="saveParty()">
+  <label>Name</label>
+  <input type="text" [(ngModel)]="party.name" name="name">
 
-  <p>{{party.description}}</p>
+  <label>Description</label>
+  <input type="text" [(ngModel)]="party.description" name="description">
 
-  <p>{{party.location}}</p>
-</header>
\ No newline at end of file
+  <label>Location</label>
+  <input type="text" [(ngModel)]="party.location" name="location">
+
+  <button type="submit">Save</button>
+  <a [routerLink]="['/']">Cancel</a>
+</form>
\ No newline at end of file
-- 
2.7.4


From 6c6ff34a867021a393df46d7725a50816e4467fd Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 19:01:57 +0200
Subject: [PATCH 061/292] Step 7.3: Add submit event handler

---
 client/imports/app/parties/party-details.component.ts | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 6c53448..3abaa71 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -32,6 +32,16 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
       });
   }
 
+  saveParty() {
+    Parties.update(this.party._id, {
+      $set: {
+        name: this.party.name,
+        description: this.party.description,
+        location: this.party.location
+      }
+    });
+  }
+
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
   }
-- 
2.7.4


From 2810b9f24b1d5ddc3630a0ed51c81df817905f47 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 12:20:54 -0200
Subject: [PATCH 062/292] Step 7: Bind one object

---
 steps/step7.md | 130 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 130 insertions(+)
 create mode 100644 steps/step7.md

diff --git a/steps/step7.md b/steps/step7.md
new file mode 100644
index 0000000..0d14754
--- /dev/null
+++ b/steps/step7.md
@@ -0,0 +1,130 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Bind one object
+
+In this step we are going to:
+
+- add a form to the party details view
+- bind a party object to the view, so that we'll be able to change party details and
+then save changes to the storage
+
+# Two-Way Data Binding
+
+As we've already explored on the 3rd step, data can be bound to the HTML input elements
+with the help of a group of special Angular 2 Control objects, otherwise called a form model.
+We called this approach the _Model-Driven approach_.
+
+Also, it was mentioned that Angular 2 has support of two-way data binding
+through a special attribute, though with different syntax from Angular 1. We'll get to this shortly.
+
+First, let's bind the party details into our view:
+
+[{]: <helper> (diff_step 7.1)
+#### Step 7.1: Display party details
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -1,5 +1,7 @@
+-┊1┊ ┊<header>
+-┊2┊ ┊  <h2>PARTY_NAME</h2>
++┊ ┊1┊<header *ngIf="party">
++┊ ┊2┊  <h2>undefined</h2>
+ ┊3┊3┊
+-┊4┊ ┊  <p>PARTY_DESCRIPTION</p>
++┊ ┊4┊  <p>undefined</p>
++┊ ┊5┊
++┊ ┊6┊  <p>undefined</p>
+ ┊5┊7┊</header>🚫↵
+```
+[}]: #
+
+Now, let's change `party-details.component.html` into a form, so that we can edit the party details:
+
+[{]: <helper> (diff_step 7.2)
+#### Step 7.2: Create form inside PartyDetails template
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -1,7 +1,13 @@
+-┊ 1┊  ┊<header *ngIf="party">
+-┊ 2┊  ┊  <h2>undefined</h2>
++┊  ┊ 1┊<form *ngIf="party" (submit)="saveParty()">
++┊  ┊ 2┊  <label>Name</label>
++┊  ┊ 3┊  <input type="text" [(ngModel)]="party.name" name="name">
+ ┊ 3┊ 4┊
+-┊ 4┊  ┊  <p>undefined</p>
++┊  ┊ 5┊  <label>Description</label>
++┊  ┊ 6┊  <input type="text" [(ngModel)]="party.description" name="description">
+ ┊ 5┊ 7┊
+-┊ 6┊  ┊  <p>undefined</p>
+-┊ 7┊  ┊</header>🚫↵
++┊  ┊ 8┊  <label>Location</label>
++┊  ┊ 9┊  <input type="text" [(ngModel)]="party.location" name="location">
++┊  ┊10┊
++┊  ┊11┊  <button type="submit">Save</button>
++┊  ┊12┊  <a [routerLink]="['/']">Cancel</a>
++┊  ┊13┊</form>🚫↵
+```
+[}]: #
+
+> Notice we have a routerLink button on the page that redirects back to the list (from our previous step's challenge). Here is how to do that:
+
+## ngModel
+
+[ngModel](https://angular.io/docs/js/latest/api/common/NgModel-directive.html) binds a HTML form to the component's model, which can be an object of any type, in comparison to
+the Model-Driven binding where the `FormGroup` instance is used.
+
+The syntax looks a bit different, using both square and rounded brackets: `[(ngModel)]`. `ngModel` binds to the party properties and fills out the inputs, and vice versa.
+
+Let's do a little test to see how form controls and events work in Angular 2. Start by binding to `party.name` below the input, then experiment by changing the input's text.
+
+    <label for="name">Name</label>
+    <input type="text" [(ngModel)]="party.name" name="name">
+
+    <p>undefinedparty.name}}</p>
+
+Notice that it updates automatically on changes. You can contrast this to `FormControl`s which we need to update manually using events to reach this functionality.
+
+As a finishing touch, let's add a submit event handler that saves the current party:
+
+[{]: <helper> (diff_step 7.3)
+#### Step 7.3: Add submit event handler
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -32,6 +32,16 @@
+ ┊32┊32┊      });
+ ┊33┊33┊  }
+ ┊34┊34┊
++┊  ┊35┊  saveParty() {
++┊  ┊36┊    Parties.update(this.party._id, {
++┊  ┊37┊      $set: {
++┊  ┊38┊        name: this.party.name,
++┊  ┊39┊        description: this.party.description,
++┊  ┊40┊        location: this.party.location
++┊  ┊41┊      }
++┊  ┊42┊    });
++┊  ┊43┊  }
++┊  ┊44┊
+ ┊35┊45┊  ngOnDestroy() {
+ ┊36┊46┊    this.paramsSub.unsubscribe();
+ ┊37┊47┊  }
+```
+[}]: #
+
+# Summary
+
+In this step, we learned:
+
+- how two-way data binding works in Angular 2 using `[(ngModel)]`
+- how to bind inputs to the view and save the data
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step6.md) | [Next Step >](step8.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From aa540fa15d29a294ddc91edd5a7a4cf8350f7a91 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 12:47:36 -0200
Subject: [PATCH 063/292] Step 8: Folder structure

---
 steps/step8.md | 146 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 146 insertions(+)
 create mode 100644 steps/step8.md

diff --git a/steps/step8.md b/steps/step8.md
new file mode 100644
index 0000000..91b00d6
--- /dev/null
+++ b/steps/step8.md
@@ -0,0 +1,146 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Folder structure
+
+In this step we will:
+
+- review the file structure of our Socially app so far,
+- look closer into certain TypeScript features, since having a better understanding of the primary programming language of this package would be surely beneficial
+
+# File Structure
+
+As you have probably noticed, our tutorial app has a strict modular structure at this point:
+there are no pure JavaScript files that are being bundled together and auto-executed, so Meteor's file loading conventions doesn't have any effect.
+Even more, every `.ts` file is being compiled into a separate CommonJS module, which we can then import whenever we need to.
+
+There is another thing worth mentioning once more. As you know, Meteor has two special folders: _client_ and _server_.
+We can benefit from them (and have already done so in this app) by allowing access to the client side modules from the client side only and, accordingly, to server side modules from the server side.
+Everything outside of those folders will be available to the both client and server.
+It’s no wonder why this is a recommended approach in Meteor, and this is why we’ve been doing it so far.
+Let's stick to it further.
+
+# TypeScript
+
+TypeScript is a rather new language that has been growing in [popularity](https://www.google.com/trends/explore#q=%2Fm%2F0n50hxv) since it's creation 3 years ago. TypeScript has one of the fullest implementations of ES2015 features on the market: including some experimental features, pseudo type-checking and a rich toolset developed by Microsoft and the TypeScript community. It has support already in all major IDEs including Visual Studio, WebStorm, Sublime, Atom, etc.
+
+One of the biggest issues in JavaScript is making code less bug-prone and more suitable for big projects. In the OOP world, well-known solutions include modularity and strict type-checking. While OOP is available in JavaScript in some way, it turned out to be very hard to create good type-checking. One always needs to impose a certain number of rules to follow to make a JavaScript compiler more effective. For many years, we’ve seen around a number of solutions including the Closure Compiler and GWT from Google, a bunch of C#-to-JavaScript compilers and others.
+
+This was, for sure, one of the problems the TypeScript team were striving to solve: to create a language that would inherit the flexibility of JavaScript while, at the same time, having effective and optional type-checking with minimum effort required from the user.
+
+## Type Declaration Files
+
+As you may have noticed, Angular2-Meteor package itself installs a number of type declaration (`.d.ts`) files into the _typings_ folder. These are files of a special kind where you describe the interfaces for your classes along with signatures of the methods and types of the parameters they take, so that TypeScript will be able to refer to these files to verify the correctness of your class's API. Of course, the flexibility is still there so if you don’t want to declare types you can skip them right away.
+
+Keep in mind, type-checking is not delivered in the outputted JavaScript. It is only extra sugar for your development environment, and adds no weight to the outputted .js file.
+
+Some of the typings files have names `angular2.d.ts` and `meteor.d.ts`, which, as you can guess, are used to verify that API of Meteor and Angular 2 are being used correctly in your code
+
+During this tutorial, we will create our own declaration file for our project in order to learn this type-checking better (we already created one of those earlier).
+
+## Interfaces
+
+We are already declared a `Party` interface, and you should already be familiar with its properties: "name", "description" and "location". We can make the "Description" property optional.
+
+TypeScript's type-checking bases on the "shapes" that types have. And interfaces are TypeScript's means to describe these type "shapes", which is sometimes called "duck typing". More on that you can read [here](http://www.typescriptlang.org/docs/handbook/interfaces.html).
+
+## TypeScript Configuration and IDEs
+
+As you already know from the bootstrapping step, TypeScript is generally configured by a special JSON file called [_tsconfig.json_](https://github.com/Microsoft/typescript/wiki/tsconfig.json).
+
+As mentioned, the TypeScript language today has development plugins in many [popular IDEs](https://github.com/Microsoft/TypeScript/wiki/TypeScript-Editor-Support), including Visual Studio, WebStorm, Sublime, Atom etc. These plugins work in the same style as it's become de facto today — compile, using TypeScript shell command, `.ts` and `tsconfig.json` files update automatically as you change them.
+With that, if you've configured your project right with declaration files in place you'll get a bunch of invaluable features such as better code completion and instantaneous highlighting of compilation errors.
+
+If you use one of the mentioned IDEs, you've likely noticed that a bunch of the code lines
+are now marked in red, indicating the TypeScript plugins don't work right quite yet.
+
+That's because most of the plugins recognize _tsconfig.json_ as well if it's placed in the root folder,
+but so far our _tsconfig.json_ contains only a "files" property, which is certainly not enough for
+a general compilation. At the same time, Angular2-Meteor's TypeScript compiler, defaults most of the
+compilation options internally to fit our needs. To fix plugins, let's set up our _tsconfig.json_
+properly with the options that will make plugins understand our needs and the structure of our app.
+
+```json
+{
+  "compilerOptions": {
+    "target": "es5",
+    "module": "commonjs",
+    "isolatedModules": false,
+    "moduleResolution": "node",
+    "experimentalDecorators": true,
+    "emitDecoratorMetadata": true,
+    "removeComments": false,
+    "noImplicitAny": false,
+    "sourceMap": true
+  },
+  "exclude": [
+    "node_modules"
+  ],
+  "compileOnSave": false
+}
+```
+
+**CompilerOptions:**
+
+- `target` - Specify ECMAScript target version
+- `module` - Specify module code generation
+- `isolatedModules` - Unconditionally emit imports for unresolved files
+- `moduleResolution` - Determine how modules get resolved
+- `experimentalDecorators` - Enables experimental support for ES7 decorators.
+- `emitDecoratorMetadata` - Emit design-type metadata for decorated declarations in source
+- `removeComments` - Remove all comments except copy-right header comments beginning with
+- `noImplicitAny` - Raise error on expressions and declarations with an implied 'any' type
+- `sourceMap` - Generates corresponding '.map' file
+
+Now, let's go to any of the `.ts` files and check if all that annoying redness has disappeared.
+
+> Note: you may need to reload you IDE to pick up the latest changes to the config.
+
+Please note, since the Meteor environment is quite specific, some of the `tsconfig.json` options won't make sense in Meteor. You can read about the exceptions [here](https://github.com/barbatus/typescript#compiler-options).
+TypeScript compiler of this package supports some additional options that might be useful in the Meteor environment.
+They can be included in the "meteorCompilerOptions" section of _tsconfig.json_ and described [here](https://github.com/barbatus/ts-compilers#typescript-config).
+
+### IDE Specific Configurations
+
+##### Atom
+
+If you are using [Atom](atom.io) as your editor with the [Atom-TypeScript plugin](https://github.com/TypeStrong/atom-typescript), use the following configuration to automatically generate your `tsconfig.json` file:
+
+    {
+     "atom": {
+        "rewriteTsconfig": true
+      },
+      "compileOnSave": false,
+      "buildOnSave": false,
+      "compilerOptions": {
+        "target": "es5",
+        "module": "commonjs",
+        "moduleResolution": "classic",
+        "experimentalDecorators": true
+      },
+      "filesGlob": [
+        "**/*.ts"
+      ],
+      "files": []
+    }
+
+# Summary
+
+In this step we discovered how to make our TypeScript code less buggy with:
+
+- the benefits of type-checking
+- type declaration files for verifying library APIs
+- interfaces to check our own projects APIs
+- TSD for loading declaration files easily
+- creating a `tsconfig.json` file for loading files and specifying compiler options
+
+In the [next step](/tutorials/angular2/user-accounts-authentication-and-permissions) we'll look at creating user accounts and securing server data access.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step7.md) | [Next Step >](step9.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From bda152eac963d1ee802a107f1f57cd7f74a66898 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 20:40:52 +0200
Subject: [PATCH 064/292] Step 9.1: Add accounts

---
 .meteor/packages |  2 +-
 .meteor/versions | 11 ++++++++++-
 package.json     |  3 ++-
 3 files changed, 13 insertions(+), 3 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index cd12a6f..eb89681 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -16,10 +16,10 @@ standard-minifier-js@1.2.0    # JS minifier run for production mode
 es5-shim@4.6.14                # ECMAScript 5 compatibility for older browsers.
 
 autopublish@1.0.7             # Publish all data to the clients (for prototyping)
-insecure@1.0.7                # Allow all DB writes from clients (for prototyping)
 angular2-compilers
 practicalmeteor:mocha
 xolvio:cleaner
 hwillson:stub-collections
 dispatch:mocha-phantomjs
 shell-server
+accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index 9886afc..a935b08 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,3 +1,5 @@
+accounts-base@1.2.11
+accounts-password@1.3.0
 allow-deny@1.0.5
 angular2-compilers@0.6.1
 autopublish@1.0.7
@@ -22,6 +24,7 @@ coffeescript@1.1.4
 ddp@1.2.5
 ddp-client@1.2.9
 ddp-common@1.2.6
+ddp-rate-limiter@1.0.5
 ddp-server@1.2.10
 deps@1.0.12
 diff-sequence@1.0.6
@@ -30,6 +33,7 @@ dispatch:phantomjs-tests@0.0.5
 ecmascript@0.5.8
 ecmascript-runtime@0.3.14
 ejson@1.0.12
+email@1.1.17
 es5-shim@4.6.14
 fastclick@1.0.12
 geojson-utils@1.0.9
@@ -39,10 +43,10 @@ htmljs@1.0.11
 http@1.1.8
 hwillson:stub-collections@1.0.1
 id-map@1.0.8
-insecure@1.0.7
 jquery@1.11.9
 launch-screen@1.0.12
 livedata@1.0.18
+localstorage@1.0.11
 logging@1.1.15
 meteor@1.2.17
 meteor-base@1.0.4
@@ -55,6 +59,7 @@ modules@0.7.6
 modules-runtime@0.7.6
 mongo@1.1.12
 mongo-id@1.0.5
+npm-bcrypt@0.9.1
 npm-mongo@1.5.49
 observe-sequence@1.0.12
 ordered-dict@1.0.8
@@ -65,13 +70,17 @@ practicalmeteor:mocha-core@1.0.1
 practicalmeteor:sinon@1.14.1_2
 promise@0.8.7
 random@1.0.10
+rate-limit@1.0.5
 reactive-var@1.0.10
 reload@1.1.10
 retry@1.0.8
 routepolicy@1.0.11
+service-configuration@1.0.10
+sha@1.0.8
 shell-server@0.2.1
 spacebars@1.0.13
 spacebars-compiler@1.0.13
+srp@1.0.9
 standard-minifier-css@1.2.0
 standard-minifier-js@1.2.0
 templating@1.1.14
diff --git a/package.json b/package.json
index b020f1c..710bd25 100644
--- a/package.json
+++ b/package.json
@@ -23,7 +23,8 @@
     "@angular/platform-browser-dynamic": "2.0.1",
     "@angular/router": "3.0.1",
     "angular2-meteor": "0.7.0",
-    "angular2-meteor-polyfills": "0.1.1",
+    "angular2-meteor-accounts-ui": "0.8.0",
+    "angular2-meteor-polyfills": "^0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
-- 
2.7.4


From 687300643de270cd14e0efa43c7d4bd8b6bb348f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 20:41:37 +0200
Subject: [PATCH 065/292] Step 9.2: Import AccountsModule

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 192c630..1e7e1ac 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -2,6 +2,7 @@ import { NgModule } from '@angular/core';
 import { BrowserModule } from '@angular/platform-browser';
 import { FormsModule, ReactiveFormsModule } from '@angular/forms';
 import { RouterModule } from '@angular/router';
+import { AccountsModule } from 'angular2-meteor-accounts-ui';
 
 import { AppComponent } from './app.component';
 import { routes } from './app.routes';
@@ -12,7 +13,8 @@ import { PARTIES_DECLARATIONS } from './parties';
     BrowserModule,
     FormsModule,
     ReactiveFormsModule,
-    RouterModule.forRoot(routes)
+    RouterModule.forRoot(routes),
+    AccountsModule
   ],
   declarations: [
     AppComponent,
-- 
2.7.4


From 004b074fd3ad5c596ce955b8c5e192a74786e810 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 20:42:08 +0200
Subject: [PATCH 066/292] Step 9.3: Use LoginButtons component

---
 client/imports/app/parties/parties-list.component.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 488ba09..20400c4 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -1,5 +1,6 @@
 <div>
   <parties-form></parties-form>
+  <login-buttons></login-buttons>
 
   <ul>
     <li *ngFor="let party of parties | async">
-- 
2.7.4


From 86eae94c1ad48489c785081614aaa1374f668817 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 20:42:25 +0200
Subject: [PATCH 067/292] Step 9.4: Import styles

---
 client/main.scss | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 client/main.scss

diff --git a/client/main.scss b/client/main.scss
new file mode 100644
index 0000000..ac0e5ee
--- /dev/null
+++ b/client/main.scss
@@ -0,0 +1 @@
+@import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
\ No newline at end of file
-- 
2.7.4


From 4b96a64bd5a9bde09a6dd3f1185fdf74bb9bb264 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 21:20:37 +0200
Subject: [PATCH 068/292] Step 9.5: Add Parties collection security

---
 both/collections/parties.collection.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/both/collections/parties.collection.ts b/both/collections/parties.collection.ts
index 8146c60..731b244 100644
--- a/both/collections/parties.collection.ts
+++ b/both/collections/parties.collection.ts
@@ -1,5 +1,16 @@
 import { MongoObservable } from 'meteor-rxjs';
+import { Meteor } from 'meteor/meteor';
 
 import { Party } from '../models/party.model';
 
 export const Parties = new MongoObservable.Collection<Party>('parties');
+
+function loggedIn() {
+  return !!Meteor.user();
+}
+
+Parties.allow({
+  insert: loggedIn,
+  update: loggedIn,
+  remove: loggedIn
+});
-- 
2.7.4


From 0aff98d0181e0146024bde73eef873efb6a71939 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 21:27:52 +0200
Subject: [PATCH 069/292] Step 9.6: Check access in PartiesForm

---
 client/imports/app/parties/parties-form.component.ts | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index 511812d..565cf77 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -1,5 +1,6 @@
 import { Component, OnInit } from '@angular/core';
 import { FormGroup, FormBuilder, Validators } from '@angular/forms';
+import { Meteor } from 'meteor/meteor';
 
 import { Parties } from '../../../../both/collections/parties.collection';
 
@@ -25,6 +26,11 @@ export class PartiesFormComponent implements OnInit {
   }
 
   addParty(): void {
+    if (!Meteor.userId()) {
+      alert('Please log in to add a party');
+      return;
+    }
+
     if (this.addForm.valid) {
       Parties.insert(this.addForm.value);
 
-- 
2.7.4


From e1c8009452d4a5457db735c1339ed7275608817b Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 21:30:05 +0200
Subject: [PATCH 070/292] Step 9.7: Add owner

---
 client/imports/app/parties/parties-form.component.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index 565cf77..978f6e4 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -32,7 +32,7 @@ export class PartiesFormComponent implements OnInit {
     }
 
     if (this.addForm.valid) {
-      Parties.insert(this.addForm.value);
+      Parties.insert(Object.assign({}, this.addForm.value, { owner: Meteor.userId() }));
 
       this.addForm.reset();
     }
-- 
2.7.4


From f861042abaa4a72e93d294ca68a801adecf69869 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 21:30:44 +0200
Subject: [PATCH 071/292] Step 9.8: Define owner in Party type

---
 both/models/party.model.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
index fd5a709..5b20610 100644
--- a/both/models/party.model.ts
+++ b/both/models/party.model.ts
@@ -4,4 +4,5 @@ export interface Party extends CollectionObject {
   name: string;
   description: string;
   location: string;
+  owner?: string; 
 }
-- 
2.7.4


From 69941e57bb261ba6eb7741b0a3bab32277da030b Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 21:32:09 +0200
Subject: [PATCH 072/292] Step 9.9: Check access to update a party

---
 client/imports/app/parties/party-details.component.ts | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 3abaa71..0032c65 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -1,6 +1,7 @@
 import { Component, OnInit, OnDestroy } from '@angular/core';
 import { ActivatedRoute } from '@angular/router';
-import { Subscription } from 'rxjs/Subscription'; 
+import { Subscription } from 'rxjs/Subscription';
+import { Meteor } from 'meteor/meteor'; 
 
 import 'rxjs/add/operator/map';
 
@@ -33,6 +34,11 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
   }
 
   saveParty() {
+    if (!Meteor.userId()) {
+      alert('Please log in to change this party');
+      return;
+    }
+    
     Parties.update(this.party._id, {
       $set: {
         name: this.party.name,
-- 
2.7.4


From 40b20441a14469a236503b90f9cd1f9194b317fd Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 21:37:13 +0200
Subject: [PATCH 073/292] Step 9.10: Require user to access PartyDetails

---
 client/imports/app/app.routes.ts | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
index fef7277..c5812a4 100644
--- a/client/imports/app/app.routes.ts
+++ b/client/imports/app/app.routes.ts
@@ -1,9 +1,15 @@
 import { Route } from '@angular/router';
+import { Meteor } from 'meteor/meteor';
 
 import { PartiesListComponent } from './parties/parties-list.component';
 import { PartyDetailsComponent } from './parties/party-details.component';
 
 export const routes: Route[] = [
   { path: '', component: PartiesListComponent },
-  { path: 'party/:partyId', component: PartyDetailsComponent }
+  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] }
 ];
+
+export const ROUTES_PROVIDERS = [{
+  provide: 'canActivateForLoggedIn',
+  useValue: () => !! Meteor.userId()
+}];
-- 
2.7.4


From 0d404a3cfa8512f18c9468ff6ea7ee279f49404e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Wed, 21 Sep 2016 21:37:31 +0200
Subject: [PATCH 074/292] Step 9.11: Add ROUTES_PROVIDERS

---
 client/imports/app/app.module.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 1e7e1ac..139b880 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -5,7 +5,7 @@ import { RouterModule } from '@angular/router';
 import { AccountsModule } from 'angular2-meteor-accounts-ui';
 
 import { AppComponent } from './app.component';
-import { routes } from './app.routes';
+import { routes, ROUTES_PROVIDERS } from './app.routes';
 import { PARTIES_DECLARATIONS } from './parties';
 
 @NgModule({
@@ -20,6 +20,9 @@ import { PARTIES_DECLARATIONS } from './parties';
     AppComponent,
     ...PARTIES_DECLARATIONS
   ],
+  providers: [
+    ...ROUTES_PROVIDERS
+  ],
   bootstrap: [
     AppComponent
   ]
-- 
2.7.4


From 322ea97ec73005ad69a91979f218c3a561775d5f Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 13:13:40 -0200
Subject: [PATCH 075/292] Step 9: User accounts, authentication and permissions

---
 steps/step9.md | 426 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 426 insertions(+)
 create mode 100644 steps/step9.md

diff --git a/steps/step9.md b/steps/step9.md
new file mode 100644
index 0000000..5ee8a79
--- /dev/null
+++ b/steps/step9.md
@@ -0,0 +1,426 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# User accounts, authentication and permissions
+
+In this section we'll look at how to:
+
+- implement security for an app using Meteor and Angular 2 API
+- setup user accounts in meteor using a login and password
+- setup OAuth login for Facebook & Twitter
+- restrict access to views based on user permissions
+
+# Removing Insecure
+
+Right now, our app is publishing all parties to all clients, allowing any client to change those parties. The changes are then reflected back to all the other clients automatically.
+
+This is super powerful and easy, but what about security?  We don't want any user to be able to change any party...
+
+For quick and easy setup, Meteor automatically includes a package called `insecure`. As the name implies, the packages provides a default behavior to Meteor collections allowing all reads and writes.
+
+The first thing we should do is to remove the "insecure" package. By removing that package, the default behavior is changed to deny all.
+
+Execute this command in the command line:
+
+    $ meteor remove insecure
+    > insecure removed from your project
+
+Let's try to change the parties array or a specific party. Nothing's working.
+
+That's because now we have to write an explicit security rule for each operation we want to make on the Mongo collection.
+
+We can assume we will allow a user to alter data if any of the following are true:
+
+- the user is logged in
+- the user created the party
+- the user is an admin
+
+# User Accounts
+
+One of Meteor's most powerful packages is the [Meteor accounts](https://www.meteor.com/accounts) system.
+
+Add the "accounts-password" Meteor package. It's a very powerful package for all the user operations you can think of: login, signup, change password, password recovery, email confirmation and more.
+
+    $ meteor add accounts-password
+
+Now we are going to add `angular2-meteor-accounts-ui` which is a package that contains all the HTML and CSS we need for the user operation forms.
+
+    $ meteor npm install --save angular2-meteor-accounts-ui
+
+Because Angular 2 works with modules, we need to import this package's module into our:
+
+[{]: <helper> (diff_step 9.2)
+#### Step 9.2: Import AccountsModule
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -2,6 +2,7 @@
+ ┊2┊2┊import { BrowserModule } from '@angular/platform-browser';
+ ┊3┊3┊import { FormsModule, ReactiveFormsModule } from '@angular/forms';
+ ┊4┊4┊import { RouterModule } from '@angular/router';
++┊ ┊5┊import { AccountsModule } from 'angular2-meteor-accounts-ui';
+ ┊5┊6┊
+ ┊6┊7┊import { AppComponent } from './app.component';
+ ┊7┊8┊import { routes } from './app.routes';
+```
+```diff
+@@ -12,7 +13,8 @@
+ ┊12┊13┊    BrowserModule,
+ ┊13┊14┊    FormsModule,
+ ┊14┊15┊    ReactiveFormsModule,
+-┊15┊  ┊    RouterModule.forRoot(routes)
++┊  ┊16┊    RouterModule.forRoot(routes),
++┊  ┊17┊    AccountsModule
+ ┊16┊18┊  ],
+ ┊17┊19┊  declarations: [
+ ┊18┊20┊    AppComponent,
+```
+[}]: #
+
+Let's add the `<login-buttons>` tag below of the party form in the PartiesList's template:
+
+[{]: <helper> (diff_step 9.3)
+#### Step 9.3: Use LoginButtons component
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -1,5 +1,6 @@
+ ┊1┊1┊<div>
+ ┊2┊2┊  <parties-form></parties-form>
++┊ ┊3┊  <login-buttons></login-buttons>
+ ┊3┊4┊
+ ┊4┊5┊  <ul>
+ ┊5┊6┊    <li *ngFor="let party of parties | async">
+```
+[}]: #
+
+Now let's create main stylesheet file (with `.scss` extension), and import the SCSS file from the package:
+
+[{]: <helper> (diff_step 9.4)
+#### Step 9.4: Import styles
+
+##### Added client/main.scss
+```diff
+@@ -0,0 +1 @@
++┊ ┊1┊@import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";🚫↵
+```
+[}]: #
+
+Run the code, you'll see a login link below the form. Click on the link and then "create  account" to sign up. Try to log in and log out.
+
+That's it! As you can see, it's very easy to add basic login support with the help of the Meteor accounts package.
+
+## Parties.allow()
+
+Now that we have our account system, we can start defining our security rules for the parties.
+
+Let's go to the "collection" folder and specify what actions are allowed:
+
+[{]: <helper> (diff_step 9.5)
+#### Step 9.5: Add Parties collection security
+
+##### Changed both/collections/parties.collection.ts
+```diff
+@@ -1,5 +1,16 @@
+ ┊ 1┊ 1┊import { MongoObservable } from 'meteor-rxjs';
++┊  ┊ 2┊import { Meteor } from 'meteor/meteor';
+ ┊ 2┊ 3┊
+ ┊ 3┊ 4┊import { Party } from '../models/party.model';
+ ┊ 4┊ 5┊
+ ┊ 5┊ 6┊export const Parties = new MongoObservable.Collection<Party>('parties');
++┊  ┊ 7┊
++┊  ┊ 8┊function loggedIn() {
++┊  ┊ 9┊  return !!Meteor.user();
++┊  ┊10┊}
++┊  ┊11┊
++┊  ┊12┊Parties.allow({
++┊  ┊13┊  insert: loggedIn,
++┊  ┊14┊  update: loggedIn,
++┊  ┊15┊  remove: loggedIn
++┊  ┊16┊});
+```
+[}]: #
+
+In only 10 lines of code we've specified that inserts, updates and removes can only be completed if a user is logged in.
+
+The callbacks passed to the Parties.allow are executed on the server only. The client optimistically assumes that any action (such as removal of a party) will succeed, and reverts the action as soon as the server denies permission.
+If you want to learn more about those parameters passed into Parties.allow or how this method works in general, please, read the official Meteor [docs on allow](http://docs.meteor.com/#/full/allow).
+
+## Meteor.user()
+
+Let's work on ensuring only the party creator (owner) can change the party data.
+
+First we must define an owner for each party that gets created. We do this by taking our current user's ID and setting it as the owner ID of the created party.
+
+Meteor's base accounts package provides two reactive functions that we are going to
+use, [`Meteor.user()`](http://docs.meteor.com/#/full/meteor_user) and [`Meteor.userId()`](http://docs.meteor.com/#/full/meteor_users).
+
+For now, we are going to keep it simple in this app and allow every logged-in user to change a party.
+It'd be useful to add an alert prompting the user to log in if she wants to add or update a party.
+
+Change the click handler of the "Add" button in the `parties-form.component.ts`, `addParty`:
+
+[{]: <helper> (diff_step 9.6)
+#### Step 9.6: Check access in PartiesForm
+
+##### Changed client/imports/app/parties/parties-form.component.ts
+```diff
+@@ -1,5 +1,6 @@
+ ┊1┊1┊import { Component, OnInit } from '@angular/core';
+ ┊2┊2┊import { FormGroup, FormBuilder, Validators } from '@angular/forms';
++┊ ┊3┊import { Meteor } from 'meteor/meteor';
+ ┊3┊4┊
+ ┊4┊5┊import { Parties } from '../../../../both/collections/parties.collection';
+ ┊5┊6┊
+```
+```diff
+@@ -25,6 +26,11 @@
+ ┊25┊26┊  }
+ ┊26┊27┊
+ ┊27┊28┊  addParty(): void {
++┊  ┊29┊    if (!Meteor.userId()) {
++┊  ┊30┊      alert('Please log in to add a party');
++┊  ┊31┊      return;
++┊  ┊32┊    }
++┊  ┊33┊
+ ┊28┊34┊    if (this.addForm.valid) {
+ ┊29┊35┊      Parties.insert(this.addForm.value);
+```
+[}]: #
+
+Now, change it to save the user ID as well:
+
+[{]: <helper> (diff_step 9.7)
+#### Step 9.7: Add owner
+
+##### Changed client/imports/app/parties/parties-form.component.ts
+```diff
+@@ -32,7 +32,7 @@
+ ┊32┊32┊    }
+ ┊33┊33┊
+ ┊34┊34┊    if (this.addForm.valid) {
+-┊35┊  ┊      Parties.insert(this.addForm.value);
++┊  ┊35┊      Parties.insert(Object.assign({}, this.addForm.value, { owner: Meteor.userId() }));
+ ┊36┊36┊
+ ┊37┊37┊      this.addForm.reset();
+ ┊38┊38┊    }
+```
+[}]: #
+
+Notice that you'll need to update the Party interface in the `party.interface.ts` definition file with the optional new property: `owner?: string`:
+
+[{]: <helper> (diff_step 9.8)
+#### Step 9.8: Define owner in Party type
+
+##### Changed both/models/party.model.ts
+```diff
+@@ -4,4 +4,5 @@
+ ┊4┊4┊  name: string;
+ ┊5┊5┊  description: string;
+ ┊6┊6┊  location: string;
++┊ ┊7┊  owner?: string; 
+ ┊7┊8┊}
+```
+[}]: #
+
+Let's verify the same logic for updating a party:
+
+[{]: <helper> (diff_step 9.9)
+#### Step 9.9: Check access to update a party
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -1,6 +1,7 @@
+ ┊1┊1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊2┊2┊import { ActivatedRoute } from '@angular/router';
+-┊3┊ ┊import { Subscription } from 'rxjs/Subscription'; 
++┊ ┊3┊import { Subscription } from 'rxjs/Subscription';
++┊ ┊4┊import { Meteor } from 'meteor/meteor'; 
+ ┊4┊5┊
+ ┊5┊6┊import 'rxjs/add/operator/map';
+ ┊6┊7┊
+```
+```diff
+@@ -33,6 +34,11 @@
+ ┊33┊34┊  }
+ ┊34┊35┊
+ ┊35┊36┊  saveParty() {
++┊  ┊37┊    if (!Meteor.userId()) {
++┊  ┊38┊      alert('Please log in to change this party');
++┊  ┊39┊      return;
++┊  ┊40┊    }
++┊  ┊41┊    
+ ┊36┊42┊    Parties.update(this.party._id, {
+ ┊37┊43┊      $set: {
+ ┊38┊44┊        name: this.party.name,
+```
+[}]: #
+
+# canActivate
+
+`CanActivate` is a one of three guard types in the new router. It decides if a route can be activated.
+
+Now you can specify if a component can be accessed only when a user is logged in using the `canActivate` property in the router definition.
+
+[{]: <helper> (diff_step 9.10)
+#### Step 9.10: Require user to access PartyDetails
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -1,9 +1,15 @@
+ ┊ 1┊ 1┊import { Route } from '@angular/router';
++┊  ┊ 2┊import { Meteor } from 'meteor/meteor';
+ ┊ 2┊ 3┊
+ ┊ 3┊ 4┊import { PartiesListComponent } from './parties/parties-list.component';
+ ┊ 4┊ 5┊import { PartyDetailsComponent } from './parties/party-details.component';
+ ┊ 5┊ 6┊
+ ┊ 6┊ 7┊export const routes: Route[] = [
+ ┊ 7┊ 8┊  { path: '', component: PartiesListComponent },
+-┊ 8┊  ┊  { path: 'party/:partyId', component: PartyDetailsComponent }
++┊  ┊ 9┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] }
+ ┊ 9┊10┊];
++┊  ┊11┊
++┊  ┊12┊export const ROUTES_PROVIDERS = [{
++┊  ┊13┊  provide: 'canActivateForLoggedIn',
++┊  ┊14┊  useValue: () => !! Meteor.userId()
++┊  ┊15┊}];
+```
+[}]: #
+
+We created a new provider called `canActivateForLoggedIn` that contains a boolean value with login state.
+
+As you can see we specified only the name of that provider inside `canActivate` property.
+
+It's worth mentioning that guards can receive more than one provider.
+
+Now, we only need to declare this provider in our NgModule:
+
+[{]: <helper> (diff_step 9.11)
+#### Step 9.11: Add ROUTES_PROVIDERS
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -5,7 +5,7 @@
+ ┊ 5┊ 5┊import { AccountsModule } from 'angular2-meteor-accounts-ui';
+ ┊ 6┊ 6┊
+ ┊ 7┊ 7┊import { AppComponent } from './app.component';
+-┊ 8┊  ┊import { routes } from './app.routes';
++┊  ┊ 8┊import { routes, ROUTES_PROVIDERS } from './app.routes';
+ ┊ 9┊ 9┊import { PARTIES_DECLARATIONS } from './parties';
+ ┊10┊10┊
+ ┊11┊11┊@NgModule({
+```
+```diff
+@@ -20,6 +20,9 @@
+ ┊20┊20┊    AppComponent,
+ ┊21┊21┊    ...PARTIES_DECLARATIONS
+ ┊22┊22┊  ],
++┊  ┊23┊  providers: [
++┊  ┊24┊    ...ROUTES_PROVIDERS
++┊  ┊25┊  ],
+ ┊23┊26┊  bootstrap: [
+ ┊24┊27┊    AppComponent
+ ┊25┊28┊  ]
+```
+[}]: #
+
+# InjectUser
+
+If you place `@InjectUser` above the `PartiesFormComponent` it will inject a new user property:
+
+__`client/imports/parties/parties-form.component.ts`__:
+
+    import { InjectUser } from 'angular2-meteor-accounts-ui';
+
+    import template from './parties-form.component.html';
+
+    @Component({
+      selector: 'parties-form',
+      template,
+    })
+    @InjectUser('user')
+    export class PartiesFormComponent {
+      user: Meteor.User;
+
+      constructor() {
+        console.log(this.user);
+      }
+    }
+
+Call `this.user` and you will see that it returns the same object as `Meteor.user()`.
+The new property is reactive and can be used in any template, for example:
+
+__`client/imports/parties/parties-form.component.html`__:
+
+    <div *ngIf="!user">Please, log in to change party</div>
+    <form ...>
+      ...
+    </form>
+
+As you can see, we've added a label "Please, login to change party" that is
+conditioned to be shown if `user` is not defined with help of an `ngIf` attribute, and
+will be hidden otherwise.
+
+# Routing Permissions
+
+Let's imagine now that we allow to see and change party details only for logged-in users.
+An ideal way to implement this would be to restrict redirecting to the party details page when
+someone clicks on a party link. In this case, we don't need to check access manually in the party details component itself because the route request is denied early on.
+
+This can be easily done again with help of `CanActivate` property. You can do this with the PartyDetailsComponent, just like we did previous steps earlier with the PartiesFormComponent.
+
+Now log out and try to click on any party link. See, links don't work!
+
+But what about more sophisticated access? Say, let's prevent access into the PartyDetails view for those
+who don't own that particular party.
+
+It could be done inside of a component using `canActivate` method.
+
+Let's add a `canActivate` method and `CanActivate` interface, where we get the current route's `partyId` parameter
+and check if the corresponding party's owner is the same as the currently logged-in user.
+
+  __`client/imports/parties/party-details.component.ts`__:
+    import { CanActivate } from '@angular/router';
+    import template from './party-details.component.html';
+
+    @Component({
+      selector: 'party-details',
+      template
+    })
+    export class PartyDetails implements CanActivate {
+      ...
+
+      canActivate() {
+        const party = Parties.findOne(this.partyId);
+        return (party && party.owner == Meteor.userId());
+      }
+    }
+
+Now log in, then add a new party, log out and click on the party link.
+Nothing happens meaning that access is restricted to party owners.
+
+Please note it is possible for someone with malicious intent to override your routing restrictions on the client.
+You should never restrict access to sensitive data, sensitive areas, using the client router only.
+
+This is the reason we also made restrictions on the server using the allow/deny functionality, so even if someone gets in they cannot make updates.
+While this prevents writes from happening from unintended sources, reads can still be an issue.
+The next step will take care of privacy, not showing users parties they are not allowed to see.
+
+# Summary
+
+Amazing, only a few lines of code and we have a much more secure application!
+
+We've added two powerful features to our app:
+
+- the "accounts-ui" package that comes with features like user login, logout, registration
+  and complete UI supporting them;
+- restricted access to the party details page, with access available for logged-in users only.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step8.md) | [Next Step >](step10.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From a08ecc730225e63ee9d598b73c654e694fd196ef Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 12:54:25 +0200
Subject: [PATCH 076/292] Step 10.1: Remove autopublish package

---
 .meteor/packages | 1 -
 .meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index eb89681..27a491b 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -15,7 +15,6 @@ standard-minifier-css@1.2.0   # CSS minifier run for production mode
 standard-minifier-js@1.2.0    # JS minifier run for production mode
 es5-shim@4.6.14                # ECMAScript 5 compatibility for older browsers.
 
-autopublish@1.0.7             # Publish all data to the clients (for prototyping)
 angular2-compilers
 practicalmeteor:mocha
 xolvio:cleaner
diff --git a/.meteor/versions b/.meteor/versions
index a935b08..749f684 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -2,7 +2,6 @@ accounts-base@1.2.11
 accounts-password@1.3.0
 allow-deny@1.0.5
 angular2-compilers@0.6.1
-autopublish@1.0.7
 autoupdate@1.2.11
 babel-compiler@6.9.1
 babel-runtime@0.1.11
-- 
2.7.4


From c5b3c5dbb1981ad95e2ec86b9592771650881aad Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 12:56:22 +0200
Subject: [PATCH 077/292] Step 10.2: Publish Parties collection

---
 server/imports/publications/parties.ts | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 server/imports/publications/parties.ts

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
new file mode 100644
index 0000000..08ef863
--- /dev/null
+++ b/server/imports/publications/parties.ts
@@ -0,0 +1,4 @@
+import { Meteor } from 'meteor/meteor';
+import { Parties } from '../../../both/collections/parties.collection';
+
+Meteor.publish('parties', () => Parties.find());
-- 
2.7.4


From cbded5e343f84c12501cda974f3dcaade9fcc521 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 12:57:35 +0200
Subject: [PATCH 078/292] Step 10.3: Add publication to server-side entry point

---
 server/main.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/server/main.ts b/server/main.ts
index cf58a8d..7f8e626 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -2,6 +2,8 @@ import { Meteor } from 'meteor/meteor';
 
 import { loadParties } from './imports/fixtures/parties';
 
+import './imports/publications/parties'; 
+
 Meteor.startup(() => {
   loadParties();
 });
-- 
2.7.4


From 2d6aaecb1a842900caba73990427a3c4ff94df96 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 13:54:06 +0200
Subject: [PATCH 079/292] Step 10.4: Subscribe to Parties publication

---
 client/imports/app/parties/parties-list.component.ts | 14 +++++++++++---
 1 file changed, 11 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index bb09b1c..93be382 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -1,5 +1,7 @@
-import { Component } from '@angular/core';
+import { Component, OnInit, OnDestroy } from '@angular/core';
 import { Observable } from 'rxjs/Observable';
+import { Subscription } from 'rxjs/Subscription';
+import { MeteorObservable } from 'meteor-rxjs';
 
 import { Parties } from '../../../../both/collections/parties.collection';
 import { Party } from '../../../../both/models/party.model';
@@ -10,14 +12,20 @@ import template from './parties-list.component.html';
   selector: 'parties-list',
   template
 })
-export class PartiesListComponent {
+export class PartiesListComponent implements OnInit, OnDestroy {
   parties: Observable<Party[]>;
+  partiesSub: Subscription;
 
-  constructor() {
+  ngOnInit() {
     this.parties = Parties.find({}).zone();
+    this.partiesSub = MeteorObservable.subscribe('parties').subscribe();
   }
 
   removeParty(party: Party): void {
     Parties.remove(party._id);
   }
+
+  ngOnDestroy() {
+    this.partiesSub.unsubscribe();
+  }
 }
-- 
2.7.4


From ff22904185bb4d3107421249cb134dcda0390996 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:02:19 +0200
Subject: [PATCH 080/292] Step 10.5: Add checkbox for public property

---
 client/imports/app/parties/parties-form.component.html | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index 98f90ca..3cc8990 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -7,6 +7,9 @@
 
   <label>Location</label>
   <input type="text" formControlName="location">
+
+  <label>Public</label>
+  <input type="checkbox" formControlName="public">
   
   <button type="submit">Add</button>
 </form>
\ No newline at end of file
-- 
2.7.4


From b7cd6849d879f328939a6f139d9616b26cdceacf Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:05:09 +0200
Subject: [PATCH 081/292] Step 10.6: Update Party interface

---
 both/models/party.model.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
index 5b20610..2526c11 100644
--- a/both/models/party.model.ts
+++ b/both/models/party.model.ts
@@ -4,5 +4,6 @@ export interface Party extends CollectionObject {
   name: string;
   description: string;
   location: string;
-  owner?: string; 
+  owner?: string;
+  public: boolean;
 }
-- 
2.7.4


From b3341216308bf41e631623ea2f955c63fcb52027 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:05:26 +0200
Subject: [PATCH 082/292] Step 10.7: Update parties initials

---
 server/imports/fixtures/parties.ts | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/server/imports/fixtures/parties.ts b/server/imports/fixtures/parties.ts
index 4f6d555..e49a665 100644
--- a/server/imports/fixtures/parties.ts
+++ b/server/imports/fixtures/parties.ts
@@ -6,15 +6,18 @@ export function loadParties() {
     const parties: Party[] = [{
       name: 'Dubstep-Free Zone',
       description: 'Can we please just for an evening not listen to dubstep.',
-      location: 'Palo Alto'
+      location: 'Palo Alto',
+      public: true
     }, {
       name: 'All dubstep all the time',
       description: 'Get it on!',
-      location: 'Palo Alto'
+      location: 'Palo Alto',
+      public: true
     }, {
       name: 'Savage lounging',
       description: 'Leisure suit required. And only fiercest manners.',
-      location: 'San Francisco'
+      location: 'San Francisco',
+      public: true
     }];
 
     parties.forEach((party: Party) => Parties.insert(party));
-- 
2.7.4


From 1c992f0b7ec3bd98c18689a1115abdcd6f27ec4c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:06:19 +0200
Subject: [PATCH 083/292] Step 10.8: Add public property to form builder

---
 client/imports/app/parties/parties-form.component.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index 978f6e4..0823749 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -21,7 +21,8 @@ export class PartiesFormComponent implements OnInit {
     this.addForm = this.formBuilder.group({
       name: ['', Validators.required],
       description: [],
-      location: ['', Validators.required]
+      location: ['', Validators.required],
+      public: [false]
     });
   }
 
-- 
2.7.4


From 8a7104d6a80cb7743683d19c3c8a360b063912b3 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:09:53 +0200
Subject: [PATCH 084/292] Step 10.9: Limit data sent to the client

---
 server/imports/publications/parties.ts | 22 +++++++++++++++++++++-
 1 file changed, 21 insertions(+), 1 deletion(-)

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
index 08ef863..b7652bb 100644
--- a/server/imports/publications/parties.ts
+++ b/server/imports/publications/parties.ts
@@ -1,4 +1,24 @@
 import { Meteor } from 'meteor/meteor';
 import { Parties } from '../../../both/collections/parties.collection';
 
-Meteor.publish('parties', () => Parties.find());
+Meteor.publish('parties', function() {
+  const selector = {
+    $or: [{
+      // party is public
+      public: true
+    },
+    // or
+    { 
+      // current user is the owner
+      $and: [{
+        owner: this.userId 
+      }, {
+        owner: {
+          $exists: true
+        }
+      }]
+    }]
+  };
+
+  return Parties.find(selector);
+});
-- 
2.7.4


From d2b39405ab8d39a75b45b36fd1a41af41a2efc23 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:13:28 +0200
Subject: [PATCH 085/292] Step 10.10: Add party publication

---
 server/imports/publications/parties.ts | 26 +++++++++++++++++++++++---
 1 file changed, 23 insertions(+), 3 deletions(-)

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
index b7652bb..5314c57 100644
--- a/server/imports/publications/parties.ts
+++ b/server/imports/publications/parties.ts
@@ -2,7 +2,16 @@ import { Meteor } from 'meteor/meteor';
 import { Parties } from '../../../both/collections/parties.collection';
 
 Meteor.publish('parties', function() {
-  const selector = {
+  return Parties.find(buildQuery.call(this));
+});
+
+Meteor.publish('party', function(partyId: string) {
+  return Parties.find(buildQuery.call(this, partyId));
+});
+
+
+function buildQuery(partyId?: string): Object {
+  const isAvailable = {
     $or: [{
       // party is public
       public: true
@@ -20,5 +29,16 @@ Meteor.publish('parties', function() {
     }]
   };
 
-  return Parties.find(selector);
-});
+  if (partyId) {
+    return {
+      // only single party
+      $and: [{
+          _id: partyId
+        },
+        isAvailable
+      ]
+    };
+  }
+
+  return isAvailable;
+}
\ No newline at end of file
-- 
2.7.4


From b19c86bd6528e2687beb2642d63ecbf3e3282864 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:22:47 +0200
Subject: [PATCH 086/292] Step 10.11: Subscribe to the party publication

---
 client/imports/app/parties/party-details.component.ts | 15 ++++++++++++---
 1 file changed, 12 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 0032c65..9c7a9e7 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -1,7 +1,8 @@
 import { Component, OnInit, OnDestroy } from '@angular/core';
 import { ActivatedRoute } from '@angular/router';
 import { Subscription } from 'rxjs/Subscription';
-import { Meteor } from 'meteor/meteor'; 
+import { Meteor } from 'meteor/meteor';
+import { MeteorObservable } from 'meteor-rxjs';
 
 import 'rxjs/add/operator/map';
 
@@ -18,6 +19,7 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
   partyId: string;
   paramsSub: Subscription;
   party: Party;
+  partySub: Subscription;
 
   constructor(
     private route: ActivatedRoute
@@ -27,9 +29,15 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
     this.paramsSub = this.route.params
       .map(params => params['partyId'])
       .subscribe(partyId => {
-        this.partyId = partyId
+        this.partyId = partyId;
         
-        this.party = Parties.findOne(this.partyId);
+        if (this.partySub) {
+          this.partySub.unsubscribe();
+        }
+
+        this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
+          this.party = Parties.findOne(this.partyId);
+        });
       });
   }
 
@@ -50,5 +58,6 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
 
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
+    this.partySub.unsubscribe();
   }
 }
-- 
2.7.4


From 5e1c26d0418ef3dbd8b29abbfe9d12f0dc80d133 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:24:27 +0200
Subject: [PATCH 087/292] Step 10.12: Add search input

---
 client/imports/app/parties/parties-list.component.html | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 20400c4..bd2f99c 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -1,5 +1,8 @@
 <div>
-  <parties-form></parties-form>
+  <parties-form style="float: left"></parties-form>
+  <input type="text" #searchtext placeholder="Search by Location">
+  <button type="button" (click)="search(searchtext.value)">Search</button>
+  
   <login-buttons></login-buttons>
 
   <ul>
-- 
2.7.4


From 86d22776388a9b07ca9cb8db44c3eb263e2e3834 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:37:54 +0200
Subject: [PATCH 088/292] Step 10.13: Add search method

---
 client/imports/app/parties/parties-list.component.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index 93be382..b80de38 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -25,6 +25,10 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     Parties.remove(party._id);
   }
 
+  search(value: string): void {
+    this.parties = Parties.find(value ? { location: value } : {}).zone();
+  }
+
   ngOnDestroy() {
     this.partiesSub.unsubscribe();
   }
-- 
2.7.4


From e7be98df8ab5b086b90fb0d3d5bb35d509758387 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 13:40:34 -0200
Subject: [PATCH 089/292] Step 10: Privacy and publish-subscribe functions

---
 steps/step10.md | 503 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 503 insertions(+)
 create mode 100644 steps/step10.md

diff --git a/steps/step10.md b/steps/step10.md
new file mode 100644
index 0000000..451106a
--- /dev/null
+++ b/steps/step10.md
@@ -0,0 +1,503 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Privacy and publish-subscribe functions
+
+You may have noticed that all available parties were always shown on the page
+at the time, regardless of whether they had been added by a logged-in user or
+anonymously.
+
+In future versions of our app, we'll probably want to have a RSVP feature for parties,
+which should only display:
+
+- public parties
+- parties the current user has been invited to
+
+In this step we are going to learn how we can restrict data flow from the server side
+to the client side for only desired data in Meteor, based on the user currently logged-in and some other parameters.
+
+## Autopublish
+
+First we need to remove the `autopublish` Meteor package.
+
+`autopublish` is added to any new Meteor project.
+Like it was mentioned before, it pushes a full copy of the database to each client.
+It helped us rapidly develop our app, but it's not so good for privacy...
+
+Write this command in the console:
+
+    meteor remove autopublish
+
+Now run the app. Oops, nothing on the page!
+
+## Meteor.publish
+
+Data in Meteor is published from the server and subscribed to by the client.
+
+We need to tell Meteor what parties we want transferred to the client side.
+
+To do that we will use Meteor's [publish function](http://docs.meteor.com/#/full/meteor_publish).
+
+Publication functions are placed inside the "server" folder so clients won't have access to them.
+
+Let's create a new file inside the "server/imports/publications" folder called `parties.ts`. Here we can specify which parties to pass to the client.
+
+[{]: <helper> (diff_step 10.2)
+#### Step 10.2: Publish Parties collection
+
+##### Added server/imports/publications/parties.ts
+```diff
+@@ -0,0 +1,4 @@
++┊ ┊1┊import { Meteor } from 'meteor/meteor';
++┊ ┊2┊import { Parties } from '../../../both/collections/parties.collection';
++┊ ┊3┊
++┊ ┊4┊Meteor.publish('parties', () => Parties.find());
+```
+[}]: #
+
+As you can see, parameters of the Meteor.publish are self-explanatory:
+first one is a publication name, then there goes a function that returns
+a Mongo cursor, which represents a subset of the parties collection
+that server will transfer to the client.
+
+The publish function can take parameters as well, but
+we'll get to that in a minute.
+
+We've just created a module, as you already know, one necessary thing is left — to import it in the `main.ts` in order to execute code inside:
+
+[{]: <helper> (diff_step 10.3)
+#### Step 10.3: Add publication to server-side entry point
+
+##### Changed server/main.ts
+```diff
+@@ -2,6 +2,8 @@
+ ┊2┊2┊
+ ┊3┊3┊import { loadParties } from './imports/fixtures/parties';
+ ┊4┊4┊
++┊ ┊5┊import './imports/publications/parties'; 
++┊ ┊6┊
+ ┊5┊7┊Meteor.startup(() => {
+ ┊6┊8┊  loadParties();
+ ┊7┊9┊});
+```
+[}]: #
+
+## Meteor.subscribe
+
+[Meteor.subscribe](http://docs.meteor.com/#/full/meteor_subscribe) is the receiving end of Meteor.publish on the client.
+
+:et's add the following line to subscribe to the `parties` publications:
+
+    MeteorObservable.subscribe('parties').subscribe();
+
+> Note that the first `subscribe` belongs to Meteor API, and the return value in this case is an `Observable` because we used `MeteorObservable`. The second `subscribe` is a method of `Observable`.
+
+> When using `MeteorObservable.subscribe`, the `next` callback called only once - when the subscription is ready to use.
+
+But beyond that simplicity there are two small issues we'll need to solve:
+
+1) Ending a subscription.
+
+Each subscription means that Meteor will continue synchronizing (or in Meteor terms, updating reactively) the particular set of data, we've just subscribed to, between server and client.
+If the PartiesList component gets destroyed, we need to inform Meteor to stop that synchronization, otherwise we'll produce a memory leak.
+
+In this case, we will use `OnDestroy` and implement `ngOnDestroy`, and we will use the `Subscription` object returned from our `Observable` - so when the Component is destroyed - the subscription will end.
+
+2) Updating Angular 2's UI
+
+In order to connect Angular 2 and Meteor, we will use a special `Observable` operator called `zone()` - we use it on the Collection query object, so when the collection changes - the view will update.
+
+So, we are going to extend the `PartiesListComponent` component and make use of `MeteorObservable.subscribe`:
+
+[{]: <helper> (diff_step 10.4)
+#### Step 10.4: Subscribe to Parties publication
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -1,5 +1,7 @@
+-┊1┊ ┊import { Component } from '@angular/core';
++┊ ┊1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊2┊2┊import { Observable } from 'rxjs/Observable';
++┊ ┊3┊import { Subscription } from 'rxjs/Subscription';
++┊ ┊4┊import { MeteorObservable } from 'meteor-rxjs';
+ ┊3┊5┊
+ ┊4┊6┊import { Parties } from '../../../../both/collections/parties.collection';
+ ┊5┊7┊import { Party } from '../../../../both/models/party.model';
+```
+```diff
+@@ -10,14 +12,20 @@
+ ┊10┊12┊  selector: 'parties-list',
+ ┊11┊13┊  template
+ ┊12┊14┊})
+-┊13┊  ┊export class PartiesListComponent {
++┊  ┊15┊export class PartiesListComponent implements OnInit, OnDestroy {
+ ┊14┊16┊  parties: Observable<Party[]>;
++┊  ┊17┊  partiesSub: Subscription;
+ ┊15┊18┊
+-┊16┊  ┊  constructor() {
++┊  ┊19┊  ngOnInit() {
+ ┊17┊20┊    this.parties = Parties.find({}).zone();
++┊  ┊21┊    this.partiesSub = MeteorObservable.subscribe('parties').subscribe();
+ ┊18┊22┊  }
+ ┊19┊23┊
+ ┊20┊24┊  removeParty(party: Party): void {
+ ┊21┊25┊    Parties.remove(party._id);
+ ┊22┊26┊  }
++┊  ┊27┊
++┊  ┊28┊  ngOnDestroy() {
++┊  ┊29┊    this.partiesSub.unsubscribe();
++┊  ┊30┊  }
+ ┊23┊31┊}
+```
+[}]: #
+
+Now run the app. Whoa, we've just made all the parties come back using pub/sub!
+
+As it's mentioned earlier, it'd be nice for the app to implement some basic security and show parties based on who owns them. Let's do it.
+
+Firstly, we'll add a new `public` field to the party data through several steps:
+
+Add UI with the new "Public" checkbox to the right of the "Location" input;
+
+[{]: <helper> (diff_step 10.5)
+#### Step 10.5: Add checkbox for public property
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -7,6 +7,9 @@
+ ┊ 7┊ 7┊
+ ┊ 8┊ 8┊  <label>Location</label>
+ ┊ 9┊ 9┊  <input type="text" formControlName="location">
++┊  ┊10┊
++┊  ┊11┊  <label>Public</label>
++┊  ┊12┊  <input type="checkbox" formControlName="public">
+ ┊10┊13┊  
+ ┊11┊14┊  <button type="submit">Add</button>
+ ┊12┊15┊</form>🚫↵
+```
+[}]: #
+
+Update Party in `both/models/party.model.ts` to include `public: boolean`;
+
+[{]: <helper> (diff_step 10.6)
+#### Step 10.6: Update Party interface
+
+##### Changed both/models/party.model.ts
+```diff
+@@ -4,5 +4,6 @@
+ ┊4┊4┊  name: string;
+ ┊5┊5┊  description: string;
+ ┊6┊6┊  location: string;
+-┊7┊ ┊  owner?: string; 
++┊ ┊7┊  owner?: string;
++┊ ┊8┊  public: boolean;
+ ┊8┊9┊}
+```
+[}]: #
+
+Change the initial data on the server in `parties.ts` to contain the `public` field as well:
+
+[{]: <helper> (diff_step 10.7)
+#### Step 10.7: Update parties initials
+
+##### Changed server/imports/fixtures/parties.ts
+```diff
+@@ -6,15 +6,18 @@
+ ┊ 6┊ 6┊    const parties: Party[] = [{
+ ┊ 7┊ 7┊      name: 'Dubstep-Free Zone',
+ ┊ 8┊ 8┊      description: 'Can we please just for an evening not listen to dubstep.',
+-┊ 9┊  ┊      location: 'Palo Alto'
++┊  ┊ 9┊      location: 'Palo Alto',
++┊  ┊10┊      public: true
+ ┊10┊11┊    }, {
+ ┊11┊12┊      name: 'All dubstep all the time',
+ ┊12┊13┊      description: 'Get it on!',
+-┊13┊  ┊      location: 'Palo Alto'
++┊  ┊14┊      location: 'Palo Alto',
++┊  ┊15┊      public: true
+ ┊14┊16┊    }, {
+ ┊15┊17┊      name: 'Savage lounging',
+ ┊16┊18┊      description: 'Leisure suit required. And only fiercest manners.',
+-┊17┊  ┊      location: 'San Francisco'
++┊  ┊19┊      location: 'San Francisco',
++┊  ┊20┊      public: true
+ ┊18┊21┊    }];
+ ┊19┊22┊
+ ┊20┊23┊    parties.forEach((party: Party) => Parties.insert(party));
+```
+[}]: #
+
+Now, let's add the public field to our Form declaration:
+
+[{]: <helper> (diff_step 10.8)
+#### Step 10.8: Add public property to form builder
+
+##### Changed client/imports/app/parties/parties-form.component.ts
+```diff
+@@ -21,7 +21,8 @@
+ ┊21┊21┊    this.addForm = this.formBuilder.group({
+ ┊22┊22┊      name: ['', Validators.required],
+ ┊23┊23┊      description: [],
+-┊24┊  ┊      location: ['', Validators.required]
++┊  ┊24┊      location: ['', Validators.required],
++┊  ┊25┊      public: [false]
+ ┊25┊26┊    });
+ ┊26┊27┊  }
+```
+[}]: #
+
+Next, we are limiting data sent to the client. A simple check is to verify that either
+the party is public or the "owner" field exists and is equal to the currently logged-in user:
+
+[{]: <helper> (diff_step 10.9)
+#### Step 10.9: Limit data sent to the client
+
+##### Changed server/imports/publications/parties.ts
+```diff
+@@ -1,4 +1,24 @@
+ ┊ 1┊ 1┊import { Meteor } from 'meteor/meteor';
+ ┊ 2┊ 2┊import { Parties } from '../../../both/collections/parties.collection';
+ ┊ 3┊ 3┊
+-┊ 4┊  ┊Meteor.publish('parties', () => Parties.find());
++┊  ┊ 4┊Meteor.publish('parties', function() {
++┊  ┊ 5┊  const selector = {
++┊  ┊ 6┊    $or: [{
++┊  ┊ 7┊      // party is public
++┊  ┊ 8┊      public: true
++┊  ┊ 9┊    },
++┊  ┊10┊    // or
++┊  ┊11┊    { 
++┊  ┊12┊      // current user is the owner
++┊  ┊13┊      $and: [{
++┊  ┊14┊        owner: this.userId 
++┊  ┊15┊      }, {
++┊  ┊16┊        owner: {
++┊  ┊17┊          $exists: true
++┊  ┊18┊        }
++┊  ┊19┊      }]
++┊  ┊20┊    }]
++┊  ┊21┊  };
++┊  ┊22┊
++┊  ┊23┊  return Parties.find(selector);
++┊  ┊24┊});
+```
+[}]: #
+
+> `$or`, `$and` and `$exists` names are part of the MongoDB query syntax.
+> If you are not familiar with it, please, read about them here: [$or](http://docs.mongodb.org/manual/reference/operator/query/or/), [$and](http://docs.mongodb.org/manual/reference/operator/query/and/) and [$exists](http://docs.mongodb.org/manual/reference/operator/query/exists/).
+
+We also need to reset the database since schema of the parties inside is already invalid:
+
+    meteor reset
+
+Let's check to make sure everything is working.
+
+Run the app again, and you will see only two items. That's because we set the third party to be private.
+
+Log in with 2 different users in 2 different browsers. Try to create a couple of public parties and a couple of private ones. Now log out and check out what parties are shown. Only public parties should be visible.
+
+Now log in as a party owner user and verify that a couple of private parties got to the page as well.
+
+## Subscribe with Params
+
+There is one page in our app so far where we'll need parameterized publishing — the `PartyDetails` component's page.
+Besides that, let's add another cool feature to Socially, party search by location.
+
+As you already know, the second parameter of Meteor.publish is a callback function that can take a variable number
+of parameters, and these parameters are passed by the user to `Meteor.subscribe` on the client.
+
+Let's elaborate our "party" publication on the server. We want to publish both a list of parties and a single party.
+
+[{]: <helper> (diff_step 10.10)
+#### Step 10.10: Add party publication
+
+##### Changed server/imports/publications/parties.ts
+```diff
+@@ -2,7 +2,16 @@
+ ┊ 2┊ 2┊import { Parties } from '../../../both/collections/parties.collection';
+ ┊ 3┊ 3┊
+ ┊ 4┊ 4┊Meteor.publish('parties', function() {
+-┊ 5┊  ┊  const selector = {
++┊  ┊ 5┊  return Parties.find(buildQuery.call(this));
++┊  ┊ 6┊});
++┊  ┊ 7┊
++┊  ┊ 8┊Meteor.publish('party', function(partyId: string) {
++┊  ┊ 9┊  return Parties.find(buildQuery.call(this, partyId));
++┊  ┊10┊});
++┊  ┊11┊
++┊  ┊12┊
++┊  ┊13┊function buildQuery(partyId?: string): Object {
++┊  ┊14┊  const isAvailable = {
+ ┊ 6┊15┊    $or: [{
+ ┊ 7┊16┊      // party is public
+ ┊ 8┊17┊      public: true
+```
+```diff
+@@ -20,5 +29,16 @@
+ ┊20┊29┊    }]
+ ┊21┊30┊  };
+ ┊22┊31┊
+-┊23┊  ┊  return Parties.find(selector);
+-┊24┊  ┊});
++┊  ┊32┊  if (partyId) {
++┊  ┊33┊    return {
++┊  ┊34┊      // only single party
++┊  ┊35┊      $and: [{
++┊  ┊36┊          _id: partyId
++┊  ┊37┊        },
++┊  ┊38┊        isAvailable
++┊  ┊39┊      ]
++┊  ┊40┊    };
++┊  ┊41┊  }
++┊  ┊42┊
++┊  ┊43┊  return isAvailable;
++┊  ┊44┊}🚫↵
+```
+[}]: #
+
+Looks like a lot of code, but it does something powerful. The privacy query, we introduced above, was moved to a separate method called `buildQuery`. We'll need this function to avoid repetition with each different parties query.
+
+> Notice that we used `buildQuery.call(this)` calling syntax in order to make context of this method the same as in Meteor.publish and be able to use `this.userId` inside that method.
+
+Let's subscribe to the new publication in the `PartyDetails` to load one specific party:
+
+[{]: <helper> (diff_step 10.11)
+#### Step 10.11: Subscribe to the party publication
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -1,7 +1,8 @@
+ ┊1┊1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊2┊2┊import { ActivatedRoute } from '@angular/router';
+ ┊3┊3┊import { Subscription } from 'rxjs/Subscription';
+-┊4┊ ┊import { Meteor } from 'meteor/meteor'; 
++┊ ┊4┊import { Meteor } from 'meteor/meteor';
++┊ ┊5┊import { MeteorObservable } from 'meteor-rxjs';
+ ┊5┊6┊
+ ┊6┊7┊import 'rxjs/add/operator/map';
+ ┊7┊8┊
+```
+```diff
+@@ -18,6 +19,7 @@
+ ┊18┊19┊  partyId: string;
+ ┊19┊20┊  paramsSub: Subscription;
+ ┊20┊21┊  party: Party;
++┊  ┊22┊  partySub: Subscription;
+ ┊21┊23┊
+ ┊22┊24┊  constructor(
+ ┊23┊25┊    private route: ActivatedRoute
+```
+```diff
+@@ -27,9 +29,15 @@
+ ┊27┊29┊    this.paramsSub = this.route.params
+ ┊28┊30┊      .map(params => params['partyId'])
+ ┊29┊31┊      .subscribe(partyId => {
+-┊30┊  ┊        this.partyId = partyId
++┊  ┊32┊        this.partyId = partyId;
+ ┊31┊33┊        
+-┊32┊  ┊        this.party = Parties.findOne(this.partyId);
++┊  ┊34┊        if (this.partySub) {
++┊  ┊35┊          this.partySub.unsubscribe();
++┊  ┊36┊        }
++┊  ┊37┊
++┊  ┊38┊        this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
++┊  ┊39┊          this.party = Parties.findOne(this.partyId);
++┊  ┊40┊        });
+ ┊33┊41┊      });
+ ┊34┊42┊  }
+ ┊35┊43┊
+```
+```diff
+@@ -50,5 +58,6 @@
+ ┊50┊58┊
+ ┊51┊59┊  ngOnDestroy() {
+ ┊52┊60┊    this.paramsSub.unsubscribe();
++┊  ┊61┊    this.partySub.unsubscribe();
+ ┊53┊62┊  }
+ ┊54┊63┊}
+```
+[}]: #
+
+We used `MeteorObservable.subscribe` with the parameter we got from the Router params, and do the same logic of OnDestroy.
+
+> Note that in this case, we use the Subscription of the `MeteorObservable.subscribe`, in order to know when the subscription is ready to use, and then we used `findOne` to get the actual object from the Collection.
+
+Run the app and click on one of the party links. You'll see that the party details page loads with full data as before.
+
+# Search
+
+Now it's time for the parties search. Let's add a search input and button to the right of the "Add" button.
+We are going to extend the `PartiesList` component since this features is related to the parties list itself:
+
+[{]: <helper> (diff_step 10.12)
+#### Step 10.12: Add search input
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -1,5 +1,8 @@
+ ┊1┊1┊<div>
+-┊2┊ ┊  <parties-form></parties-form>
++┊ ┊2┊  <parties-form style="float: left"></parties-form>
++┊ ┊3┊  <input type="text" #searchtext placeholder="Search by Location">
++┊ ┊4┊  <button type="button" (click)="search(searchtext.value)">Search</button>
++┊ ┊5┊  
+ ┊3┊6┊  <login-buttons></login-buttons>
+ ┊4┊7┊
+ ┊5┊8┊  <ul>
+```
+[}]: #
+
+As you may have guessed, the next thing is to process the button click event:
+
+[{]: <helper> (diff_step 10.13)
+#### Step 10.13: Add search method
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -25,6 +25,10 @@
+ ┊25┊25┊    Parties.remove(party._id);
+ ┊26┊26┊  }
+ ┊27┊27┊
++┊  ┊28┊  search(value: string): void {
++┊  ┊29┊    this.parties = Parties.find(value ? { location: value } : {}).zone();
++┊  ┊30┊  }
++┊  ┊31┊
+ ┊28┊32┊  ngOnDestroy() {
+ ┊29┊33┊    this.partiesSub.unsubscribe();
+ ┊30┊34┊  }
+```
+[}]: #
+
+Notice that we don't re-subscribe in the `search` method because we've already loaded all parties available to
+the current user from the published parties, so we just query the loaded collection.
+
+# Understanding Publish-Subscribe
+
+It is very important to understand Meteor's Publish-Subscribe mechanism so you don't get confused and use it to filter things in the view!
+
+Meteor accumulates all the data from the different subscriptions of the same collection in the client, so adding a different subscription in a different view won't delete the data that is already in the client.
+
+Please, read more about Pub/Sub in Meteor [here](http://www.meteorpedia.com/read/Understanding_Meteor_Publish_and_Subscribe).
+
+# Summary
+
+In this step we've clearly seen how powerful Meteor and Angular 2 are and how they become even more
+powerful when used together. With rather few lines of code, we were able to add full privacy to Socially as well as
+search capabilities.
+
+Meanwhile, we've learned about:
+
+- the importance of removing `autopublish`;
+- the Publish-Subscribe mechanism in Meteor;
+- how to query particular data from the database via the server side.
+
+In the next step, we'll look at how quick and easy it is to deploy your Meteor app.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step9.md) | [Next Step >](step11.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 37dadc3af20751da6a2c9da47193c8a359edd9d1 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 13:43:19 -0200
Subject: [PATCH 090/292] Step 11: Deploying your app

---
 steps/step11.md | 43 +++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 43 insertions(+)
 create mode 100644 steps/step11.md

diff --git a/steps/step11.md b/steps/step11.md
new file mode 100644
index 0000000..cff3188
--- /dev/null
+++ b/steps/step11.md
@@ -0,0 +1,43 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Deploying your app
+
+Now that we have a working app, we can go public!
+
+One way to operate your app with confidence is to use Galaxy, the service built by Meteor Development Group specifically to run Meteor apps.
+
+In order to deploy to Galaxy, you’ll need to sign up for an account [here](https://www.meteor.com/galaxy/signup), and separately provision a MongoDB database later.
+
+Simply type in the command line of your app directory
+(replace `your-app` with your own name):
+
+    DEPLOY_HOSTNAME=galaxy.meteor.com meteor deploy your-app.com
+
+In order for Galaxy to work with your custom domain (your-app.com in this case), you need to [set up your DNS to point at Galaxy](https://galaxy.meteor.com/help/configuring-dns). Once you’ve done this, you should be able to reach your site from a browser.
+
+For full Galaxy deployment tutorial, please follow [here](http://guide.meteor.com/deployment.html#deployment-options).
+
+Now try to play around with the deployed app on different devices.
+This might be in a browser on your mobile phone, a laptop or a desktop computer.
+
+Add, remove and change some parties and you will see that all opened versions of the app update
+almost simultaneously on different devices.
+
+UI updates of a Meteor app are fast, user-friendly and reliable,
+thanks to WebSockets, latency compensation and different complex concepts realized in Meteor.
+
+# Summary
+
+Congratulations, you've made a working app that you can now use with your friends!
+
+In the next step, we'll take a detour to see that while we were building a web app, we've also created a pretty nice mobile app along the way.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step10.md) | [Next Step >](step12.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From e9a812bfce6a1e630f04b085cfc25f8beceb1975 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 13:48:36 -0200
Subject: [PATCH 091/292] Step 12: Running your app on Android or iOS with
 PhoneGap

---
 steps/step12.md | 96 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 96 insertions(+)
 create mode 100644 steps/step12.md

diff --git a/steps/step12.md b/steps/step12.md
new file mode 100644
index 0000000..1cad732
--- /dev/null
+++ b/steps/step12.md
@@ -0,0 +1,96 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Running your app on Android or iOS with PhoneGap
+
+So far, we've been building our app and testing only in a web browser,
+however Meteor has been designed to work across different platforms — your socially website can become an iOS or Android app with just a few commands.
+
+## Cordova
+
+Meteor uses an open-sourced framework called [Cordova](https://cordova.apache.org) to build and run Web apps on iOS or Android mobile devices.
+
+Cordova is integrated with Meteor's toolkit, which means you won't need anything more than the `meteor` command in the terminal to build mobile Web apps. You will, however, require two necessary dependencies to install:
+
+- an Android emulator for Android
+- XCode for iOS.
+
+In addition, Meteor has an especially useful feature for mobile apps: [hot code pushes](http://info.meteor.com/blog/meteor-hot-code-push).
+After you deploy your app to the stores, once you update your code, all your apps are instantly updated; no need to go through the app/play store update process!
+
+You can find more information about Cordova integration with Meteor [here](https://github.com/meteor/meteor/wiki/Meteor-Cordova-Phonegap-integration).
+
+### Running on Android Emulator
+
+Follow this [instruction](https://github.com/meteor/meteor/wiki/Mobile-Development-Install:-Android-on-Mac) to install all of the necessary tools to build an Android app from your project.
+
+When you are done installing everything, type:
+
+    meteor add-platform android
+
+After you agree to the license terms, type:
+
+    meteor run android
+
+After some initialization, you will see an Android emulator pop up, running your app inside of a native Android wrapper. The emulator can be somewhat slow, [Geny Motion](https://www.genymotion.com/) is a popular Android emulator alternative. However, if you want to see what it's really like using your app, you should run it on an actual device.
+
+### Running on an Android Device
+
+First, complete all of the steps above to set up the Android tools on your system.
+Then, make sure you have USB Debugging enabled on your phone and the phone is plugged into your computer with a USB cable. You must also quit the Android emulator before running your app on a device.
+
+Run the following command:
+
+    meteor run android-device
+
+The app will be built and installed on your device. If you want to point your app to the server you deployed in the previous step, run:
+
+    meteor run android-device --mobile-server my_app_name.meteor.com
+
+### Running on an iOS simulator (Mac Only)
+
+If you have a Mac, you can run your app inside the iOS simulator.
+
+Follow this [instruction](https://github.com/meteor/meteor/wiki/Mobile-Development-Install:-iOS-on-Mac) to run you through the setup necessary to build an iOS app from your project.
+
+When you're done, type:
+
+    meteor add-platform ios
+    meteor run ios
+
+You will see the iOS simulator pop up with your app running inside.
+
+### Running on an iPhone or iPad (Mac Only)
+
+> Requires an Apple developer account
+
+If you have an Apple developer account, you can also run your app on an iOS device. Run the following command:
+
+    meteor run ios-device
+
+This will open Xcode with a project for your iOS app. You can use Xcode to then launch the app on any device or simulator that Xcode supports.
+
+If you want to point your app to the previously deployed server, run:
+
+    meteor run ios-device --mobile-server my_app_name.meteor.com
+
+### Submit your Android app to the Play Store:
+
+[https://github.com/meteor/meteor/wiki/How-to-submit-your-Android-app-to-Play-Store](https://github.com/meteor/meteor/wiki/How-to-submit-your-Android-app-to-Play-Store)
+
+### Submit your iOS app to the App Store:
+
+[https://github.com/meteor/meteor/wiki/How-to-submit-your-iOS-app-to-App-Store](https://github.com/meteor/meteor/wiki/How-to-submit-your-iOS-app-to-App-Store)
+
+# Summary
+
+Now that we have seen how easy it is to deploy our app and run it on mobile, let's get to adding some more features. In the next step we'll look at adding party sorting and pagination.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step11.md) | [Next Step >](step13.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From ded2832e73f3cd8850eba7843606d383e5095e08 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Thu, 22 Sep 2016 14:37:40 +0200
Subject: [PATCH 092/292] Step 13.1: Add options to the parties publication

---
 server/imports/publications/parties.ts | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
index 5314c57..1e5d5df 100644
--- a/server/imports/publications/parties.ts
+++ b/server/imports/publications/parties.ts
@@ -1,8 +1,12 @@
 import { Meteor } from 'meteor/meteor';
 import { Parties } from '../../../both/collections/parties.collection';
 
-Meteor.publish('parties', function() {
-  return Parties.find(buildQuery.call(this));
+interface Options {
+  [key: string]: any;
+}
+
+Meteor.publish('parties', function(options: Options) {
+  return Parties.find(buildQuery.call(this), options);
 });
 
 Meteor.publish('party', function(partyId: string) {
-- 
2.7.4


From fa373a0339cb5fc1c1edf238ff85dcf07f1eb19e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:24:11 +0200
Subject: [PATCH 093/292] Step 13.2: Define options and use it in the
 subscription

---
 .../imports/app/parties/parties-list.component.ts  | 23 ++++++++++++++++++++--
 1 file changed, 21 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index b80de38..c9be502 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -8,6 +8,15 @@ import { Party } from '../../../../both/models/party.model';
 
 import template from './parties-list.component.html';
 
+interface Pagination {
+  limit: number;
+  skip: number;
+}
+
+interface Options extends Pagination {
+  [key: string]: any
+}
+
 @Component({
   selector: 'parties-list',
   template
@@ -15,10 +24,20 @@ import template from './parties-list.component.html';
 export class PartiesListComponent implements OnInit, OnDestroy {
   parties: Observable<Party[]>;
   partiesSub: Subscription;
+  pageSize: number = 10;
+  curPage: number = 1;
+  nameOrder: number = 1;
 
   ngOnInit() {
-    this.parties = Parties.find({}).zone();
-    this.partiesSub = MeteorObservable.subscribe('parties').subscribe();
+    const options: Options = {
+      limit: this.pageSize,
+      skip: (this.curPage - 1) * this.pageSize,
+      sort: { name: this.nameOrder }
+    };
+
+    this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
+      this.parties = Parties.find({}).zone();
+    });
   }
 
   removeParty(party: Party): void {
-- 
2.7.4


From e27404561463886f31b0ea9b0ea54ce8b7972ef4 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:27:05 +0200
Subject: [PATCH 094/292] Step 13.3: Add sorting by party name to PartiesList

---
 client/imports/app/parties/parties-list.component.ts | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index c9be502..4930912 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -36,7 +36,11 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     };
 
     this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
-      this.parties = Parties.find({}).zone();
+      this.parties = Parties.find({}, {
+        sort: {
+          name: this.nameOrder
+        }
+      }).zone();
     });
   }
 
-- 
2.7.4


From 247e23e6a75c40d48a29fd4cd43fbf9fe7ad1f52 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:29:02 +0200
Subject: [PATCH 095/292] Step 13.4: Turn primitive values into Subjects

---
 client/imports/app/parties/parties-list.component.ts | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index 4930912..30a8be4 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -1,5 +1,6 @@
 import { Component, OnInit, OnDestroy } from '@angular/core';
 import { Observable } from 'rxjs/Observable';
+import { Subject } from 'rxjs/Subject';
 import { Subscription } from 'rxjs/Subscription';
 import { MeteorObservable } from 'meteor-rxjs';
 
@@ -24,9 +25,9 @@ interface Options extends Pagination {
 export class PartiesListComponent implements OnInit, OnDestroy {
   parties: Observable<Party[]>;
   partiesSub: Subscription;
-  pageSize: number = 10;
-  curPage: number = 1;
-  nameOrder: number = 1;
+  pageSize: Subject<number> = new Subject<number>();
+  curPage: Subject<number> = new Subject<number>();
+  nameOrder: Subject<number> = new Subject<number>();
 
   ngOnInit() {
     const options: Options = {
@@ -42,6 +43,10 @@ export class PartiesListComponent implements OnInit, OnDestroy {
         }
       }).zone();
     });
+
+    this.pageSize.next(10);
+    this.curPage.next(1);
+    this.nameOrder.next(1);
   }
 
   removeParty(party: Party): void {
-- 
2.7.4


From 38f95a0708d2cb3d6bde13a83b16a26b4b8b0929 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:46:28 +0200
Subject: [PATCH 096/292] Step 13.5: Re-subscribe on current page changes

---
 .../imports/app/parties/parties-list.component.ts  | 38 +++++++++++++++-------
 1 file changed, 26 insertions(+), 12 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index 30a8be4..0960bbb 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -4,6 +4,8 @@ import { Subject } from 'rxjs/Subject';
 import { Subscription } from 'rxjs/Subscription';
 import { MeteorObservable } from 'meteor-rxjs';
 
+import 'rxjs/add/operator/combineLatest';
+
 import { Parties } from '../../../../both/collections/parties.collection';
 import { Party } from '../../../../both/models/party.model';
 
@@ -28,20 +30,31 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   pageSize: Subject<number> = new Subject<number>();
   curPage: Subject<number> = new Subject<number>();
   nameOrder: Subject<number> = new Subject<number>();
+  optionsSub: Subscription;
 
   ngOnInit() {
-    const options: Options = {
-      limit: this.pageSize,
-      skip: (this.curPage - 1) * this.pageSize,
-      sort: { name: this.nameOrder }
-    };
-
-    this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
-      this.parties = Parties.find({}, {
-        sort: {
-          name: this.nameOrder
-        }
-      }).zone();
+    this.optionsSub = Observable.combineLatest(
+      this.pageSize,
+      this.curPage,
+      this.nameOrder
+    ).subscribe(([pageSize, curPage, nameOrder]) => {
+      const options: Options = {
+        limit: pageSize as number,
+        skip: ((curPage as number) - 1) * (pageSize as number),
+        sort: { name: nameOrder as number }
+      };
+
+      if (this.partiesSub) {
+        this.partiesSub.unsubscribe();
+      }
+      
+      this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
+        this.parties = Parties.find({}, {
+          sort: {
+            name: nameOrder
+          }
+        }).zone();
+      });
     });
 
     this.pageSize.next(10);
@@ -59,5 +72,6 @@ export class PartiesListComponent implements OnInit, OnDestroy {
 
   ngOnDestroy() {
     this.partiesSub.unsubscribe();
+    this.optionsSub.unsubscribe();
   }
 }
-- 
2.7.4


From 8f0574a9aec938f506ccde8d1f7a7f1c36d50503 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:51:56 +0200
Subject: [PATCH 097/292] Step 13.6: Install ng2-pagination

---
 package.json | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/package.json b/package.json
index 710bd25..6b995da 100644
--- a/package.json
+++ b/package.json
@@ -28,7 +28,8 @@
     "angular2-meteor-tests-polyfills": "0.0.2",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
-    "reflect-metadata": "0.1.8",
+    "ng2-pagination": "0.4.1",
+    "reflect-metadata": "^0.1.8",
     "rxjs": "5.0.0-beta.12",
     "zone.js": "0.6.21"
   },
-- 
2.7.4


From c393788411cbf07e13951475a253a50725c2b1ba Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:53:03 +0200
Subject: [PATCH 098/292] Step 13.7: Import Ng2PaginationModule

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 139b880..65145a8 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -3,6 +3,7 @@ import { BrowserModule } from '@angular/platform-browser';
 import { FormsModule, ReactiveFormsModule } from '@angular/forms';
 import { RouterModule } from '@angular/router';
 import { AccountsModule } from 'angular2-meteor-accounts-ui';
+import { Ng2PaginationModule } from 'ng2-pagination';
 
 import { AppComponent } from './app.component';
 import { routes, ROUTES_PROVIDERS } from './app.routes';
@@ -14,7 +15,8 @@ import { PARTIES_DECLARATIONS } from './parties';
     FormsModule,
     ReactiveFormsModule,
     RouterModule.forRoot(routes),
-    AccountsModule
+    AccountsModule,
+    Ng2PaginationModule
   ],
   declarations: [
     AppComponent,
-- 
2.7.4


From 483970a78c54d879479678401b9c1765c90c3d9d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:54:54 +0200
Subject: [PATCH 099/292] Step 13.8: Register configuration of pagination

---
 client/imports/app/parties/parties-list.component.ts | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index 0960bbb..aacb366 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -3,6 +3,7 @@ import { Observable } from 'rxjs/Observable';
 import { Subject } from 'rxjs/Subject';
 import { Subscription } from 'rxjs/Subscription';
 import { MeteorObservable } from 'meteor-rxjs';
+import { PaginationService } from 'ng2-pagination';
 
 import 'rxjs/add/operator/combineLatest';
 
@@ -32,6 +33,10 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   nameOrder: Subject<number> = new Subject<number>();
   optionsSub: Subscription;
 
+  constructor(
+    private paginationService: PaginationService
+  ) {}
+
   ngOnInit() {
     this.optionsSub = Observable.combineLatest(
       this.pageSize,
@@ -57,6 +62,13 @@ export class PartiesListComponent implements OnInit, OnDestroy {
       });
     });
 
+    this.paginationService.register({
+      id: this.paginationService.defaultId,
+      itemsPerPage: 10,
+      currentPage: 1,
+      totalItems: 30,
+    });
+
     this.pageSize.next(10);
     this.curPage.next(1);
     this.nameOrder.next(1);
-- 
2.7.4


From 1de71961117e486868ab7ea1e77109ae9680597d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:56:31 +0200
Subject: [PATCH 100/292] Step 13.9: Update current page when options change

---
 client/imports/app/parties/parties-list.component.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index aacb366..bc1fa19 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -49,6 +49,8 @@ export class PartiesListComponent implements OnInit, OnDestroy {
         sort: { name: nameOrder as number }
       };
 
+      this.paginationService.setCurrentPage(this.paginationService.defaultId, curPage as number);
+
       if (this.partiesSub) {
         this.partiesSub.unsubscribe();
       }
-- 
2.7.4


From 979f0905326f33f8815784078a1360a6ff256604 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:58:16 +0200
Subject: [PATCH 101/292] Step 13.10: Add pagination to the list

---
 client/imports/app/parties/parties-list.component.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index bd2f99c..d72d6f5 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -13,4 +13,6 @@
       <button (click)="removeParty(party)">X</button>
     </li>
   </ul>
+
+  <pagination-controls></pagination-controls>
 </div>
\ No newline at end of file
-- 
2.7.4


From 2a008631d54f27abdcc8df2392b4c186a9cee244 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:58:41 +0200
Subject: [PATCH 102/292] Step 13.11: Add pageChange event binding

---
 client/imports/app/parties/parties-list.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index d72d6f5..4e998d4 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -14,5 +14,5 @@
     </li>
   </ul>
 
-  <pagination-controls></pagination-controls>
+  <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
 </div>
\ No newline at end of file
-- 
2.7.4


From 71e209a47d4b48ee2a15953bf8a99a78f6608323 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 12:59:27 +0200
Subject: [PATCH 103/292] Step 13.12: Add event handler for pageChange

---
 client/imports/app/parties/parties-list.component.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index bc1fa19..d360f15 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -84,6 +84,10 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     this.parties = Parties.find(value ? { location: value } : {}).zone();
   }
 
+  onPageChanged(page: number): void {
+    this.curPage.next(page);
+  }
+
   ngOnDestroy() {
     this.partiesSub.unsubscribe();
     this.optionsSub.unsubscribe();
-- 
2.7.4


From 9a1afcd93740398dc9182885f605d28d496de2f5 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 13:01:25 +0200
Subject: [PATCH 104/292] Step 13.13: Add tmeasday:publish-counts

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 27a491b..4a92e64 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -22,3 +22,4 @@ hwillson:stub-collections
 dispatch:mocha-phantomjs
 shell-server
 accounts-password
+tmeasday:publish-counts
diff --git a/.meteor/versions b/.meteor/versions
index 749f684..f90fa45 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -84,6 +84,7 @@ standard-minifier-css@1.2.0
 standard-minifier-js@1.2.0
 templating@1.1.14
 templating-tools@1.0.5
+tmeasday:publish-counts@0.7.3
 tmeasday:test-reporter-helpers@0.2.1
 tracker@1.1.0
 ui@1.0.12
-- 
2.7.4


From 1f1ac6b90440eca8b515e5385530c1102a116321 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 13:15:05 +0200
Subject: [PATCH 105/292] Step 13.14: Publish total number of parties

---
 server/imports/publications/parties.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
index 1e5d5df..f772e48 100644
--- a/server/imports/publications/parties.ts
+++ b/server/imports/publications/parties.ts
@@ -1,4 +1,6 @@
 import { Meteor } from 'meteor/meteor';
+import { Counts } from 'meteor/tmeasday:publish-counts';
+
 import { Parties } from '../../../both/collections/parties.collection';
 
 interface Options {
@@ -6,6 +8,8 @@ interface Options {
 }
 
 Meteor.publish('parties', function(options: Options) {
+  Counts.publish(this, 'numberOfParties', Parties.collection.find(buildQuery.call(this)), { noReady: true });
+
   return Parties.find(buildQuery.call(this), options);
 });
 
-- 
2.7.4


From cb8302c42795c0a2be9c7c02b0e1e7300af2e20d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 13:15:19 +0200
Subject: [PATCH 106/292] Step 13.15: Add declaration of counts package

---
 typings.d.ts | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/typings.d.ts b/typings.d.ts
index 1684801..b80dd63 100644
--- a/typings.d.ts
+++ b/typings.d.ts
@@ -1,4 +1,15 @@
 declare module '*.html' {
   const template: string;
   export default template;
-}
\ No newline at end of file
+}
+
+declare module 'meteor/tmeasday:publish-counts' {
+  import { Mongo } from 'meteor/mongo';
+  
+  interface CountsObject {
+    get(publicationName: string): number;
+    publish(context: any, publicationName: string, cursor: Mongo.Cursor, options: any): number;
+  }
+
+  export const Counts: CountsObject;
+}
-- 
2.7.4


From eda471defd4107f053491fee53050d31e5909857 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 13:32:27 +0200
Subject: [PATCH 107/292] Step 13.16: Handle reactive updates of the parties
 total number

---
 client/imports/app/parties/parties-list.component.ts | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index d360f15..b725d0c 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -4,6 +4,7 @@ import { Subject } from 'rxjs/Subject';
 import { Subscription } from 'rxjs/Subscription';
 import { MeteorObservable } from 'meteor-rxjs';
 import { PaginationService } from 'ng2-pagination';
+import { Counts } from 'meteor/tmeasday:publish-counts';
 
 import 'rxjs/add/operator/combineLatest';
 
@@ -32,6 +33,8 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   curPage: Subject<number> = new Subject<number>();
   nameOrder: Subject<number> = new Subject<number>();
   optionsSub: Subscription;
+  partiesSize: number = 0;
+  autorunSub: Subscription;
 
   constructor(
     private paginationService: PaginationService
@@ -68,12 +71,17 @@ export class PartiesListComponent implements OnInit, OnDestroy {
       id: this.paginationService.defaultId,
       itemsPerPage: 10,
       currentPage: 1,
-      totalItems: 30,
+      totalItems: this.partiesSize
     });
 
     this.pageSize.next(10);
     this.curPage.next(1);
     this.nameOrder.next(1);
+
+    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
+      this.partiesSize = Counts.get('numberOfParties');
+      this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
+    });
   }
 
   removeParty(party: Party): void {
@@ -91,5 +99,6 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   ngOnDestroy() {
     this.partiesSub.unsubscribe();
     this.optionsSub.unsubscribe();
+    this.autorunSub.unsubscribe();
   }
 }
-- 
2.7.4


From 93c6f02deb82e5c2c802c63a47796071e584bfc0 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 14:07:04 +0200
Subject: [PATCH 108/292] Step 13.17: Add the sort order dropdown

---
 client/imports/app/parties/parties-list.component.html | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 4e998d4..f1083e3 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -5,6 +5,15 @@
   
   <login-buttons></login-buttons>
 
+  <h1>Parties:</h1>
+
+  <div>
+    <select #sort (change)="changeSortOrder(sort.value)">
+      <option value="1" selected>Ascending</option>
+      <option value="-1">Descending</option>
+    </select>
+  </div>
+
   <ul>
     <li *ngFor="let party of parties | async">
       <a [routerLink]="['/party', party._id]">{{party.name}}</a>
-- 
2.7.4


From 48cec6ad4e0a190e11aa0c3bf96c38488124f27d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 14:18:38 +0200
Subject: [PATCH 109/292] Step 13.18: Re-subscribe when sort order changes

---
 client/imports/app/parties/parties-list.component.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index b725d0c..1a3201c 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -96,6 +96,10 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     this.curPage.next(page);
   }
 
+  changeSortOrder(nameOrder: string): void {
+    this.nameOrder.next(parseInt(nameOrder));
+  }
+
   ngOnDestroy() {
     this.partiesSub.unsubscribe();
     this.optionsSub.unsubscribe();
-- 
2.7.4


From b28c626be35ce2cb0f27270eace43ed1760ff161 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 14:30:35 +0200
Subject: [PATCH 110/292] Step 13.19: Add search by the party location using
 regex

---
 server/imports/publications/parties.ts | 20 +++++++++++++++-----
 1 file changed, 15 insertions(+), 5 deletions(-)

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
index f772e48..34c9470 100644
--- a/server/imports/publications/parties.ts
+++ b/server/imports/publications/parties.ts
@@ -7,10 +7,12 @@ interface Options {
   [key: string]: any;
 }
 
-Meteor.publish('parties', function(options: Options) {
-  Counts.publish(this, 'numberOfParties', Parties.collection.find(buildQuery.call(this)), { noReady: true });
+Meteor.publish('parties', function(options: Options, location?: string) {
+  const selector = buildQuery.call(this, null, location);
 
-  return Parties.find(buildQuery.call(this), options);
+  Counts.publish(this, 'numberOfParties', Parties.collection.find(selector), { noReady: true });
+
+  return Parties.find(selector, options);
 });
 
 Meteor.publish('party', function(partyId: string) {
@@ -18,7 +20,7 @@ Meteor.publish('party', function(partyId: string) {
 });
 
 
-function buildQuery(partyId?: string): Object {
+function buildQuery(partyId?: string, location?: string): Object {
   const isAvailable = {
     $or: [{
       // party is public
@@ -48,5 +50,13 @@ function buildQuery(partyId?: string): Object {
     };
   }
 
-  return isAvailable;
+  const searchRegEx = { '$regex': '.*' + (location || '') + '.*', '$options': 'i' };
+
+  return {
+    $and: [{
+        location: searchRegEx
+      },
+      isAvailable
+    ]
+  };
 }
\ No newline at end of file
-- 
2.7.4


From d391152032c1d4eafe9f64baf960c1d68dcc67c9 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 14:33:46 +0200
Subject: [PATCH 111/292] Step 13.20: Add reactive search by location

---
 client/imports/app/parties/parties-list.component.ts | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index 1a3201c..f94da32 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -35,6 +35,7 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   optionsSub: Subscription;
   partiesSize: number = 0;
   autorunSub: Subscription;
+  location: Subject<string> = new Subject<string>();
 
   constructor(
     private paginationService: PaginationService
@@ -44,8 +45,9 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     this.optionsSub = Observable.combineLatest(
       this.pageSize,
       this.curPage,
-      this.nameOrder
-    ).subscribe(([pageSize, curPage, nameOrder]) => {
+      this.nameOrder,
+      this.location
+    ).subscribe(([pageSize, curPage, nameOrder, location]) => {
       const options: Options = {
         limit: pageSize as number,
         skip: ((curPage as number) - 1) * (pageSize as number),
@@ -58,7 +60,7 @@ export class PartiesListComponent implements OnInit, OnDestroy {
         this.partiesSub.unsubscribe();
       }
       
-      this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
+      this.partiesSub = MeteorObservable.subscribe('parties', options, location).subscribe(() => {
         this.parties = Parties.find({}, {
           sort: {
             name: nameOrder
@@ -77,6 +79,7 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     this.pageSize.next(10);
     this.curPage.next(1);
     this.nameOrder.next(1);
+    this.location.next('');
 
     this.autorunSub = MeteorObservable.autorun().subscribe(() => {
       this.partiesSize = Counts.get('numberOfParties');
@@ -89,7 +92,8 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   }
 
   search(value: string): void {
-    this.parties = Parties.find(value ? { location: value } : {}).zone();
+    this.curPage.next(1);
+    this.location.next(value);
   }
 
   onPageChanged(page: number): void {
-- 
2.7.4


From cbf992b9121ab2d7212b90b26e5ac4ca55e82aa4 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 15:06:36 -0200
Subject: [PATCH 112/292] Step 13: Search, sort, pagination and reactive vars

---
 steps/step13.md | 927 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 927 insertions(+)
 create mode 100644 steps/step13.md

diff --git a/steps/step13.md b/steps/step13.md
new file mode 100644
index 0000000..f879121
--- /dev/null
+++ b/steps/step13.md
@@ -0,0 +1,927 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Search, sort, pagination and reactive vars
+
+In this step we are going to add:
+
+- parties list pagination
+- sorting by party name
+- lastly, we will move our previously implemented parties location search to the server side.
+
+Pagination simply means delivering and showing parties to the client on a page-by-page basis,
+where each page has a predefined number of items. Pagination reduces the number of documents to be transferred at one time thus decreasing load time. It also increases the usability of the user interface if there are too many documents in the storage.
+
+Besides client-side logic, it usually includes querying a specific page of parties on
+the server side to deliver up to the client as well.
+
+# Pagination
+
+First off, we'll add pagination on the server side.
+
+Thanks to the simplicity of the Mongo API combined with Meteor's power, we only need to execute `Parties.find` on the server with some additional parameters. Keep in mind, with Meteor's isomorphic environment, we'll query `Parties` on the client with the same parameters as on the server.
+
+### Mongo Collection query options
+
+`Collection.find` has a convenient second parameter called `options`,
+which takes an object for configuring collection querying.
+To implement pagination we'll need to provide _sort_, _limit_, and _skip_ fields as `options`.
+
+While  _limit_ and _skip_ set boundaries on the result set, _sort_, at the same time, may not.
+We'll use _sort_ to guarantee consistency of our pagination across page changes and page loads,
+since Mongo doesn't guarantee any order of documents if they are queried and not sorted.
+You can find more information about the _find_ method in Mongo [here](http://docs.meteor.com/#/full/find).
+
+Now, let's go to the `parties` subscription in the `server/imports/publications/parties.ts` file,
+add the `options` parameter to the subscription method, and then pass it to `Parties.find`:
+
+[{]: <helper> (diff_step 13.1)
+#### Step 13.19: Add search by the party location using regex
+
+##### Changed server/imports/publications/parties.ts
+```diff
+@@ -7,10 +7,12 @@
+ ┊ 7┊ 7┊  [key: string]: any;
+ ┊ 8┊ 8┊}
+ ┊ 9┊ 9┊
+-┊10┊  ┊Meteor.publish('parties', function(options: Options) {
+-┊11┊  ┊  Counts.publish(this, 'numberOfParties', Parties.collection.find(buildQuery.call(this)), { noReady: true });
++┊  ┊10┊Meteor.publish('parties', function(options: Options, location?: string) {
++┊  ┊11┊  const selector = buildQuery.call(this, null, location);
+ ┊12┊12┊
+-┊13┊  ┊  return Parties.find(buildQuery.call(this), options);
++┊  ┊13┊  Counts.publish(this, 'numberOfParties', Parties.collection.find(selector), { noReady: true });
++┊  ┊14┊
++┊  ┊15┊  return Parties.find(selector, options);
+ ┊14┊16┊});
+ ┊15┊17┊
+ ┊16┊18┊Meteor.publish('party', function(partyId: string) {
+```
+```diff
+@@ -18,7 +20,7 @@
+ ┊18┊20┊});
+ ┊19┊21┊
+ ┊20┊22┊
+-┊21┊  ┊function buildQuery(partyId?: string): Object {
++┊  ┊23┊function buildQuery(partyId?: string, location?: string): Object {
+ ┊22┊24┊  const isAvailable = {
+ ┊23┊25┊    $or: [{
+ ┊24┊26┊      // party is public
+```
+```diff
+@@ -48,5 +50,13 @@
+ ┊48┊50┊    };
+ ┊49┊51┊  }
+ ┊50┊52┊
+-┊51┊  ┊  return isAvailable;
++┊  ┊53┊  const searchRegEx = { '$regex': '.*' + (location || '') + '.*', '$options': 'i' };
++┊  ┊54┊
++┊  ┊55┊  return {
++┊  ┊56┊    $and: [{
++┊  ┊57┊        location: searchRegEx
++┊  ┊58┊      },
++┊  ┊59┊      isAvailable
++┊  ┊60┊    ]
++┊  ┊61┊  };
+ ┊52┊62┊}🚫↵
+```
+[}]: #
+
+On the client side, we are going to define three additional variables in the `PartiesList` component which our pagination will depend on:
+page size, current page number and name sort order.
+Secondly, we'll create a special _options_ object made up of these variables and pass it to the parties subscription:
+
+[{]: <helper> (diff_step 13.2)
+#### Step 13.20: Add reactive search by location
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -35,6 +35,7 @@
+ ┊35┊35┊  optionsSub: Subscription;
+ ┊36┊36┊  partiesSize: number = 0;
+ ┊37┊37┊  autorunSub: Subscription;
++┊  ┊38┊  location: Subject<string> = new Subject<string>();
+ ┊38┊39┊
+ ┊39┊40┊  constructor(
+ ┊40┊41┊    private paginationService: PaginationService
+```
+```diff
+@@ -44,8 +45,9 @@
+ ┊44┊45┊    this.optionsSub = Observable.combineLatest(
+ ┊45┊46┊      this.pageSize,
+ ┊46┊47┊      this.curPage,
+-┊47┊  ┊      this.nameOrder
+-┊48┊  ┊    ).subscribe(([pageSize, curPage, nameOrder]) => {
++┊  ┊48┊      this.nameOrder,
++┊  ┊49┊      this.location
++┊  ┊50┊    ).subscribe(([pageSize, curPage, nameOrder, location]) => {
+ ┊49┊51┊      const options: Options = {
+ ┊50┊52┊        limit: pageSize as number,
+ ┊51┊53┊        skip: ((curPage as number) - 1) * (pageSize as number),
+```
+```diff
+@@ -58,7 +60,7 @@
+ ┊58┊60┊        this.partiesSub.unsubscribe();
+ ┊59┊61┊      }
+ ┊60┊62┊      
+-┊61┊  ┊      this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
++┊  ┊63┊      this.partiesSub = MeteorObservable.subscribe('parties', options, location).subscribe(() => {
+ ┊62┊64┊        this.parties = Parties.find({}, {
+ ┊63┊65┊          sort: {
+ ┊64┊66┊            name: nameOrder
+```
+```diff
+@@ -77,6 +79,7 @@
+ ┊77┊79┊    this.pageSize.next(10);
+ ┊78┊80┊    this.curPage.next(1);
+ ┊79┊81┊    this.nameOrder.next(1);
++┊  ┊82┊    this.location.next('');
+ ┊80┊83┊
+ ┊81┊84┊    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
+ ┊82┊85┊      this.partiesSize = Counts.get('numberOfParties');
+```
+```diff
+@@ -89,7 +92,8 @@
+ ┊89┊92┊  }
+ ┊90┊93┊
+ ┊91┊94┊  search(value: string): void {
+-┊92┊  ┊    this.parties = Parties.find(value ? { location: value } : {}).zone();
++┊  ┊95┊    this.curPage.next(1);
++┊  ┊96┊    this.location.next(value);
+ ┊93┊97┊  }
+ ┊94┊98┊
+ ┊95┊99┊  onPageChanged(page: number): void {
+```
+[}]: #
+
+As was said before, we also need to query `Parties` on the client side with same parameters and options as we used on the server, i.e., parameters and options we pass to the server side.
+
+In reality, though, we don't need _skip_ and _limit_ options in this case, since the subscription result of the parties collection will always have a maximum page size of documents on the client.
+
+So, we will only add sorting:
+
+[{]: <helper> (diff_step 13.3)
+#### Step 13.3: Add sorting by party name to PartiesList
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -36,7 +36,11 @@
+ ┊36┊36┊    };
+ ┊37┊37┊
+ ┊38┊38┊    this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
+-┊39┊  ┊      this.parties = Parties.find({}).zone();
++┊  ┊39┊      this.parties = Parties.find({}, {
++┊  ┊40┊        sort: {
++┊  ┊41┊          name: this.nameOrder
++┊  ┊42┊        }
++┊  ┊43┊      }).zone();
+ ┊40┊44┊    });
+ ┊41┊45┊  }
+```
+[}]: #
+
+### Reactive Changes
+
+The idea behind Reactive variables and changes - is to update our Meteor subscription according to the user interaction - for example: if the user changes the sort order - we want to drop the old Meteor subscription and replace it with a new one that matches the new parameters.
+
+Because we are using RxJS, we can create variables that are `Observable`s - which means we can register to the changes notification - and act as required - in our case - changed the Meteor subscription.
+
+In order to do so, we will use RxJS `Subject` - which is an extension for `Observable`.
+
+A `Subject` is a sort of bridge or proxy that is available in some implementations of RxJS that acts both as an observer and as an Observable.
+
+Which means we can both register to the updates notifications and trigger the notification!
+
+In our case - when the user changes the parameters of the Meteor subscription, we need to trigger the notification.
+
+So let's do it. We will replace the regular variables with `Subject`s, and in order to trigger the notification in the first time, we will execute `next()` for the `Subject`s:
+
+[{]: <helper> (diff_step 13.4)
+#### Step 13.4: Turn primitive values into Subjects
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -1,5 +1,6 @@
+ ┊1┊1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊2┊2┊import { Observable } from 'rxjs/Observable';
++┊ ┊3┊import { Subject } from 'rxjs/Subject';
+ ┊3┊4┊import { Subscription } from 'rxjs/Subscription';
+ ┊4┊5┊import { MeteorObservable } from 'meteor-rxjs';
+ ┊5┊6┊
+```
+```diff
+@@ -24,9 +25,9 @@
+ ┊24┊25┊export class PartiesListComponent implements OnInit, OnDestroy {
+ ┊25┊26┊  parties: Observable<Party[]>;
+ ┊26┊27┊  partiesSub: Subscription;
+-┊27┊  ┊  pageSize: number = 10;
+-┊28┊  ┊  curPage: number = 1;
+-┊29┊  ┊  nameOrder: number = 1;
++┊  ┊28┊  pageSize: Subject<number> = new Subject<number>();
++┊  ┊29┊  curPage: Subject<number> = new Subject<number>();
++┊  ┊30┊  nameOrder: Subject<number> = new Subject<number>();
+ ┊30┊31┊
+ ┊31┊32┊  ngOnInit() {
+ ┊32┊33┊    const options: Options = {
+```
+```diff
+@@ -42,6 +43,10 @@
+ ┊42┊43┊        }
+ ┊43┊44┊      }).zone();
+ ┊44┊45┊    });
++┊  ┊46┊
++┊  ┊47┊    this.pageSize.next(10);
++┊  ┊48┊    this.curPage.next(1);
++┊  ┊49┊    this.nameOrder.next(1);
+ ┊45┊50┊  }
+ ┊46┊51┊
+ ┊47┊52┊  removeParty(party: Party): void {
+```
+[}]: #
+
+Now we need to register to those changes notifications.
+
+Because we need to register to multiple notifications (page size, current page, sort), we need to use a special RxJS Operator called `combineLatest` - which combines multiple `Observable`s into one, and trigger a notification when one of them changes!
+
+So let's use it and update the subscription:
+
+[{]: <helper> (diff_step 13.5)
+#### Step 13.5: Re-subscribe on current page changes
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -4,6 +4,8 @@
+ ┊ 4┊ 4┊import { Subscription } from 'rxjs/Subscription';
+ ┊ 5┊ 5┊import { MeteorObservable } from 'meteor-rxjs';
+ ┊ 6┊ 6┊
++┊  ┊ 7┊import 'rxjs/add/operator/combineLatest';
++┊  ┊ 8┊
+ ┊ 7┊ 9┊import { Parties } from '../../../../both/collections/parties.collection';
+ ┊ 8┊10┊import { Party } from '../../../../both/models/party.model';
+ ┊ 9┊11┊
+```
+```diff
+@@ -28,20 +30,31 @@
+ ┊28┊30┊  pageSize: Subject<number> = new Subject<number>();
+ ┊29┊31┊  curPage: Subject<number> = new Subject<number>();
+ ┊30┊32┊  nameOrder: Subject<number> = new Subject<number>();
++┊  ┊33┊  optionsSub: Subscription;
+ ┊31┊34┊
+ ┊32┊35┊  ngOnInit() {
+-┊33┊  ┊    const options: Options = {
+-┊34┊  ┊      limit: this.pageSize,
+-┊35┊  ┊      skip: (this.curPage - 1) * this.pageSize,
+-┊36┊  ┊      sort: { name: this.nameOrder }
+-┊37┊  ┊    };
+-┊38┊  ┊
+-┊39┊  ┊    this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
+-┊40┊  ┊      this.parties = Parties.find({}, {
+-┊41┊  ┊        sort: {
+-┊42┊  ┊          name: this.nameOrder
+-┊43┊  ┊        }
+-┊44┊  ┊      }).zone();
++┊  ┊36┊    this.optionsSub = Observable.combineLatest(
++┊  ┊37┊      this.pageSize,
++┊  ┊38┊      this.curPage,
++┊  ┊39┊      this.nameOrder
++┊  ┊40┊    ).subscribe(([pageSize, curPage, nameOrder]) => {
++┊  ┊41┊      const options: Options = {
++┊  ┊42┊        limit: pageSize as number,
++┊  ┊43┊        skip: ((curPage as number) - 1) * (pageSize as number),
++┊  ┊44┊        sort: { name: nameOrder as number }
++┊  ┊45┊      };
++┊  ┊46┊
++┊  ┊47┊      if (this.partiesSub) {
++┊  ┊48┊        this.partiesSub.unsubscribe();
++┊  ┊49┊      }
++┊  ┊50┊      
++┊  ┊51┊      this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
++┊  ┊52┊        this.parties = Parties.find({}, {
++┊  ┊53┊          sort: {
++┊  ┊54┊            name: nameOrder
++┊  ┊55┊          }
++┊  ┊56┊        }).zone();
++┊  ┊57┊      });
+ ┊45┊58┊    });
+ ┊46┊59┊
+ ┊47┊60┊    this.pageSize.next(10);
+```
+```diff
+@@ -59,5 +72,6 @@
+ ┊59┊72┊
+ ┊60┊73┊  ngOnDestroy() {
+ ┊61┊74┊    this.partiesSub.unsubscribe();
++┊  ┊75┊    this.optionsSub.unsubscribe();
+ ┊62┊76┊  }
+ ┊63┊77┊}
+```
+[}]: #
+
+> Notice that we also removes the Subscription and use `unsubscribe` because we want to drop the old subscription each time it changes.
+
+# Pagination UI
+
+As this paragraph name suggests, the next logical thing to do would be to implement a
+pagination UI, which consists of, at least, a list of page links at the bottom of every page,
+so that the user can switch pages by clicking on these links.
+
+Creating a pagination component is not a trivial task and not one of the primary goals of this tutorial,
+so we are going to make use of an already existing package with Angular 2 pagination components.
+Run the following line to add this package:
+
+    $ meteor npm install ng2-pagination --save
+
+> This package's pagination mark-up follows the structure of
+> the [Bootstrap pagination component](http://getbootstrap.com/components/#pagination),
+> so you can change its look simply by using proper CSS styles.
+> It's worth noting, though, that this package has been created
+> with the only this tutorial in mind.
+> It misses a lot of features that would be quite useful
+> in the real world, for example, custom templates.
+
+Ng2-Pagination consists of three main parts:
+
+- pagination controls that render a list of links
+- a pagination service to manipulate logic programmatically
+- a pagination pipe component, which can be added in any component template, with the main goal to
+transform a list of items according to the current state of the pagination service and show current page of items on UI
+
+First, let's import the pagination module into our `NgModule`:
+
+[{]: <helper> (diff_step 13.7)
+#### Step 13.7: Import Ng2PaginationModule
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -3,6 +3,7 @@
+ ┊3┊3┊import { FormsModule, ReactiveFormsModule } from '@angular/forms';
+ ┊4┊4┊import { RouterModule } from '@angular/router';
+ ┊5┊5┊import { AccountsModule } from 'angular2-meteor-accounts-ui';
++┊ ┊6┊import { Ng2PaginationModule } from 'ng2-pagination';
+ ┊6┊7┊
+ ┊7┊8┊import { AppComponent } from './app.component';
+ ┊8┊9┊import { routes, ROUTES_PROVIDERS } from './app.routes';
+```
+```diff
+@@ -14,7 +15,8 @@
+ ┊14┊15┊    FormsModule,
+ ┊15┊16┊    ReactiveFormsModule,
+ ┊16┊17┊    RouterModule.forRoot(routes),
+-┊17┊  ┊    AccountsModule
++┊  ┊18┊    AccountsModule,
++┊  ┊19┊    Ng2PaginationModule
+ ┊18┊20┊  ],
+ ┊19┊21┊  declarations: [
+ ┊20┊22┊    AppComponent,
+```
+[}]: #
+
+Because of pagination pipe of ng2-pagination supports only arrays we'll use the `PaginationService`.
+Let's define the configuration:
+
+[{]: <helper> (diff_step 13.8)
+#### Step 13.8: Register configuration of pagination
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -3,6 +3,7 @@
+ ┊3┊3┊import { Subject } from 'rxjs/Subject';
+ ┊4┊4┊import { Subscription } from 'rxjs/Subscription';
+ ┊5┊5┊import { MeteorObservable } from 'meteor-rxjs';
++┊ ┊6┊import { PaginationService } from 'ng2-pagination';
+ ┊6┊7┊
+ ┊7┊8┊import 'rxjs/add/operator/combineLatest';
+ ┊8┊9┊
+```
+```diff
+@@ -32,6 +33,10 @@
+ ┊32┊33┊  nameOrder: Subject<number> = new Subject<number>();
+ ┊33┊34┊  optionsSub: Subscription;
+ ┊34┊35┊
++┊  ┊36┊  constructor(
++┊  ┊37┊    private paginationService: PaginationService
++┊  ┊38┊  ) {}
++┊  ┊39┊
+ ┊35┊40┊  ngOnInit() {
+ ┊36┊41┊    this.optionsSub = Observable.combineLatest(
+ ┊37┊42┊      this.pageSize,
+```
+```diff
+@@ -57,6 +62,13 @@
+ ┊57┊62┊      });
+ ┊58┊63┊    });
+ ┊59┊64┊
++┊  ┊65┊    this.paginationService.register({
++┊  ┊66┊      id: this.paginationService.defaultId,
++┊  ┊67┊      itemsPerPage: 10,
++┊  ┊68┊      currentPage: 1,
++┊  ┊69┊      totalItems: 30,
++┊  ┊70┊    });
++┊  ┊71┊
+ ┊60┊72┊    this.pageSize.next(10);
+ ┊61┊73┊    this.curPage.next(1);
+ ┊62┊74┊    this.nameOrder.next(1);
+```
+[}]: #
+
+> `id` - this is the identifier of specific pagination, we use the default.
+
+We need to notify the pagination that the current page has been changed, so let's add it to the method where we handle the reactive changes:
+
+[{]: <helper> (diff_step 13.9)
+#### Step 13.9: Update current page when options change
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -49,6 +49,8 @@
+ ┊49┊49┊        sort: { name: nameOrder as number }
+ ┊50┊50┊      };
+ ┊51┊51┊
++┊  ┊52┊      this.paginationService.setCurrentPage(this.paginationService.defaultId, curPage as number);
++┊  ┊53┊
+ ┊52┊54┊      if (this.partiesSub) {
+ ┊53┊55┊        this.partiesSub.unsubscribe();
+ ┊54┊56┊      }
+```
+[}]: #
+
+Now, add the pagination controls to the `parties-list.component.html` template:
+
+[{]: <helper> (diff_step 13.10)
+#### Step 13.10: Add pagination to the list
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -13,4 +13,6 @@
+ ┊13┊13┊      <button (click)="removeParty(party)">X</button>
+ ┊14┊14┊    </li>
+ ┊15┊15┊  </ul>
++┊  ┊16┊
++┊  ┊17┊  <pagination-controls></pagination-controls>
+ ┊16┊18┊</div>🚫↵
+```
+[}]: #
+
+In the configuration, we provided the current page number, the page size and a new value of total items in the list to paginate.
+
+This total number of items are required to be set in our case, since we don't provide a
+regular array of elements but instead an `Observable`, the pagination service simply won't know how to calculate its size.
+
+We'll get back to this in the next paragraph where we'll be setting parties total size reactively.
+
+For now, let's just set it to be 30. We'll see why this default value is needed shortly.
+
+### pageChange events
+
+The final part is to handle user clicks on the page links. The pagination controls component
+fires a special event when the user clicks on a page link, causing the current page to update.
+
+Let's handle this event in the template first and then add a method to the `PartiesList` component itself:
+
+[{]: <helper> (diff_step 13.11)
+#### Step 13.11: Add pageChange event binding
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -14,5 +14,5 @@
+ ┊14┊14┊    </li>
+ ┊15┊15┊  </ul>
+ ┊16┊16┊
+-┊17┊  ┊  <pagination-controls></pagination-controls>
++┊  ┊17┊  <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
+ ┊18┊18┊</div>🚫↵
+```
+[}]: #
+
+As you can see, the pagination controls component fires the `pageChange` event, calling the `onPageChanged` method with
+a special event object that contains the new page number to set. Add the `onPageChanged` method:
+
+[{]: <helper> (diff_step 13.12)
+#### Step 13.12: Add event handler for pageChange
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -84,6 +84,10 @@
+ ┊84┊84┊    this.parties = Parties.find(value ? { location: value } : {}).zone();
+ ┊85┊85┊  }
+ ┊86┊86┊
++┊  ┊87┊  onPageChanged(page: number): void {
++┊  ┊88┊    this.curPage.next(page);
++┊  ┊89┊  }
++┊  ┊90┊
+ ┊87┊91┊  ngOnDestroy() {
+ ┊88┊92┊    this.partiesSub.unsubscribe();
+ ┊89┊93┊    this.optionsSub.unsubscribe();
+```
+[}]: #
+
+At this moment, we have almost everything in place. Let's check if everything is working.
+We are going to have to add a lot of parties, at least, a couple of pages.
+But, since we've chosen quite a large default page size (10), it would be tedious to add all parties manually.
+
+# Getting the Total Number of Parties
+
+The pagination component needs to know how many pages it will create. As such, we need to know the total number of parties in storage and divide it by the number of items per page.
+
+At the same time, our parties collection will always have no more than necessary parties on the client side.
+This suggests that we have to add a new publication to publish only the current count of parties existing in storage.
+
+This task looks quite common and, thankfully, it's already been
+implemented. We can use the [tmeasday:publish-counts](https://github.com/percolatestudio/publish-counts) package.
+
+    $ meteor add tmeasday:publish-counts
+
+This package is an example for a package that does not provide it's own Typings, so we will have to create `d.ts` file by our self according to the package API:
+
+[{]: <helper> (diff_step 13.15)
+#### Step 13.15: Add declaration of counts package
+
+##### Changed typings.d.ts
+```diff
+@@ -1,4 +1,15 @@
+ ┊ 1┊ 1┊declare module '*.html' {
+ ┊ 2┊ 2┊  const template: string;
+ ┊ 3┊ 3┊  export default template;
+-┊ 4┊  ┊}🚫↵
++┊  ┊ 4┊}
++┊  ┊ 5┊
++┊  ┊ 6┊declare module 'meteor/tmeasday:publish-counts' {
++┊  ┊ 7┊  import { Mongo } from 'meteor/mongo';
++┊  ┊ 8┊  
++┊  ┊ 9┊  interface CountsObject {
++┊  ┊10┊    get(publicationName: string): number;
++┊  ┊11┊    publish(context: any, publicationName: string, cursor: Mongo.Cursor, options: any): number;
++┊  ┊12┊  }
++┊  ┊13┊
++┊  ┊14┊  export const Counts: CountsObject;
++┊  ┊15┊}
+```
+[}]: #
+
+This package exports a `Counts` object with all of the API methods we will need.
+
+> Notice that you'll see a TypeScript warning in the terminal
+> saying that "Counts" has no method you want to use, when you start using the API.
+> You can remove this warning by adding a [publish-counts type declaration file](https://github.com/correpw/meteor-publish-counts.d.ts/blob/master/Counts.d.ts) to your typings.
+
+Let's publish the total number of parties as follows:
+
+[{]: <helper> (diff_step 13.14)
+#### Step 13.14: Publish total number of parties
+
+##### Changed server/imports/publications/parties.ts
+```diff
+@@ -1,4 +1,6 @@
+ ┊1┊1┊import { Meteor } from 'meteor/meteor';
++┊ ┊2┊import { Counts } from 'meteor/tmeasday:publish-counts';
++┊ ┊3┊
+ ┊2┊4┊import { Parties } from '../../../both/collections/parties.collection';
+ ┊3┊5┊
+ ┊4┊6┊interface Options {
+```
+```diff
+@@ -6,6 +8,8 @@
+ ┊ 6┊ 8┊}
+ ┊ 7┊ 9┊
+ ┊ 8┊10┊Meteor.publish('parties', function(options: Options) {
++┊  ┊11┊  Counts.publish(this, 'numberOfParties', Parties.collection.find(buildQuery.call(this)), { noReady: true });
++┊  ┊12┊
+ ┊ 9┊13┊  return Parties.find(buildQuery.call(this), options);
+ ┊10┊14┊});
+```
+[}]: #
+
+> Notice that we are passing `{ noReady: true }` in the last argument so
+> that the publication will be ready only after our main cursor is loaded, instead of waiting for Counts.
+
+We've just created the new _numberOfParties_ publication.
+Let's get it reactively on the client side using the `Counts` object, and, at the same time,
+introduce a new `partiesSize` property in the `PartiesList` component:
+
+[{]: <helper> (diff_step 13.16)
+#### Step 13.16: Handle reactive updates of the parties total number
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -4,6 +4,7 @@
+ ┊ 4┊ 4┊import { Subscription } from 'rxjs/Subscription';
+ ┊ 5┊ 5┊import { MeteorObservable } from 'meteor-rxjs';
+ ┊ 6┊ 6┊import { PaginationService } from 'ng2-pagination';
++┊  ┊ 7┊import { Counts } from 'meteor/tmeasday:publish-counts';
+ ┊ 7┊ 8┊
+ ┊ 8┊ 9┊import 'rxjs/add/operator/combineLatest';
+ ┊ 9┊10┊
+```
+```diff
+@@ -32,6 +33,8 @@
+ ┊32┊33┊  curPage: Subject<number> = new Subject<number>();
+ ┊33┊34┊  nameOrder: Subject<number> = new Subject<number>();
+ ┊34┊35┊  optionsSub: Subscription;
++┊  ┊36┊  partiesSize: number = 0;
++┊  ┊37┊  autorunSub: Subscription;
+ ┊35┊38┊
+ ┊36┊39┊  constructor(
+ ┊37┊40┊    private paginationService: PaginationService
+```
+```diff
+@@ -68,12 +71,17 @@
+ ┊68┊71┊      id: this.paginationService.defaultId,
+ ┊69┊72┊      itemsPerPage: 10,
+ ┊70┊73┊      currentPage: 1,
+-┊71┊  ┊      totalItems: 30,
++┊  ┊74┊      totalItems: this.partiesSize
+ ┊72┊75┊    });
+ ┊73┊76┊
+ ┊74┊77┊    this.pageSize.next(10);
+ ┊75┊78┊    this.curPage.next(1);
+ ┊76┊79┊    this.nameOrder.next(1);
++┊  ┊80┊
++┊  ┊81┊    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
++┊  ┊82┊      this.partiesSize = Counts.get('numberOfParties');
++┊  ┊83┊      this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
++┊  ┊84┊    });
+ ┊77┊85┊  }
+ ┊78┊86┊
+ ┊79┊87┊  removeParty(party: Party): void {
+```
+```diff
+@@ -91,5 +99,6 @@
+ ┊ 91┊ 99┊  ngOnDestroy() {
+ ┊ 92┊100┊    this.partiesSub.unsubscribe();
+ ┊ 93┊101┊    this.optionsSub.unsubscribe();
++┊   ┊102┊    this.autorunSub.unsubscribe();
+ ┊ 94┊103┊  }
+ ┊ 95┊104┊}
+```
+[}]: #
+
+We used `MeteorObservable.autorun` because we wan't to know when there are changes regarding the data that comes from Meteor - so now every change of data, we will calculate the total number of parties and save it in our Component, then we will set it in the `PaginationService`.
+
+Let's verify that the app works the same as before.
+Run the app. There should be same three pages of parties.
+
+What's more interesting is to add a couple of new parties, thus, adding
+a new 4th page. By this way, we can prove that our new "total number" publication and pagination controls are all working properly.
+
+# Changing Sort Order
+
+It's time for a new cool feature Socially users will certainly enjoy - sorting the parties list by party name.
+At this moment, we know everything we need to implement it.
+
+As previously implements, `nameOrder` uses one of two values, 1 or -1, to express ascending and descending orders
+respectively. Then, as you can see, we assign `nameOrder` to the party property (currently, `name`) we want to sort.
+
+We'll add a new dropdown UI control with two orders to change, ascending and descending. Let's add it in front of our parties list:
+
+[{]: <helper> (diff_step 13.17)
+#### Step 13.17: Add the sort order dropdown
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -5,6 +5,15 @@
+ ┊ 5┊ 5┊  
+ ┊ 6┊ 6┊  <login-buttons></login-buttons>
+ ┊ 7┊ 7┊
++┊  ┊ 8┊  <h1>Parties:</h1>
++┊  ┊ 9┊
++┊  ┊10┊  <div>
++┊  ┊11┊    <select #sort (change)="changeSortOrder(sort.value)">
++┊  ┊12┊      <option value="1" selected>Ascending</option>
++┊  ┊13┊      <option value="-1">Descending</option>
++┊  ┊14┊    </select>
++┊  ┊15┊  </div>
++┊  ┊16┊
+ ┊ 8┊17┊  <ul>
+ ┊ 9┊18┊    <li *ngFor="let party of parties | async">
+ ┊10┊19┊      <a [routerLink]="['/party', party._id]">undefined</a>
+```
+[}]: #
+
+In the `PartiesList` component, we change the `nameOrder` property to be a reactive variable and add a `changeSortOrder` event handler, where we set the new sort order:
+
+[{]: <helper> (diff_step 13.18)
+#### Step 13.18: Re-subscribe when sort order changes
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -96,6 +96,10 @@
+ ┊ 96┊ 96┊    this.curPage.next(page);
+ ┊ 97┊ 97┊  }
+ ┊ 98┊ 98┊
++┊   ┊ 99┊  changeSortOrder(nameOrder: string): void {
++┊   ┊100┊    this.nameOrder.next(parseInt(nameOrder));
++┊   ┊101┊  }
++┊   ┊102┊
+ ┊ 99┊103┊  ngOnDestroy() {
+ ┊100┊104┊    this.partiesSub.unsubscribe();
+ ┊101┊105┊    this.optionsSub.unsubscribe();
+```
+[}]: #
+
+> Calling `next` on `nameOrder` Subject, will trigger the change notification - and then the Meteor subscription will re-created with the new parameters!
+
+That's just it! Run the app and change the sort order back and forth.
+
+What's important here is that pagination updates properly, i.e. according to a new sort order.
+
+# Server Side Search
+
+Before this step we had a nice feature to search parties by location, but with the addition of pagination, location search has partly broken. In its current state, there will always be no more than the current page of parties shown simultaneously on the client side. We would like, of course, to search parties across all storage, not just across the current page.
+
+To fix that, we'll need to patch our "parties" and "total number" publications on the server side
+to query parties with a new "location" parameter passed down from the client.
+Having that fixed, it should work properly in accordance with the added pagination.
+
+So, let's add filtering parties by the location with the help of Mongo's regex API.
+It is going to look like this:
+
+[{]: <helper> (diff_step 13.19)
+#### Step 13.19: Add search by the party location using regex
+
+##### Changed server/imports/publications/parties.ts
+```diff
+@@ -7,10 +7,12 @@
+ ┊ 7┊ 7┊  [key: string]: any;
+ ┊ 8┊ 8┊}
+ ┊ 9┊ 9┊
+-┊10┊  ┊Meteor.publish('parties', function(options: Options) {
+-┊11┊  ┊  Counts.publish(this, 'numberOfParties', Parties.collection.find(buildQuery.call(this)), { noReady: true });
++┊  ┊10┊Meteor.publish('parties', function(options: Options, location?: string) {
++┊  ┊11┊  const selector = buildQuery.call(this, null, location);
+ ┊12┊12┊
+-┊13┊  ┊  return Parties.find(buildQuery.call(this), options);
++┊  ┊13┊  Counts.publish(this, 'numberOfParties', Parties.collection.find(selector), { noReady: true });
++┊  ┊14┊
++┊  ┊15┊  return Parties.find(selector, options);
+ ┊14┊16┊});
+ ┊15┊17┊
+ ┊16┊18┊Meteor.publish('party', function(partyId: string) {
+```
+```diff
+@@ -18,7 +20,7 @@
+ ┊18┊20┊});
+ ┊19┊21┊
+ ┊20┊22┊
+-┊21┊  ┊function buildQuery(partyId?: string): Object {
++┊  ┊23┊function buildQuery(partyId?: string, location?: string): Object {
+ ┊22┊24┊  const isAvailable = {
+ ┊23┊25┊    $or: [{
+ ┊24┊26┊      // party is public
+```
+```diff
+@@ -48,5 +50,13 @@
+ ┊48┊50┊    };
+ ┊49┊51┊  }
+ ┊50┊52┊
+-┊51┊  ┊  return isAvailable;
++┊  ┊53┊  const searchRegEx = { '$regex': '.*' + (location || '') + '.*', '$options': 'i' };
++┊  ┊54┊
++┊  ┊55┊  return {
++┊  ┊56┊    $and: [{
++┊  ┊57┊        location: searchRegEx
++┊  ┊58┊      },
++┊  ┊59┊      isAvailable
++┊  ┊60┊    ]
++┊  ┊61┊  };
+ ┊52┊62┊}🚫↵
+```
+[}]: #
+
+On the client side, we are going to add a new reactive variable and set it to update when a user clicks on the search button:
+
+[{]: <helper> (diff_step 13.20)
+#### Step 13.20: Add reactive search by location
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -35,6 +35,7 @@
+ ┊35┊35┊  optionsSub: Subscription;
+ ┊36┊36┊  partiesSize: number = 0;
+ ┊37┊37┊  autorunSub: Subscription;
++┊  ┊38┊  location: Subject<string> = new Subject<string>();
+ ┊38┊39┊
+ ┊39┊40┊  constructor(
+ ┊40┊41┊    private paginationService: PaginationService
+```
+```diff
+@@ -44,8 +45,9 @@
+ ┊44┊45┊    this.optionsSub = Observable.combineLatest(
+ ┊45┊46┊      this.pageSize,
+ ┊46┊47┊      this.curPage,
+-┊47┊  ┊      this.nameOrder
+-┊48┊  ┊    ).subscribe(([pageSize, curPage, nameOrder]) => {
++┊  ┊48┊      this.nameOrder,
++┊  ┊49┊      this.location
++┊  ┊50┊    ).subscribe(([pageSize, curPage, nameOrder, location]) => {
+ ┊49┊51┊      const options: Options = {
+ ┊50┊52┊        limit: pageSize as number,
+ ┊51┊53┊        skip: ((curPage as number) - 1) * (pageSize as number),
+```
+```diff
+@@ -58,7 +60,7 @@
+ ┊58┊60┊        this.partiesSub.unsubscribe();
+ ┊59┊61┊      }
+ ┊60┊62┊      
+-┊61┊  ┊      this.partiesSub = MeteorObservable.subscribe('parties', options).subscribe(() => {
++┊  ┊63┊      this.partiesSub = MeteorObservable.subscribe('parties', options, location).subscribe(() => {
+ ┊62┊64┊        this.parties = Parties.find({}, {
+ ┊63┊65┊          sort: {
+ ┊64┊66┊            name: nameOrder
+```
+```diff
+@@ -77,6 +79,7 @@
+ ┊77┊79┊    this.pageSize.next(10);
+ ┊78┊80┊    this.curPage.next(1);
+ ┊79┊81┊    this.nameOrder.next(1);
++┊  ┊82┊    this.location.next('');
+ ┊80┊83┊
+ ┊81┊84┊    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
+ ┊82┊85┊      this.partiesSize = Counts.get('numberOfParties');
+```
+```diff
+@@ -89,7 +92,8 @@
+ ┊89┊92┊  }
+ ┊90┊93┊
+ ┊91┊94┊  search(value: string): void {
+-┊92┊  ┊    this.parties = Parties.find(value ? { location: value } : {}).zone();
++┊  ┊95┊    this.curPage.next(1);
++┊  ┊96┊    this.location.next(value);
+ ┊93┊97┊  }
+ ┊94┊98┊
+ ┊95┊99┊  onPageChanged(page: number): void {
+```
+[}]: #
+
+> Notice that we don't know what size to expect from the search
+> that's why we are re-setting the current page to 1.
+
+Let's check it out now that everything works properly altogether: pagination, search, sorting,
+removing and addition of new parties.
+
+For example, you can try to add 30 parties in a way mentioned slightly above;
+then try to remove all 30 parties; then sort by the descending order; then try to search by Palo Alto — it should
+find only two, in case if you have not added any other parties rather than used in this tutorial so far;
+then try to remove one of the found parties and, finally, search with an empty location.
+
+Although this sequence of actions looks quite complicated, it was accomplished with rather few lines of code.
+
+### Generating Mock Data
+
+In this example, we need to deal with multiple objects and in order to test it and get the best results - we need a lot of Parties objects.
+
+Thankfully, we have a helpful package called [_anti:fake_](https://atmospherejs.com/anti/fake), which will help us out with the generation of names, locations and other properties of new fake parties.
+
+    $ meteor add anti:fake
+
+So, with the following lines of code we are going to have 30 parties in total
+(given that we already have three):
+
+__`server/imports/fixtures/parties.ts`__:
+
+    ...
+
+    for (var i = 0; i < 27; i++) {
+      Parties.insert({
+        name: Fake.sentence(50),
+        location: Fake.sentence(10),
+        description: Fake.sentence(100),
+        public: true
+      });
+    }
+
+
+Fake is loaded in Meteor as a global, you may want to declare it for TypeScript.
+
+__`typings/fake.d.ts`__:
+
+    declare var Fake: {
+        sentence(words: number): string;
+    }
+
+Now reset the database (`meteor reset`) and run the app. You should see a list of 10 parties shown initially and 3 pages links just at the bottom.
+
+Play around with the pagination: click on page links to go back and forth,
+then try to delete parties to check if the current page updates properly.
+
+# Summary
+
+This step covered a lot. We looked at:
+
+- Mongo query sort options: `sort`, `limit`, `skip`
+- RxJS `Subject` for updating variables automatically
+- Angular 2 pipes to filter data
+- Handling onChange events in Angular 2
+- Generating fake data with `anti:fake`
+- Establishing the total number of results with `tmeasday:publish-counts`
+- Enabling server-side searching across an entire collection
+
+In the next step we'll look at sending out our party invitations and look deeper into pipes.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step12.md) | [Next Step >](step14.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 07de99cb92679a9c5be4ff17b66203206c6b2e2a Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:27:03 +0200
Subject: [PATCH 113/292] Step 14.1: Add uninvited users publication

---
 server/imports/publications/users.ts | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)
 create mode 100644 server/imports/publications/users.ts

diff --git a/server/imports/publications/users.ts b/server/imports/publications/users.ts
new file mode 100644
index 0000000..c320f41
--- /dev/null
+++ b/server/imports/publications/users.ts
@@ -0,0 +1,18 @@
+import { Meteor } from 'meteor/meteor';
+
+import { Parties } from '../../../both/collections/parties.collection';
+
+Meteor.publish('uninvited', function (partyId: string) {
+  const party = Parties.findOne(partyId);
+
+  if (!party) {
+    throw new Meteor.Error('404', 'No such party!');
+  }
+
+  return Meteor.users.find({
+    _id: {
+      $nin: party.invited || [],
+      $ne: this.userId
+    }
+  });
+});
-- 
2.7.4


From 6a85cc15790e86c6acee4b7216585e2c230d8aac Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:28:24 +0200
Subject: [PATCH 114/292] Step 14.2: Add invited to Party interface

---
 both/models/party.model.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
index 2526c11..64e6ae1 100644
--- a/both/models/party.model.ts
+++ b/both/models/party.model.ts
@@ -6,4 +6,5 @@ export interface Party extends CollectionObject {
   location: string;
   owner?: string;
   public: boolean;
+  invited?: string[];
 }
-- 
2.7.4


From 2ec709611e7a6df6a65a48a80b890984583d97b7 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:28:59 +0200
Subject: [PATCH 115/292] Step 14.3: Use it on the server

---
 server/main.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/server/main.ts b/server/main.ts
index 7f8e626..f6356dd 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -2,7 +2,8 @@ import { Meteor } from 'meteor/meteor';
 
 import { loadParties } from './imports/fixtures/parties';
 
-import './imports/publications/parties'; 
+import './imports/publications/parties';
+import './imports/publications/users'; 
 
 Meteor.startup(() => {
   loadParties();
-- 
2.7.4


From 64e6ca56957b89dc5c8c946e9248514a0b62261d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:42:28 +0200
Subject: [PATCH 116/292] Step 14.4: Create Users collection from Meteor.users

---
 both/collections/users.collection.ts | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 both/collections/users.collection.ts

diff --git a/both/collections/users.collection.ts b/both/collections/users.collection.ts
new file mode 100644
index 0000000..dbd121b
--- /dev/null
+++ b/both/collections/users.collection.ts
@@ -0,0 +1,4 @@
+import { MongoObservable } from 'meteor-rxjs';
+import { Meteor } from 'meteor/meteor';
+
+export const Users = MongoObservable.fromExisting(Meteor.users);
-- 
2.7.4


From 02e298f080f7101713d61b31210963f8a8e2e456 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:42:57 +0200
Subject: [PATCH 117/292] Step 14.5: Create also User interface

---
 both/models/user.model.ts | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 both/models/user.model.ts

diff --git a/both/models/user.model.ts b/both/models/user.model.ts
new file mode 100644
index 0000000..08eeec5
--- /dev/null
+++ b/both/models/user.model.ts
@@ -0,0 +1,3 @@
+import { Meteor } from 'meteor/meteor';
+
+export interface User extends Meteor.User {}
-- 
2.7.4


From 60601986eff3b880d971195ac9b6ce295d52c249 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:45:17 +0200
Subject: [PATCH 118/292] Step 14.6: Implement subscription of uninvited users

---
 client/imports/app/parties/party-details.component.ts | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 9c7a9e7..246243e 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -1,5 +1,6 @@
 import { Component, OnInit, OnDestroy } from '@angular/core';
 import { ActivatedRoute } from '@angular/router';
+import { Observable } from 'rxjs/Observable';
 import { Subscription } from 'rxjs/Subscription';
 import { Meteor } from 'meteor/meteor';
 import { MeteorObservable } from 'meteor-rxjs';
@@ -8,6 +9,8 @@ import 'rxjs/add/operator/map';
 
 import { Parties } from '../../../../both/collections/parties.collection';
 import { Party } from '../../../../both/models/party.model';
+import { Users } from '../../../../both/collections/users.collection';
+import { User } from '../../../../both/models/user.model';
 
 import template from './party-details.component.html';
 
@@ -20,6 +23,8 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
   paramsSub: Subscription;
   party: Party;
   partySub: Subscription;
+  users: Observable<User>;
+  uninvitedSub: Subscription;
 
   constructor(
     private route: ActivatedRoute
@@ -38,6 +43,18 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
         this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
           this.party = Parties.findOne(this.partyId);
         });
+
+        if (this.uninvitedSub) {
+          this.uninvitedSub.unsubscribe();
+        }
+
+        this.uninvitedSub = MeteorObservable.subscribe('uninvited', this.partyId).subscribe(() => {
+           this.users = Users.find({
+             _id: {
+               $ne: Meteor.userId()
+              }
+            }).zone();
+        });
       });
   }
 
@@ -59,5 +76,6 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
     this.partySub.unsubscribe();
+    this.uninvitedSub.unsubscribe();
   }
 }
-- 
2.7.4


From 1e0ef69520701647aea8c4c3623bc9cfb669b4b8 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:46:28 +0200
Subject: [PATCH 119/292] Step 14.7: Display list of uninvited users

---
 client/imports/app/parties/party-details.component.html | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index aef5bae..2ce1e72 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -10,4 +10,11 @@
 
   <button type="submit">Save</button>
   <a [routerLink]="['/']">Cancel</a>
-</form>
\ No newline at end of file
+</form>
+
+<p>Users to invite:</p>
+<ul>
+  <li *ngFor="let user of users | async">
+    <div>{{user.emails[0].address}}</div>
+  </li>
+</ul>
-- 
2.7.4


From b01d9ebcaea9b7daa15d97b3df4e953cf6a9d9ef Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:50:06 +0200
Subject: [PATCH 120/292] Step 14.8: Create DisplayNamePipe

---
 client/imports/app/shared/display-name.pipe.ts | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 client/imports/app/shared/display-name.pipe.ts

diff --git a/client/imports/app/shared/display-name.pipe.ts b/client/imports/app/shared/display-name.pipe.ts
new file mode 100644
index 0000000..40efbb6
--- /dev/null
+++ b/client/imports/app/shared/display-name.pipe.ts
@@ -0,0 +1,25 @@
+import { Pipe, PipeTransform } from '@angular/core';
+import { Meteor } from 'meteor/meteor';
+
+import { User } from '../../../../both/models/user.model';
+
+@Pipe({
+  name: 'displayName'
+})
+export class DisplayNamePipe implements PipeTransform {
+  transform(user: User): string {
+    if (!user) {
+      return '';
+    }
+
+    if (user.username) {
+      return user.username;
+    }
+
+    if (user.emails) {
+      return user.emails[0].address;
+    }
+
+    return '';
+  }
+}
-- 
2.7.4


From 9cb29a75bbedf0de3a7b1d74d25e01eb0496348c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:51:10 +0200
Subject: [PATCH 121/292] Step 14.9: Make space for shared declarations

---
 client/imports/app/shared/index.ts | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 client/imports/app/shared/index.ts

diff --git a/client/imports/app/shared/index.ts b/client/imports/app/shared/index.ts
new file mode 100644
index 0000000..d9104e8
--- /dev/null
+++ b/client/imports/app/shared/index.ts
@@ -0,0 +1,5 @@
+import { DisplayNamePipe } from './display-name.pipe';
+
+export const SHARED_DECLARATIONS: any[] = [
+  DisplayNamePipe
+];
-- 
2.7.4


From 26c71eb1991499295ff3a824259090c0c3f1e4df Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:51:49 +0200
Subject: [PATCH 122/292] Step 14.10: Import those declarations to AppModule

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 65145a8..383ed58 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -8,6 +8,7 @@ import { Ng2PaginationModule } from 'ng2-pagination';
 import { AppComponent } from './app.component';
 import { routes, ROUTES_PROVIDERS } from './app.routes';
 import { PARTIES_DECLARATIONS } from './parties';
+import { SHARED_DECLARATIONS } from './shared';
 
 @NgModule({
   imports: [
@@ -20,7 +21,8 @@ import { PARTIES_DECLARATIONS } from './parties';
   ],
   declarations: [
     AppComponent,
-    ...PARTIES_DECLARATIONS
+    ...PARTIES_DECLARATIONS,
+    ...SHARED_DECLARATIONS
   ],
   providers: [
     ...ROUTES_PROVIDERS
-- 
2.7.4


From b3fb862c6d177bd8c3941a0dfb3142acfac5c58d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 23 Sep 2016 17:54:00 +0200
Subject: [PATCH 123/292] Step 14.11: Use this Pipe in PartyDetails

---
 client/imports/app/parties/party-details.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index 2ce1e72..78e0c41 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -15,6 +15,6 @@
 <p>Users to invite:</p>
 <ul>
   <li *ngFor="let user of users | async">
-    <div>{{user.emails[0].address}}</div>
+    <div>{{user | displayName}}</div>
   </li>
 </ul>
-- 
2.7.4


From 0c5bb165cd90140f79332175944dd93b45f55a14 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 15:18:29 -0200
Subject: [PATCH 124/292] Step 14: Using and creating AngularJS filters

---
 steps/step14.md | 338 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 338 insertions(+)
 create mode 100644 steps/step14.md

diff --git a/steps/step14.md b/steps/step14.md
new file mode 100644
index 0000000..7ed7848
--- /dev/null
+++ b/steps/step14.md
@@ -0,0 +1,338 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Using and creating AngularJS filters
+
+In this and next steps we are going to:
+
+- add party invitations;
+- filter data with Angular2 pipes
+- learn about Meteor methods
+
+# Rendering Users
+
+We'll start by working on the `PartyDetails` component. Each party owner should be able to invite multiple guests to a party, hence, the user needs to be able to manipulate the data on the party details page.
+
+First of all, we'll need to render a list of all users to invite on the page. Since we've made the app secure during step 8 by removing the _insecure_ package, to get a list of users — the same as for the parties — we'll need to create a new publication, and then subscribe to load the user collection.
+
+Let's create a new file `server/imports/publications/users.ts` and add a new publication there. We can start by finding all uninvited users, specifically, users who are not invited and not the current user.
+
+[{]: <helper> (diff_step 14.1)
+#### Step 14.11: Use this Pipe in PartyDetails
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -15,6 +15,6 @@
+ ┊15┊15┊<p>Users to invite:</p>
+ ┊16┊16┊<ul>
+ ┊17┊17┊  <li *ngFor="let user of users | async">
+-┊18┊  ┊    <div>undefined</div>
++┊  ┊18┊    <div>undefined</div>
+ ┊19┊19┊  </li>
+ ┊20┊20┊</ul>
+```
+[}]: #
+
+Notice that we've made use of a special Mongo selector [`$nin`](https://docs.mongodb.org/manual/reference/operator/query/nin/),
+meaning "not in", to sift out users that have already been invited to this party so far.
+We used [`$ne`](https://docs.mongodb.org/manual/reference/operator/query/ne/) to select ids
+that are "not equal" to the user's id.
+
+As you can see above, we've introduced a new party property — "invited", which is going to be an array of all invited user IDs.
+
+Now, let's update the Party interface to contain the new field:
+
+[{]: <helper> (diff_step 14.2)
+#### Step 14.2: Add invited to Party interface
+
+##### Changed both/models/party.model.ts
+```diff
+@@ -6,4 +6,5 @@
+ ┊ 6┊ 6┊  location: string;
+ ┊ 7┊ 7┊  owner?: string;
+ ┊ 8┊ 8┊  public: boolean;
++┊  ┊ 9┊  invited?: string[];
+ ┊ 9┊10┊}
+```
+[}]: #
+
+Next, import the users publication to be defined on the server during startup:
+
+[{]: <helper> (diff_step 14.3)
+#### Step 14.3: Use it on the server
+
+##### Changed server/main.ts
+```diff
+@@ -2,7 +2,8 @@
+ ┊2┊2┊
+ ┊3┊3┊import { loadParties } from './imports/fixtures/parties';
+ ┊4┊4┊
+-┊5┊ ┊import './imports/publications/parties'; 
++┊ ┊5┊import './imports/publications/parties';
++┊ ┊6┊import './imports/publications/users'; 
+ ┊6┊7┊
+ ┊7┊8┊Meteor.startup(() => {
+ ┊8┊9┊  loadParties();
+```
+[}]: #
+
+Now, let's create a new Collection with RxJS support for the users collection. Meteor have a built-in users collection, so we just need to wrap it using `MongoObservable.fromExisting`:
+
+[{]: <helper> (diff_step 14.4)
+#### Step 14.4: Create Users collection from Meteor.users
+
+##### Added both/collections/users.collection.ts
+```diff
+@@ -0,0 +1,4 @@
++┊ ┊1┊import { MongoObservable } from 'meteor-rxjs';
++┊ ┊2┊import { Meteor } from 'meteor/meteor';
++┊ ┊3┊
++┊ ┊4┊export const Users = MongoObservable.fromExisting(Meteor.users);
+```
+[}]: #
+
+And let's create an interface for the User object:
+
+[{]: <helper> (diff_step 14.5)
+#### Step 14.5: Create also User interface
+
+##### Added both/models/user.model.ts
+```diff
+@@ -0,0 +1,3 @@
++┊ ┊1┊import { Meteor } from 'meteor/meteor';
++┊ ┊2┊
++┊ ┊3┊export interface User extends Meteor.User {}
+```
+[}]: #
+
+Then, let's load the uninvited users of a particular party into the `PartyDetails` component.
+
+We will use `MeteorObservable.subscribe` to subscribe to the data, and we use `.find` on the `Users` collection in order to fetch the user's details:
+
+[{]: <helper> (diff_step 14.6)
+#### Step 14.6: Implement subscription of uninvited users
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -1,5 +1,6 @@
+ ┊1┊1┊import { Component, OnInit, OnDestroy } from '@angular/core';
+ ┊2┊2┊import { ActivatedRoute } from '@angular/router';
++┊ ┊3┊import { Observable } from 'rxjs/Observable';
+ ┊3┊4┊import { Subscription } from 'rxjs/Subscription';
+ ┊4┊5┊import { Meteor } from 'meteor/meteor';
+ ┊5┊6┊import { MeteorObservable } from 'meteor-rxjs';
+```
+```diff
+@@ -8,6 +9,8 @@
+ ┊ 8┊ 9┊
+ ┊ 9┊10┊import { Parties } from '../../../../both/collections/parties.collection';
+ ┊10┊11┊import { Party } from '../../../../both/models/party.model';
++┊  ┊12┊import { Users } from '../../../../both/collections/users.collection';
++┊  ┊13┊import { User } from '../../../../both/models/user.model';
+ ┊11┊14┊
+ ┊12┊15┊import template from './party-details.component.html';
+ ┊13┊16┊
+```
+```diff
+@@ -20,6 +23,8 @@
+ ┊20┊23┊  paramsSub: Subscription;
+ ┊21┊24┊  party: Party;
+ ┊22┊25┊  partySub: Subscription;
++┊  ┊26┊  users: Observable<User>;
++┊  ┊27┊  uninvitedSub: Subscription;
+ ┊23┊28┊
+ ┊24┊29┊  constructor(
+ ┊25┊30┊    private route: ActivatedRoute
+```
+```diff
+@@ -38,6 +43,18 @@
+ ┊38┊43┊        this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
+ ┊39┊44┊          this.party = Parties.findOne(this.partyId);
+ ┊40┊45┊        });
++┊  ┊46┊
++┊  ┊47┊        if (this.uninvitedSub) {
++┊  ┊48┊          this.uninvitedSub.unsubscribe();
++┊  ┊49┊        }
++┊  ┊50┊
++┊  ┊51┊        this.uninvitedSub = MeteorObservable.subscribe('uninvited', this.partyId).subscribe(() => {
++┊  ┊52┊           this.users = Users.find({
++┊  ┊53┊             _id: {
++┊  ┊54┊               $ne: Meteor.userId()
++┊  ┊55┊              }
++┊  ┊56┊            }).zone();
++┊  ┊57┊        });
+ ┊41┊58┊      });
+ ┊42┊59┊  }
+ ┊43┊60┊
+```
+```diff
+@@ -59,5 +76,6 @@
+ ┊59┊76┊  ngOnDestroy() {
+ ┊60┊77┊    this.paramsSub.unsubscribe();
+ ┊61┊78┊    this.partySub.unsubscribe();
++┊  ┊79┊    this.uninvitedSub.unsubscribe();
+ ┊62┊80┊  }
+ ┊63┊81┊}
+```
+[}]: #
+
+Now, render the uninvited users on the `PartyDetails`'s page:
+
+[{]: <helper> (diff_step 14.7)
+#### Step 14.7: Display list of uninvited users
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -10,4 +10,11 @@
+ ┊10┊10┊
+ ┊11┊11┊  <button type="submit">Save</button>
+ ┊12┊12┊  <a [routerLink]="['/']">Cancel</a>
+-┊13┊  ┊</form>🚫↵
++┊  ┊13┊</form>
++┊  ┊14┊
++┊  ┊15┊<p>Users to invite:</p>
++┊  ┊16┊<ul>
++┊  ┊17┊  <li *ngFor="let user of users | async">
++┊  ┊18┊    <div>undefined</div>
++┊  ┊19┊  </li>
++┊  ┊20┊</ul>
+```
+[}]: #
+
+> Remember? we use `async` Pipe because we use RxJS `Observable`
+
+# Implementing Pipes
+
+In the previous section we rendered a list of user emails. In Meteor's [accounts package](http://docs.meteor.com/#/full/accounts_api) an email is considered a primary user ID by default. At the same time, everything is configurable, which means there is way for a user to set a custom username to be identified with during the registration. Considering usernames are more visually appealing than emails, let's render them instead of emails in that list of uninvited users checking if the name is set for each user.
+
+For that purpose we could create a private component method and call it each time in the template to get the right display name, i.e., username or email. Instead, we'll implement a special pipe that handles this, at the same time, we'll learn how to create stateless pipes. One of the advantages of this approach in comparison to class methods is that we can use the same pipe in any component. You can read [the docs](https://angular.io/docs/ts/latest/guide/pipes.html) to know more about Angular2 Pipes.
+
+Let's add a new folder "client/imports/app/shared" and place a new file `display-name.pipe.ts`. We'll add our new `displayName` pipe inside of it:
+
+[{]: <helper> (diff_step 14.8)
+#### Step 14.8: Create DisplayNamePipe
+
+##### Added client/imports/app/shared/display-name.pipe.ts
+```diff
+@@ -0,0 +1,25 @@
++┊  ┊ 1┊import { Pipe, PipeTransform } from '@angular/core';
++┊  ┊ 2┊import { Meteor } from 'meteor/meteor';
++┊  ┊ 3┊
++┊  ┊ 4┊import { User } from '../../../../both/models/user.model';
++┊  ┊ 5┊
++┊  ┊ 6┊@Pipe({
++┊  ┊ 7┊  name: 'displayName'
++┊  ┊ 8┊})
++┊  ┊ 9┊export class DisplayNamePipe implements PipeTransform {
++┊  ┊10┊  transform(user: User): string {
++┊  ┊11┊    if (!user) {
++┊  ┊12┊      return '';
++┊  ┊13┊    }
++┊  ┊14┊
++┊  ┊15┊    if (user.username) {
++┊  ┊16┊      return user.username;
++┊  ┊17┊    }
++┊  ┊18┊
++┊  ┊19┊    if (user.emails) {
++┊  ┊20┊      return user.emails[0].address;
++┊  ┊21┊    }
++┊  ┊22┊
++┊  ┊23┊    return '';
++┊  ┊24┊  }
++┊  ┊25┊}
+```
+[}]: #
+
+As you can see, there are a couple of things to remember in order to create a pipe:
+
+- define a class that implements the `PipeTransform` interface, with an implemented method `transform` inside
+- place pipe metadata upon this class with the help of the `@Pipe` decorator to notify Angular 2 that this class essentially is a pipe
+
+Now, in order to use this Pipe, we need to declare it in the `NgModule`, so first let's create an index file for all of the shared declarations:
+
+[{]: <helper> (diff_step 14.9)
+#### Step 14.9: Make space for shared declarations
+
+##### Added client/imports/app/shared/index.ts
+```diff
+@@ -0,0 +1,5 @@
++┊ ┊1┊import { DisplayNamePipe } from './display-name.pipe';
++┊ ┊2┊
++┊ ┊3┊export const SHARED_DECLARATIONS: any[] = [
++┊ ┊4┊  DisplayNamePipe
++┊ ┊5┊];
+```
+[}]: #
+
+And import the exposed Array in our `NgModule` definition:
+
+[{]: <helper> (diff_step 14.10)
+#### Step 14.10: Import those declarations to AppModule
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -8,6 +8,7 @@
+ ┊ 8┊ 8┊import { AppComponent } from './app.component';
+ ┊ 9┊ 9┊import { routes, ROUTES_PROVIDERS } from './app.routes';
+ ┊10┊10┊import { PARTIES_DECLARATIONS } from './parties';
++┊  ┊11┊import { SHARED_DECLARATIONS } from './shared';
+ ┊11┊12┊
+ ┊12┊13┊@NgModule({
+ ┊13┊14┊  imports: [
+```
+```diff
+@@ -20,7 +21,8 @@
+ ┊20┊21┊  ],
+ ┊21┊22┊  declarations: [
+ ┊22┊23┊    AppComponent,
+-┊23┊  ┊    ...PARTIES_DECLARATIONS
++┊  ┊24┊    ...PARTIES_DECLARATIONS,
++┊  ┊25┊    ...SHARED_DECLARATIONS
+ ┊24┊26┊  ],
+ ┊25┊27┊  providers: [
+ ┊26┊28┊    ...ROUTES_PROVIDERS
+```
+[}]: #
+
+To make use of the created pipe, change the markup of the `PartyDetails`'s template to:
+
+[{]: <helper> (diff_step 14.11)
+#### Step 14.11: Use this Pipe in PartyDetails
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -15,6 +15,6 @@
+ ┊15┊15┊<p>Users to invite:</p>
+ ┊16┊16┊<ul>
+ ┊17┊17┊  <li *ngFor="let user of users | async">
+-┊18┊  ┊    <div>undefined</div>
++┊  ┊18┊    <div>undefined</div>
+ ┊19┊19┊  </li>
+ ┊20┊20┊</ul>
+```
+[}]: #
+
+If you were familiar with Angular 1's filters concept, you might believe that Angular 2's pipes are very similar. This is both true and not. While the view syntax and aims they are used for are the same, there are some important differences. The main one is that Angular 2 can now efficiently handle _stateful_ pipes, whereas stateful filters were discouraged in Angular 1. Another thing to note is that Angular 2 pipes are defined in the unique and elegant Angular 2 way, i.e., using classes and class metadata, the same as for components and their views.
+
+# Challenge
+
+In order to cement our knowledge of using pipes, try to create a current user status pipe, which transforms the current user in a party to one of three values: owner, invited and uninvited. This will be helpful in the next step, where we'll get to the implementation of the invitation feature and will change the current UI for improved security.
+
+# Summary
+
+In this step, we learned about:
+
+- how to implement pipes in Angular 2, and how they different from filters in Angular 1
+- configuring our accounts-ui package
+- some Mongo query operators like `$nin` & `$ne`
+
+In the next step we'll look at using Meteor methods as a way to securely verify client-side data changes on the server.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step13.md) | [Next Step >](step15.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From c7fa4dffb9057c6607870f582c9e8ab778af1106 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:24:02 +0300
Subject: [PATCH 125/292] Step 15.1: Add a party invitation method

---
 both/methods/parties.methods.ts | 47 +++++++++++++++++++++++++++++++++++++++++
 1 file changed, 47 insertions(+)
 create mode 100644 both/methods/parties.methods.ts

diff --git a/both/methods/parties.methods.ts b/both/methods/parties.methods.ts
new file mode 100644
index 0000000..cc324f9
--- /dev/null
+++ b/both/methods/parties.methods.ts
@@ -0,0 +1,47 @@
+import {Parties} from '../collections/parties.collection';
+import {Email} from 'meteor/email';
+import {check} from 'meteor/check';
+import {Meteor} from 'meteor/meteor';
+
+function getContactEmail(user:Meteor.User):string {
+  if (user.emails && user.emails.length)
+    return user.emails[0].address;
+
+  return null;
+}
+
+Meteor.methods({
+  invite: function (partyId:string, userId:string) {
+    check(partyId, String);
+    check(userId, String);
+
+    let party = Parties.collection.findOne(partyId);
+
+    if (!party)
+      throw new Meteor.Error('404', 'No such party!');
+
+    if (party.public)
+      throw new Meteor.Error('400', 'That party is public. No need to invite people.');
+
+    if (party.owner !== this.userId)
+      throw new Meteor.Error('403', 'No permissions!');
+
+    if (userId !== party.owner && (party.invited || []).indexOf(userId) == -1) {
+      Parties.collection.update(partyId, {$addToSet: {invited: userId}});
+
+      let from = getContactEmail(Meteor.users.findOne(this.userId));
+      let to = getContactEmail(Meteor.users.findOne(userId));
+
+      if (Meteor.isServer && to) {
+        Email.send({
+          from: 'noreply@socially.com',
+          to: to,
+          replyTo: from || undefined,
+          subject: 'PARTY: ' + party.name,
+          text: `Hi, I just invited you to ${party.name} on Socially.
+                        \n\nCome check it out: ${Meteor.absoluteUrl()}\n`
+        });
+      }
+    }
+  }
+});
\ No newline at end of file
-- 
2.7.4


From 95e57bcf1d9678e8f757cfe316d334b9845a0325 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:24:34 +0300
Subject: [PATCH 126/292] Step 15.2: Import methods on the server side

---
 server/main.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/server/main.ts b/server/main.ts
index f6356dd..7979c05 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -3,7 +3,8 @@ import { Meteor } from 'meteor/meteor';
 import { loadParties } from './imports/fixtures/parties';
 
 import './imports/publications/parties';
-import './imports/publications/users'; 
+import './imports/publications/users';
+import '../both/methods/parties.methods';
 
 Meteor.startup(() => {
   loadParties();
-- 
2.7.4


From e52bbdd9855c6f40357624fbda181b18064ede99 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:25:20 +0300
Subject: [PATCH 127/292] Step 15.3: Import methods on the client side

---
 client/main.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/main.ts b/client/main.ts
index c5323fd..45d1530 100644
--- a/client/main.ts
+++ b/client/main.ts
@@ -4,5 +4,7 @@ import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 
 import { AppModule } from './imports/app/app.module';
 
+import '../both/methods/parties.methods';
+
 const platform = platformBrowserDynamic();
 platform.bootstrapModule(AppModule);
\ No newline at end of file
-- 
2.7.4


From 06cff6da9aa604f3c67d50963a8626c0b4a8b89e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:27:04 +0300
Subject: [PATCH 128/292] Step 15.4: Add check and email packages

---
 .meteor/packages | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 4a92e64..6c5c67f 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -23,3 +23,5 @@ dispatch:mocha-phantomjs
 shell-server
 accounts-password
 tmeasday:publish-counts
+check
+email
-- 
2.7.4


From d94f7e1449d503902bf29daeb41384cb2d3fdfad Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:29:09 +0300
Subject: [PATCH 129/292] Step 15.5: Add invite method

---
 client/imports/app/parties/party-details.component.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index 78e0c41..28c9588 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -16,5 +16,6 @@
 <ul>
   <li *ngFor="let user of users | async">
     <div>{{user | displayName}}</div>
+    <button (click)="invite(user)">Invite</button>
   </li>
 </ul>
-- 
2.7.4


From 502947961b448def591b2355555545d8ea110eec Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:31:02 +0300
Subject: [PATCH 130/292] Step 15.6: Add the click handler in the Component

---
 client/imports/app/parties/party-details.component.ts | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 246243e..d17eb1f 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -73,6 +73,14 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
     });
   }
 
+  invite(user: Meteor.User) {
+    MeteorObservable.call('invite', this.party._id, user._id).subscribe(() => {
+      alert('User successfully invited.');
+    }, (error) => {
+      alert(`Failed to invite due to ${error}`);
+    });
+  }
+
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
     this.partySub.unsubscribe();
-- 
2.7.4


From ea60f6a38eefcb7ecbfe057ab62a4da2b2e7791e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:42:39 +0300
Subject: [PATCH 131/292] Step 15.7: Get the party reactively

---
 client/imports/app/parties/party-details.component.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index d17eb1f..fb07803 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -41,7 +41,9 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
         }
 
         this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
-          this.party = Parties.findOne(this.partyId);
+          MeteorObservable.autorun().subscribe(() => {
+            this.party = Parties.findOne(this.partyId);
+          });
         });
 
         if (this.uninvitedSub) {
-- 
2.7.4


From 29af60cd6faeb8375cc7f26b48596f5a5440d0ec Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:44:39 +0300
Subject: [PATCH 132/292] Step 15.8: Update the users list reactively

---
 client/imports/app/parties/party-details.component.ts | 18 +++++++++++++-----
 1 file changed, 13 insertions(+), 5 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index fb07803..8d877f6 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -43,6 +43,7 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
         this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
           MeteorObservable.autorun().subscribe(() => {
             this.party = Parties.findOne(this.partyId);
+            this.getUsers(this.party);
           });
         });
 
@@ -51,15 +52,22 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
         }
 
         this.uninvitedSub = MeteorObservable.subscribe('uninvited', this.partyId).subscribe(() => {
-           this.users = Users.find({
-             _id: {
-               $ne: Meteor.userId()
-              }
-            }).zone();
+          this.getUsers(this.party);
         });
       });
   }
 
+  getUsers(party: Party) {
+    if (party) {
+      this.users = Users.find({
+        _id: {
+          $nin: party.invited || [],
+          $ne: Meteor.userId()
+        }
+      }).zone();
+    }
+  }
+
   saveParty() {
     if (!Meteor.userId()) {
       alert('Please log in to change this party');
-- 
2.7.4


From aacbc76ecfd1297d0cc26929065b32b7aba38a5f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:47:08 +0300
Subject: [PATCH 133/292] Step 15.9: Show private parties to the invited and
 owners only

---
 server/imports/publications/parties.ts | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
index 34c9470..4742280 100644
--- a/server/imports/publications/parties.ts
+++ b/server/imports/publications/parties.ts
@@ -36,6 +36,12 @@ function buildQuery(partyId?: string, location?: string): Object {
           $exists: true
         }
       }]
+    },
+    {
+      $and: [
+        { invited: this.userId },
+        { invited: { $exists: true } }
+      ]
     }]
   };
 
-- 
2.7.4


From 43f26be9588178f9dade4488674e88cf119a5076 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:48:03 +0300
Subject: [PATCH 134/292] Step 15.10: Add a reply method

---
 both/methods/parties.methods.ts | 45 +++++++++++++++++++++++++++++++++++++++++
 1 file changed, 45 insertions(+)

diff --git a/both/methods/parties.methods.ts b/both/methods/parties.methods.ts
index cc324f9..ac0bfc7 100644
--- a/both/methods/parties.methods.ts
+++ b/both/methods/parties.methods.ts
@@ -43,5 +43,50 @@ Meteor.methods({
         });
       }
     }
+  },
+  reply: function(partyId: string, rsvp: string) {
+    check(partyId, String);
+    check(rsvp, String);
+
+    if (!this.userId)
+      throw new Meteor.Error('403', 'You must be logged-in to reply');
+
+    if (['yes', 'no', 'maybe'].indexOf(rsvp) === -1)
+      throw new Meteor.Error('400', 'Invalid RSVP');
+
+    let party = Parties.findOne({ _id: partyId });
+
+    if (!party)
+      throw new Meteor.Error('404', 'No such party');
+
+    if (party.owner === this.userId)
+      throw new Meteor.Error('500', 'You are the owner!');
+
+    if (!party.public && (!party.invited || party.invited.indexOf(this.userId) == -1))
+      throw new Meteor.Error('403', 'No such party'); // its private, but let's not tell this to the user
+
+    let rsvpIndex = party.rsvps ? party.rsvps.findIndex((rsvp) => rsvp.userId === this.userId) : -1;
+
+    if (rsvpIndex !== -1) {
+      // update existing rsvp entry
+      if (Meteor.isServer) {
+        // update the appropriate rsvp entry with $
+        Parties.update(
+          { _id: partyId, 'rsvps.userId': this.userId },
+          { $set: { 'rsvps.$.response': rsvp } });
+      } else {
+        // minimongo doesn't yet support $ in modifier. as a temporary
+        // workaround, make a modifier that uses an index. this is
+        // safe on the client since there's only one thread.
+        let modifier = { $set: {} };
+        modifier.$set['rsvps.' + rsvpIndex + '.response'] = rsvp;
+
+        Parties.update(partyId, modifier);
+      }
+    } else {
+      // add new rsvp entry
+      Parties.update(partyId,
+        { $push: { rsvps: { userId: this.userId, response: rsvp } } });
+    }
   }
 });
\ No newline at end of file
-- 
2.7.4


From 0e9224711c2fc0a8159c82ff64ba3dcc2e6d06ab Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:48:46 +0300
Subject: [PATCH 135/292] Step 15.11: Add RSVP interface

---
 both/models/party.model.ts | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
index 64e6ae1..9f7c41e 100644
--- a/both/models/party.model.ts
+++ b/both/models/party.model.ts
@@ -7,4 +7,10 @@ export interface Party extends CollectionObject {
   owner?: string;
   public: boolean;
   invited?: string[];
+  rsvps?: RSVP[];
 }
+
+interface RSVP {
+  userId: string;
+  response: string;
+}
\ No newline at end of file
-- 
2.7.4


From 39d70edfe63fb69c363c5c91e94125f6eff6e676 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:49:22 +0300
Subject: [PATCH 136/292] Step 15.12: Add reponse buttons

---
 client/imports/app/parties/party-details.component.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index 28c9588..a3e173d 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -19,3 +19,10 @@
     <button (click)="invite(user)">Invite</button>
   </li>
 </ul>
+
+<div>
+  <h2>Reply to the invitation</h2>
+  <input type="button" value="I'm going!" (click)="reply('yes')">
+  <input type="button" value="Maybe" (click)="reply('maybe')">
+  <input type="button" value="No" (click)="reply('no')">
+</div>
-- 
2.7.4


From 8ed7fd46ceb0e044a14d35d03cb6cd7434f02fb6 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:51:03 +0300
Subject: [PATCH 137/292] Step 15.13: Add reply method to PartyDetails
 component

---
 client/imports/app/parties/party-details.component.ts | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 8d877f6..e70f680 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -91,6 +91,14 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
     });
   }
 
+  reply(rsvp: string) {
+    MeteorObservable.call('reply', this.party._id, rsvp).subscribe(() => {
+      alert('You successfully replied.');
+    }, (error) => {
+      alert(`Failed to reply due to ${error}`);
+    });
+  }
+
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
     this.partySub.unsubscribe();
-- 
2.7.4


From ebaf0d004dbf27960335ce5bf894e2764f0ea6f7 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:59:23 +0300
Subject: [PATCH 138/292] Step 15.14: Add a new response counting pipe

---
 client/imports/app/shared/rsvp.pipe.ts | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)
 create mode 100644 client/imports/app/shared/rsvp.pipe.ts

diff --git a/client/imports/app/shared/rsvp.pipe.ts b/client/imports/app/shared/rsvp.pipe.ts
new file mode 100644
index 0000000..5b5938c
--- /dev/null
+++ b/client/imports/app/shared/rsvp.pipe.ts
@@ -0,0 +1,22 @@
+import {Pipe, PipeTransform} from '@angular/core';
+import {Party} from "../../../../both/models/party.model";
+import {Parties} from "../../../../both/collections/parties.collection";
+
+@Pipe({
+  name: 'rsvp'
+})
+export class RsvpPipe implements PipeTransform {
+  transform(party: Party, type: string): number {
+    if (!type) {
+      return 0;
+    }
+
+    let total = 0;
+    const found = Parties.findOne(party._id);
+
+    if (found)
+      total = found.rsvps ? found.rsvps.filter(rsvp => rsvp.response === type).length : 0;
+
+    return total;
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 44a0ba565f5da2120624d581cda24ad07f170d70 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:59:34 +0300
Subject: [PATCH 139/292] Step 15.15: Display response statistics on the list

---
 client/imports/app/parties/parties-list.component.html | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index f1083e3..40e51d2 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -20,6 +20,12 @@
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
       <button (click)="removeParty(party)">X</button>
+      <div>
+        Who is coming:
+        Yes - {{party | rsvp:'yes'}}
+        Maybe - {{party | rsvp:'maybe'}}
+        No - {{party | rsvp:'no'}}
+      </div>
     </li>
   </ul>
 
-- 
2.7.4


From 9799ebd86bacea3e7db143231da9b6972c0bb119 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 10:59:44 +0300
Subject: [PATCH 140/292] Step 15.16: Import RsvpPipe

---
 client/imports/app/shared/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/shared/index.ts b/client/imports/app/shared/index.ts
index d9104e8..12c7d64 100644
--- a/client/imports/app/shared/index.ts
+++ b/client/imports/app/shared/index.ts
@@ -1,5 +1,7 @@
 import { DisplayNamePipe } from './display-name.pipe';
+import {RsvpPipe} from "./rsvp.pipe";
 
 export const SHARED_DECLARATIONS: any[] = [
-  DisplayNamePipe
+  DisplayNamePipe,
+  RsvpPipe
 ];
-- 
2.7.4


From a612df944438479bf45f9f3f2dc9a675b5b80a0a Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 15:25:04 -0200
Subject: [PATCH 141/292] Step 15: Meteor methods

---
 steps/step15.md | 541 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 541 insertions(+)
 create mode 100644 steps/step15.md

diff --git a/steps/step15.md b/steps/step15.md
new file mode 100644
index 0000000..6c033d5
--- /dev/null
+++ b/steps/step15.md
@@ -0,0 +1,541 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Meteor methods
+
+In this step we will learn how to use Meteor Methods to
+implement server side logic of the party invitation feature.
+
+> A capital "M" will be used with Meteor "M"ethods to avoid confusion with Javascript function methods
+
+Meteor Methods are a more secure and reliable way to
+implement complex logic on the server side in comparison to the direct
+manipulations of Mongo collections. Also, we'll touch briefly on
+Meteor's UI latency compensation mechanism that comes with these Methods.
+This is one of the great Meteor concepts that allows for rapid UI changes.
+
+# Invitation Method
+
+Let's create a new file `both/methods/parties.methods.ts`, and add the following `invite` Meteor Method:
+
+[{]: <helper> (diff_step 15.1)
+#### Step 15.16: Import RsvpPipe
+
+##### Changed client/imports/app/shared/index.ts
+```diff
+@@ -1,5 +1,7 @@
+ ┊1┊1┊import { DisplayNamePipe } from './display-name.pipe';
++┊ ┊2┊import {RsvpPipe} from "./rsvp.pipe";
+ ┊2┊3┊
+ ┊3┊4┊export const SHARED_DECLARATIONS: any[] = [
+-┊4┊ ┊  DisplayNamePipe
++┊ ┊5┊  DisplayNamePipe,
++┊ ┊6┊  RsvpPipe
+ ┊5┊7┊];
+```
+[}]: #
+
+We used a special API method `Meteor.methods` to register
+a new Meteor Method. Again, don't forget to import your created `parties.methods.ts` module
+in the server's `main.ts` module to have the Methods defined properly:
+
+[{]: <helper> (diff_step 15.2)
+#### Step 15.2: Import methods on the server side
+
+##### Changed server/main.ts
+```diff
+@@ -3,7 +3,8 @@
+ ┊ 3┊ 3┊import { loadParties } from './imports/fixtures/parties';
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊import './imports/publications/parties';
+-┊ 6┊  ┊import './imports/publications/users'; 
++┊  ┊ 6┊import './imports/publications/users';
++┊  ┊ 7┊import '../both/methods/parties.methods';
+ ┊ 7┊ 8┊
+ ┊ 8┊ 9┊Meteor.startup(() => {
+ ┊ 9┊10┊  loadParties();
+```
+[}]: #
+
+### Latency Compensation
+
+UI Latency compensation is one of the features that makes Meteor stand out amongst most other Web frameworks, thanks again to the isomorphic environment and Meteor Methods.
+In short, visual changes are applied immediately as a response to some user action,
+even before the server responds to anything. If you want to read up more about how the view can securely be updated
+even before the server is contacted proceed to an [Introduction to Latency Compensation](https://meteorhacks.com/introduction-to-latency-compensation) written by Arunoda.
+
+But to make it happen, we need to define our Methods on the client side as well. Let's import our Methods in `client/main.ts`:
+
+[{]: <helper> (diff_step 15.3)
+#### Step 15.3: Import methods on the client side
+
+##### Changed client/main.ts
+```diff
+@@ -4,5 +4,7 @@
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊import { AppModule } from './imports/app/app.module';
+ ┊ 6┊ 6┊
++┊  ┊ 7┊import '../both/methods/parties.methods';
++┊  ┊ 8┊
+ ┊ 7┊ 9┊const platform = platformBrowserDynamic();
+ ┊ 8┊10┊platform.bootstrapModule(AppModule);🚫↵
+```
+[}]: #
+
+### Validating Methods with Check
+
+As you can see, we've also done a lot of checks to verify that
+all arguments passed down to the method are valid.
+
+First the validity of the arguments' types are checked, and then
+the business logic associated with them is checked.
+
+Type validation checks, which are essential for the JavaScript methods dealing with the storage's data,
+are done with the help of a handy Meteor's package called ["check"](https://atmospherejs.com/meteor/check).
+
+    meteor add check
+
+Then, if everything is valid, we send an invitation email.
+Here we are using another handy Meteor's package titled ["email"](https://atmospherejs.com/meteor/email).
+
+    meteor add email
+
+At this point, we are ready to add a call to the new Method from the client.
+
+Let's add a new button right after each username or email in that
+list of users to invite in the `PartyDetails`'s template:
+
+[{]: <helper> (diff_step 15.5)
+#### Step 15.5: Add invite method
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -16,5 +16,6 @@
+ ┊16┊16┊<ul>
+ ┊17┊17┊  <li *ngFor="let user of users | async">
+ ┊18┊18┊    <div>undefined</div>
++┊  ┊19┊    <button (click)="invite(user)">Invite</button>
+ ┊19┊20┊  </li>
+ ┊20┊21┊</ul>
+```
+[}]: #
+
+And then, change the component to handle the click event and invite a user:
+
+[{]: <helper> (diff_step 15.6)
+#### Step 15.6: Add the click handler in the Component
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -73,6 +73,14 @@
+ ┊73┊73┊    });
+ ┊74┊74┊  }
+ ┊75┊75┊
++┊  ┊76┊  invite(user: Meteor.User) {
++┊  ┊77┊    MeteorObservable.call('invite', this.party._id, user._id).subscribe(() => {
++┊  ┊78┊      alert('User successfully invited.');
++┊  ┊79┊    }, (error) => {
++┊  ┊80┊      alert(`Failed to invite due to ${error}`);
++┊  ┊81┊    });
++┊  ┊82┊  }
++┊  ┊83┊
+ ┊76┊84┊  ngOnDestroy() {
+ ┊77┊85┊    this.paramsSub.unsubscribe();
+ ┊78┊86┊    this.partySub.unsubscribe();
+```
+[}]: #
+
+> We used `MeteorObservable.call` which triggers a Meteor server method, which triggers `next` callback when the server returns a response, and `error` when the server returns an error.
+
+### Updating Invited Users Reactively
+
+One more thing before we are done with the party owner's invitation
+logic. We, of course, would like to make this list of users
+change reactively, i.e. each user disappears from the list
+when the invitation has been sent successfully.
+
+It's worth mentioning that each party should change appropriately
+when we invite a user — the party `invited` array should update
+in the local Mongo storage. If we wrap the line where
+we get the new party with the `MeteorObservable.autorun` method, this code should
+re-run reactively:
+
+[{]: <helper> (diff_step 15.7)
+#### Step 15.7: Get the party reactively
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -41,7 +41,9 @@
+ ┊41┊41┊        }
+ ┊42┊42┊
+ ┊43┊43┊        this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
+-┊44┊  ┊          this.party = Parties.findOne(this.partyId);
++┊  ┊44┊          MeteorObservable.autorun().subscribe(() => {
++┊  ┊45┊            this.party = Parties.findOne(this.partyId);
++┊  ┊46┊          });
+ ┊45┊47┊        });
+ ┊46┊48┊
+ ┊47┊49┊        if (this.uninvitedSub) {
+```
+[}]: #
+
+> Now each time the Party object changes, we will re-fetch it from the collection and assign it to the Component property. Our view known to update itself's because we used `zone()` operator in order to connect between Meteor data and Angular change detection.
+
+Now its time to update our users list.
+We'll move the line that gets the users list into a
+separate method, provided with the list of IDs of already invited users;
+and call it whenever we need: right in the above `MeteorObservable.autorun` method after the party assignment and in the subscription, like that:
+
+[{]: <helper> (diff_step 15.8)
+#### Step 15.8: Update the users list reactively
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -43,6 +43,7 @@
+ ┊43┊43┊        this.partySub = MeteorObservable.subscribe('party', this.partyId).subscribe(() => {
+ ┊44┊44┊          MeteorObservable.autorun().subscribe(() => {
+ ┊45┊45┊            this.party = Parties.findOne(this.partyId);
++┊  ┊46┊            this.getUsers(this.party);
+ ┊46┊47┊          });
+ ┊47┊48┊        });
+ ┊48┊49┊
+```
+```diff
+@@ -51,15 +52,22 @@
+ ┊51┊52┊        }
+ ┊52┊53┊
+ ┊53┊54┊        this.uninvitedSub = MeteorObservable.subscribe('uninvited', this.partyId).subscribe(() => {
+-┊54┊  ┊           this.users = Users.find({
+-┊55┊  ┊             _id: {
+-┊56┊  ┊               $ne: Meteor.userId()
+-┊57┊  ┊              }
+-┊58┊  ┊            }).zone();
++┊  ┊55┊          this.getUsers(this.party);
+ ┊59┊56┊        });
+ ┊60┊57┊      });
+ ┊61┊58┊  }
+ ┊62┊59┊
++┊  ┊60┊  getUsers(party: Party) {
++┊  ┊61┊    if (party) {
++┊  ┊62┊      this.users = Users.find({
++┊  ┊63┊        _id: {
++┊  ┊64┊          $nin: party.invited || [],
++┊  ┊65┊          $ne: Meteor.userId()
++┊  ┊66┊        }
++┊  ┊67┊      }).zone();
++┊  ┊68┊    }
++┊  ┊69┊  }
++┊  ┊70┊
+ ┊63┊71┊  saveParty() {
+ ┊64┊72┊    if (!Meteor.userId()) {
+ ┊65┊73┊      alert('Please log in to change this party');
+```
+[}]: #
+
+Here comes test time. Let's add a couple of new users.
+Then login as an old user and add a new party.
+Go to the party: you should see a list of all users including
+newly created ones. Invite several of them — each item in the list
+should disappear after a successful invitation.
+
+What's important to notice here is that each user item in the users list
+disappears right after the click, even before the message about
+the invitation was successfully sent. That's the latency compensation at work!
+
+# User Reply
+
+Here we are going to implement the user reply to the party invitation request.
+
+First of all, let's make parties list a bit more secure,
+which means two things: showing private parties to those who have been invited
+or to owners, and elaborate routing activation defense for the party details view:
+
+[{]: <helper> (diff_step 15.9)
+#### Step 15.9: Show private parties to the invited and owners only
+
+##### Changed server/imports/publications/parties.ts
+```diff
+@@ -36,6 +36,12 @@
+ ┊36┊36┊          $exists: true
+ ┊37┊37┊        }
+ ┊38┊38┊      }]
++┊  ┊39┊    },
++┊  ┊40┊    {
++┊  ┊41┊      $and: [
++┊  ┊42┊        { invited: this.userId },
++┊  ┊43┊        { invited: { $exists: true } }
++┊  ┊44┊      ]
+ ┊39┊45┊    }]
+ ┊40┊46┊  };
+```
+[}]: #
+
+The next thing is a party invitee response to the invitation itself. Here, as usual,
+we'll need to update the server side and UI. For the server,
+let's add a new `reply` Meteor Method:
+
+[{]: <helper> (diff_step 15.10)
+#### Step 15.10: Add a reply method
+
+##### Changed both/methods/parties.methods.ts
+```diff
+@@ -43,5 +43,50 @@
+ ┊43┊43┊        });
+ ┊44┊44┊      }
+ ┊45┊45┊    }
++┊  ┊46┊  },
++┊  ┊47┊  reply: function(partyId: string, rsvp: string) {
++┊  ┊48┊    check(partyId, String);
++┊  ┊49┊    check(rsvp, String);
++┊  ┊50┊
++┊  ┊51┊    if (!this.userId)
++┊  ┊52┊      throw new Meteor.Error('403', 'You must be logged-in to reply');
++┊  ┊53┊
++┊  ┊54┊    if (['yes', 'no', 'maybe'].indexOf(rsvp) === -1)
++┊  ┊55┊      throw new Meteor.Error('400', 'Invalid RSVP');
++┊  ┊56┊
++┊  ┊57┊    let party = Parties.findOne({ _id: partyId });
++┊  ┊58┊
++┊  ┊59┊    if (!party)
++┊  ┊60┊      throw new Meteor.Error('404', 'No such party');
++┊  ┊61┊
++┊  ┊62┊    if (party.owner === this.userId)
++┊  ┊63┊      throw new Meteor.Error('500', 'You are the owner!');
++┊  ┊64┊
++┊  ┊65┊    if (!party.public && (!party.invited || party.invited.indexOf(this.userId) == -1))
++┊  ┊66┊      throw new Meteor.Error('403', 'No such party'); // its private, but let's not tell this to the user
++┊  ┊67┊
++┊  ┊68┊    let rsvpIndex = party.rsvps ? party.rsvps.findIndex((rsvp) => rsvp.userId === this.userId) : -1;
++┊  ┊69┊
++┊  ┊70┊    if (rsvpIndex !== -1) {
++┊  ┊71┊      // update existing rsvp entry
++┊  ┊72┊      if (Meteor.isServer) {
++┊  ┊73┊        // update the appropriate rsvp entry with $
++┊  ┊74┊        Parties.update(
++┊  ┊75┊          { _id: partyId, 'rsvps.userId': this.userId },
++┊  ┊76┊          { $set: { 'rsvps.$.response': rsvp } });
++┊  ┊77┊      } else {
++┊  ┊78┊        // minimongo doesn't yet support $ in modifier. as a temporary
++┊  ┊79┊        // workaround, make a modifier that uses an index. this is
++┊  ┊80┊        // safe on the client since there's only one thread.
++┊  ┊81┊        let modifier = { $set: {} };
++┊  ┊82┊        modifier.$set['rsvps.' + rsvpIndex + '.response'] = rsvp;
++┊  ┊83┊
++┊  ┊84┊        Parties.update(partyId, modifier);
++┊  ┊85┊      }
++┊  ┊86┊    } else {
++┊  ┊87┊      // add new rsvp entry
++┊  ┊88┊      Parties.update(partyId,
++┊  ┊89┊        { $push: { rsvps: { userId: this.userId, response: rsvp } } });
++┊  ┊90┊    }
+ ┊46┊91┊  }
+ ┊47┊92┊});🚫↵
+```
+[}]: #
+
+As you can see, a new property, called "rsvp", was added
+above to collect user responses of this particular party.
+One more thing. Let's update the party declaration file to
+make TypeScript resolve and compile with no warnings:
+
+[{]: <helper> (diff_step 15.11)
+#### Step 15.11: Add RSVP interface
+
+##### Changed both/models/party.model.ts
+```diff
+@@ -7,4 +7,10 @@
+ ┊ 7┊ 7┊  owner?: string;
+ ┊ 8┊ 8┊  public: boolean;
+ ┊ 9┊ 9┊  invited?: string[];
++┊  ┊10┊  rsvps?: RSVP[];
+ ┊10┊11┊}
++┊  ┊12┊
++┊  ┊13┊interface RSVP {
++┊  ┊14┊  userId: string;
++┊  ┊15┊  response: string;
++┊  ┊16┊}🚫↵
+```
+[}]: #
+
+For the UI, let's add three new buttons onto the party details view.
+These will be "yes", "no", "maybe" buttons and users responses accordingly:
+
+[{]: <helper> (diff_step 15.12)
+#### Step 15.12: Add reponse buttons
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -19,3 +19,10 @@
+ ┊19┊19┊    <button (click)="invite(user)">Invite</button>
+ ┊20┊20┊  </li>
+ ┊21┊21┊</ul>
++┊  ┊22┊
++┊  ┊23┊<div>
++┊  ┊24┊  <h2>Reply to the invitation</h2>
++┊  ┊25┊  <input type="button" value="I'm going!" (click)="reply('yes')">
++┊  ┊26┊  <input type="button" value="Maybe" (click)="reply('maybe')">
++┊  ┊27┊  <input type="button" value="No" (click)="reply('no')">
++┊  ┊28┊</div>
+```
+[}]: #
+
+Then, handle click events in the PartyDetails component:
+
+[{]: <helper> (diff_step 15.13)
+#### Step 15.13: Add reply method to PartyDetails component
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -91,6 +91,14 @@
+ ┊ 91┊ 91┊    });
+ ┊ 92┊ 92┊  }
+ ┊ 93┊ 93┊
++┊   ┊ 94┊  reply(rsvp: string) {
++┊   ┊ 95┊    MeteorObservable.call('reply', this.party._id, rsvp).subscribe(() => {
++┊   ┊ 96┊      alert('You successfully replied.');
++┊   ┊ 97┊    }, (error) => {
++┊   ┊ 98┊      alert(`Failed to reply due to ${error}`);
++┊   ┊ 99┊    });
++┊   ┊100┊  }
++┊   ┊101┊
+ ┊ 94┊102┊  ngOnDestroy() {
+ ┊ 95┊103┊    this.paramsSub.unsubscribe();
+ ┊ 96┊104┊    this.partySub.unsubscribe();
+```
+[}]: #
+
+### Rsvp Pipe
+
+Last, but not the least, let's show statistics of the invitation responses for the party owner.
+Let's imagine that any party owner
+would like to know the total number of those who declined, accepted, or remain tentative.
+This is a perfect use case to add a new stateful pipe, which takes as
+an input a party and a one of the RSVP responses, and calculates the total number of responses
+associated with this, provided as a parameter we'll call "response".
+
+Add a new pipe to the `client/imports/app/shared/rsvp.pipe.ts` as follows:
+
+[{]: <helper> (diff_step 15.14)
+#### Step 15.14: Add a new response counting pipe
+
+##### Added client/imports/app/shared/rsvp.pipe.ts
+```diff
+@@ -0,0 +1,22 @@
++┊  ┊ 1┊import {Pipe, PipeTransform} from '@angular/core';
++┊  ┊ 2┊import {Party} from "../../../../both/models/party.model";
++┊  ┊ 3┊import {Parties} from "../../../../both/collections/parties.collection";
++┊  ┊ 4┊
++┊  ┊ 5┊@Pipe({
++┊  ┊ 6┊  name: 'rsvp'
++┊  ┊ 7┊})
++┊  ┊ 8┊export class RsvpPipe implements PipeTransform {
++┊  ┊ 9┊  transform(party: Party, type: string): number {
++┊  ┊10┊    if (!type) {
++┊  ┊11┊      return 0;
++┊  ┊12┊    }
++┊  ┊13┊
++┊  ┊14┊    let total = 0;
++┊  ┊15┊    const found = Parties.findOne(party._id);
++┊  ┊16┊
++┊  ┊17┊    if (found)
++┊  ┊18┊      total = found.rsvps ? found.rsvps.filter(rsvp => rsvp.response === type).length : 0;
++┊  ┊19┊
++┊  ┊20┊    return total;
++┊  ┊21┊  }
++┊  ┊22┊}🚫↵
+```
+[}]: #
+
+The RSVP Pipe fetches the party and returns the count of `rsvps` Array, due the fact that we binded the change detection of Angular 2 and the Meteor data change, each time the data changes, Angular 2 renders the view again, and the RSVP Pipe will run again and update the view with the new number.
+
+It's also worth mentioning that the arguments of a Pipe implementation inside a template are passed to the `transform` method in the same form. Only difference is that the first argument of `transform` is a value to be transformed. In our case, passed only the RSVP response, hence, we are taking the first
+value in the list.
+
+An example:
+
+```js
+// usage: text | subStr:20:50
+@Pipe({name: 'subStr'})
+class SubStrPipe implements PipeTransform {
+  transform(text: string, starts: number, ends: number) {
+    return text.substring(starts, ends);
+  }
+}
+```
+
+Let's make use of this pipe in the `PartiesList` component:
+
+[{]: <helper> (diff_step 15.15)
+#### Step 15.15: Display response statistics on the list
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -20,6 +20,12 @@
+ ┊20┊20┊      <p>undefined</p>
+ ┊21┊21┊      <p>undefined</p>
+ ┊22┊22┊      <button (click)="removeParty(party)">X</button>
++┊  ┊23┊      <div>
++┊  ┊24┊        Who is coming:
++┊  ┊25┊        Yes - undefined
++┊  ┊26┊        Maybe - undefined
++┊  ┊27┊        No - undefined
++┊  ┊28┊      </div>
+ ┊23┊29┊    </li>
+ ┊24┊30┊  </ul>
+```
+[}]: #
+
+And let's add the new Pipe to the shared declarations file:
+
+[{]: <helper> (diff_step 15.16)
+#### Step 15.16: Import RsvpPipe
+
+##### Changed client/imports/app/shared/index.ts
+```diff
+@@ -1,5 +1,7 @@
+ ┊1┊1┊import { DisplayNamePipe } from './display-name.pipe';
++┊ ┊2┊import {RsvpPipe} from "./rsvp.pipe";
+ ┊2┊3┊
+ ┊3┊4┊export const SHARED_DECLARATIONS: any[] = [
+-┊4┊ ┊  DisplayNamePipe
++┊ ┊5┊  DisplayNamePipe,
++┊ ┊6┊  RsvpPipe
+ ┊5┊7┊];
+```
+[}]: #
+
+Now it's testing time! Check that an invited user is able to reply to an
+invitation, and also verify that the party's statistics update properly and reactively.
+Login as an existing user. Add a new party, go to the party and
+invite some other users. Then, open a new browser window in the anonymous mode along with the current window,
+and login as the invited user there. Go to the party details page, and reply, say, "no";
+the party's statistics on the first page with the parties list should duly update.
+
+# Challenge
+
+There is one important thing that we missed. Besides the party invitation
+statistics, each user would like to know if she has already responded, in case she forgot,
+to a particular invitation. This step's challenge will be to add this status
+information onto the PartyDetails's view and make it update reactively.
+
+> Hint: In order to make it reactive, you'll need to add one more handler into
+> the party `MeteorObservable.autorun`, like the `getUsers` method in the this step above.
+
+# Summary
+
+We've just finished the invitation feature in this step, having added bunch of new stuff.
+Socially is looking much more mature with Meteor Methods on board. We can give ourselves
+a big thumbs-up for that!
+
+Though, some places in the app can certainly be improved. For example,
+we still show some private information to all invited users, which should be designated only for the party owner.
+We'll fix this in the next step.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step14.md) | [Next Step >](step16.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 945567722d7a6d9b90e7b954ded00644dc2fa780 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:42:55 +0300
Subject: [PATCH 142/292] Step 16.1: Inject Meteor User and add isOwner method

---
 client/imports/app/parties/parties-list.component.ts | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index f94da32..2e45027 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -5,6 +5,7 @@ import { Subscription } from 'rxjs/Subscription';
 import { MeteorObservable } from 'meteor-rxjs';
 import { PaginationService } from 'ng2-pagination';
 import { Counts } from 'meteor/tmeasday:publish-counts';
+import { InjectUser } from "angular2-meteor-accounts-ui";
 
 import 'rxjs/add/operator/combineLatest';
 
@@ -26,6 +27,7 @@ interface Options extends Pagination {
   selector: 'parties-list',
   template
 })
+@InjectUser('user')
 export class PartiesListComponent implements OnInit, OnDestroy {
   parties: Observable<Party[]>;
   partiesSub: Subscription;
@@ -36,6 +38,7 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   partiesSize: number = 0;
   autorunSub: Subscription;
   location: Subject<string> = new Subject<string>();
+  user: Meteor.User;
 
   constructor(
     private paginationService: PaginationService
@@ -104,6 +107,10 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     this.nameOrder.next(parseInt(nameOrder));
   }
 
+  isOwner(party: Party): boolean {
+    return this.user && this.user._id === party.owner;
+  }
+
   ngOnDestroy() {
     this.partiesSub.unsubscribe();
     this.optionsSub.unsubscribe();
-- 
2.7.4


From 0e0ad9a6d50e154a1df4946b11177881e7be2457 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:43:04 +0300
Subject: [PATCH 143/292] Step 16.2: Use the hidden attribute in the
 PartiestList

---
 client/imports/app/parties/parties-list.component.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 40e51d2..a94ea42 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -1,5 +1,5 @@
 <div>
-  <parties-form style="float: left"></parties-form>
+  <parties-form [hidden]="!user" style="float: left"></parties-form>
   <input type="text" #searchtext placeholder="Search by Location">
   <button type="button" (click)="search(searchtext.value)">Search</button>
   
@@ -19,7 +19,7 @@
       <a [routerLink]="['/party', party._id]">{{party.name}}</a>
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
-      <button (click)="removeParty(party)">X</button>
+      <button [hidden]="!isOwner(party)" (click)="removeParty(party)">X</button>
       <div>
         Who is coming:
         Yes - {{party | rsvp:'yes'}}
-- 
2.7.4


From 451a5447e8c9378d370053347a954eeaabc0107e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:43:14 +0300
Subject: [PATCH 144/292] Step 16.3: Add isOwner property

---
 client/imports/app/parties/party-details.component.ts | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index e70f680..7562d03 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -4,6 +4,7 @@ import { Observable } from 'rxjs/Observable';
 import { Subscription } from 'rxjs/Subscription';
 import { Meteor } from 'meteor/meteor';
 import { MeteorObservable } from 'meteor-rxjs';
+import { InjectUser } from "angular2-meteor-accounts-ui";
 
 import 'rxjs/add/operator/map';
 
@@ -18,6 +19,7 @@ import template from './party-details.component.html';
   selector: 'party-details',
   template
 })
+@InjectUser('user')
 export class PartyDetailsComponent implements OnInit, OnDestroy {
   partyId: string;
   paramsSub: Subscription;
@@ -25,6 +27,7 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
   partySub: Subscription;
   users: Observable<User>;
   uninvitedSub: Subscription;
+  user: Meteor.User;
 
   constructor(
     private route: ActivatedRoute
@@ -99,6 +102,10 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
     });
   }
 
+  get isOwner(): boolean {
+    return this.party && this.user && this.user._id === this.party.owner;
+  }
+
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
     this.partySub.unsubscribe();
-- 
2.7.4


From 82db3a217cff043792050c8fad314af2a4219154 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:43:20 +0300
Subject: [PATCH 145/292] Step 16.4: Add disabled attribute bindings

---
 client/imports/app/parties/party-details.component.html | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index a3e173d..a00a045 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -1,14 +1,14 @@
 <form *ngIf="party" (submit)="saveParty()">
   <label>Name</label>
-  <input type="text" [(ngModel)]="party.name" name="name">
+  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name">
 
   <label>Description</label>
-  <input type="text" [(ngModel)]="party.description" name="description">
+  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description">
 
   <label>Location</label>
-  <input type="text" [(ngModel)]="party.location" name="location">
+  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location" name="location">
 
-  <button type="submit">Save</button>
+  <button [disabled]="!isOwner" type="submit">Save</button>
   <a [routerLink]="['/']">Cancel</a>
 </form>
 
-- 
2.7.4


From bcbf0fb960baa9797239762726dae1dd52fa541f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:44:34 +0300
Subject: [PATCH 146/292] Step 16.5: Add isPublic and isInvited properties

---
 client/imports/app/parties/party-details.component.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index 7562d03..a674bb7 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -106,6 +106,20 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
     return this.party && this.user && this.user._id === this.party.owner;
   }
 
+  get isPublic(): boolean {
+    return this.party && this.party.public;
+  }
+
+  get isInvited(): boolean {
+    if (this.party && this.user) {
+      const invited = this.party.invited || [];
+
+      return invited.indexOf(this.user._id) !== -1;
+    }
+
+    return false;
+  }
+
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
     this.partySub.unsubscribe();
-- 
2.7.4


From 918c70f57a173335f7ef3a159aa63b55a93e0d82 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:46:12 +0300
Subject: [PATCH 147/292] Step 16.6: Make use of properties in the template

---
 .../imports/app/parties/party-details.component.html   | 18 ++++++++++--------
 1 file changed, 10 insertions(+), 8 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index a00a045..7abe835 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -12,15 +12,17 @@
   <a [routerLink]="['/']">Cancel</a>
 </form>
 
-<p>Users to invite:</p>
-<ul>
-  <li *ngFor="let user of users | async">
-    <div>{{user | displayName}}</div>
-    <button (click)="invite(user)">Invite</button>
-  </li>
-</ul>
+<div *ngIf="isOwner || isPublic">
+  <p>Users to invite:</p>
+  <ul>
+    <li *ngFor="let user of users | async">
+      <div>{{user | displayName}}</div>
+      <button (click)="invite(user)">Invite</button>
+    </li>
+  </ul>
+</div>
 
-<div>
+<div *ngIf="isInvited">
   <h2>Reply to the invitation</h2>
   <input type="button" value="I'm going!" (click)="reply('yes')">
   <input type="button" value="Maybe" (click)="reply('maybe')">
-- 
2.7.4


From 444214cbfc9f08002bbed323cb477ccda1645942 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 15:30:12 -0200
Subject: [PATCH 148/292] Step 16: Conditional template directives with
 AngularJS

---
 steps/step16.md | 314 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 314 insertions(+)
 create mode 100644 steps/step16.md

diff --git a/steps/step16.md b/steps/step16.md
new file mode 100644
index 0000000..07fdf24
--- /dev/null
+++ b/steps/step16.md
@@ -0,0 +1,314 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Conditional template directives with AngularJS
+
+In this step we are going to show or hide
+different parts of the app's UI depending the user's current state: either logged-in or anonymous.
+
+# Attribute Binding
+
+As you may know, Angular 1 has [ng-show](https://docs.angularjs.org/api/ng/directive/ngShow) and [ng-hide](https://docs.angularjs.org/api/ng/directive/ngHide)
+attribute directives for controlling the visibility of content.
+We'll look at how visibility is handled differently in Angular 2.
+
+Angular 2 binds an attribute to an element's property.
+As you already know, one can directly bind to the component attribute directives, for example:
+
+    <my-component [foo]="fooValue" />
+
+The Angular 2 team went further and implemented the same direct binding support for the
+DOM element attributes, including additional attributes like _hidden_ and _disabled_, and which seems logical.
+
+### [hidden]
+
+The `hidden` attribute arrived in the DOM with HTML 5.
+It's essentially similar to the old and well-known `disabled` attribute, but only
+makes an element hidden. With the presence of the `hidden` attribute and direct attribute
+binding, it seems there is no further need for attribute directives like `ng-hide`.
+There is one exception, though.
+
+> The DOM property `hidden` is rather new, and not supported by older versions of Internet Explorer (less than 11).
+> If you need to support older browsers, you must implement a new directive attribute similar to the `ng-hide`
+> yourself or make use of an already existing directive. There are sure to be solutions in the future.
+
+A user who hasn't logged-in does not have all the same permissions; we can hide functionality that anonymous users cannot access such as the "add party" form and the "remove" button for each party in the parties list.
+
+Let's toggle on and off these components with the help of the `hidden` attribute, but first let's inject
+the user property into the PartiesList component, since this is what our attribute
+binding will depend on. User injection was already mentioned in step 8,
+so let's make practical use of it now:
+
+[{]: <helper> (diff_step 16.1)
+#### Step 16.1: Inject Meteor User and add isOwner method
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -5,6 +5,7 @@
+ ┊ 5┊ 5┊import { MeteorObservable } from 'meteor-rxjs';
+ ┊ 6┊ 6┊import { PaginationService } from 'ng2-pagination';
+ ┊ 7┊ 7┊import { Counts } from 'meteor/tmeasday:publish-counts';
++┊  ┊ 8┊import { InjectUser } from "angular2-meteor-accounts-ui";
+ ┊ 8┊ 9┊
+ ┊ 9┊10┊import 'rxjs/add/operator/combineLatest';
+ ┊10┊11┊
+```
+```diff
+@@ -26,6 +27,7 @@
+ ┊26┊27┊  selector: 'parties-list',
+ ┊27┊28┊  template
+ ┊28┊29┊})
++┊  ┊30┊@InjectUser('user')
+ ┊29┊31┊export class PartiesListComponent implements OnInit, OnDestroy {
+ ┊30┊32┊  parties: Observable<Party[]>;
+ ┊31┊33┊  partiesSub: Subscription;
+```
+```diff
+@@ -36,6 +38,7 @@
+ ┊36┊38┊  partiesSize: number = 0;
+ ┊37┊39┊  autorunSub: Subscription;
+ ┊38┊40┊  location: Subject<string> = new Subject<string>();
++┊  ┊41┊  user: Meteor.User;
+ ┊39┊42┊
+ ┊40┊43┊  constructor(
+ ┊41┊44┊    private paginationService: PaginationService
+```
+```diff
+@@ -104,6 +107,10 @@
+ ┊104┊107┊    this.nameOrder.next(parseInt(nameOrder));
+ ┊105┊108┊  }
+ ┊106┊109┊
++┊   ┊110┊  isOwner(party: Party): boolean {
++┊   ┊111┊    return this.user && this.user._id === party.owner;
++┊   ┊112┊  }
++┊   ┊113┊
+ ┊107┊114┊  ngOnDestroy() {
+ ┊108┊115┊    this.partiesSub.unsubscribe();
+ ┊109┊116┊    this.optionsSub.unsubscribe();
+```
+[}]: #
+
+As you can see, we've added a new `isOwner` method to the component,
+thus, we allow only a party owner to remove the party.
+
+Then, change the template to use the `hidden` attribute:
+
+[{]: <helper> (diff_step 16.2)
+#### Step 16.2: Use the hidden attribute in the PartiestList
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -1,5 +1,5 @@
+ ┊1┊1┊<div>
+-┊2┊ ┊  <parties-form style="float: left"></parties-form>
++┊ ┊2┊  <parties-form [hidden]="!user" style="float: left"></parties-form>
+ ┊3┊3┊  <input type="text" #searchtext placeholder="Search by Location">
+ ┊4┊4┊  <button type="button" (click)="search(searchtext.value)">Search</button>
+ ┊5┊5┊  
+```
+```diff
+@@ -19,7 +19,7 @@
+ ┊19┊19┊      <a [routerLink]="['/party', party._id]">undefined</a>
+ ┊20┊20┊      <p>undefined</p>
+ ┊21┊21┊      <p>undefined</p>
+-┊22┊  ┊      <button (click)="removeParty(party)">X</button>
++┊  ┊22┊      <button [hidden]="!isOwner(party)" (click)="removeParty(party)">X</button>
+ ┊23┊23┊      <div>
+ ┊24┊24┊        Who is coming:
+ ┊25┊25┊        Yes - undefined
+```
+[}]: #
+
+Now run the app. Make sure you have added _barbatus:ng2-meteor-accounts_ for it to work.
+
+The "add party" form and "remove" buttons should disappear if you are not logged-in. Try to log in: everything should be visible again.
+
+> Note: CSS's `display` property has priority over the `hidden` property.
+> If one of the CSS classes of any element has this property set,
+> `hidden` gets over-ruled. In this case, you'll have to wrap the element into
+> a container element such as a `<div>` and assign CSS classes with the "display" on that parent container.
+
+### [disabled]
+
+Next let's add the `disabled` attribute to the PartyDetails component.
+Currently, all users have access to the party details page and can
+change the values of the inputs, though they are still prohibited from saving anything
+(remember the parties security added in step 8?).
+Let's disable these inputs for users that are not owners.
+
+We will get an `isOwner` property when the party owner matches the logged-in user id:
+
+[{]: <helper> (diff_step 16.3)
+#### Step 16.3: Add isOwner property
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -4,6 +4,7 @@
+ ┊ 4┊ 4┊import { Subscription } from 'rxjs/Subscription';
+ ┊ 5┊ 5┊import { Meteor } from 'meteor/meteor';
+ ┊ 6┊ 6┊import { MeteorObservable } from 'meteor-rxjs';
++┊  ┊ 7┊import { InjectUser } from "angular2-meteor-accounts-ui";
+ ┊ 7┊ 8┊
+ ┊ 8┊ 9┊import 'rxjs/add/operator/map';
+ ┊ 9┊10┊
+```
+```diff
+@@ -18,6 +19,7 @@
+ ┊18┊19┊  selector: 'party-details',
+ ┊19┊20┊  template
+ ┊20┊21┊})
++┊  ┊22┊@InjectUser('user')
+ ┊21┊23┊export class PartyDetailsComponent implements OnInit, OnDestroy {
+ ┊22┊24┊  partyId: string;
+ ┊23┊25┊  paramsSub: Subscription;
+```
+```diff
+@@ -25,6 +27,7 @@
+ ┊25┊27┊  partySub: Subscription;
+ ┊26┊28┊  users: Observable<User>;
+ ┊27┊29┊  uninvitedSub: Subscription;
++┊  ┊30┊  user: Meteor.User;
+ ┊28┊31┊
+ ┊29┊32┊  constructor(
+ ┊30┊33┊    private route: ActivatedRoute
+```
+```diff
+@@ -99,6 +102,10 @@
+ ┊ 99┊102┊    });
+ ┊100┊103┊  }
+ ┊101┊104┊
++┊   ┊105┊  get isOwner(): boolean {
++┊   ┊106┊    return this.party && this.user && this.user._id === this.party.owner;
++┊   ┊107┊  }
++┊   ┊108┊
+ ┊102┊109┊  ngOnDestroy() {
+ ┊103┊110┊    this.paramsSub.unsubscribe();
+ ┊104┊111┊    this.partySub.unsubscribe();
+```
+[}]: #
+
+`isOwner` can be used before the subscription has finished, so we must check if the `party` property is available before checking if the party owner matches.
+
+Then, let's add our new `[disabled]` condition to the party details template:
+
+[{]: <helper> (diff_step 16.4)
+#### Step 16.4: Add disabled attribute bindings
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -1,14 +1,14 @@
+ ┊ 1┊ 1┊<form *ngIf="party" (submit)="saveParty()">
+ ┊ 2┊ 2┊  <label>Name</label>
+-┊ 3┊  ┊  <input type="text" [(ngModel)]="party.name" name="name">
++┊  ┊ 3┊  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name">
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊  <label>Description</label>
+-┊ 6┊  ┊  <input type="text" [(ngModel)]="party.description" name="description">
++┊  ┊ 6┊  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description">
+ ┊ 7┊ 7┊
+ ┊ 8┊ 8┊  <label>Location</label>
+-┊ 9┊  ┊  <input type="text" [(ngModel)]="party.location" name="location">
++┊  ┊ 9┊  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location" name="location">
+ ┊10┊10┊
+-┊11┊  ┊  <button type="submit">Save</button>
++┊  ┊11┊  <button [disabled]="!isOwner" type="submit">Save</button>
+ ┊12┊12┊  <a [routerLink]="['/']">Cancel</a>
+ ┊13┊13┊</form>
+```
+[}]: #
+
+# Using `ngIf`
+
+It's important to know the difference between the `hidden` attribute and `ngIf` directive.
+While `hidden` shows and hides a DOM element that is already rendered,
+`ngIf` adds or removes an element from the DOM, making it both heavier and slower.
+It makes sense to use `ngIf` if the decision to show or hide some part of the UI is made during page loading.
+
+Regarding our party details page, we'll show or hide with the help of `ngIf`.
+We'll show or hide the invitation response buttons to those who are already invited,
+and the invitation list to the party owners and to everybody if the party is public.
+
+We've already added our `isOwner` variable. Let's add two more: `isPublic` and `isInvited`.
+
+[{]: <helper> (diff_step 16.5)
+#### Step 16.5: Add isPublic and isInvited properties
+
+##### Changed client/imports/app/parties/party-details.component.ts
+```diff
+@@ -106,6 +106,20 @@
+ ┊106┊106┊    return this.party && this.user && this.user._id === this.party.owner;
+ ┊107┊107┊  }
+ ┊108┊108┊
++┊   ┊109┊  get isPublic(): boolean {
++┊   ┊110┊    return this.party && this.party.public;
++┊   ┊111┊  }
++┊   ┊112┊
++┊   ┊113┊  get isInvited(): boolean {
++┊   ┊114┊    if (this.party && this.user) {
++┊   ┊115┊      const invited = this.party.invited || [];
++┊   ┊116┊
++┊   ┊117┊      return invited.indexOf(this.user._id) !== -1;
++┊   ┊118┊    }
++┊   ┊119┊
++┊   ┊120┊    return false;
++┊   ┊121┊  }
++┊   ┊122┊
+ ┊109┊123┊  ngOnDestroy() {
+ ┊110┊124┊    this.paramsSub.unsubscribe();
+ ┊111┊125┊    this.partySub.unsubscribe();
+```
+[}]: #
+
+Then, make use of the properties in the template:
+
+[{]: <helper> (diff_step 16.6)
+#### Step 16.6: Make use of properties in the template
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -12,15 +12,17 @@
+ ┊12┊12┊  <a [routerLink]="['/']">Cancel</a>
+ ┊13┊13┊</form>
+ ┊14┊14┊
+-┊15┊  ┊<p>Users to invite:</p>
+-┊16┊  ┊<ul>
+-┊17┊  ┊  <li *ngFor="let user of users | async">
+-┊18┊  ┊    <div>undefined</div>
+-┊19┊  ┊    <button (click)="invite(user)">Invite</button>
+-┊20┊  ┊  </li>
+-┊21┊  ┊</ul>
++┊  ┊15┊<div *ngIf="isOwner || isPublic">
++┊  ┊16┊  <p>Users to invite:</p>
++┊  ┊17┊  <ul>
++┊  ┊18┊    <li *ngFor="let user of users | async">
++┊  ┊19┊      <div>undefined</div>
++┊  ┊20┊      <button (click)="invite(user)">Invite</button>
++┊  ┊21┊    </li>
++┊  ┊22┊  </ul>
++┊  ┊23┊</div>
+ ┊22┊24┊
+-┊23┊  ┊<div>
++┊  ┊25┊<div *ngIf="isInvited">
+ ┊24┊26┊  <h2>Reply to the invitation</h2>
+ ┊25┊27┊  <input type="button" value="I'm going!" (click)="reply('yes')">
+ ┊26┊28┊  <input type="button" value="Maybe" (click)="reply('maybe')">
+```
+[}]: #
+
+# Summary
+
+In this step we've become familiar with the binding to the DOM attributes in Angular 2 and
+used two of the attributes to make our app better: `hidden` and `disabled`.
+
+The difference between `ngIf` and `hidden` was highlighted, and based on that, `ngIf`
+was used to make the party details page securer and visually better.
+
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step15.md) | [Next Step >](step17.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 6f2eb83e148c8645d5209516dc8696c0caff2e73 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:48:18 +0300
Subject: [PATCH 149/292] Step 17.1: Extend party location with coords

---
 both/models/party.model.ts | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
index 9f7c41e..5e62f1b 100644
--- a/both/models/party.model.ts
+++ b/both/models/party.model.ts
@@ -3,7 +3,7 @@ import { CollectionObject } from './collection-object.model';
 export interface Party extends CollectionObject {
   name: string;
   description: string;
-  location: string;
+  location: Location;
   owner?: string;
   public: boolean;
   invited?: string[];
@@ -13,4 +13,10 @@ export interface Party extends CollectionObject {
 interface RSVP {
   userId: string;
   response: string;
+}
+
+interface Location {
+  name: string;
+  lat?: number;
+  lng?: number;
 }
\ No newline at end of file
-- 
2.7.4


From 47454d6cb8f70f3e1254832f29ef8bb826c82921 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:49:10 +0300
Subject: [PATCH 150/292] Step 17.2: Change initial parties accordingly

---
 server/imports/fixtures/parties.ts | 12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)

diff --git a/server/imports/fixtures/parties.ts b/server/imports/fixtures/parties.ts
index e49a665..10168af 100644
--- a/server/imports/fixtures/parties.ts
+++ b/server/imports/fixtures/parties.ts
@@ -6,17 +6,23 @@ export function loadParties() {
     const parties: Party[] = [{
       name: 'Dubstep-Free Zone',
       description: 'Can we please just for an evening not listen to dubstep.',
-      location: 'Palo Alto',
+      location: {
+        name: 'Palo Alto'
+      },
       public: true
     }, {
       name: 'All dubstep all the time',
       description: 'Get it on!',
-      location: 'Palo Alto',
+      location: {
+        name: 'Palo Alto'
+      },
       public: true
     }, {
       name: 'Savage lounging',
       description: 'Leisure suit required. And only fiercest manners.',
-      location: 'San Francisco',
+      location: {
+        name: 'San Francisco'
+      },
       public: true
     }];
 
-- 
2.7.4


From ba0c46db19481ade67f67162b21fbacd099a68ed Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:50:53 +0300
Subject: [PATCH 151/292] Step 17.3: Change party creation component

---
 client/imports/app/parties/parties-form.component.ts | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index 0823749..3a213f0 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -33,7 +33,15 @@ export class PartiesFormComponent implements OnInit {
     }
 
     if (this.addForm.valid) {
-      Parties.insert(Object.assign({}, this.addForm.value, { owner: Meteor.userId() }));
+      Parties.insert({
+        name: this.addForm.value.name,
+        description: this.addForm.value.description,
+        location: {
+          name: this.addForm.value.location
+        },
+        public: this.addForm.value.public,
+        owner: Meteor.userId()
+      });
 
       this.addForm.reset();
     }
-- 
2.7.4


From 1bdcf1523e6bf2d89b446453b98868cbf0adefbe Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:51:39 +0300
Subject: [PATCH 152/292] Step 17.4: Reflect type changes in the parties search

---
 server/imports/publications/parties.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/server/imports/publications/parties.ts b/server/imports/publications/parties.ts
index 4742280..d1c8e00 100644
--- a/server/imports/publications/parties.ts
+++ b/server/imports/publications/parties.ts
@@ -60,7 +60,7 @@ function buildQuery(partyId?: string, location?: string): Object {
 
   return {
     $and: [{
-        location: searchRegEx
+        'location.name': searchRegEx
       },
       isAvailable
     ]
-- 
2.7.4


From 4133b9fbbc4765f1dafa61de64ac487894542f82 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:53:13 +0300
Subject: [PATCH 153/292] Step 17.5: Install angular2-google-maps

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index 6b995da..4d4b2a9 100644
--- a/package.json
+++ b/package.json
@@ -22,6 +22,7 @@
     "@angular/platform-browser": "2.0.1",
     "@angular/platform-browser-dynamic": "2.0.1",
     "@angular/router": "3.0.1",
+    "angular2-google-maps": "0.15.0",
     "angular2-meteor": "0.7.0",
     "angular2-meteor-accounts-ui": "0.8.0",
     "angular2-meteor-polyfills": "^0.1.1",
-- 
2.7.4


From dd5c8e01edbfbb1c9a80674f789f8ccbce421c93 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:55:17 +0300
Subject: [PATCH 154/292] Step 17.6: Import google maps module

---
 client/imports/app/app.module.ts | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 383ed58..0240ddf 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -4,6 +4,7 @@ import { FormsModule, ReactiveFormsModule } from '@angular/forms';
 import { RouterModule } from '@angular/router';
 import { AccountsModule } from 'angular2-meteor-accounts-ui';
 import { Ng2PaginationModule } from 'ng2-pagination';
+import { AgmCoreModule } from 'angular2-google-maps/core';
 
 import { AppComponent } from './app.component';
 import { routes, ROUTES_PROVIDERS } from './app.routes';
@@ -17,7 +18,10 @@ import { SHARED_DECLARATIONS } from './shared';
     ReactiveFormsModule,
     RouterModule.forRoot(routes),
     AccountsModule,
-    Ng2PaginationModule
+    Ng2PaginationModule,
+    AgmCoreModule.forRoot({
+      apiKey: 'AIzaSyAWoBdZHCNh5R-hB5S5ZZ2oeoYyfdDgniA'
+    })
   ],
   declarations: [
     AppComponent,
-- 
2.7.4


From 59aef275de940bd1718c258de041ff670ee1f0f0 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 11:55:43 +0300
Subject: [PATCH 155/292] Step 17.7: Change ngModel to location.name

---
 client/imports/app/parties/party-details.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index 7abe835..26f21ca 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -6,7 +6,7 @@
   <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description">
 
   <label>Location</label>
-  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location" name="location">
+  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location.name" name="location">
 
   <button [disabled]="!isOwner" type="submit">Save</button>
   <a [routerLink]="['/']">Cancel</a>
-- 
2.7.4


From b4d107a1009098806fc524c2e2041ffd4761c7bf Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:19:47 +0300
Subject: [PATCH 156/292] Step 17.8: Use in a template

---
 client/imports/app/parties/party-details.component.html | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index 26f21ca..151fb03 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -28,3 +28,15 @@
   <input type="button" value="Maybe" (click)="reply('maybe')">
   <input type="button" value="No" (click)="reply('no')">
 </div>
+
+<sebm-google-map
+  [latitude]="lat || centerLat"
+  [longitude]="lng || centerLng"
+  [zoom]="8"
+  (mapClick)="mapClicked($event)">
+  <sebm-google-map-marker
+    *ngIf="lat && lng"
+    [latitude]="lat"
+    [longitude]="lng">
+  </sebm-google-map-marker>
+</sebm-google-map>
\ No newline at end of file
-- 
2.7.4


From cc74c24d3c7eee03f4b7bd48f97dd31c23b3e664 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:19:54 +0300
Subject: [PATCH 157/292] Step 17.9: Add maps logic to the component

---
 client/imports/app/parties/party-details.component.ts | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/client/imports/app/parties/party-details.component.ts b/client/imports/app/parties/party-details.component.ts
index a674bb7..4609f47 100644
--- a/client/imports/app/parties/party-details.component.ts
+++ b/client/imports/app/parties/party-details.component.ts
@@ -5,6 +5,7 @@ import { Subscription } from 'rxjs/Subscription';
 import { Meteor } from 'meteor/meteor';
 import { MeteorObservable } from 'meteor-rxjs';
 import { InjectUser } from "angular2-meteor-accounts-ui";
+import { MouseEvent } from "angular2-google-maps/core";
 
 import 'rxjs/add/operator/map';
 
@@ -28,6 +29,9 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
   users: Observable<User>;
   uninvitedSub: Subscription;
   user: Meteor.User;
+  // Default center Palo Alto coordinates.
+  centerLat: number = 37.4292;
+  centerLng: number = -122.1381;
 
   constructor(
     private route: ActivatedRoute
@@ -120,6 +124,20 @@ export class PartyDetailsComponent implements OnInit, OnDestroy {
     return false;
   }
 
+
+  get lat(): number {
+    return this.party && this.party.location.lat;
+  }
+
+  get lng(): number {
+    return this.party && this.party.location.lng;
+  }
+
+  mapClicked($event: MouseEvent) {
+    this.party.location.lat = $event.coords.lat;
+    this.party.location.lng = $event.coords.lng;
+  }
+
   ngOnDestroy() {
     this.paramsSub.unsubscribe();
     this.partySub.unsubscribe();
-- 
2.7.4


From 5b7690f23a0a395ee13d68d031e686ae1b7e654f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:22:56 +0300
Subject: [PATCH 158/292] Step 17.10: Add maps styles

---
 client/main.scss | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/client/main.scss b/client/main.scss
index ac0e5ee..b32e376 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -1 +1,6 @@
-@import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
\ No newline at end of file
+@import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
+
+.sebm-google-map-container {
+  width: 400px;
+  height: 400px;
+}
\ No newline at end of file
-- 
2.7.4


From 75212620017701ff5395f3818d0409327472ecf0 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:25:46 +0300
Subject: [PATCH 159/292] Step 17.11: Add all parties locations on the map

---
 client/imports/app/parties/parties-list.component.html | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index a94ea42..043f2ff 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -18,7 +18,7 @@
     <li *ngFor="let party of parties | async">
       <a [routerLink]="['/party', party._id]">{{party.name}}</a>
       <p>{{party.description}}</p>
-      <p>{{party.location}}</p>
+      <p>{{party.location.name}}</p>
       <button [hidden]="!isOwner(party)" (click)="removeParty(party)">X</button>
       <div>
         Who is coming:
@@ -29,5 +29,18 @@
     </li>
   </ul>
 
+  <sebm-google-map
+    [latitude]="0"
+    [longitude]="0"
+    [zoom]="1">
+    <div *ngFor="let party of parties | async">
+      <sebm-google-map-marker
+        *ngIf="party.location.lat"
+        [latitude]="party.location.lat"
+        [longitude]="party.location.lng">
+      </sebm-google-map-marker>
+    </div>
+  </sebm-google-map>
+
   <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
 </div>
\ No newline at end of file
-- 
2.7.4


From 654fb847f954bdf6bcf60196ca2a095f4c7aedd6 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 15:42:53 -0200
Subject: [PATCH 160/292] Step 17: Google Maps

---
 steps/step17.md | 139 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 139 insertions(+)
 create mode 100644 steps/step17.md

diff --git a/steps/step17.md b/steps/step17.md
new file mode 100644
index 0000000..9c43b83
--- /dev/null
+++ b/steps/step17.md
@@ -0,0 +1,139 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Google Maps
+
+As you see, our app looks far from fancy using only
+pure HTML templates. It urgently needs graphical design improvements
+to be usable. We are going to fix this issue in the next three steps starting
+from the current. Ultimately, we'll try out two graphical design front-end libraries: Twitter's Bootstrap and Google's Material Design,
+which are among most popular design libraries and has multiple open-source implementations on the market.
+
+But first up, we'll add one more visual feature to the Socially: maps.
+This will be quite beneficial, taking into account specifics of our app:
+parties need precise locations to avoid confusions.
+We are going to imploy this package of Google Maps components for Angular 2.
+
+# Adding Location Coordinates
+
+Having maps on board, we can make use of latitute and
+longitute coordinates, which are most precise location information possible.
+And of course, we'll show everything on the map to make this information
+comprehensive for users.
+
+There are two pages in the app which will be changed: main page to
+show all parties' locations on the map and party details page to show and
+change a particular party's location on the map. If it's done nicely,
+it will certantly look terrific and attract more users to the app.
+
+Before we start with the maps directly, we need to make some preparations.
+First up, we need to extend `Party`'s with two more properties: "lat" and "lng",
+which are the above mentioned latitude and longitude.
+Since we have the location name and would like not to remove it since it still might be useful,
+let's consider converting "location" property to an object with three properties: "name", "lat", and "lng".
+It will require, though, some changes in other parts of the app, where `Party` type is used.
+
+Let's add those changes consequently, starting from `Party` type itself:
+
+undefined
+
+Then, change the parties, that are created and added on the server initially, accordingly:
+
+undefined
+
+The PartiesForm component needs to be changed too to reflect type changes:
+
+undefined
+
+Lastly, we are updating the parties publications. It's interesting to
+see what a small change is required to update the parties search by location: it needs only to point out that "location" property has been moved to "location.name", thanks to Mongo's flexible API:
+
+undefined
+
+And also let's update it in the view:
+
+undefined
+
+Now when we are done with updates, let's reset the database in case it has
+parties of the old type (remember how to do it? Execute `meteor reset`). Then, run the app to make sure that everything is alright and
+works as before.
+
+# Adding Google Maps
+
+Now is the time to upgrade above mentioned components to feature Google Maps.
+Let's add a Meteor package that wraps around that Google Maps NPM package:
+
+    $ meteor npm install angular2-google-maps --save
+
+And just like any other external package, we need to import the module into our `NgModule`:
+
+undefined
+
+The maps package contains two major directives: one is to render a HTML container with Google Maps,
+another one is to visualize a map marker. Let's add a maps markup to the PartyDetails component's template:
+
+undefined
+
+It needs some explanation. Our markup now contains these two directives.
+As you can see, parent map container directive has a party marker directive as a child element, so that it can be
+parsed and rendered on the map. We are setting "latitude" and "longitude" on the map directive, which will fixate the map at a particular location on the page load.
+
+You may notice as well, four new properties were added:
+"lat", "lng", "centerLat", and "centerLng". "lat" and "lng" are wrappers over a party's coordinates, while "centerLat" and "centerLng" are default center coordinates.
+In addition, location property binding has been corrected to reflect new type changes.
+
+Here come changes to the component itself, including imports, new coordinates properties, and maps click event handler:
+
+undefined
+
+It's going to work in a scenario as follows:
+
+  - when the user visit a newly created party,
+    she will see a map centered at Palo Alto;
+  - if she clicks on some part of the map, a new marker
+    will be placed at that place;
+  - if she decides to save the party changes, new location coordinates will
+    be saved as well;
+  - on the next visit, the map will be centered at the saved party location
+    with a marker shown at this point.
+
+That's almost it with the party details. So far, so good and simple.
+
+The last change will be about CSS styles. To show the map container of a specific size,
+we'll have to set element styles. Since we'll need styles for that for two pages, let's create
+a separate CSS file for the whole app, which is, anyways, will be useful on the next steps:
+
+undefined
+
+As usual, having introduced new feature, we are finishing it up with testing.
+Let's create a new party with the location name set to some existing place you know, and go to the details page. Click on the maps at the
+location that corresponds to the party's location name: a new marker should appear there.
+Now, click "Save" button and re-load the page: it should be loaded with the map and a marker on it at
+the point you've just pointed out.
+
+# Multiple Markers
+
+Adding multiple markers on the parties front page should be straightforward now.
+Here is the markup:
+
+undefined
+
+As you can see, we are looping through the all parties and adding a new marker for each party,
+having checked if the current party has location coordinates available.
+We are also setting the minimum zoom and zero central coordinates on the map to set whole Earth view point initially.
+
+# Summary
+
+It turned to be quite easy to add location coordinates to the parties and make
+changes to the UI, which included Google Maps and location markers on them.
+
+Now we are all set to proceed to more radical visual design changes.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step16.md) | [Next Step >](step18.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 209741aa94de7a4d74a88f54b59eb047531384a8 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:43:17 +0300
Subject: [PATCH 161/292] Step 18.1: Install Bootstrap 4

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index 4d4b2a9..d85d95f 100644
--- a/package.json
+++ b/package.json
@@ -27,6 +27,7 @@
     "angular2-meteor-accounts-ui": "0.8.0",
     "angular2-meteor-polyfills": "^0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
+    "bootstrap": "^4.0.0-alpha.4",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
     "ng2-pagination": "0.4.1",
-- 
2.7.4


From f0715f8b17c6a8d9bfb850ca1cd8d778044c8d58 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:44:18 +0300
Subject: [PATCH 162/292] Step 18.2: Import bootstrap style into the main style
 file

---
 client/main.scss | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/main.scss b/client/main.scss
index b32e376..5c3a0d0 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -1,4 +1,6 @@
 @import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
+@import "{}/node_modules/bootstrap/scss/bootstrap.scss";
+
 
 .sebm-google-map-container {
   width: 400px;
-- 
2.7.4


From 700b64c415416990007f4bd8fb4a3ceeb9e318de Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:44:23 +0300
Subject: [PATCH 163/292] Step 18.3: Add bootstrap navbar

---
 client/imports/app/app.component.html | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index b426778..b3c49f0 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,3 +1,6 @@
-<div>
+<nav class="navbar navbar-light bg-faded">
+  <a class="navbar-brand" href="#">Socially</a>
+</nav>
+<div class="container-fluid">
   <router-outlet></router-outlet>
 </div>
\ No newline at end of file
-- 
2.7.4


From 865ca3fac27ede2ebff84dacaefa32b9c2d85128 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:49:04 +0300
Subject: [PATCH 164/292] Step 18.4: Remove LoginButtons from a template

---
 client/imports/app/parties/parties-list.component.html | 2 --
 1 file changed, 2 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 043f2ff..96fd80f 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -2,8 +2,6 @@
   <parties-form [hidden]="!user" style="float: left"></parties-form>
   <input type="text" #searchtext placeholder="Search by Location">
   <button type="button" (click)="search(searchtext.value)">Search</button>
-  
-  <login-buttons></login-buttons>
 
   <h1>Parties:</h1>
 
-- 
2.7.4


From e2e89c2a2ff38c96be523671936eaf774b9b3315 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:49:33 +0300
Subject: [PATCH 165/292] Step 18.5: Add login buttons to the navigation bar

---
 client/imports/app/app.component.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index b3c49f0..dffc2ea 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,5 +1,6 @@
 <nav class="navbar navbar-light bg-faded">
   <a class="navbar-brand" href="#">Socially</a>
+  <login-buttons class="pull-right"></login-buttons>
 </nav>
 <div class="container-fluid">
   <router-outlet></router-outlet>
-- 
2.7.4


From 6c0227dc5e1afbe00ef37331f0b40c45713d0552 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:50:05 +0300
Subject: [PATCH 166/292] Step 18.6: Add fonts and FontAwesome

---
 client/index.html | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/client/index.html b/client/index.html
index 4e8596c..264730d 100644
--- a/client/index.html
+++ b/client/index.html
@@ -1,5 +1,8 @@
 <head>
+  <meta name="viewport" content="width=device-width, initial-scale=1">
   <base href="/">
+  <link href='http://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
+  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
 </head>
 <body>
   <app>Loading...</app>
-- 
2.7.4


From 820d5b57a057d36ccd5e1126a9a0b85f80b6886e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:53:42 +0300
Subject: [PATCH 167/292] Step 18.7: Update the new party form

---
 .../app/parties/parties-form.component.html        | 30 +++++++++++++---------
 1 file changed, 18 insertions(+), 12 deletions(-)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index 3cc8990..c791629 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -1,15 +1,21 @@
-<form [formGroup]="addForm" (ngSubmit)="addParty()">
-  <label>Name</label>
-  <input type="text" formControlName="name">
+<form [formGroup]="addForm" (ngSubmit)="addParty()" class="form-inline">
+  <fieldset class="form-group">
+    <label for="partyName">Party name</label>
+    <input id="partyName" class="form-control" type="text" formControlName="name" placeholder="Party name" />
 
-  <label>Description</label>
-  <input type="text" formControlName="description">
+    <label for="description">Description</label>
+    <input id="description" class="form-control" type="text" formControlName="description" placeholder="Description">
 
-  <label>Location</label>
-  <input type="text" formControlName="location">
+    <label for="location_name">Location</label>
+    <input id="location_name" class="form-control" type="text" formControlName="location" placeholder="Location name">
 
-  <label>Public</label>
-  <input type="checkbox" formControlName="public">
-  
-  <button type="submit">Add</button>
-</form>
\ No newline at end of file
+    <div class="checkbox">
+      <label>
+        <input type="checkbox" formControlName="public">
+        Public
+      </label>
+    </div>
+
+    <button type="submit" class="btn btn-primary">Add</button>
+  </fieldset>
+</form>
-- 
2.7.4


From 3bc6bc5b12fb835a7580674640fbd9796766096b Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:55:08 +0300
Subject: [PATCH 168/292] Step 18.8: Update parties list layout

---
 .../app/parties/parties-list.component.html        | 134 +++++++++++++++------
 1 file changed, 95 insertions(+), 39 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 96fd80f..0629b28 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -1,44 +1,100 @@
-<div>
-  <parties-form [hidden]="!user" style="float: left"></parties-form>
-  <input type="text" #searchtext placeholder="Search by Location">
-  <button type="button" (click)="search(searchtext.value)">Search</button>
-
-  <h1>Parties:</h1>
-
-  <div>
-    <select #sort (change)="changeSortOrder(sort.value)">
+<div class="row">
+  <div class="col-md-12">
+    <div class="jumbotron">
+      <h3>Create a new party!</h3>
+      <parties-form [hidden]="!user"></parties-form>
+      <div [hidden]="user">You need to login to create new parties!</div>
+    </div>
+  </div>
+</div>
+<div class="row ma-filters">
+  <div class="col-md-6">
+    <h3>All Parties:</h3>
+    <form class="form-inline">
+      <input type="text" class="form-control" #searchtext placeholder="Search by Location">
+      <button type="button" class="btn btn-primary" (click)="search(searchtext.value)">Search</button>
+      Sort by name: <select class="form-control" #sort (change)="changeSortOrder(sort.value)">
       <option value="1" selected>Ascending</option>
       <option value="-1">Descending</option>
     </select>
+    </form>
+  </div>
+</div>
+<div class="row">
+  <div class="col-md-6">
+    <ul class="list-group">
+      <li class="list-group-item">
+        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
+      </li>
+      <li *ngFor="let party of parties | async"
+          class="list-group-item ma-party-item">
+        <div class="row">
+          <div class="col-sm-8">
+            <h2 class="ma-party-name">
+              <a [routerLink]="['/party', party._id]">{{party.name}}</a>
+            </h2>
+            @ {{party.location.name}}
+            <p class="ma-party-description">
+              {{party.description}}
+            </p>
+          </div>
+          <div class="col-sm-4">
+            <button class="btn btn-danger pull-right" [hidden]="!isOwner(party)" (click)="removeParty(party)"><i
+              class="fa fa-times"></i></button>
+          </div>
+        </div>
+        <div class="row ma-party-item-bottom">
+          <div class="col-sm-4">
+            <div class="ma-rsvp-sum">
+              <div class="ma-rsvp-amount">
+                <div class="ma-amount">
+                  {{party | rsvp:'yes'}}
+                </div>
+                <div class="ma-rsvp-title">
+                  YES
+                </div>
+              </div>
+              <div class="ma-rsvp-amount">
+                <div class="ma-amount">
+                  {{party | rsvp:'maybe'}}
+                </div>
+                <div class="ma-rsvp-title">
+                  MAYBE
+                </div>
+              </div>
+              <div class="ma-rsvp-amount">
+                <div class="ma-amount">
+                  {{party | rsvp:'no'}}
+                </div>
+                <div class="ma-rsvp-title">
+                  NO
+                </div>
+              </div>
+            </div>
+          </div>
+        </div>
+      </li>
+      <li class="list-group-item">
+        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
+      </li>
+    </ul>
+  </div>
+  <div class="col-md-6">
+    <ul class="list-group">
+      <li class="list-group-item">
+        <sebm-google-map
+          [latitude]="0"
+          [longitude]="0"
+          [zoom]="1">
+          <div *ngFor="let party of parties | async">
+            <sebm-google-map-marker
+              *ngIf="party.location.lat"
+              [latitude]="party.location.lat"
+              [longitude]="party.location.lng">
+            </sebm-google-map-marker>
+          </div>
+        </sebm-google-map>
+      </li>
+    </ul>
   </div>
-
-  <ul>
-    <li *ngFor="let party of parties | async">
-      <a [routerLink]="['/party', party._id]">{{party.name}}</a>
-      <p>{{party.description}}</p>
-      <p>{{party.location.name}}</p>
-      <button [hidden]="!isOwner(party)" (click)="removeParty(party)">X</button>
-      <div>
-        Who is coming:
-        Yes - {{party | rsvp:'yes'}}
-        Maybe - {{party | rsvp:'maybe'}}
-        No - {{party | rsvp:'no'}}
-      </div>
-    </li>
-  </ul>
-
-  <sebm-google-map
-    [latitude]="0"
-    [longitude]="0"
-    [zoom]="1">
-    <div *ngFor="let party of parties | async">
-      <sebm-google-map-marker
-        *ngIf="party.location.lat"
-        [latitude]="party.location.lat"
-        [longitude]="party.location.lng">
-      </sebm-google-map-marker>
-    </div>
-  </sebm-google-map>
-
-  <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
 </div>
\ No newline at end of file
-- 
2.7.4


From 8875ee868eadf9875530ffef95a58b2d86cda2de Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:56:18 +0300
Subject: [PATCH 169/292] Step 18.9: Add styles for PartiesList

---
 .../app/parties/parties-list.component.scss        | 125 +++++++++++++++++++++
 1 file changed, 125 insertions(+)
 create mode 100644 client/imports/app/parties/parties-list.component.scss

diff --git a/client/imports/app/parties/parties-list.component.scss b/client/imports/app/parties/parties-list.component.scss
new file mode 100644
index 0000000..2cd8d06
--- /dev/null
+++ b/client/imports/app/parties/parties-list.component.scss
@@ -0,0 +1,125 @@
+.ma-add-button-container {
+  button.btn {
+    background: $color3;
+    float: right;
+    margin-right: 5px;
+    outline: none;
+    i {
+      color: $color5;
+    }
+  }
+}
+
+.ma-parties-col {
+  padding-top: 20px;
+}
+
+.ma-filters {
+  margin-bottom: 10px;
+}
+
+.ma-party-item {
+  .ma-party-name {
+    margin-bottom: 20px;
+    a {
+      color: $color6;
+      text-decoration: none !important;
+      font-weight: 400;
+    }
+  }
+  .ma-party-description {
+    color: $color6;
+    font-weight: 300;
+    padding-left: 18px;
+    font-size: 14px;
+  }
+
+  .ma-remove {
+    color: lighten($color7, 20%);
+    position: absolute;
+    right: 20px;
+    top: 20px;
+    &:hover {
+      color: $color7;
+    }
+  }
+
+  .ma-party-item-bottom {
+    padding-top: 10px;
+    .ma-posted-by-col {
+      .ma-posted-by {
+        color: darken($color4, 30%);
+        font-size: 12px;
+      }
+      .ma-everyone-invited {
+        @media (max-width: 400px) {
+          display: block;
+          i {
+            margin-left: 0px !important;
+          }
+        }
+        font-size: 12px;
+        color: darken($color4, 10%);
+        i {
+          color: darken($color4, 10%);
+          margin-left: 5px;
+        }
+      }
+    }
+
+    .ma-rsvp-buttons {
+      input.btn {
+        color: darken($color3, 20%);
+        background: transparent !important;
+        outline: none;
+        padding-left: 0;
+        &:active {
+          box-shadow: none;
+        }
+        &:hover {
+          color: darken($color3, 30%);
+        }
+        &.btn-primary {
+          color: lighten($color3, 10%);
+          border: 0;
+          background: transparent !important;
+        }
+      }
+    }
+
+    .ma-rsvp-sum {
+      width: 160px;
+      @media (min-width: 400px) {
+        float: right;
+      }
+      @media (max-width: 400px) {
+        margin: 0 auto;
+      }
+    }
+    .ma-rsvp-amount {
+      display: inline-block;
+      text-align: center;
+      width: 50px;
+      .ma-amount {
+        font-weight: bold;
+        font-size: 20px;
+      }
+      .ma-rsvp-title {
+        font-size: 11px;
+        color: #aaa;
+        text-transform: uppercase;
+      }
+    }
+  }
+}
+
+.ma-angular-map-col {
+  .angular-google-map-container, .angular-google-map {
+    height: 100%;
+    width: 100%;
+  }
+}
+
+.search-form {
+  margin-bottom: 1em;
+}
\ No newline at end of file
-- 
2.7.4


From 2b1fe3331aa1880e21c6079065eb66399658c456 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:56:48 +0300
Subject: [PATCH 170/292] Step 18.10: Add styles for the party details page

---
 .../app/parties/party-details.component.scss       | 32 ++++++++++++++++++++++
 1 file changed, 32 insertions(+)
 create mode 100644 client/imports/app/parties/party-details.component.scss

diff --git a/client/imports/app/parties/party-details.component.scss b/client/imports/app/parties/party-details.component.scss
new file mode 100644
index 0000000..82dcfc3
--- /dev/null
+++ b/client/imports/app/parties/party-details.component.scss
@@ -0,0 +1,32 @@
+.ma-party-details-container {
+  padding: 20px;
+
+  .angular-google-map-container {
+    width: 100%;
+    height: 100%;
+  }
+
+  .angular-google-map {
+    width: 100%;
+    height: 400px;
+  }
+
+  .ma-map-title {
+    font-size: 16px;
+    font-weight: bolder;
+  }
+
+  .ma-invite-list {
+    margin-top: 20px;
+    margin-bottom: 20px;
+
+    h3 {
+      font-size: 16px;
+      font-weight: bolder;
+    }
+
+    ul {
+      padding: 0;
+    }
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 227f7c16197e8f9b58783296fa7d35a97ec7b25a Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:57:37 +0300
Subject: [PATCH 171/292] Step 18.11: Add components styles in main style entry
 point

---
 client/main.scss | 42 +++++++++++++++++++++++++++++++++++++++---
 1 file changed, 39 insertions(+), 3 deletions(-)

diff --git a/client/main.scss b/client/main.scss
index 5c3a0d0..1b0b7da 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -1,8 +1,44 @@
 @import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
 @import "{}/node_modules/bootstrap/scss/bootstrap.scss";
 
+$color1 : #2F2933;
+$color2 : #01A2A6;
+$color3 : #29D9C2;
+$color4 : #BDF271;
+$color5 : #FFFFA6;
+$color6 : #2F2933;
+$color7 : #FF6F69;
+
+html, body {
+  height: 100%;
+}
+
+body {
+  background-color: #f8f8f8;
+  font-family: 'Muli', sans-serif;
+}
 
 .sebm-google-map-container {
-  width: 400px;
-  height: 400px;
-}
\ No newline at end of file
+  width: 450px;
+  height: 450px;
+}
+
+.navbar {
+  background-color: #ffffff;
+  border-bottom: #eee 1px solid;
+  color: $color3;
+  font-family: 'Muli', sans-serif;
+  a {
+    color: $color3;
+    text-decoration: none !important;
+  }
+
+  .navbar-right-container {
+    position: absolute;
+    top: 17px;
+    right: 17px;
+  }
+}
+
+@import "./imports/app/parties/parties-list.component";
+@import "./imports/app/parties/party-details.component";
\ No newline at end of file
-- 
2.7.4


From 7f9d2dc2f221b7136fd1a85b53026e2c4d8d6b73 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:58:27 +0300
Subject: [PATCH 172/292] Step 18.12: Update the layout of the party details
 page

---
 .../app/parties/party-details.component.html       | 91 +++++++++++++---------
 1 file changed, 55 insertions(+), 36 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index 151fb03..c7fc234 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -1,42 +1,61 @@
-<form *ngIf="party" (submit)="saveParty()">
-  <label>Name</label>
-  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name">
+<div class="row ma-party-details-container">
+  <div class="col-sm-6 col-sm-offset-3">
+    <legend>View and Edit Your Party Details:</legend>
+    <form class="form-horizontal" *ngIf="party" (submit)="saveParty()">
+      <div class="form-group">
+        <label>Party Name</label>
+        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name" class="form-control">
+      </div>
 
-  <label>Description</label>
-  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description">
+      <div class="form-group">
+        <label>Description</label>
+        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description" class="form-control">
+      </div>
 
-  <label>Location</label>
-  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location.name" name="location">
+      <div class="form-group">
+        <label>Location name</label>
+        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location.name" name="location" class="form-control">
+      </div>
 
-  <button [disabled]="!isOwner" type="submit">Save</button>
-  <a [routerLink]="['/']">Cancel</a>
-</form>
+      <div class="form-group">
+        <button [disabled]="!isOwner" type="submit" class="btn btn-primary">Save</button>
+        <a [routerLink]="['/']" class="btn">Back</a>
+      </div>
+    </form>
 
-<div *ngIf="isOwner || isPublic">
-  <p>Users to invite:</p>
-  <ul>
-    <li *ngFor="let user of users | async">
-      <div>{{user | displayName}}</div>
-      <button (click)="invite(user)">Invite</button>
-    </li>
-  </ul>
-</div>
+    <ul class="ma-invite-list" *ngIf="isOwner || isPublic">
+      <h3>
+        Users to invite:
+      </h3>
+      <li *ngFor="let user of users | async">
+        <div>{{ user | displayName }}</div>
+        <button (click)="invite(user)" class="btn btn-primary btn-sm">Invite</button>
+      </li>
+    </ul>
 
-<div *ngIf="isInvited">
-  <h2>Reply to the invitation</h2>
-  <input type="button" value="I'm going!" (click)="reply('yes')">
-  <input type="button" value="Maybe" (click)="reply('maybe')">
-  <input type="button" value="No" (click)="reply('no')">
-</div>
+    <div *ngIf="isInvited">
+      <h2>Reply to the invitation</h2>
+      <input type="button" class="btn btn-primary" value="I'm going!" (click)="reply('yes')">
+      <input type="button" class="btn btn-warning" value="Maybe" (click)="reply('maybe')">
+      <input type="button" class="btn btn-danger" value="No" (click)="reply('no')">
+    </div>
 
-<sebm-google-map
-  [latitude]="lat || centerLat"
-  [longitude]="lng || centerLng"
-  [zoom]="8"
-  (mapClick)="mapClicked($event)">
-  <sebm-google-map-marker
-    *ngIf="lat && lng"
-    [latitude]="lat"
-    [longitude]="lng">
-  </sebm-google-map-marker>
-</sebm-google-map>
\ No newline at end of file
+    <h3 class="ma-map-title">
+      Click the map to set the party location
+    </h3>
+
+    <div class="angular-google-map-container">
+      <sebm-google-map
+        [latitude]="lat || centerLat"
+        [longitude]="lng || centerLng"
+        [zoom]="8"
+        (mapClick)="mapClicked($event)">
+        <sebm-google-map-marker
+          *ngIf="lat && lng"
+          [latitude]="lat"
+          [longitude]="lng">
+        </sebm-google-map-marker>
+      </sebm-google-map>
+    </div>
+  </div>
+</div>
\ No newline at end of file
-- 
2.7.4


From d803f58d8307e8cd0bca7d24287a1eb328f66ed1 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 15:51:31 -0200
Subject: [PATCH 173/292] Step 18: CSS, SASS and Bootstrap

---
 steps/step18.md | 676 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 676 insertions(+)
 create mode 100644 steps/step18.md

diff --git a/steps/step18.md b/steps/step18.md
new file mode 100644
index 0000000..377dc53
--- /dev/null
+++ b/steps/step18.md
@@ -0,0 +1,676 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# CSS, SASS and Bootstrap
+
+In this chapter we will add Twitter's bootstrap to our project, and add some style and layout to the project.
+
+# Adding and importing Bootstrap 4
+
+First, we need to add Bootstrap 4 to our project - so let's do that.
+
+Run the following command in your Terminal:
+
+    $ meteor npm install --save bootstrap@4.0.0-alpha.3
+
+ Import Bootstrap's styles into your project:
+
+[{]: <helper> (diff_step 18.2)
+#### Step 18.2: Import bootstrap style into the main style file
+
+##### Changed client/main.scss
+```diff
+@@ -1,4 +1,6 @@
+ ┊1┊1┊@import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
++┊ ┊2┊@import "{}/node_modules/bootstrap/scss/bootstrap.scss";
++┊ ┊3┊
+ ┊2┊4┊
+ ┊3┊5┊.sebm-google-map-container {
+ ┊4┊6┊  width: 400px;
+```
+[}]: #
+
+# First touch of style
+
+Now let's add some style! we will add navigation bar in the top of the page.
+
+We will also add a container with the `router-outlet` to keep that content of the page:
+
+[{]: <helper> (diff_step 18.3)
+#### Step 18.3: Add bootstrap navbar
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,3 +1,6 @@
+-┊1┊ ┊<div>
++┊ ┊1┊<nav class="navbar navbar-light bg-faded">
++┊ ┊2┊  <a class="navbar-brand" href="#">Socially</a>
++┊ ┊3┊</nav>
++┊ ┊4┊<div class="container-fluid">
+ ┊2┊5┊  <router-outlet></router-outlet>
+ ┊3┊6┊</div>🚫↵
+```
+[}]: #
+
+# Moving things around
+
+So first thing we want to do now, is to move the login buttons to another place - let's say that we want it as a part of the navigation bar.
+
+So first let's remove it from it's current place (parties list), first the view:
+
+[{]: <helper> (diff_step 18.4)
+#### Step 18.4: Remove LoginButtons from a template
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -2,8 +2,6 @@
+ ┊2┊2┊  <parties-form [hidden]="!user" style="float: left"></parties-form>
+ ┊3┊3┊  <input type="text" #searchtext placeholder="Search by Location">
+ ┊4┊4┊  <button type="button" (click)="search(searchtext.value)">Search</button>
+-┊5┊ ┊  
+-┊6┊ ┊  <login-buttons></login-buttons>
+ ┊7┊5┊
+ ┊8┊6┊  <h1>Parties:</h1>
+```
+[}]: #
+
+And add it to the main component, which is the component that responsible to the navigation bar, so the view first:
+
+[{]: <helper> (diff_step 18.5)
+#### Step 18.5: Add login buttons to the navigation bar
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,5 +1,6 @@
+ ┊1┊1┊<nav class="navbar navbar-light bg-faded">
+ ┊2┊2┊  <a class="navbar-brand" href="#">Socially</a>
++┊ ┊3┊  <login-buttons class="pull-right"></login-buttons>
+ ┊3┊4┊</nav>
+ ┊4┊5┊<div class="container-fluid">
+ ┊5┊6┊  <router-outlet></router-outlet>
+```
+[}]: #
+
+# Fonts and FontAwesome
+
+Meteor gives you the control of your `head` tag, so you can import fonts and add your `meta` tags.
+
+We will add a cool font and add [FontAwesome](https://fortawesome.github.io/Font-Awesome/) style file, which also contains it's font:
+
+[{]: <helper> (diff_step 18.6)
+#### Step 18.6: Add fonts and FontAwesome
+
+##### Changed client/index.html
+```diff
+@@ -1,5 +1,8 @@
+ ┊1┊1┊<head>
++┊ ┊2┊  <meta name="viewport" content="width=device-width, initial-scale=1">
+ ┊2┊3┊  <base href="/">
++┊ ┊4┊  <link href='http://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
++┊ ┊5┊  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
+ ┊3┊6┊</head>
+ ┊4┊7┊<body>
+ ┊5┊8┊  <app>Loading...</app>
+```
+[}]: #
+
+# Some more style
+
+So now we will take advantage of all Bootstrap's features - first let's update the layout of the form:
+
+[{]: <helper> (diff_step 18.7)
+#### Step 18.7: Update the new party form
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -1,15 +1,21 @@
+-┊ 1┊  ┊<form [formGroup]="addForm" (ngSubmit)="addParty()">
+-┊ 2┊  ┊  <label>Name</label>
+-┊ 3┊  ┊  <input type="text" formControlName="name">
++┊  ┊ 1┊<form [formGroup]="addForm" (ngSubmit)="addParty()" class="form-inline">
++┊  ┊ 2┊  <fieldset class="form-group">
++┊  ┊ 3┊    <label for="partyName">Party name</label>
++┊  ┊ 4┊    <input id="partyName" class="form-control" type="text" formControlName="name" placeholder="Party name" />
+ ┊ 4┊ 5┊
+-┊ 5┊  ┊  <label>Description</label>
+-┊ 6┊  ┊  <input type="text" formControlName="description">
++┊  ┊ 6┊    <label for="description">Description</label>
++┊  ┊ 7┊    <input id="description" class="form-control" type="text" formControlName="description" placeholder="Description">
+ ┊ 7┊ 8┊
+-┊ 8┊  ┊  <label>Location</label>
+-┊ 9┊  ┊  <input type="text" formControlName="location">
++┊  ┊ 9┊    <label for="location_name">Location</label>
++┊  ┊10┊    <input id="location_name" class="form-control" type="text" formControlName="location" placeholder="Location name">
+ ┊10┊11┊
+-┊11┊  ┊  <label>Public</label>
+-┊12┊  ┊  <input type="checkbox" formControlName="public">
+-┊13┊  ┊  
+-┊14┊  ┊  <button type="submit">Add</button>
+-┊15┊  ┊</form>🚫↵
++┊  ┊12┊    <div class="checkbox">
++┊  ┊13┊      <label>
++┊  ┊14┊        <input type="checkbox" formControlName="public">
++┊  ┊15┊        Public
++┊  ┊16┊      </label>
++┊  ┊17┊    </div>
++┊  ┊18┊
++┊  ┊19┊    <button type="submit" class="btn btn-primary">Add</button>
++┊  ┊20┊  </fieldset>
++┊  ┊21┊</form>
+```
+[}]: #
+
+And now the parties list:
+
+[{]: <helper> (diff_step 18.8)
+#### Step 18.8: Update parties list layout
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -1,44 +1,100 @@
+-┊  1┊   ┊<div>
+-┊  2┊   ┊  <parties-form [hidden]="!user" style="float: left"></parties-form>
+-┊  3┊   ┊  <input type="text" #searchtext placeholder="Search by Location">
+-┊  4┊   ┊  <button type="button" (click)="search(searchtext.value)">Search</button>
+-┊  5┊   ┊
+-┊  6┊   ┊  <h1>Parties:</h1>
+-┊  7┊   ┊
+-┊  8┊   ┊  <div>
+-┊  9┊   ┊    <select #sort (change)="changeSortOrder(sort.value)">
++┊   ┊  1┊<div class="row">
++┊   ┊  2┊  <div class="col-md-12">
++┊   ┊  3┊    <div class="jumbotron">
++┊   ┊  4┊      <h3>Create a new party!</h3>
++┊   ┊  5┊      <parties-form [hidden]="!user"></parties-form>
++┊   ┊  6┊      <div [hidden]="user">You need to login to create new parties!</div>
++┊   ┊  7┊    </div>
++┊   ┊  8┊  </div>
++┊   ┊  9┊</div>
++┊   ┊ 10┊<div class="row ma-filters">
++┊   ┊ 11┊  <div class="col-md-6">
++┊   ┊ 12┊    <h3>All Parties:</h3>
++┊   ┊ 13┊    <form class="form-inline">
++┊   ┊ 14┊      <input type="text" class="form-control" #searchtext placeholder="Search by Location">
++┊   ┊ 15┊      <button type="button" class="btn btn-primary" (click)="search(searchtext.value)">Search</button>
++┊   ┊ 16┊      Sort by name: <select class="form-control" #sort (change)="changeSortOrder(sort.value)">
+ ┊ 10┊ 17┊      <option value="1" selected>Ascending</option>
+ ┊ 11┊ 18┊      <option value="-1">Descending</option>
+ ┊ 12┊ 19┊    </select>
++┊   ┊ 20┊    </form>
++┊   ┊ 21┊  </div>
++┊   ┊ 22┊</div>
++┊   ┊ 23┊<div class="row">
++┊   ┊ 24┊  <div class="col-md-6">
++┊   ┊ 25┊    <ul class="list-group">
++┊   ┊ 26┊      <li class="list-group-item">
++┊   ┊ 27┊        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
++┊   ┊ 28┊      </li>
++┊   ┊ 29┊      <li *ngFor="let party of parties | async"
++┊   ┊ 30┊          class="list-group-item ma-party-item">
++┊   ┊ 31┊        <div class="row">
++┊   ┊ 32┊          <div class="col-sm-8">
++┊   ┊ 33┊            <h2 class="ma-party-name">
++┊   ┊ 34┊              <a [routerLink]="['/party', party._id]">undefined</a>
++┊   ┊ 35┊            </h2>
++┊   ┊ 36┊            @ undefined
++┊   ┊ 37┊            <p class="ma-party-description">
++┊   ┊ 38┊              undefined
++┊   ┊ 39┊            </p>
++┊   ┊ 40┊          </div>
++┊   ┊ 41┊          <div class="col-sm-4">
++┊   ┊ 42┊            <button class="btn btn-danger pull-right" [hidden]="!isOwner(party)" (click)="removeParty(party)"><i
++┊   ┊ 43┊              class="fa fa-times"></i></button>
++┊   ┊ 44┊          </div>
++┊   ┊ 45┊        </div>
++┊   ┊ 46┊        <div class="row ma-party-item-bottom">
++┊   ┊ 47┊          <div class="col-sm-4">
++┊   ┊ 48┊            <div class="ma-rsvp-sum">
++┊   ┊ 49┊              <div class="ma-rsvp-amount">
++┊   ┊ 50┊                <div class="ma-amount">
++┊   ┊ 51┊                  undefined
++┊   ┊ 52┊                </div>
++┊   ┊ 53┊                <div class="ma-rsvp-title">
++┊   ┊ 54┊                  YES
++┊   ┊ 55┊                </div>
++┊   ┊ 56┊              </div>
++┊   ┊ 57┊              <div class="ma-rsvp-amount">
++┊   ┊ 58┊                <div class="ma-amount">
++┊   ┊ 59┊                  undefined
++┊   ┊ 60┊                </div>
++┊   ┊ 61┊                <div class="ma-rsvp-title">
++┊   ┊ 62┊                  MAYBE
++┊   ┊ 63┊                </div>
++┊   ┊ 64┊              </div>
++┊   ┊ 65┊              <div class="ma-rsvp-amount">
++┊   ┊ 66┊                <div class="ma-amount">
++┊   ┊ 67┊                  undefined
++┊   ┊ 68┊                </div>
++┊   ┊ 69┊                <div class="ma-rsvp-title">
++┊   ┊ 70┊                  NO
++┊   ┊ 71┊                </div>
++┊   ┊ 72┊              </div>
++┊   ┊ 73┊            </div>
++┊   ┊ 74┊          </div>
++┊   ┊ 75┊        </div>
++┊   ┊ 76┊      </li>
++┊   ┊ 77┊      <li class="list-group-item">
++┊   ┊ 78┊        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
++┊   ┊ 79┊      </li>
++┊   ┊ 80┊    </ul>
++┊   ┊ 81┊  </div>
++┊   ┊ 82┊  <div class="col-md-6">
++┊   ┊ 83┊    <ul class="list-group">
++┊   ┊ 84┊      <li class="list-group-item">
++┊   ┊ 85┊        <sebm-google-map
++┊   ┊ 86┊          [latitude]="0"
++┊   ┊ 87┊          [longitude]="0"
++┊   ┊ 88┊          [zoom]="1">
++┊   ┊ 89┊          <div *ngFor="let party of parties | async">
++┊   ┊ 90┊            <sebm-google-map-marker
++┊   ┊ 91┊              *ngIf="party.location.lat"
++┊   ┊ 92┊              [latitude]="party.location.lat"
++┊   ┊ 93┊              [longitude]="party.location.lng">
++┊   ┊ 94┊            </sebm-google-map-marker>
++┊   ┊ 95┊          </div>
++┊   ┊ 96┊        </sebm-google-map>
++┊   ┊ 97┊      </li>
++┊   ┊ 98┊    </ul>
+ ┊ 13┊ 99┊  </div>
+-┊ 14┊   ┊
+-┊ 15┊   ┊  <ul>
+-┊ 16┊   ┊    <li *ngFor="let party of parties | async">
+-┊ 17┊   ┊      <a [routerLink]="['/party', party._id]">undefined</a>
+-┊ 18┊   ┊      <p>undefined</p>
+-┊ 19┊   ┊      <p>undefined</p>
+-┊ 20┊   ┊      <button [hidden]="!isOwner(party)" (click)="removeParty(party)">X</button>
+-┊ 21┊   ┊      <div>
+-┊ 22┊   ┊        Who is coming:
+-┊ 23┊   ┊        Yes - undefined
+-┊ 24┊   ┊        Maybe - undefined
+-┊ 25┊   ┊        No - undefined
+-┊ 26┊   ┊      </div>
+-┊ 27┊   ┊    </li>
+-┊ 28┊   ┊  </ul>
+-┊ 29┊   ┊
+-┊ 30┊   ┊  <sebm-google-map
+-┊ 31┊   ┊    [latitude]="0"
+-┊ 32┊   ┊    [longitude]="0"
+-┊ 33┊   ┊    [zoom]="1">
+-┊ 34┊   ┊    <div *ngFor="let party of parties | async">
+-┊ 35┊   ┊      <sebm-google-map-marker
+-┊ 36┊   ┊        *ngIf="party.location.lat"
+-┊ 37┊   ┊        [latitude]="party.location.lat"
+-┊ 38┊   ┊        [longitude]="party.location.lng">
+-┊ 39┊   ┊      </sebm-google-map-marker>
+-┊ 40┊   ┊    </div>
+-┊ 41┊   ┊  </sebm-google-map>
+-┊ 42┊   ┊
+-┊ 43┊   ┊  <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
+ ┊ 44┊100┊</div>🚫↵
+```
+[}]: #
+
+# Styling components
+
+We will create style file for each component.
+
+So let's start with the parties list, and add some style (it's not that critical at the moment what is the effect of those CSS rules)
+
+[{]: <helper> (diff_step 18.9)
+#### Step 18.9: Add styles for PartiesList
+
+##### Added client/imports/app/parties/parties-list.component.scss
+```diff
+@@ -0,0 +1,125 @@
++┊   ┊  1┊.ma-add-button-container {
++┊   ┊  2┊  button.btn {
++┊   ┊  3┊    background: $color3;
++┊   ┊  4┊    float: right;
++┊   ┊  5┊    margin-right: 5px;
++┊   ┊  6┊    outline: none;
++┊   ┊  7┊    i {
++┊   ┊  8┊      color: $color5;
++┊   ┊  9┊    }
++┊   ┊ 10┊  }
++┊   ┊ 11┊}
++┊   ┊ 12┊
++┊   ┊ 13┊.ma-parties-col {
++┊   ┊ 14┊  padding-top: 20px;
++┊   ┊ 15┊}
++┊   ┊ 16┊
++┊   ┊ 17┊.ma-filters {
++┊   ┊ 18┊  margin-bottom: 10px;
++┊   ┊ 19┊}
++┊   ┊ 20┊
++┊   ┊ 21┊.ma-party-item {
++┊   ┊ 22┊  .ma-party-name {
++┊   ┊ 23┊    margin-bottom: 20px;
++┊   ┊ 24┊    a {
++┊   ┊ 25┊      color: $color6;
++┊   ┊ 26┊      text-decoration: none !important;
++┊   ┊ 27┊      font-weight: 400;
++┊   ┊ 28┊    }
++┊   ┊ 29┊  }
++┊   ┊ 30┊  .ma-party-description {
++┊   ┊ 31┊    color: $color6;
++┊   ┊ 32┊    font-weight: 300;
++┊   ┊ 33┊    padding-left: 18px;
++┊   ┊ 34┊    font-size: 14px;
++┊   ┊ 35┊  }
++┊   ┊ 36┊
++┊   ┊ 37┊  .ma-remove {
++┊   ┊ 38┊    color: lighten($color7, 20%);
++┊   ┊ 39┊    position: absolute;
++┊   ┊ 40┊    right: 20px;
++┊   ┊ 41┊    top: 20px;
++┊   ┊ 42┊    &:hover {
++┊   ┊ 43┊      color: $color7;
++┊   ┊ 44┊    }
++┊   ┊ 45┊  }
++┊   ┊ 46┊
++┊   ┊ 47┊  .ma-party-item-bottom {
++┊   ┊ 48┊    padding-top: 10px;
++┊   ┊ 49┊    .ma-posted-by-col {
++┊   ┊ 50┊      .ma-posted-by {
++┊   ┊ 51┊        color: darken($color4, 30%);
++┊   ┊ 52┊        font-size: 12px;
++┊   ┊ 53┊      }
++┊   ┊ 54┊      .ma-everyone-invited {
++┊   ┊ 55┊        @media (max-width: 400px) {
++┊   ┊ 56┊          display: block;
++┊   ┊ 57┊          i {
++┊   ┊ 58┊            margin-left: 0px !important;
++┊   ┊ 59┊          }
++┊   ┊ 60┊        }
++┊   ┊ 61┊        font-size: 12px;
++┊   ┊ 62┊        color: darken($color4, 10%);
++┊   ┊ 63┊        i {
++┊   ┊ 64┊          color: darken($color4, 10%);
++┊   ┊ 65┊          margin-left: 5px;
++┊   ┊ 66┊        }
++┊   ┊ 67┊      }
++┊   ┊ 68┊    }
++┊   ┊ 69┊
++┊   ┊ 70┊    .ma-rsvp-buttons {
++┊   ┊ 71┊      input.btn {
++┊   ┊ 72┊        color: darken($color3, 20%);
++┊   ┊ 73┊        background: transparent !important;
++┊   ┊ 74┊        outline: none;
++┊   ┊ 75┊        padding-left: 0;
++┊   ┊ 76┊        &:active {
++┊   ┊ 77┊          box-shadow: none;
++┊   ┊ 78┊        }
++┊   ┊ 79┊        &:hover {
++┊   ┊ 80┊          color: darken($color3, 30%);
++┊   ┊ 81┊        }
++┊   ┊ 82┊        &.btn-primary {
++┊   ┊ 83┊          color: lighten($color3, 10%);
++┊   ┊ 84┊          border: 0;
++┊   ┊ 85┊          background: transparent !important;
++┊   ┊ 86┊        }
++┊   ┊ 87┊      }
++┊   ┊ 88┊    }
++┊   ┊ 89┊
++┊   ┊ 90┊    .ma-rsvp-sum {
++┊   ┊ 91┊      width: 160px;
++┊   ┊ 92┊      @media (min-width: 400px) {
++┊   ┊ 93┊        float: right;
++┊   ┊ 94┊      }
++┊   ┊ 95┊      @media (max-width: 400px) {
++┊   ┊ 96┊        margin: 0 auto;
++┊   ┊ 97┊      }
++┊   ┊ 98┊    }
++┊   ┊ 99┊    .ma-rsvp-amount {
++┊   ┊100┊      display: inline-block;
++┊   ┊101┊      text-align: center;
++┊   ┊102┊      width: 50px;
++┊   ┊103┊      .ma-amount {
++┊   ┊104┊        font-weight: bold;
++┊   ┊105┊        font-size: 20px;
++┊   ┊106┊      }
++┊   ┊107┊      .ma-rsvp-title {
++┊   ┊108┊        font-size: 11px;
++┊   ┊109┊        color: #aaa;
++┊   ┊110┊        text-transform: uppercase;
++┊   ┊111┊      }
++┊   ┊112┊    }
++┊   ┊113┊  }
++┊   ┊114┊}
++┊   ┊115┊
++┊   ┊116┊.ma-angular-map-col {
++┊   ┊117┊  .angular-google-map-container, .angular-google-map {
++┊   ┊118┊    height: 100%;
++┊   ┊119┊    width: 100%;
++┊   ┊120┊  }
++┊   ┊121┊}
++┊   ┊122┊
++┊   ┊123┊.search-form {
++┊   ┊124┊  margin-bottom: 1em;
++┊   ┊125┊}🚫↵
+```
+[}]: #
+
+And now let's add SASS file for the party details:
+
+[{]: <helper> (diff_step 18.10)
+#### Step 18.10: Add styles for the party details page
+
+##### Added client/imports/app/parties/party-details.component.scss
+```diff
+@@ -0,0 +1,32 @@
++┊  ┊ 1┊.ma-party-details-container {
++┊  ┊ 2┊  padding: 20px;
++┊  ┊ 3┊
++┊  ┊ 4┊  .angular-google-map-container {
++┊  ┊ 5┊    width: 100%;
++┊  ┊ 6┊    height: 100%;
++┊  ┊ 7┊  }
++┊  ┊ 8┊
++┊  ┊ 9┊  .angular-google-map {
++┊  ┊10┊    width: 100%;
++┊  ┊11┊    height: 400px;
++┊  ┊12┊  }
++┊  ┊13┊
++┊  ┊14┊  .ma-map-title {
++┊  ┊15┊    font-size: 16px;
++┊  ┊16┊    font-weight: bolder;
++┊  ┊17┊  }
++┊  ┊18┊
++┊  ┊19┊  .ma-invite-list {
++┊  ┊20┊    margin-top: 20px;
++┊  ┊21┊    margin-bottom: 20px;
++┊  ┊22┊
++┊  ┊23┊    h3 {
++┊  ┊24┊      font-size: 16px;
++┊  ┊25┊      font-weight: bolder;
++┊  ┊26┊    }
++┊  ┊27┊
++┊  ┊28┊    ul {
++┊  ┊29┊      padding: 0;
++┊  ┊30┊    }
++┊  ┊31┊  }
++┊  ┊32┊}🚫↵
+```
+[}]: #
+
+import it into the main SASS file:
+
+[{]: <helper> (diff_step 18.11)
+#### Step 18.11: Add components styles in main style entry point
+
+##### Changed client/main.scss
+```diff
+@@ -1,8 +1,44 @@
+ ┊ 1┊ 1┊@import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
+ ┊ 2┊ 2┊@import "{}/node_modules/bootstrap/scss/bootstrap.scss";
+ ┊ 3┊ 3┊
++┊  ┊ 4┊$color1 : #2F2933;
++┊  ┊ 5┊$color2 : #01A2A6;
++┊  ┊ 6┊$color3 : #29D9C2;
++┊  ┊ 7┊$color4 : #BDF271;
++┊  ┊ 8┊$color5 : #FFFFA6;
++┊  ┊ 9┊$color6 : #2F2933;
++┊  ┊10┊$color7 : #FF6F69;
++┊  ┊11┊
++┊  ┊12┊html, body {
++┊  ┊13┊  height: 100%;
++┊  ┊14┊}
++┊  ┊15┊
++┊  ┊16┊body {
++┊  ┊17┊  background-color: #f8f8f8;
++┊  ┊18┊  font-family: 'Muli', sans-serif;
++┊  ┊19┊}
+ ┊ 4┊20┊
+ ┊ 5┊21┊.sebm-google-map-container {
+-┊ 6┊  ┊  width: 400px;
+-┊ 7┊  ┊  height: 400px;
+-┊ 8┊  ┊}🚫↵
++┊  ┊22┊  width: 450px;
++┊  ┊23┊  height: 450px;
++┊  ┊24┊}
++┊  ┊25┊
++┊  ┊26┊.navbar {
++┊  ┊27┊  background-color: #ffffff;
++┊  ┊28┊  border-bottom: #eee 1px solid;
++┊  ┊29┊  color: $color3;
++┊  ┊30┊  font-family: 'Muli', sans-serif;
++┊  ┊31┊  a {
++┊  ┊32┊    color: $color3;
++┊  ┊33┊    text-decoration: none !important;
++┊  ┊34┊  }
++┊  ┊35┊
++┊  ┊36┊  .navbar-right-container {
++┊  ┊37┊    position: absolute;
++┊  ┊38┊    top: 17px;
++┊  ┊39┊    right: 17px;
++┊  ┊40┊  }
++┊  ┊41┊}
++┊  ┊42┊
++┊  ┊43┊@import "./imports/app/parties/parties-list.component";
++┊  ┊44┊@import "./imports/app/parties/party-details.component";🚫↵
+```
+[}]: #
+
+And use those new cool styles in the view of the party details:
+
+[{]: <helper> (diff_step 18.12)
+#### Step 18.12: Update the layout of the party details page
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -1,42 +1,61 @@
+-┊ 1┊  ┊<form *ngIf="party" (submit)="saveParty()">
+-┊ 2┊  ┊  <label>Name</label>
+-┊ 3┊  ┊  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name">
++┊  ┊ 1┊<div class="row ma-party-details-container">
++┊  ┊ 2┊  <div class="col-sm-6 col-sm-offset-3">
++┊  ┊ 3┊    <legend>View and Edit Your Party Details:</legend>
++┊  ┊ 4┊    <form class="form-horizontal" *ngIf="party" (submit)="saveParty()">
++┊  ┊ 5┊      <div class="form-group">
++┊  ┊ 6┊        <label>Party Name</label>
++┊  ┊ 7┊        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name" class="form-control">
++┊  ┊ 8┊      </div>
+ ┊ 4┊ 9┊
+-┊ 5┊  ┊  <label>Description</label>
+-┊ 6┊  ┊  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description">
++┊  ┊10┊      <div class="form-group">
++┊  ┊11┊        <label>Description</label>
++┊  ┊12┊        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description" class="form-control">
++┊  ┊13┊      </div>
+ ┊ 7┊14┊
+-┊ 8┊  ┊  <label>Location</label>
+-┊ 9┊  ┊  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location.name" name="location">
++┊  ┊15┊      <div class="form-group">
++┊  ┊16┊        <label>Location name</label>
++┊  ┊17┊        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location.name" name="location" class="form-control">
++┊  ┊18┊      </div>
+ ┊10┊19┊
+-┊11┊  ┊  <button [disabled]="!isOwner" type="submit">Save</button>
+-┊12┊  ┊  <a [routerLink]="['/']">Cancel</a>
+-┊13┊  ┊</form>
++┊  ┊20┊      <div class="form-group">
++┊  ┊21┊        <button [disabled]="!isOwner" type="submit" class="btn btn-primary">Save</button>
++┊  ┊22┊        <a [routerLink]="['/']" class="btn">Back</a>
++┊  ┊23┊      </div>
++┊  ┊24┊    </form>
+ ┊14┊25┊
+-┊15┊  ┊<div *ngIf="isOwner || isPublic">
+-┊16┊  ┊  <p>Users to invite:</p>
+-┊17┊  ┊  <ul>
+-┊18┊  ┊    <li *ngFor="let user of users | async">
+-┊19┊  ┊      <div>undefined</div>
+-┊20┊  ┊      <button (click)="invite(user)">Invite</button>
+-┊21┊  ┊    </li>
+-┊22┊  ┊  </ul>
+-┊23┊  ┊</div>
++┊  ┊26┊    <ul class="ma-invite-list" *ngIf="isOwner || isPublic">
++┊  ┊27┊      <h3>
++┊  ┊28┊        Users to invite:
++┊  ┊29┊      </h3>
++┊  ┊30┊      <li *ngFor="let user of users | async">
++┊  ┊31┊        <div>undefined</div>
++┊  ┊32┊        <button (click)="invite(user)" class="btn btn-primary btn-sm">Invite</button>
++┊  ┊33┊      </li>
++┊  ┊34┊    </ul>
+ ┊24┊35┊
+-┊25┊  ┊<div *ngIf="isInvited">
+-┊26┊  ┊  <h2>Reply to the invitation</h2>
+-┊27┊  ┊  <input type="button" value="I'm going!" (click)="reply('yes')">
+-┊28┊  ┊  <input type="button" value="Maybe" (click)="reply('maybe')">
+-┊29┊  ┊  <input type="button" value="No" (click)="reply('no')">
+-┊30┊  ┊</div>
++┊  ┊36┊    <div *ngIf="isInvited">
++┊  ┊37┊      <h2>Reply to the invitation</h2>
++┊  ┊38┊      <input type="button" class="btn btn-primary" value="I'm going!" (click)="reply('yes')">
++┊  ┊39┊      <input type="button" class="btn btn-warning" value="Maybe" (click)="reply('maybe')">
++┊  ┊40┊      <input type="button" class="btn btn-danger" value="No" (click)="reply('no')">
++┊  ┊41┊    </div>
+ ┊31┊42┊
+-┊32┊  ┊<sebm-google-map
+-┊33┊  ┊  [latitude]="lat || centerLat"
+-┊34┊  ┊  [longitude]="lng || centerLng"
+-┊35┊  ┊  [zoom]="8"
+-┊36┊  ┊  (mapClick)="mapClicked($event)">
+-┊37┊  ┊  <sebm-google-map-marker
+-┊38┊  ┊    *ngIf="lat && lng"
+-┊39┊  ┊    [latitude]="lat"
+-┊40┊  ┊    [longitude]="lng">
+-┊41┊  ┊  </sebm-google-map-marker>
+-┊42┊  ┊</sebm-google-map>🚫↵
++┊  ┊43┊    <h3 class="ma-map-title">
++┊  ┊44┊      Click the map to set the party location
++┊  ┊45┊    </h3>
++┊  ┊46┊
++┊  ┊47┊    <div class="angular-google-map-container">
++┊  ┊48┊      <sebm-google-map
++┊  ┊49┊        [latitude]="lat || centerLat"
++┊  ┊50┊        [longitude]="lng || centerLng"
++┊  ┊51┊        [zoom]="8"
++┊  ┊52┊        (mapClick)="mapClicked($event)">
++┊  ┊53┊        <sebm-google-map-marker
++┊  ┊54┊          *ngIf="lat && lng"
++┊  ┊55┊          [latitude]="lat"
++┊  ┊56┊          [longitude]="lng">
++┊  ┊57┊        </sebm-google-map-marker>
++┊  ┊58┊      </sebm-google-map>
++┊  ┊59┊    </div>
++┊  ┊60┊  </div>
++┊  ┊61┊</div>🚫↵
+```
+[}]: #
+
+
+# Summary
+
+So in this chapter of the tutorial we added the Bootstrap library and used it's layout and CSS styles.
+
+We also learned how to integrate SASS compiler with Meteor and how to create isolated SASS styles for each component.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step17.md) | [Next Step >](step19.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From a20297addea6cc5f4f638f827dddc97a5a7ebc04 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:59:21 +0300
Subject: [PATCH 174/292] Step 19.1: Uninstall bootstrap

---
 package.json | 1 -
 1 file changed, 1 deletion(-)

diff --git a/package.json b/package.json
index d85d95f..4d4b2a9 100644
--- a/package.json
+++ b/package.json
@@ -27,7 +27,6 @@
     "angular2-meteor-accounts-ui": "0.8.0",
     "angular2-meteor-polyfills": "^0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
-    "bootstrap": "^4.0.0-alpha.4",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
     "ng2-pagination": "0.4.1",
-- 
2.7.4


From 6793ba5a42285ccc1e8a172434d7b4af1bd0aaa0 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 12:59:34 +0300
Subject: [PATCH 175/292] Step 19.2: Remove bootstrap scss

---
 client/main.scss | 1 -
 1 file changed, 1 deletion(-)

diff --git a/client/main.scss b/client/main.scss
index 1b0b7da..16e869c 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -1,5 +1,4 @@
 @import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
-@import "{}/node_modules/bootstrap/scss/bootstrap.scss";
 
 $color1 : #2F2933;
 $color2 : #01A2A6;
-- 
2.7.4


From 3ef1220328a4c8d6164ae47f9f783d0607deac4a Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:00:35 +0300
Subject: [PATCH 176/292] Step 19.3: Install @angular-material2 packages

---
 package.json | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/package.json b/package.json
index 4d4b2a9..f04c79f 100644
--- a/package.json
+++ b/package.json
@@ -22,6 +22,13 @@
     "@angular/platform-browser": "2.0.1",
     "@angular/platform-browser-dynamic": "2.0.1",
     "@angular/router": "3.0.1",
+    "@angular2-material/button": "2.0.0-alpha.8-2",
+    "@angular2-material/card": "2.0.0-alpha.8-2",
+    "@angular2-material/checkbox": "2.0.0-alpha.8-2",
+    "@angular2-material/core": "2.0.0-alpha.8-2",
+    "@angular2-material/input": "2.0.0-alpha.8-2",
+    "@angular2-material/list": "2.0.0-alpha.8-2",
+    "@angular2-material/toolbar": "2.0.0-alpha.8-2",
     "angular2-google-maps": "0.15.0",
     "angular2-meteor": "0.7.0",
     "angular2-meteor-accounts-ui": "0.8.0",
-- 
2.7.4


From d1774a3043e4b945a27bc04b558f6dcad609f33d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:02:15 +0300
Subject: [PATCH 177/292] Step 19.4: Imported the angular2-material modules

---
 client/imports/app/app.module.ts | 16 +++++++++++++++-
 1 file changed, 15 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 0240ddf..2adac35 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -10,6 +10,13 @@ import { AppComponent } from './app.component';
 import { routes, ROUTES_PROVIDERS } from './app.routes';
 import { PARTIES_DECLARATIONS } from './parties';
 import { SHARED_DECLARATIONS } from './shared';
+import { MdButtonModule } from "@angular2-material/button";
+import { MdToolbarModule } from "@angular2-material/toolbar";
+import { MdInputModule } from "@angular2-material/input";
+import { MdCardModule } from "@angular2-material/card";
+import { MdCoreModule } from "@angular2-material/core";
+import { MdCheckboxModule } from "@angular2-material/checkbox";
+import {MdListModule} from "@angular2-material/list";
 
 @NgModule({
   imports: [
@@ -21,7 +28,14 @@ import { SHARED_DECLARATIONS } from './shared';
     Ng2PaginationModule,
     AgmCoreModule.forRoot({
       apiKey: 'AIzaSyAWoBdZHCNh5R-hB5S5ZZ2oeoYyfdDgniA'
-    })
+    }),
+    MdCoreModule.forRoot(),
+    MdButtonModule.forRoot(),
+    MdToolbarModule.forRoot(),
+    MdInputModule.forRoot(),
+    MdCardModule.forRoot(),
+    MdCheckboxModule.forRoot(),
+    MdListModule.forRoot()
   ],
   declarations: [
     AppComponent,
-- 
2.7.4


From 6eb66866f9aee469e450164b52768750b9b2ae05 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:21:11 +0300
Subject: [PATCH 178/292] Step 19.5: Change the nav bar and the layout

---
 client/imports/app/app.component.html | 13 ++++++-------
 1 file changed, 6 insertions(+), 7 deletions(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index dffc2ea..a021e59 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,7 +1,6 @@
-<nav class="navbar navbar-light bg-faded">
-  <a class="navbar-brand" href="#">Socially</a>
-  <login-buttons class="pull-right"></login-buttons>
-</nav>
-<div class="container-fluid">
-  <router-outlet></router-outlet>
-</div>
\ No newline at end of file
+<md-toolbar color="primary">
+  <a routerLink="/" class="md-title">Socially</a>
+  <span class="fill-remaining-space"></span>
+  <login-buttons></login-buttons>
+</md-toolbar>
+<router-outlet></router-outlet>
\ No newline at end of file
-- 
2.7.4


From 279863199dff28089822012934ba07cf02aa89af Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:21:21 +0300
Subject: [PATCH 179/292] Step 19.6: Added the missing css

---
 client/main.scss | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/main.scss b/client/main.scss
index 16e869c..d86c9f5 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -8,6 +8,10 @@ $color5 : #FFFFA6;
 $color6 : #2F2933;
 $color7 : #FF6F69;
 
+.fill-remaining-space {
+  flex: 1 1 auto;
+}
+
 html, body {
   height: 100%;
 }
-- 
2.7.4


From ca3a155a80d762252f72d6be909116d7587bc7c6 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:22:18 +0300
Subject: [PATCH 180/292] Step 19.7: Update the view of the parties form

---
 .../app/parties/parties-form.component.html        | 22 +++++++---------------
 1 file changed, 7 insertions(+), 15 deletions(-)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index c791629..0318fa5 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -1,21 +1,13 @@
-<form [formGroup]="addForm" (ngSubmit)="addParty()" class="form-inline">
+<form [formGroup]="addForm" (ngSubmit)="addParty()">
   <fieldset class="form-group">
-    <label for="partyName">Party name</label>
-    <input id="partyName" class="form-control" type="text" formControlName="name" placeholder="Party name" />
-
-    <label for="description">Description</label>
-    <input id="description" class="form-control" type="text" formControlName="description" placeholder="Description">
-
-    <label for="location_name">Location</label>
-    <input id="location_name" class="form-control" type="text" formControlName="location" placeholder="Location name">
+    <md-input formControlName="name" placeholder="Party name"></md-input>
+    <md-input formControlName="description" placeholder="Description"></md-input>
+    <md-input formControlName="location" placeholder="Location name"></md-input>
 
     <div class="checkbox">
-      <label>
-        <input type="checkbox" formControlName="public">
-        Public
-      </label>
+      <md-checkbox formControlName="public">Public</md-checkbox>
     </div>
 
-    <button type="submit" class="btn btn-primary">Add</button>
+    <button md-raised-button type="submit">Add</button>
   </fieldset>
-</form>
+</form>
\ No newline at end of file
-- 
2.7.4


From 7a805b04d2e8716fe0f484738b19a7fbb93c09ff Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:25:12 +0300
Subject: [PATCH 181/292] Step 19.8: Change the layout of the parties list

---
 .../app/parties/parties-list.component.html        | 141 +++++++++------------
 1 file changed, 59 insertions(+), 82 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 0629b28..8ca6bf0 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -1,88 +1,65 @@
-<div class="row">
-  <div class="col-md-12">
-    <div class="jumbotron">
-      <h3>Create a new party!</h3>
-      <parties-form [hidden]="!user"></parties-form>
-      <div [hidden]="user">You need to login to create new parties!</div>
-    </div>
-  </div>
-</div>
-<div class="row ma-filters">
-  <div class="col-md-6">
-    <h3>All Parties:</h3>
-    <form class="form-inline">
-      <input type="text" class="form-control" #searchtext placeholder="Search by Location">
-      <button type="button" class="btn btn-primary" (click)="search(searchtext.value)">Search</button>
-      Sort by name: <select class="form-control" #sort (change)="changeSortOrder(sort.value)">
-      <option value="1" selected>Ascending</option>
-      <option value="-1">Descending</option>
-    </select>
-    </form>
-  </div>
-</div>
-<div class="row">
-  <div class="col-md-6">
-    <ul class="list-group">
-      <li class="list-group-item">
-        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
-      </li>
-      <li *ngFor="let party of parties | async"
-          class="list-group-item ma-party-item">
-        <div class="row">
-          <div class="col-sm-8">
-            <h2 class="ma-party-name">
-              <a [routerLink]="['/party', party._id]">{{party.name}}</a>
-            </h2>
-            @ {{party.location.name}}
-            <p class="ma-party-description">
-              {{party.description}}
-            </p>
-          </div>
-          <div class="col-sm-4">
-            <button class="btn btn-danger pull-right" [hidden]="!isOwner(party)" (click)="removeParty(party)"><i
-              class="fa fa-times"></i></button>
-          </div>
+<div flex layout="row" class="div ma-parties-list">
+  <div layout="row" flex>
+    <div flex="50">
+      <div>
+        <div class="div new-party-form-container">
+          <md-toolbar>
+            <div class="md-toolbar-tools">
+              <h3>Create a new party!</h3>
+            </div>
+          </md-toolbar>
+          <parties-form [hidden]="!user"></parties-form>
+          <div [hidden]="user">You need to login to create new parties!</div>
         </div>
-        <div class="row ma-party-item-bottom">
-          <div class="col-sm-4">
-            <div class="ma-rsvp-sum">
-              <div class="ma-rsvp-amount">
-                <div class="ma-amount">
-                  {{party | rsvp:'yes'}}
-                </div>
-                <div class="ma-rsvp-title">
-                  YES
-                </div>
-              </div>
-              <div class="ma-rsvp-amount">
-                <div class="ma-amount">
-                  {{party | rsvp:'maybe'}}
-                </div>
-                <div class="ma-rsvp-title">
-                  MAYBE
-                </div>
-              </div>
-              <div class="ma-rsvp-amount">
-                <div class="ma-amount">
-                  {{party | rsvp:'no'}}
-                </div>
-                <div class="ma-rsvp-title">
-                  NO
+        <div layout-padding layout="row">
+          <md-input #searchtext placeholder="Search by Location"></md-input>
+        </div>
+        <div layout-padding layout="row">
+          Sort by name:
+          <select class="form-control" #sort (change)="changeSortOrder(sort.value)">
+            <option value="1" selected>Ascending</option>
+            <option value="-1">Descending</option>
+          </select>
+        </div>
+
+        <div class="div md-padding" style="padding-top:0;">
+          <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
+          <div *ngFor="let party of parties | async">
+            <md-card>
+              <md-card-content>
+                <h2 class="md-title ma-name">
+                  <a [routerLink]="['/party', party._id]">{{party.name}}</a>
+                </h2>
+                <p class="ma-description" style="padding:0 10px;margin-bottom:35px;margin-top: 6px;">
+                  {{party.description}}
+                </p>
+                <div layout="row">
+                  <div layout="row" layout-align="end end">
+                    <div>
+                      <div class="rsvps-sum">
+                        <div class="rsvps-amount">{{party | rsvp:'yes'}}</div>
+                        <div class="rsvps-title">Yes</div>
+                      </div>
+                      <div class="rsvps-sum">
+                        <div class="rsvps-amount">{{party | rsvp:'maybe'}}</div>
+                        <div class="rsvps-title">Maybe</div>
+                      </div>
+                      <div class="rsvps-sum">
+                        <div class="rsvps-amount">{{party | rsvp:'no'}}</div>
+                        <div class="rsvps-title">No</div>
+                      </div>
+                    </div>
+                  </div>
                 </div>
-              </div>
-            </div>
+              </md-card-content>
+            </md-card>
           </div>
         </div>
-      </li>
-      <li class="list-group-item">
-        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
-      </li>
-    </ul>
-  </div>
-  <div class="col-md-6">
-    <ul class="list-group">
-      <li class="list-group-item">
+      </div>
+      <div flex="50" layout="row" style="min-height:300px;">
         <sebm-google-map
+          style="width: 100%; min-height:300px;"
+          flex layout="row"
           [latitude]="0"
           [longitude]="0"
           [zoom]="1">
@@ -94,7 +71,7 @@
             </sebm-google-map-marker>
           </div>
         </sebm-google-map>
-      </li>
-    </ul>
+      </div>
+    </div>
   </div>
 </div>
\ No newline at end of file
-- 
2.7.4


From 4f78db08f661873574b1465bcb5802f9d58ab6ca Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:25:40 +0300
Subject: [PATCH 182/292] Step 19.9: Add some style to the parties list

---
 .../app/parties/parties-list.component.scss        | 148 ++++++---------------
 1 file changed, 42 insertions(+), 106 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.scss b/client/imports/app/parties/parties-list.component.scss
index 2cd8d06..60f77b1 100644
--- a/client/imports/app/parties/parties-list.component.scss
+++ b/client/imports/app/parties/parties-list.component.scss
@@ -1,125 +1,61 @@
-.ma-add-button-container {
-  button.btn {
-    background: $color3;
-    float: right;
-    margin-right: 5px;
-    outline: none;
-    i {
-      color: $color5;
-    }
-  }
-}
-
-.ma-parties-col {
-  padding-top: 20px;
-}
-
-.ma-filters {
-  margin-bottom: 10px;
+.new-party-form-container {
+  margin: 20px;
+  border: 1px gainsboro solid;
 }
-
-.ma-party-item {
-  .ma-party-name {
-    margin-bottom: 20px;
-    a {
-      color: $color6;
-      text-decoration: none !important;
-      font-weight: 400;
-    }
+.ma-parties-list {
+  .sebm-google-map {
+    box-sizing: border-box;
+    -webkit-flex: 1;
+    -ms-flex: 1;
+    flex: 1;
+    -webkit-flex-direction: row;
+    -ms-flex-direction: row;
+    flex-direction: row;
+    box-sizing: border-box;
+    display: -webkit-flex;
+    display: -ms-flexbox;
+    display: flex;
   }
-  .ma-party-description {
-    color: $color6;
-    font-weight: 300;
-    padding-left: 18px;
-    font-size: 14px;
+
+  .angular-google-map-container {
+    box-sizing: border-box;
+    -webkit-flex: 1;
+    -ms-flex: 1;
+    flex: 1;
   }
 
-  .ma-remove {
-    color: lighten($color7, 20%);
-    position: absolute;
-    right: 20px;
-    top: 20px;
-    &:hover {
-      color: $color7;
+  .rsvps-sum {
+    display: inline-block;
+    width: 50px;
+    text-align: center;
+    .rsvps-amount {
+      font-size: 24px;
+    }
+    .rsvps-title {
+      font-size: 13px;
+      color: #aaa;
     }
   }
 
-  .ma-party-item-bottom {
-    padding-top: 10px;
-    .ma-posted-by-col {
-      .ma-posted-by {
-        color: darken($color4, 30%);
-        font-size: 12px;
-      }
-      .ma-everyone-invited {
-        @media (max-width: 400px) {
-          display: block;
-          i {
-            margin-left: 0px !important;
-          }
-        }
-        font-size: 12px;
-        color: darken($color4, 10%);
-        i {
-          color: darken($color4, 10%);
-          margin-left: 5px;
-        }
-      }
+  .ma-party {
+    .party-image {
+      background-size: cover;
+      width: 100%;
+      height: 200px;
     }
 
-    .ma-rsvp-buttons {
-      input.btn {
-        color: darken($color3, 20%);
-        background: transparent !important;
-        outline: none;
-        padding-left: 0;
-        &:active {
-          box-shadow: none;
-        }
-        &:hover {
-          color: darken($color3, 30%);
-        }
-        &.btn-primary {
-          color: lighten($color3, 10%);
-          border: 0;
-          background: transparent !important;
-        }
+    .ma-name {
+      a {
+        text-decoration: none;
+        color: #333;
       }
     }
+    .ma-description {
 
-    .ma-rsvp-sum {
-      width: 160px;
-      @media (min-width: 400px) {
-        float: right;
-      }
-      @media (max-width: 400px) {
-        margin: 0 auto;
-      }
-    }
-    .ma-rsvp-amount {
-      display: inline-block;
-      text-align: center;
-      width: 50px;
-      .ma-amount {
-        font-weight: bold;
-        font-size: 20px;
-      }
-      .ma-rsvp-title {
-        font-size: 11px;
-        color: #aaa;
-        text-transform: uppercase;
-      }
     }
   }
 }
 
-.ma-angular-map-col {
-  .angular-google-map-container, .angular-google-map {
-    height: 100%;
-    width: 100%;
-  }
-}
-
 .search-form {
   margin-bottom: 1em;
 }
\ No newline at end of file
-- 
2.7.4


From 05e22177f0f847db925e22c55095be8361501d17 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:34:03 +0300
Subject: [PATCH 183/292] Step 19.10: Update the layout of the party details

---
 .../app/parties/party-details.component.html       | 97 ++++++++++------------
 1 file changed, 43 insertions(+), 54 deletions(-)

diff --git a/client/imports/app/parties/party-details.component.html b/client/imports/app/parties/party-details.component.html
index c7fc234..ff5e42b 100644
--- a/client/imports/app/parties/party-details.component.html
+++ b/client/imports/app/parties/party-details.component.html
@@ -1,61 +1,50 @@
-<div class="row ma-party-details-container">
-  <div class="col-sm-6 col-sm-offset-3">
-    <legend>View and Edit Your Party Details:</legend>
-    <form class="form-horizontal" *ngIf="party" (submit)="saveParty()">
-      <div class="form-group">
-        <label>Party Name</label>
-        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name" class="form-control">
-      </div>
-
-      <div class="form-group">
-        <label>Description</label>
-        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description" class="form-control">
-      </div>
-
-      <div class="form-group">
+<div layout="row" flex class="ma-party-details">
+  <div flex="33" offset="33">
+    <div class="md-content new-party-form-container">
+      <md-toolbar>
+        <div class="md-toolbar-tools">
+          <h3>Your party details:</h3>
+        </div>
+      </md-toolbar>
+      <form layout="column" *ngIf="party" (submit)="saveParty()">
+        <label>Party Name: </label>
+        <md-input [disabled]="!isOwner" [(ngModel)]="party.name" name="name"></md-input>
+        <label>Party Description</label>
+        <md-input [disabled]="!isOwner" [(ngModel)]="party.description" name="description"></md-input>
         <label>Location name</label>
-        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location.name" name="location" class="form-control">
-      </div>
-
-      <div class="form-group">
-        <button [disabled]="!isOwner" type="submit" class="btn btn-primary">Save</button>
-        <a [routerLink]="['/']" class="btn">Back</a>
-      </div>
-    </form>
+        <md-input [disabled]="!isOwner" [(ngModel)]="party.location.name" name="location"></md-input>
+        <md-checkbox [disabled]="!isOwner" [(checked)]="party.public" name="public" aria-label="Public">
+          Is public
+        </md-checkbox>
 
-    <ul class="ma-invite-list" *ngIf="isOwner || isPublic">
-      <h3>
-        Users to invite:
-      </h3>
-      <li *ngFor="let user of users | async">
-        <div>{{ user | displayName }}</div>
-        <button (click)="invite(user)" class="btn btn-primary btn-sm">Invite</button>
-      </li>
-    </ul>
-
-    <div *ngIf="isInvited">
-      <h2>Reply to the invitation</h2>
-      <input type="button" class="btn btn-primary" value="I'm going!" (click)="reply('yes')">
-      <input type="button" class="btn btn-warning" value="Maybe" (click)="reply('maybe')">
-      <input type="button" class="btn btn-danger" value="No" (click)="reply('no')">
-    </div>
+        <div layout="row" layout-align="left">
+          <button [disabled]="!isOwner" type="submit" md-raised-button class="md-raised md-primary">Save</button>
+          <a [routerLink]="['/']" md-raised-button class="md-raised">Back</a>
+        </div>
 
-    <h3 class="ma-map-title">
-      Click the map to set the party location
-    </h3>
+        <md-list>
+          <div class="md-no-sticky">Users to invite:</div>
+          <md-list-item *ngFor="let user of users | async">
+            <div>{{ user | displayName }}</div>
+            <button (click)="invite(user)" md-raised-button class="md-raised">Invite</button>
+          </md-list-item>
+        </md-list>
 
-    <div class="angular-google-map-container">
-      <sebm-google-map
-        [latitude]="lat || centerLat"
-        [longitude]="lng || centerLng"
-        [zoom]="8"
-        (mapClick)="mapClicked($event)">
-        <sebm-google-map-marker
-          *ngIf="lat && lng"
-          [latitude]="lat"
-          [longitude]="lng">
-        </sebm-google-map-marker>
-      </sebm-google-map>
+        <div class="angular-google-map-container">
+          <sebm-google-map
+            style="height: 300px;"
+            [latitude]="lat || centerLat"
+            [longitude]="lng || centerLng"
+            [zoom]="8"
+            (mapClick)="mapClicked($event)">
+            <sebm-google-map-marker
+              *ngIf="lat && lng"
+              [latitude]="lat"
+              [longitude]="lng">
+            </sebm-google-map-marker>
+          </sebm-google-map>
+        </div>
+      </form>
     </div>
   </div>
 </div>
\ No newline at end of file
-- 
2.7.4


From 7db447b72588a87683ed1c99ae6b6f512a710c8f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:34:54 +0300
Subject: [PATCH 184/292] Step 19.11: Replace login buttons with custom buttons

---
 client/imports/app/app.component.html | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index a021e59..f6c5855 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,6 +1,13 @@
 <md-toolbar color="primary">
   <a routerLink="/" class="md-title">Socially</a>
   <span class="fill-remaining-space"></span>
-  <login-buttons></login-buttons>
+  <div [hidden]="user">
+    <a md-button [routerLink]="['/login']" >Login</a>
+    <a md-button [routerLink]="['/signup']">Sign up</a>
+  </div>
+  <div [hidden]="!user">
+    <span>{{ user | displayName }}</span>
+    <button md-button (click)="logout()">Logout</button>
+  </div>
 </md-toolbar>
 <router-outlet></router-outlet>
\ No newline at end of file
-- 
2.7.4


From 41194c473a14f9f3b308faf5fe3a9e049304fcce Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:35:54 +0300
Subject: [PATCH 185/292] Step 19.12: Add auth logic to the App component

---
 client/imports/app/app.component.ts | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index 91e1a06..ba12be4 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -1,9 +1,19 @@
 import { Component } from '@angular/core';
 
 import template from './app.component.html';
+import {InjectUser} from "angular2-meteor-accounts-ui";
 
 @Component({
   selector: 'app',
   template
 })
-export class AppComponent {}
+@InjectUser('user')
+export class AppComponent {
+  constructor() {
+
+  }
+
+  logout() {
+    Meteor.logout();
+  }
+}
-- 
2.7.4


From 43be1b50f56b7a5e96721f5b8c375d968580ab60 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:46:12 +0300
Subject: [PATCH 186/292] Step 19.13: Create LoginComponent

---
 client/imports/app/auth/login.component.ts | 40 ++++++++++++++++++++++++++++++
 1 file changed, 40 insertions(+)
 create mode 100644 client/imports/app/auth/login.component.ts

diff --git a/client/imports/app/auth/login.component.ts b/client/imports/app/auth/login.component.ts
new file mode 100644
index 0000000..ed740de
--- /dev/null
+++ b/client/imports/app/auth/login.component.ts
@@ -0,0 +1,40 @@
+import {Component, OnInit, NgZone} from '@angular/core';
+import { FormBuilder, FormGroup, Validators } from '@angular/forms';
+import { Router } from '@angular/router';
+import { Meteor } from 'meteor/meteor';
+
+import template from './login.component.html';
+
+@Component({
+  selector: 'login',
+  template
+})
+export class LoginComponent implements OnInit {
+  loginForm: FormGroup;
+  error: string;
+
+  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
+
+  ngOnInit() {
+    this.loginForm = this.formBuilder.group({
+      email: ['', Validators.required],
+      password: ['', Validators.required]
+    });
+
+    this.error = '';
+  }
+
+  login() {
+    if (this.loginForm.valid) {
+      Meteor.loginWithPassword(this.loginForm.value.email, this.loginForm.value.password, (err) => {
+        if (err) {
+          this.zone.run(() => {
+            this.error = err;
+          });
+        } else {
+          this.router.navigate(['/']);
+        }
+      });
+    }
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 104d0ab95819ce1e5473f82f47b0f1f0fefa4c51 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:46:21 +0300
Subject: [PATCH 187/292] Step 19.14: Create a template for LoginComponent

---
 client/imports/app/auth/login.component.html | 37 ++++++++++++++++++++++++++++
 1 file changed, 37 insertions(+)
 create mode 100644 client/imports/app/auth/login.component.html

diff --git a/client/imports/app/auth/login.component.html b/client/imports/app/auth/login.component.html
new file mode 100644
index 0000000..04fe11c
--- /dev/null
+++ b/client/imports/app/auth/login.component.html
@@ -0,0 +1,37 @@
+<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
+  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
+    <md-toolbar class="md-primary" color="primary">
+      Sign in
+    </md-toolbar>
+
+    <div layout="column" layout-fill layout-margin layout-padding>
+      <div layout="row" layout-fill layout-margin>
+        <p class="md-body-2"> Sign in with your email</p>
+      </div>
+
+      <form [formGroup]="loginForm" #f="ngForm" (ngSubmit)="login()"
+            layout="column" layout-fill layout-padding layout-margin>
+
+        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
+        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
+
+        <div layout="row" layout-align="space-between center">
+          <a md-button [routerLink]="['/recover']">Forgot password?</a>
+          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign In</button>
+        </div>
+      </form>
+
+      <div [hidden]="error == ''">
+        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+          <p class="md-body-1">{{ error }}</p>
+        </md-toolbar>
+      </div>
+
+      <md-divider></md-divider>
+
+      <div layout="row" layout-align="center">
+        <a md-button [routerLink]="['/signup']">Need an account?</a>
+      </div>
+    </div>
+  </div>
+</div>
\ No newline at end of file
-- 
2.7.4


From 412b15a5945fb696f99c37459bed46a5689d0d7f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:46:33 +0300
Subject: [PATCH 188/292] Step 19.15: Add the login route

---
 client/imports/app/app.routes.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
index c5812a4..83e37a2 100644
--- a/client/imports/app/app.routes.ts
+++ b/client/imports/app/app.routes.ts
@@ -3,10 +3,12 @@ import { Meteor } from 'meteor/meteor';
 
 import { PartiesListComponent } from './parties/parties-list.component';
 import { PartyDetailsComponent } from './parties/party-details.component';
+import {LoginComponent} from "./auth/login.component";
 
 export const routes: Route[] = [
   { path: '', component: PartiesListComponent },
-  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] }
+  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
+  { path: 'login', component: LoginComponent }
 ];
 
 export const ROUTES_PROVIDERS = [{
-- 
2.7.4


From 3dfd670102a9fd6dab980ef75777b21cbb71a9aa Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:46:49 +0300
Subject: [PATCH 189/292] Step 19.16: Create the index file for auth component

---
 client/imports/app/auth/index.ts | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 client/imports/app/auth/index.ts

diff --git a/client/imports/app/auth/index.ts b/client/imports/app/auth/index.ts
new file mode 100644
index 0000000..c8c17d6
--- /dev/null
+++ b/client/imports/app/auth/index.ts
@@ -0,0 +1,5 @@
+import {LoginComponent} from "./login.component";
+
+export const AUTH_DECLARATIONS = [
+  LoginComponent
+];
-- 
2.7.4


From 6bdd6a41dcc6aa5b682fe8b57a41ba6834885410 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:47:01 +0300
Subject: [PATCH 190/292] Step 19.17: Updated the NgModule imports

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 2adac35..32d4df7 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -17,6 +17,7 @@ import { MdCardModule } from "@angular2-material/card";
 import { MdCoreModule } from "@angular2-material/core";
 import { MdCheckboxModule } from "@angular2-material/checkbox";
 import {MdListModule} from "@angular2-material/list";
+import {AUTH_DECLARATIONS} from "./auth/index";
 
 @NgModule({
   imports: [
@@ -40,7 +41,8 @@ import {MdListModule} from "@angular2-material/list";
   declarations: [
     AppComponent,
     ...PARTIES_DECLARATIONS,
-    ...SHARED_DECLARATIONS
+    ...SHARED_DECLARATIONS,
+    ...AUTH_DECLARATIONS
   ],
   providers: [
     ...ROUTES_PROVIDERS
-- 
2.7.4


From 4745b4b21c6d4b627285b68da2b61fa66fd59ee9 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:50:22 +0300
Subject: [PATCH 191/292] Step 19.18: Added the signup component

---
 client/imports/app/auth/singup.component.ts | 43 +++++++++++++++++++++++++++++
 1 file changed, 43 insertions(+)
 create mode 100644 client/imports/app/auth/singup.component.ts

diff --git a/client/imports/app/auth/singup.component.ts b/client/imports/app/auth/singup.component.ts
new file mode 100644
index 0000000..eed82b2
--- /dev/null
+++ b/client/imports/app/auth/singup.component.ts
@@ -0,0 +1,43 @@
+import {Component, OnInit, NgZone} from '@angular/core';
+import { FormBuilder, FormGroup, Validators } from '@angular/forms';
+import { Router } from '@angular/router';
+import { Accounts } from 'meteor/accounts-base';
+
+import template from './signup.component.html';
+
+@Component({
+  selector: 'signup',
+  template
+})
+export class SignupComponent implements OnInit {
+  signupForm: FormGroup;
+  error: string;
+
+  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
+
+  ngOnInit() {
+    this.signupForm = this.formBuilder.group({
+      email: ['', Validators.required],
+      password: ['', Validators.required]
+    });
+
+    this.error = '';
+  }
+
+  signup() {
+    if (this.signupForm.valid) {
+      Accounts.createUser({
+        email: this.signupForm.value.email,
+        password: this.signupForm.value.password
+      }, (err) => {
+        if (err) {
+          this.zone.run(() => {
+            this.error = err;
+          });
+        } else {
+          this.router.navigate(['/']);
+        }
+      });
+    }
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 903ea9bc50a3201b325339255a29b2a0910821cb Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:50:30 +0300
Subject: [PATCH 192/292] Step 19.19: Added the signup view

---
 client/imports/app/auth/signup.component.html | 32 +++++++++++++++++++++++++++
 1 file changed, 32 insertions(+)
 create mode 100644 client/imports/app/auth/signup.component.html

diff --git a/client/imports/app/auth/signup.component.html b/client/imports/app/auth/signup.component.html
new file mode 100644
index 0000000..eccbff8
--- /dev/null
+++ b/client/imports/app/auth/signup.component.html
@@ -0,0 +1,32 @@
+<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
+  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
+    <md-toolbar class="md-primary" color="primary">
+      Sign up
+    </md-toolbar>
+
+    <div layout="column" layout-fill layout-margin layout-padding>
+      <form [formGroup]="signupForm" #f="ngForm" (ngSubmit)="signup()"
+            layout="column" layout-fill layout-padding layout-margin>
+
+        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
+        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
+
+        <div layout="row" layout-align="space-between center">
+          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign Up</button>
+        </div>
+      </form>
+
+      <div [hidden]="error == ''">
+        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+          <p class="md-body-1">{{ error }}</p>
+        </md-toolbar>
+      </div>
+
+      <md-divider></md-divider>
+
+      <div layout="row" layout-align="center">
+        <a md-button [routerLink]="['/login']">Already a user?</a>
+      </div>
+    </div>
+  </div>
+</div>
\ No newline at end of file
-- 
2.7.4


From 4fe1bd74d417dec7b2a88aa1f03d1f43f934f60c Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:50:49 +0300
Subject: [PATCH 193/292] Step 19.20: Added signup component to the index file

---
 client/imports/app/auth/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/auth/index.ts b/client/imports/app/auth/index.ts
index c8c17d6..fa4ee3e 100644
--- a/client/imports/app/auth/index.ts
+++ b/client/imports/app/auth/index.ts
@@ -1,5 +1,7 @@
 import {LoginComponent} from "./login.component";
+import {SignupComponent} from "./singup.component";
 
 export const AUTH_DECLARATIONS = [
-  LoginComponent
+  LoginComponent,
+  SignupComponent
 ];
-- 
2.7.4


From 6b8c63eccacd2ad2124ed3756d54760a91b3c017 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:51:05 +0300
Subject: [PATCH 194/292] Step 19.21: Added signup route

---
 client/imports/app/app.routes.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
index 83e37a2..d9ad40c 100644
--- a/client/imports/app/app.routes.ts
+++ b/client/imports/app/app.routes.ts
@@ -4,11 +4,13 @@ import { Meteor } from 'meteor/meteor';
 import { PartiesListComponent } from './parties/parties-list.component';
 import { PartyDetailsComponent } from './parties/party-details.component';
 import {LoginComponent} from "./auth/login.component";
+import {SignupComponent} from "./auth/singup.component";
 
 export const routes: Route[] = [
   { path: '', component: PartiesListComponent },
   { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
-  { path: 'login', component: LoginComponent }
+  { path: 'login', component: LoginComponent },
+  { path: 'signup', component: SignupComponent }
 ];
 
 export const ROUTES_PROVIDERS = [{
-- 
2.7.4


From c3312b23be9465105405f3602aa24e527e22f701 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:53:55 +0300
Subject: [PATCH 195/292] Step 19.22: Create the recover component

---
 client/imports/app/auth/recover.component.ts | 41 ++++++++++++++++++++++++++++
 1 file changed, 41 insertions(+)
 create mode 100644 client/imports/app/auth/recover.component.ts

diff --git a/client/imports/app/auth/recover.component.ts b/client/imports/app/auth/recover.component.ts
new file mode 100644
index 0000000..6b520c6
--- /dev/null
+++ b/client/imports/app/auth/recover.component.ts
@@ -0,0 +1,41 @@
+import {Component, OnInit, NgZone} from '@angular/core';
+import { FormBuilder, FormGroup, Validators } from '@angular/forms';
+import { Router } from '@angular/router';
+import { Accounts } from 'meteor/accounts-base';
+
+import template from './recover.component.html';
+
+@Component({
+  selector: 'recover',
+  template
+})
+export class RecoverComponent implements OnInit {
+  recoverForm: FormGroup;
+  error: string;
+
+  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
+
+  ngOnInit() {
+    this.recoverForm = this.formBuilder.group({
+      email: ['', Validators.required]
+    });
+
+    this.error = '';
+  }
+
+  recover() {
+    if (this.recoverForm.valid) {
+      Accounts.forgotPassword({
+        email: this.recoverForm.value.email
+      }, (err) => {
+        if (err) {
+          this.zone.run(() => {
+            this.error = err;
+          });
+        } else {
+          this.router.navigate(['/']);
+        }
+      });
+    }
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 7d56d5ad7fe6ed853e27fdbcc5b590c5a6edb309 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:54:00 +0300
Subject: [PATCH 196/292] Step 19.23: Create the recover component view

---
 client/imports/app/auth/recover.component.html | 31 ++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)
 create mode 100644 client/imports/app/auth/recover.component.html

diff --git a/client/imports/app/auth/recover.component.html b/client/imports/app/auth/recover.component.html
new file mode 100644
index 0000000..192629d
--- /dev/null
+++ b/client/imports/app/auth/recover.component.html
@@ -0,0 +1,31 @@
+<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
+  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
+    <md-toolbar class="md-primary" color="primary">
+      Recover Your Password
+    </md-toolbar>
+
+    <div layout="column" layout-fill layout-margin layout-padding>
+      <form [formGroup]="recoverForm" #f="ngForm" (ngSubmit)="recover()"
+            layout="column" layout-fill layout-padding layout-margin>
+
+        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
+
+        <div layout="row" layout-align="space-between center">
+          <button md-raised-button class="md-primary" type="submit" aria-label="Recover">Recover</button>
+        </div>
+      </form>
+
+      <div [hidden]="error == ''">
+        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+          <p class="md-body-1">{{ error }}</p>
+        </md-toolbar>
+      </div>
+
+      <md-divider></md-divider>
+
+      <div layout="row" layout-align="center">
+        <a md-button [routerLink]="['/login']">Remember your password?</a>
+      </div>
+    </div>
+  </div>
+</divt>
\ No newline at end of file
-- 
2.7.4


From 24ac324547857e1fde3d9362f9eff2776654e8da Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:54:09 +0300
Subject: [PATCH 197/292] Step 19.24: Added the recover component to the index
 file

---
 client/imports/app/auth/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/auth/index.ts b/client/imports/app/auth/index.ts
index fa4ee3e..7e5754e 100644
--- a/client/imports/app/auth/index.ts
+++ b/client/imports/app/auth/index.ts
@@ -1,7 +1,9 @@
 import {LoginComponent} from "./login.component";
 import {SignupComponent} from "./singup.component";
+import {RecoverComponent} from "./recover.component";
 
 export const AUTH_DECLARATIONS = [
   LoginComponent,
-  SignupComponent
+  SignupComponent,
+  RecoverComponent
 ];
-- 
2.7.4


From d04d49adfe671ec84f7c7d011235df4ec70f4c8e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:54:19 +0300
Subject: [PATCH 198/292] Step 19.25: Added the recover route

---
 client/imports/app/app.routes.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
index d9ad40c..efefd60 100644
--- a/client/imports/app/app.routes.ts
+++ b/client/imports/app/app.routes.ts
@@ -5,12 +5,14 @@ import { PartiesListComponent } from './parties/parties-list.component';
 import { PartyDetailsComponent } from './parties/party-details.component';
 import {LoginComponent} from "./auth/login.component";
 import {SignupComponent} from "./auth/singup.component";
+import {RecoverComponent} from "./auth/recover.component";
 
 export const routes: Route[] = [
   { path: '', component: PartiesListComponent },
   { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
   { path: 'login', component: LoginComponent },
-  { path: 'signup', component: SignupComponent }
+  { path: 'signup', component: SignupComponent },
+  { path: 'recover', component: RecoverComponent }
 ];
 
 export const ROUTES_PROVIDERS = [{
-- 
2.7.4


From 33601935f9fc32e48015ad361af2000a71043f57 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 15:57:30 -0200
Subject: [PATCH 199/292] Step 19: angular-material and custom Angular auth
 forms

---
 steps/step19.md | 1213 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 1213 insertions(+)
 create mode 100644 steps/step19.md

diff --git a/steps/step19.md b/steps/step19.md
new file mode 100644
index 0000000..8890e75
--- /dev/null
+++ b/steps/step19.md
@@ -0,0 +1,1213 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# angular-material and custom Angular auth forms
+
+In this chapter we will add angular2-material to our project, and update some style and layout in the project.
+
+Angular2-material documentation of each component can be found [here](https://github.com/angular/material2/tree/master/src/components).
+
+# Removing Bootstrap 4
+
+First, let's remove our previous framework (Bootstrap) by running:
+
+    $ meteor npm uninstall --save bootstrap
+
+And let's remove the import from the `main.sass` file:
+
+[{]: <helper> (diff_step 19.2)
+#### Step 19.25: Added the recover route
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -5,12 +5,14 @@
+ ┊ 5┊ 5┊import { PartyDetailsComponent } from './parties/party-details.component';
+ ┊ 6┊ 6┊import {LoginComponent} from "./auth/login.component";
+ ┊ 7┊ 7┊import {SignupComponent} from "./auth/singup.component";
++┊  ┊ 8┊import {RecoverComponent} from "./auth/recover.component";
+ ┊ 8┊ 9┊
+ ┊ 9┊10┊export const routes: Route[] = [
+ ┊10┊11┊  { path: '', component: PartiesListComponent },
+ ┊11┊12┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
+ ┊12┊13┊  { path: 'login', component: LoginComponent },
+-┊13┊  ┊  { path: 'signup', component: SignupComponent }
++┊  ┊14┊  { path: 'signup', component: SignupComponent },
++┊  ┊15┊  { path: 'recover', component: RecoverComponent }
+ ┊14┊16┊];
+ ┊15┊17┊
+ ┊16┊18┊export const ROUTES_PROVIDERS = [{
+```
+[}]: #
+
+# Adding angular2-material
+
+Now we need to add angular2-material to our project - so let's do that.
+
+Run the following command in your Terminal:
+
+    $ meteor npm install @angular2-material/core @angular2-material/button @angular2-material/card @angular2-material/checkbox @angular2-material/input @angular2-material/list @angular2-material/toolbar --save
+
+We installed:
+
+- core package
+- button
+- card
+- checkbox
+- input
+- toolbar
+- list
+
+Now let's load the modules into our `NgModule`:
+
+[{]: <helper> (diff_step 19.4)
+#### Step 19.4: Imported the angular2-material modules
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -10,6 +10,13 @@
+ ┊10┊10┊import { routes, ROUTES_PROVIDERS } from './app.routes';
+ ┊11┊11┊import { PARTIES_DECLARATIONS } from './parties';
+ ┊12┊12┊import { SHARED_DECLARATIONS } from './shared';
++┊  ┊13┊import { MdButtonModule } from "@angular2-material/button";
++┊  ┊14┊import { MdToolbarModule } from "@angular2-material/toolbar";
++┊  ┊15┊import { MdInputModule } from "@angular2-material/input";
++┊  ┊16┊import { MdCardModule } from "@angular2-material/card";
++┊  ┊17┊import { MdCoreModule } from "@angular2-material/core";
++┊  ┊18┊import { MdCheckboxModule } from "@angular2-material/checkbox";
++┊  ┊19┊import {MdListModule} from "@angular2-material/list";
+ ┊13┊20┊
+ ┊14┊21┊@NgModule({
+ ┊15┊22┊  imports: [
+```
+```diff
+@@ -21,7 +28,14 @@
+ ┊21┊28┊    Ng2PaginationModule,
+ ┊22┊29┊    AgmCoreModule.forRoot({
+ ┊23┊30┊      apiKey: 'AIzaSyAWoBdZHCNh5R-hB5S5ZZ2oeoYyfdDgniA'
+-┊24┊  ┊    })
++┊  ┊31┊    }),
++┊  ┊32┊    MdCoreModule.forRoot(),
++┊  ┊33┊    MdButtonModule.forRoot(),
++┊  ┊34┊    MdToolbarModule.forRoot(),
++┊  ┊35┊    MdInputModule.forRoot(),
++┊  ┊36┊    MdCardModule.forRoot(),
++┊  ┊37┊    MdCheckboxModule.forRoot(),
++┊  ┊38┊    MdListModule.forRoot()
+ ┊25┊39┊  ],
+ ┊26┊40┊  declarations: [
+ ┊27┊41┊    AppComponent,
+```
+[}]: #
+
+Like we did in the previous chapter - let's take care of the navigation bar first.
+
+We use directives and components from Angular2-Material - such as `md-toolbar`.
+
+Let's use it in the main component's template:
+
+[{]: <helper> (diff_step 19.5)
+#### Step 19.5: Change the nav bar and the layout
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,7 +1,6 @@
+-┊1┊ ┊<nav class="navbar navbar-light bg-faded">
+-┊2┊ ┊  <a class="navbar-brand" href="#">Socially</a>
+-┊3┊ ┊  <login-buttons class="pull-right"></login-buttons>
+-┊4┊ ┊</nav>
+-┊5┊ ┊<div class="container-fluid">
+-┊6┊ ┊  <router-outlet></router-outlet>
+-┊7┊ ┊</div>🚫↵
++┊ ┊1┊<md-toolbar color="primary">
++┊ ┊2┊  <a routerLink="/" class="md-title">Socially</a>
++┊ ┊3┊  <span class="fill-remaining-space"></span>
++┊ ┊4┊  <login-buttons></login-buttons>
++┊ ┊5┊</md-toolbar>
++┊ ┊6┊<router-outlet></router-outlet>🚫↵
+```
+[}]: #
+
+And let's add `.fill-remaining-space` CSS class:
+
+[{]: <helper> (diff_step 19.6)
+#### Step 19.6: Added the missing css
+
+##### Changed client/main.scss
+```diff
+@@ -8,6 +8,10 @@
+ ┊ 8┊ 8┊$color6 : #2F2933;
+ ┊ 9┊ 9┊$color7 : #FF6F69;
+ ┊10┊10┊
++┊  ┊11┊.fill-remaining-space {
++┊  ┊12┊  flex: 1 1 auto;
++┊  ┊13┊}
++┊  ┊14┊
+ ┊11┊15┊html, body {
+ ┊12┊16┊  height: 100%;
+ ┊13┊17┊}
+```
+[}]: #
+
+# PartiesForm component
+
+Let's replace the `label` and the `input` with simply the `md-input` and `md-checkbox` and make the `button` look material:
+
+[{]: <helper> (diff_step 19.7)
+#### Step 19.7: Update the view of the parties form
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -1,21 +1,13 @@
+-┊ 1┊  ┊<form [formGroup]="addForm" (ngSubmit)="addParty()" class="form-inline">
++┊  ┊ 1┊<form [formGroup]="addForm" (ngSubmit)="addParty()">
+ ┊ 2┊ 2┊  <fieldset class="form-group">
+-┊ 3┊  ┊    <label for="partyName">Party name</label>
+-┊ 4┊  ┊    <input id="partyName" class="form-control" type="text" formControlName="name" placeholder="Party name" />
+-┊ 5┊  ┊
+-┊ 6┊  ┊    <label for="description">Description</label>
+-┊ 7┊  ┊    <input id="description" class="form-control" type="text" formControlName="description" placeholder="Description">
+-┊ 8┊  ┊
+-┊ 9┊  ┊    <label for="location_name">Location</label>
+-┊10┊  ┊    <input id="location_name" class="form-control" type="text" formControlName="location" placeholder="Location name">
++┊  ┊ 3┊    <md-input formControlName="name" placeholder="Party name"></md-input>
++┊  ┊ 4┊    <md-input formControlName="description" placeholder="Description"></md-input>
++┊  ┊ 5┊    <md-input formControlName="location" placeholder="Location name"></md-input>
+ ┊11┊ 6┊
+ ┊12┊ 7┊    <div class="checkbox">
+-┊13┊  ┊      <label>
+-┊14┊  ┊        <input type="checkbox" formControlName="public">
+-┊15┊  ┊        Public
+-┊16┊  ┊      </label>
++┊  ┊ 8┊      <md-checkbox formControlName="public">Public</md-checkbox>
+ ┊17┊ 9┊    </div>
+ ┊18┊10┊
+-┊19┊  ┊    <button type="submit" class="btn btn-primary">Add</button>
++┊  ┊11┊    <button md-raised-button type="submit">Add</button>
+ ┊20┊12┊  </fieldset>
+-┊21┊  ┊</form>
++┊  ┊13┊</form>🚫↵
+```
+[}]: #
+
+We use the `mdInput` component which is a wrapper for regular HTML input with style and cool layout.
+
+# PartiesList component
+
+PartiesForm component is done, so we can move one level higher in the component's tree. Time for the list of parties:
+
+[{]: <helper> (diff_step 19.8)
+#### Step 19.8: Change the layout of the parties list
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -1,88 +1,65 @@
+-┊ 1┊  ┊<div class="row">
+-┊ 2┊  ┊  <div class="col-md-12">
+-┊ 3┊  ┊    <div class="jumbotron">
+-┊ 4┊  ┊      <h3>Create a new party!</h3>
+-┊ 5┊  ┊      <parties-form [hidden]="!user"></parties-form>
+-┊ 6┊  ┊      <div [hidden]="user">You need to login to create new parties!</div>
+-┊ 7┊  ┊    </div>
+-┊ 8┊  ┊  </div>
+-┊ 9┊  ┊</div>
+-┊10┊  ┊<div class="row ma-filters">
+-┊11┊  ┊  <div class="col-md-6">
+-┊12┊  ┊    <h3>All Parties:</h3>
+-┊13┊  ┊    <form class="form-inline">
+-┊14┊  ┊      <input type="text" class="form-control" #searchtext placeholder="Search by Location">
+-┊15┊  ┊      <button type="button" class="btn btn-primary" (click)="search(searchtext.value)">Search</button>
+-┊16┊  ┊      Sort by name: <select class="form-control" #sort (change)="changeSortOrder(sort.value)">
+-┊17┊  ┊      <option value="1" selected>Ascending</option>
+-┊18┊  ┊      <option value="-1">Descending</option>
+-┊19┊  ┊    </select>
+-┊20┊  ┊    </form>
+-┊21┊  ┊  </div>
+-┊22┊  ┊</div>
+-┊23┊  ┊<div class="row">
+-┊24┊  ┊  <div class="col-md-6">
+-┊25┊  ┊    <ul class="list-group">
+-┊26┊  ┊      <li class="list-group-item">
+-┊27┊  ┊        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
+-┊28┊  ┊      </li>
+-┊29┊  ┊      <li *ngFor="let party of parties | async"
+-┊30┊  ┊          class="list-group-item ma-party-item">
+-┊31┊  ┊        <div class="row">
+-┊32┊  ┊          <div class="col-sm-8">
+-┊33┊  ┊            <h2 class="ma-party-name">
+-┊34┊  ┊              <a [routerLink]="['/party', party._id]">undefined</a>
+-┊35┊  ┊            </h2>
+-┊36┊  ┊            @ undefined
+-┊37┊  ┊            <p class="ma-party-description">
+-┊38┊  ┊              undefined
+-┊39┊  ┊            </p>
+-┊40┊  ┊          </div>
+-┊41┊  ┊          <div class="col-sm-4">
+-┊42┊  ┊            <button class="btn btn-danger pull-right" [hidden]="!isOwner(party)" (click)="removeParty(party)"><i
+-┊43┊  ┊              class="fa fa-times"></i></button>
+-┊44┊  ┊          </div>
++┊  ┊ 1┊<div flex layout="row" class="div ma-parties-list">
++┊  ┊ 2┊  <div layout="row" flex>
++┊  ┊ 3┊    <div flex="50">
++┊  ┊ 4┊      <div>
++┊  ┊ 5┊        <div class="div new-party-form-container">
++┊  ┊ 6┊          <md-toolbar>
++┊  ┊ 7┊            <div class="md-toolbar-tools">
++┊  ┊ 8┊              <h3>Create a new party!</h3>
++┊  ┊ 9┊            </div>
++┊  ┊10┊          </md-toolbar>
++┊  ┊11┊          <parties-form [hidden]="!user"></parties-form>
++┊  ┊12┊          <div [hidden]="user">You need to login to create new parties!</div>
+ ┊45┊13┊        </div>
+-┊46┊  ┊        <div class="row ma-party-item-bottom">
+-┊47┊  ┊          <div class="col-sm-4">
+-┊48┊  ┊            <div class="ma-rsvp-sum">
+-┊49┊  ┊              <div class="ma-rsvp-amount">
+-┊50┊  ┊                <div class="ma-amount">
+-┊51┊  ┊                  undefined
+-┊52┊  ┊                </div>
+-┊53┊  ┊                <div class="ma-rsvp-title">
+-┊54┊  ┊                  YES
+-┊55┊  ┊                </div>
+-┊56┊  ┊              </div>
+-┊57┊  ┊              <div class="ma-rsvp-amount">
+-┊58┊  ┊                <div class="ma-amount">
+-┊59┊  ┊                  undefined
+-┊60┊  ┊                </div>
+-┊61┊  ┊                <div class="ma-rsvp-title">
+-┊62┊  ┊                  MAYBE
+-┊63┊  ┊                </div>
+-┊64┊  ┊              </div>
+-┊65┊  ┊              <div class="ma-rsvp-amount">
+-┊66┊  ┊                <div class="ma-amount">
+-┊67┊  ┊                  undefined
+-┊68┊  ┊                </div>
+-┊69┊  ┊                <div class="ma-rsvp-title">
+-┊70┊  ┊                  NO
++┊  ┊14┊        <div layout-padding layout="row">
++┊  ┊15┊          <md-input #searchtext placeholder="Search by Location"></md-input>
++┊  ┊16┊        </div>
++┊  ┊17┊        <div layout-padding layout="row">
++┊  ┊18┊          Sort by name:
++┊  ┊19┊          <select class="form-control" #sort (change)="changeSortOrder(sort.value)">
++┊  ┊20┊            <option value="1" selected>Ascending</option>
++┊  ┊21┊            <option value="-1">Descending</option>
++┊  ┊22┊          </select>
++┊  ┊23┊        </div>
++┊  ┊24┊
++┊  ┊25┊        <div class="div md-padding" style="padding-top:0;">
++┊  ┊26┊          <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
++┊  ┊27┊          <div *ngFor="let party of parties | async">
++┊  ┊28┊            <md-card>
++┊  ┊29┊              <md-card-content>
++┊  ┊30┊                <h2 class="md-title ma-name">
++┊  ┊31┊                  <a [routerLink]="['/party', party._id]">undefined</a>
++┊  ┊32┊                </h2>
++┊  ┊33┊                <p class="ma-description" style="padding:0 10px;margin-bottom:35px;margin-top: 6px;">
++┊  ┊34┊                  undefined
++┊  ┊35┊                </p>
++┊  ┊36┊                <div layout="row">
++┊  ┊37┊                  <div layout="row" layout-align="end end">
++┊  ┊38┊                    <div>
++┊  ┊39┊                      <div class="rsvps-sum">
++┊  ┊40┊                        <div class="rsvps-amount">undefined</div>
++┊  ┊41┊                        <div class="rsvps-title">Yes</div>
++┊  ┊42┊                      </div>
++┊  ┊43┊                      <div class="rsvps-sum">
++┊  ┊44┊                        <div class="rsvps-amount">undefined</div>
++┊  ┊45┊                        <div class="rsvps-title">Maybe</div>
++┊  ┊46┊                      </div>
++┊  ┊47┊                      <div class="rsvps-sum">
++┊  ┊48┊                        <div class="rsvps-amount">undefined</div>
++┊  ┊49┊                        <div class="rsvps-title">No</div>
++┊  ┊50┊                      </div>
++┊  ┊51┊                    </div>
++┊  ┊52┊                  </div>
+ ┊71┊53┊                </div>
+-┊72┊  ┊              </div>
+-┊73┊  ┊            </div>
++┊  ┊54┊              </md-card-content>
++┊  ┊55┊            </md-card>
+ ┊74┊56┊          </div>
+ ┊75┊57┊        </div>
+-┊76┊  ┊      </li>
+-┊77┊  ┊      <li class="list-group-item">
+-┊78┊  ┊        <pagination-controls (pageChange)="onPageChanged($event)"></pagination-controls>
+-┊79┊  ┊      </li>
+-┊80┊  ┊    </ul>
+-┊81┊  ┊  </div>
+-┊82┊  ┊  <div class="col-md-6">
+-┊83┊  ┊    <ul class="list-group">
+-┊84┊  ┊      <li class="list-group-item">
++┊  ┊58┊      </div>
++┊  ┊59┊      <div flex="50" layout="row" style="min-height:300px;">
+ ┊85┊60┊        <sebm-google-map
++┊  ┊61┊          style="width: 100%; min-height:300px;"
++┊  ┊62┊          flex layout="row"
+ ┊86┊63┊          [latitude]="0"
+ ┊87┊64┊          [longitude]="0"
+ ┊88┊65┊          [zoom]="1">
+```
+```diff
+@@ -94,7 +71,7 @@
+ ┊ 94┊ 71┊            </sebm-google-map-marker>
+ ┊ 95┊ 72┊          </div>
+ ┊ 96┊ 73┊        </sebm-google-map>
+-┊ 97┊   ┊      </li>
+-┊ 98┊   ┊    </ul>
++┊   ┊ 74┊      </div>
++┊   ┊ 75┊    </div>
+ ┊ 99┊ 76┊  </div>
+ ┊100┊ 77┊</div>🚫↵
+```
+[}]: #
+
+To make it all look so much better, let's add couple of rules to css:
+
+[{]: <helper> (diff_step 19.9)
+#### Step 19.9: Add some style to the parties list
+
+##### Changed client/imports/app/parties/parties-list.component.scss
+```diff
+@@ -1,125 +1,61 @@
+-┊  1┊   ┊.ma-add-button-container {
+-┊  2┊   ┊  button.btn {
+-┊  3┊   ┊    background: $color3;
+-┊  4┊   ┊    float: right;
+-┊  5┊   ┊    margin-right: 5px;
+-┊  6┊   ┊    outline: none;
+-┊  7┊   ┊    i {
+-┊  8┊   ┊      color: $color5;
+-┊  9┊   ┊    }
+-┊ 10┊   ┊  }
+-┊ 11┊   ┊}
+-┊ 12┊   ┊
+-┊ 13┊   ┊.ma-parties-col {
+-┊ 14┊   ┊  padding-top: 20px;
+-┊ 15┊   ┊}
+-┊ 16┊   ┊
+-┊ 17┊   ┊.ma-filters {
+-┊ 18┊   ┊  margin-bottom: 10px;
++┊   ┊  1┊.new-party-form-container {
++┊   ┊  2┊  margin: 20px;
++┊   ┊  3┊  border: 1px gainsboro solid;
+ ┊ 19┊  4┊}
+-┊ 20┊   ┊
+-┊ 21┊   ┊.ma-party-item {
+-┊ 22┊   ┊  .ma-party-name {
+-┊ 23┊   ┊    margin-bottom: 20px;
+-┊ 24┊   ┊    a {
+-┊ 25┊   ┊      color: $color6;
+-┊ 26┊   ┊      text-decoration: none !important;
+-┊ 27┊   ┊      font-weight: 400;
+-┊ 28┊   ┊    }
++┊   ┊  5┊.ma-parties-list {
++┊   ┊  6┊  .sebm-google-map {
++┊   ┊  7┊    box-sizing: border-box;
++┊   ┊  8┊    -webkit-flex: 1;
++┊   ┊  9┊    -ms-flex: 1;
++┊   ┊ 10┊    flex: 1;
++┊   ┊ 11┊    -webkit-flex-direction: row;
++┊   ┊ 12┊    -ms-flex-direction: row;
++┊   ┊ 13┊    flex-direction: row;
++┊   ┊ 14┊    box-sizing: border-box;
++┊   ┊ 15┊    display: -webkit-flex;
++┊   ┊ 16┊    display: -ms-flexbox;
++┊   ┊ 17┊    display: flex;
+ ┊ 29┊ 18┊  }
+-┊ 30┊   ┊  .ma-party-description {
+-┊ 31┊   ┊    color: $color6;
+-┊ 32┊   ┊    font-weight: 300;
+-┊ 33┊   ┊    padding-left: 18px;
+-┊ 34┊   ┊    font-size: 14px;
++┊   ┊ 19┊
++┊   ┊ 20┊  .angular-google-map-container {
++┊   ┊ 21┊    box-sizing: border-box;
++┊   ┊ 22┊    -webkit-flex: 1;
++┊   ┊ 23┊    -ms-flex: 1;
++┊   ┊ 24┊    flex: 1;
+ ┊ 35┊ 25┊  }
+ ┊ 36┊ 26┊
+-┊ 37┊   ┊  .ma-remove {
+-┊ 38┊   ┊    color: lighten($color7, 20%);
+-┊ 39┊   ┊    position: absolute;
+-┊ 40┊   ┊    right: 20px;
+-┊ 41┊   ┊    top: 20px;
+-┊ 42┊   ┊    &:hover {
+-┊ 43┊   ┊      color: $color7;
++┊   ┊ 27┊  .rsvps-sum {
++┊   ┊ 28┊    display: inline-block;
++┊   ┊ 29┊    width: 50px;
++┊   ┊ 30┊    text-align: center;
++┊   ┊ 31┊    .rsvps-amount {
++┊   ┊ 32┊      font-size: 24px;
++┊   ┊ 33┊    }
++┊   ┊ 34┊    .rsvps-title {
++┊   ┊ 35┊      font-size: 13px;
++┊   ┊ 36┊      color: #aaa;
+ ┊ 44┊ 37┊    }
+ ┊ 45┊ 38┊  }
+ ┊ 46┊ 39┊
+-┊ 47┊   ┊  .ma-party-item-bottom {
+-┊ 48┊   ┊    padding-top: 10px;
+-┊ 49┊   ┊    .ma-posted-by-col {
+-┊ 50┊   ┊      .ma-posted-by {
+-┊ 51┊   ┊        color: darken($color4, 30%);
+-┊ 52┊   ┊        font-size: 12px;
+-┊ 53┊   ┊      }
+-┊ 54┊   ┊      .ma-everyone-invited {
+-┊ 55┊   ┊        @media (max-width: 400px) {
+-┊ 56┊   ┊          display: block;
+-┊ 57┊   ┊          i {
+-┊ 58┊   ┊            margin-left: 0px !important;
+-┊ 59┊   ┊          }
+-┊ 60┊   ┊        }
+-┊ 61┊   ┊        font-size: 12px;
+-┊ 62┊   ┊        color: darken($color4, 10%);
+-┊ 63┊   ┊        i {
+-┊ 64┊   ┊          color: darken($color4, 10%);
+-┊ 65┊   ┊          margin-left: 5px;
+-┊ 66┊   ┊        }
+-┊ 67┊   ┊      }
++┊   ┊ 40┊  .ma-party {
++┊   ┊ 41┊    .party-image {
++┊   ┊ 42┊      background-size: cover;
++┊   ┊ 43┊      width: 100%;
++┊   ┊ 44┊      height: 200px;
+ ┊ 68┊ 45┊    }
+ ┊ 69┊ 46┊
+-┊ 70┊   ┊    .ma-rsvp-buttons {
+-┊ 71┊   ┊      input.btn {
+-┊ 72┊   ┊        color: darken($color3, 20%);
+-┊ 73┊   ┊        background: transparent !important;
+-┊ 74┊   ┊        outline: none;
+-┊ 75┊   ┊        padding-left: 0;
+-┊ 76┊   ┊        &:active {
+-┊ 77┊   ┊          box-shadow: none;
+-┊ 78┊   ┊        }
+-┊ 79┊   ┊        &:hover {
+-┊ 80┊   ┊          color: darken($color3, 30%);
+-┊ 81┊   ┊        }
+-┊ 82┊   ┊        &.btn-primary {
+-┊ 83┊   ┊          color: lighten($color3, 10%);
+-┊ 84┊   ┊          border: 0;
+-┊ 85┊   ┊          background: transparent !important;
+-┊ 86┊   ┊        }
++┊   ┊ 47┊    .ma-name {
++┊   ┊ 48┊      a {
++┊   ┊ 49┊        text-decoration: none;
++┊   ┊ 50┊        color: #333;
+ ┊ 87┊ 51┊      }
+ ┊ 88┊ 52┊    }
++┊   ┊ 53┊    .ma-description {
+ ┊ 89┊ 54┊
+-┊ 90┊   ┊    .ma-rsvp-sum {
+-┊ 91┊   ┊      width: 160px;
+-┊ 92┊   ┊      @media (min-width: 400px) {
+-┊ 93┊   ┊        float: right;
+-┊ 94┊   ┊      }
+-┊ 95┊   ┊      @media (max-width: 400px) {
+-┊ 96┊   ┊        margin: 0 auto;
+-┊ 97┊   ┊      }
+-┊ 98┊   ┊    }
+-┊ 99┊   ┊    .ma-rsvp-amount {
+-┊100┊   ┊      display: inline-block;
+-┊101┊   ┊      text-align: center;
+-┊102┊   ┊      width: 50px;
+-┊103┊   ┊      .ma-amount {
+-┊104┊   ┊        font-weight: bold;
+-┊105┊   ┊        font-size: 20px;
+-┊106┊   ┊      }
+-┊107┊   ┊      .ma-rsvp-title {
+-┊108┊   ┊        font-size: 11px;
+-┊109┊   ┊        color: #aaa;
+-┊110┊   ┊        text-transform: uppercase;
+-┊111┊   ┊      }
+ ┊112┊ 55┊    }
+ ┊113┊ 56┊  }
+ ┊114┊ 57┊}
+ ┊115┊ 58┊
+-┊116┊   ┊.ma-angular-map-col {
+-┊117┊   ┊  .angular-google-map-container, .angular-google-map {
+-┊118┊   ┊    height: 100%;
+-┊119┊   ┊    width: 100%;
+-┊120┊   ┊  }
+-┊121┊   ┊}
+-┊122┊   ┊
+ ┊123┊ 59┊.search-form {
+ ┊124┊ 60┊  margin-bottom: 1em;
+ ┊125┊ 61┊}🚫↵
+```
+[}]: #
+
+# PartyDetails component
+
+We also need to update the PartyDetails component:
+
+[{]: <helper> (diff_step 19.10)
+#### Step 19.10: Update the layout of the party details
+
+##### Changed client/imports/app/parties/party-details.component.html
+```diff
+@@ -1,61 +1,50 @@
+-┊ 1┊  ┊<div class="row ma-party-details-container">
+-┊ 2┊  ┊  <div class="col-sm-6 col-sm-offset-3">
+-┊ 3┊  ┊    <legend>View and Edit Your Party Details:</legend>
+-┊ 4┊  ┊    <form class="form-horizontal" *ngIf="party" (submit)="saveParty()">
+-┊ 5┊  ┊      <div class="form-group">
+-┊ 6┊  ┊        <label>Party Name</label>
+-┊ 7┊  ┊        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name" name="name" class="form-control">
+-┊ 8┊  ┊      </div>
+-┊ 9┊  ┊
+-┊10┊  ┊      <div class="form-group">
+-┊11┊  ┊        <label>Description</label>
+-┊12┊  ┊        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description" name="description" class="form-control">
+-┊13┊  ┊      </div>
+-┊14┊  ┊
+-┊15┊  ┊      <div class="form-group">
++┊  ┊ 1┊<div layout="row" flex class="ma-party-details">
++┊  ┊ 2┊  <div flex="33" offset="33">
++┊  ┊ 3┊    <div class="md-content new-party-form-container">
++┊  ┊ 4┊      <md-toolbar>
++┊  ┊ 5┊        <div class="md-toolbar-tools">
++┊  ┊ 6┊          <h3>Your party details:</h3>
++┊  ┊ 7┊        </div>
++┊  ┊ 8┊      </md-toolbar>
++┊  ┊ 9┊      <form layout="column" *ngIf="party" (submit)="saveParty()">
++┊  ┊10┊        <label>Party Name: </label>
++┊  ┊11┊        <md-input [disabled]="!isOwner" [(ngModel)]="party.name" name="name"></md-input>
++┊  ┊12┊        <label>Party Description</label>
++┊  ┊13┊        <md-input [disabled]="!isOwner" [(ngModel)]="party.description" name="description"></md-input>
+ ┊16┊14┊        <label>Location name</label>
+-┊17┊  ┊        <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location.name" name="location" class="form-control">
+-┊18┊  ┊      </div>
+-┊19┊  ┊
+-┊20┊  ┊      <div class="form-group">
+-┊21┊  ┊        <button [disabled]="!isOwner" type="submit" class="btn btn-primary">Save</button>
+-┊22┊  ┊        <a [routerLink]="['/']" class="btn">Back</a>
+-┊23┊  ┊      </div>
+-┊24┊  ┊    </form>
++┊  ┊15┊        <md-input [disabled]="!isOwner" [(ngModel)]="party.location.name" name="location"></md-input>
++┊  ┊16┊        <md-checkbox [disabled]="!isOwner" [(checked)]="party.public" name="public" aria-label="Public">
++┊  ┊17┊          Is public
++┊  ┊18┊        </md-checkbox>
+ ┊25┊19┊
+-┊26┊  ┊    <ul class="ma-invite-list" *ngIf="isOwner || isPublic">
+-┊27┊  ┊      <h3>
+-┊28┊  ┊        Users to invite:
+-┊29┊  ┊      </h3>
+-┊30┊  ┊      <li *ngFor="let user of users | async">
+-┊31┊  ┊        <div>undefined</div>
+-┊32┊  ┊        <button (click)="invite(user)" class="btn btn-primary btn-sm">Invite</button>
+-┊33┊  ┊      </li>
+-┊34┊  ┊    </ul>
+-┊35┊  ┊
+-┊36┊  ┊    <div *ngIf="isInvited">
+-┊37┊  ┊      <h2>Reply to the invitation</h2>
+-┊38┊  ┊      <input type="button" class="btn btn-primary" value="I'm going!" (click)="reply('yes')">
+-┊39┊  ┊      <input type="button" class="btn btn-warning" value="Maybe" (click)="reply('maybe')">
+-┊40┊  ┊      <input type="button" class="btn btn-danger" value="No" (click)="reply('no')">
+-┊41┊  ┊    </div>
++┊  ┊20┊        <div layout="row" layout-align="left">
++┊  ┊21┊          <button [disabled]="!isOwner" type="submit" md-raised-button class="md-raised md-primary">Save</button>
++┊  ┊22┊          <a [routerLink]="['/']" md-raised-button class="md-raised">Back</a>
++┊  ┊23┊        </div>
+ ┊42┊24┊
+-┊43┊  ┊    <h3 class="ma-map-title">
+-┊44┊  ┊      Click the map to set the party location
+-┊45┊  ┊    </h3>
++┊  ┊25┊        <md-list>
++┊  ┊26┊          <div class="md-no-sticky">Users to invite:</div>
++┊  ┊27┊          <md-list-item *ngFor="let user of users | async">
++┊  ┊28┊            <div>undefined</div>
++┊  ┊29┊            <button (click)="invite(user)" md-raised-button class="md-raised">Invite</button>
++┊  ┊30┊          </md-list-item>
++┊  ┊31┊        </md-list>
+ ┊46┊32┊
+-┊47┊  ┊    <div class="angular-google-map-container">
+-┊48┊  ┊      <sebm-google-map
+-┊49┊  ┊        [latitude]="lat || centerLat"
+-┊50┊  ┊        [longitude]="lng || centerLng"
+-┊51┊  ┊        [zoom]="8"
+-┊52┊  ┊        (mapClick)="mapClicked($event)">
+-┊53┊  ┊        <sebm-google-map-marker
+-┊54┊  ┊          *ngIf="lat && lng"
+-┊55┊  ┊          [latitude]="lat"
+-┊56┊  ┊          [longitude]="lng">
+-┊57┊  ┊        </sebm-google-map-marker>
+-┊58┊  ┊      </sebm-google-map>
++┊  ┊33┊        <div class="angular-google-map-container">
++┊  ┊34┊          <sebm-google-map
++┊  ┊35┊            style="height: 300px;"
++┊  ┊36┊            [latitude]="lat || centerLat"
++┊  ┊37┊            [longitude]="lng || centerLng"
++┊  ┊38┊            [zoom]="8"
++┊  ┊39┊            (mapClick)="mapClicked($event)">
++┊  ┊40┊            <sebm-google-map-marker
++┊  ┊41┊              *ngIf="lat && lng"
++┊  ┊42┊              [latitude]="lat"
++┊  ┊43┊              [longitude]="lng">
++┊  ┊44┊            </sebm-google-map-marker>
++┊  ┊45┊          </sebm-google-map>
++┊  ┊46┊        </div>
++┊  ┊47┊      </form>
+ ┊59┊48┊    </div>
+ ┊60┊49┊  </div>
+ ┊61┊50┊</div>🚫↵
+```
+[}]: #
+
+# Custom Authentication Components
+
+Our next step will replace the `login-buttons` which is a simple and non-styled login/signup component - we will add our custom authentication component with custom style.
+
+First, let's remove the login-buttons from the navigation bar, and replace it with custom buttons for Login / Signup / Logout.
+
+We will also add `routerLink` to each button, and add logic to hide/show buttons according to the user's login state:
+
+[{]: <helper> (diff_step 19.11)
+#### Step 19.11: Replace login buttons with custom buttons
+
+##### Changed client/imports/app/app.component.html
+```diff
+@@ -1,6 +1,13 @@
+ ┊ 1┊ 1┊<md-toolbar color="primary">
+ ┊ 2┊ 2┊  <a routerLink="/" class="md-title">Socially</a>
+ ┊ 3┊ 3┊  <span class="fill-remaining-space"></span>
+-┊ 4┊  ┊  <login-buttons></login-buttons>
++┊  ┊ 4┊  <div [hidden]="user">
++┊  ┊ 5┊    <a md-button [routerLink]="['/login']" >Login</a>
++┊  ┊ 6┊    <a md-button [routerLink]="['/signup']">Sign up</a>
++┊  ┊ 7┊  </div>
++┊  ┊ 8┊  <div [hidden]="!user">
++┊  ┊ 9┊    <span>undefined</span>
++┊  ┊10┊    <button md-button (click)="logout()">Logout</button>
++┊  ┊11┊  </div>
+ ┊ 5┊12┊</md-toolbar>
+ ┊ 6┊13┊<router-outlet></router-outlet>🚫↵
+```
+[}]: #
+
+Let's use `InjectUser` decorator, just like we did in one of the previous chapters.
+
+[{]: <helper> (diff_step 19.12)
+#### Step 19.12: Add auth logic to the App component
+
+##### Changed client/imports/app/app.component.ts
+```diff
+@@ -1,9 +1,19 @@
+ ┊ 1┊ 1┊import { Component } from '@angular/core';
+ ┊ 2┊ 2┊
+ ┊ 3┊ 3┊import template from './app.component.html';
++┊  ┊ 4┊import {InjectUser} from "angular2-meteor-accounts-ui";
+ ┊ 4┊ 5┊
+ ┊ 5┊ 6┊@Component({
+ ┊ 6┊ 7┊  selector: 'app',
+ ┊ 7┊ 8┊  template
+ ┊ 8┊ 9┊})
+-┊ 9┊  ┊export class AppComponent {}
++┊  ┊10┊@InjectUser('user')
++┊  ┊11┊export class AppComponent {
++┊  ┊12┊  constructor() {
++┊  ┊13┊
++┊  ┊14┊  }
++┊  ┊15┊
++┊  ┊16┊  logout() {
++┊  ┊17┊    Meteor.logout();
++┊  ┊18┊  }
++┊  ┊19┊}
+```
+[}]: #
+
+As you can see, we used `DisplayNamePipe` in the view so we have to import it.
+
+We also implemented `logout()` method with `Meteor.logout()`. It is, like you probably guessed, to log out the current user.
+
+Now we can move on to create three new components.
+
+### Login component
+
+First component, is to log in user to the app.
+
+We will need a form and the login method, so let's implement them:
+
+[{]: <helper> (diff_step 19.13)
+#### Step 19.13: Create LoginComponent
+
+##### Added client/imports/app/auth/login.component.ts
+```diff
+@@ -0,0 +1,40 @@
++┊  ┊ 1┊import {Component, OnInit, NgZone} from '@angular/core';
++┊  ┊ 2┊import { FormBuilder, FormGroup, Validators } from '@angular/forms';
++┊  ┊ 3┊import { Router } from '@angular/router';
++┊  ┊ 4┊import { Meteor } from 'meteor/meteor';
++┊  ┊ 5┊
++┊  ┊ 6┊import template from './login.component.html';
++┊  ┊ 7┊
++┊  ┊ 8┊@Component({
++┊  ┊ 9┊  selector: 'login',
++┊  ┊10┊  template
++┊  ┊11┊})
++┊  ┊12┊export class LoginComponent implements OnInit {
++┊  ┊13┊  loginForm: FormGroup;
++┊  ┊14┊  error: string;
++┊  ┊15┊
++┊  ┊16┊  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
++┊  ┊17┊
++┊  ┊18┊  ngOnInit() {
++┊  ┊19┊    this.loginForm = this.formBuilder.group({
++┊  ┊20┊      email: ['', Validators.required],
++┊  ┊21┊      password: ['', Validators.required]
++┊  ┊22┊    });
++┊  ┊23┊
++┊  ┊24┊    this.error = '';
++┊  ┊25┊  }
++┊  ┊26┊
++┊  ┊27┊  login() {
++┊  ┊28┊    if (this.loginForm.valid) {
++┊  ┊29┊      Meteor.loginWithPassword(this.loginForm.value.email, this.loginForm.value.password, (err) => {
++┊  ┊30┊        if (err) {
++┊  ┊31┊          this.zone.run(() => {
++┊  ┊32┊            this.error = err;
++┊  ┊33┊          });
++┊  ┊34┊        } else {
++┊  ┊35┊          this.router.navigate(['/']);
++┊  ┊36┊        }
++┊  ┊37┊      });
++┊  ┊38┊    }
++┊  ┊39┊  }
++┊  ┊40┊}🚫↵
+```
+[}]: #
+
+> Notice that we used `NgZone` in our constructor in order to get it from the Dependency Injection, and we used it before we update the result of the login action - we need to do this because the Meteor world does not update Angular's world, and we need to tell Angular when to update the view since the async result of the login action comes from Meteor's context.
+
+You previously created a form by yourself so there's no need to explain the whole process once again.
+
+About the login method.
+
+Meteor's accounts system has a method called `loginWithPassword`, you can read more about it [here](http://docs.meteor.com/api/accounts.html#Meteor-loginWithPassword).
+
+We need to provide two values, a email and a password. We could get them from the form.
+
+In the callback of Meteor.loginWithPassword's method, we have the redirection to the homepage on success and we're saving the error message if login process failed.
+
+Let's add the view:
+
+[{]: <helper> (diff_step 19.14)
+#### Step 19.14: Create a template for LoginComponent
+
+##### Added client/imports/app/auth/login.component.html
+```diff
+@@ -0,0 +1,37 @@
++┊  ┊ 1┊<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
++┊  ┊ 2┊  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
++┊  ┊ 3┊    <md-toolbar class="md-primary" color="primary">
++┊  ┊ 4┊      Sign in
++┊  ┊ 5┊    </md-toolbar>
++┊  ┊ 6┊
++┊  ┊ 7┊    <div layout="column" layout-fill layout-margin layout-padding>
++┊  ┊ 8┊      <div layout="row" layout-fill layout-margin>
++┊  ┊ 9┊        <p class="md-body-2"> Sign in with your email</p>
++┊  ┊10┊      </div>
++┊  ┊11┊
++┊  ┊12┊      <form [formGroup]="loginForm" #f="ngForm" (ngSubmit)="login()"
++┊  ┊13┊            layout="column" layout-fill layout-padding layout-margin>
++┊  ┊14┊
++┊  ┊15┊        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
++┊  ┊16┊        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
++┊  ┊17┊
++┊  ┊18┊        <div layout="row" layout-align="space-between center">
++┊  ┊19┊          <a md-button [routerLink]="['/recover']">Forgot password?</a>
++┊  ┊20┊          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign In</button>
++┊  ┊21┊        </div>
++┊  ┊22┊      </form>
++┊  ┊23┊
++┊  ┊24┊      <div [hidden]="error == ''">
++┊  ┊25┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
++┊  ┊26┊          <p class="md-body-1">undefined</p>
++┊  ┊27┊        </md-toolbar>
++┊  ┊28┊      </div>
++┊  ┊29┊
++┊  ┊30┊      <md-divider></md-divider>
++┊  ┊31┊
++┊  ┊32┊      <div layout="row" layout-align="center">
++┊  ┊33┊        <a md-button [routerLink]="['/signup']">Need an account?</a>
++┊  ┊34┊      </div>
++┊  ┊35┊    </div>
++┊  ┊36┊  </div>
++┊  ┊37┊</div>🚫↵
+```
+[}]: #
+
+We also need to define the `/login` route:
+
+[{]: <helper> (diff_step 19.15)
+#### Step 19.15: Add the login route
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -3,10 +3,12 @@
+ ┊ 3┊ 3┊
+ ┊ 4┊ 4┊import { PartiesListComponent } from './parties/parties-list.component';
+ ┊ 5┊ 5┊import { PartyDetailsComponent } from './parties/party-details.component';
++┊  ┊ 6┊import {LoginComponent} from "./auth/login.component";
+ ┊ 6┊ 7┊
+ ┊ 7┊ 8┊export const routes: Route[] = [
+ ┊ 8┊ 9┊  { path: '', component: PartiesListComponent },
+-┊ 9┊  ┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] }
++┊  ┊10┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
++┊  ┊11┊  { path: 'login', component: LoginComponent }
+ ┊10┊12┊];
+ ┊11┊13┊
+ ┊12┊14┊export const ROUTES_PROVIDERS = [{
+```
+[}]: #
+
+And now let's create an index file for the auth files:
+
+[{]: <helper> (diff_step 19.16)
+#### Step 19.16: Create the index file for auth component
+
+##### Added client/imports/app/auth/index.ts
+```diff
+@@ -0,0 +1,5 @@
++┊ ┊1┊import {LoginComponent} from "./login.component";
++┊ ┊2┊
++┊ ┊3┊export const AUTH_DECLARATIONS = [
++┊ ┊4┊  LoginComponent
++┊ ┊5┊];
+```
+[}]: #
+
+And import the exposed Array into the `NgModule`:
+
+[{]: <helper> (diff_step 19.17)
+#### Step 19.17: Updated the NgModule imports
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -17,6 +17,7 @@
+ ┊17┊17┊import { MdCoreModule } from "@angular2-material/core";
+ ┊18┊18┊import { MdCheckboxModule } from "@angular2-material/checkbox";
+ ┊19┊19┊import {MdListModule} from "@angular2-material/list";
++┊  ┊20┊import {AUTH_DECLARATIONS} from "./auth/index";
+ ┊20┊21┊
+ ┊21┊22┊@NgModule({
+ ┊22┊23┊  imports: [
+```
+```diff
+@@ -40,7 +41,8 @@
+ ┊40┊41┊  declarations: [
+ ┊41┊42┊    AppComponent,
+ ┊42┊43┊    ...PARTIES_DECLARATIONS,
+-┊43┊  ┊    ...SHARED_DECLARATIONS
++┊  ┊44┊    ...SHARED_DECLARATIONS,
++┊  ┊45┊    ...AUTH_DECLARATIONS
+ ┊44┊46┊  ],
+ ┊45┊47┊  providers: [
+ ┊46┊48┊    ...ROUTES_PROVIDERS
+```
+[}]: #
+
+### Signup component
+
+The Signup component looks pretty much the same as the Login component. We just use different method, `Accounts.createUser()`. Here's [the link](http://docs.meteor.com/api/passwords.html#Accounts-createUser) to the documentation.
+
+[{]: <helper> (diff_step 19.18)
+#### Step 19.18: Added the signup component
+
+##### Added client/imports/app/auth/singup.component.ts
+```diff
+@@ -0,0 +1,43 @@
++┊  ┊ 1┊import {Component, OnInit, NgZone} from '@angular/core';
++┊  ┊ 2┊import { FormBuilder, FormGroup, Validators } from '@angular/forms';
++┊  ┊ 3┊import { Router } from '@angular/router';
++┊  ┊ 4┊import { Accounts } from 'meteor/accounts-base';
++┊  ┊ 5┊
++┊  ┊ 6┊import template from './signup.component.html';
++┊  ┊ 7┊
++┊  ┊ 8┊@Component({
++┊  ┊ 9┊  selector: 'signup',
++┊  ┊10┊  template
++┊  ┊11┊})
++┊  ┊12┊export class SignupComponent implements OnInit {
++┊  ┊13┊  signupForm: FormGroup;
++┊  ┊14┊  error: string;
++┊  ┊15┊
++┊  ┊16┊  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
++┊  ┊17┊
++┊  ┊18┊  ngOnInit() {
++┊  ┊19┊    this.signupForm = this.formBuilder.group({
++┊  ┊20┊      email: ['', Validators.required],
++┊  ┊21┊      password: ['', Validators.required]
++┊  ┊22┊    });
++┊  ┊23┊
++┊  ┊24┊    this.error = '';
++┊  ┊25┊  }
++┊  ┊26┊
++┊  ┊27┊  signup() {
++┊  ┊28┊    if (this.signupForm.valid) {
++┊  ┊29┊      Accounts.createUser({
++┊  ┊30┊        email: this.signupForm.value.email,
++┊  ┊31┊        password: this.signupForm.value.password
++┊  ┊32┊      }, (err) => {
++┊  ┊33┊        if (err) {
++┊  ┊34┊          this.zone.run(() => {
++┊  ┊35┊            this.error = err;
++┊  ┊36┊          });
++┊  ┊37┊        } else {
++┊  ┊38┊          this.router.navigate(['/']);
++┊  ┊39┊        }
++┊  ┊40┊      });
++┊  ┊41┊    }
++┊  ┊42┊  }
++┊  ┊43┊}🚫↵
+```
+[}]: #
+
+And the view:
+
+[{]: <helper> (diff_step 19.19)
+#### Step 19.19: Added the signup view
+
+##### Added client/imports/app/auth/signup.component.html
+```diff
+@@ -0,0 +1,32 @@
++┊  ┊ 1┊<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
++┊  ┊ 2┊  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
++┊  ┊ 3┊    <md-toolbar class="md-primary" color="primary">
++┊  ┊ 4┊      Sign up
++┊  ┊ 5┊    </md-toolbar>
++┊  ┊ 6┊
++┊  ┊ 7┊    <div layout="column" layout-fill layout-margin layout-padding>
++┊  ┊ 8┊      <form [formGroup]="signupForm" #f="ngForm" (ngSubmit)="signup()"
++┊  ┊ 9┊            layout="column" layout-fill layout-padding layout-margin>
++┊  ┊10┊
++┊  ┊11┊        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
++┊  ┊12┊        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
++┊  ┊13┊
++┊  ┊14┊        <div layout="row" layout-align="space-between center">
++┊  ┊15┊          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign Up</button>
++┊  ┊16┊        </div>
++┊  ┊17┊      </form>
++┊  ┊18┊
++┊  ┊19┊      <div [hidden]="error == ''">
++┊  ┊20┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
++┊  ┊21┊          <p class="md-body-1">undefined</p>
++┊  ┊22┊        </md-toolbar>
++┊  ┊23┊      </div>
++┊  ┊24┊
++┊  ┊25┊      <md-divider></md-divider>
++┊  ┊26┊
++┊  ┊27┊      <div layout="row" layout-align="center">
++┊  ┊28┊        <a md-button [routerLink]="['/login']">Already a user?</a>
++┊  ┊29┊      </div>
++┊  ┊30┊    </div>
++┊  ┊31┊  </div>
++┊  ┊32┊</div>🚫↵
+```
+[}]: #
+
+And add it to the index file:
+
+[{]: <helper> (diff_step 19.20)
+#### Step 19.20: Added signup component to the index file
+
+##### Changed client/imports/app/auth/index.ts
+```diff
+@@ -1,5 +1,7 @@
+ ┊1┊1┊import {LoginComponent} from "./login.component";
++┊ ┊2┊import {SignupComponent} from "./singup.component";
+ ┊2┊3┊
+ ┊3┊4┊export const AUTH_DECLARATIONS = [
+-┊4┊ ┊  LoginComponent
++┊ ┊5┊  LoginComponent,
++┊ ┊6┊  SignupComponent
+ ┊5┊7┊];
+```
+[}]: #
+
+And the `/signup` route:
+
+[{]: <helper> (diff_step 19.21)
+#### Step 19.21: Added signup route
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -4,11 +4,13 @@
+ ┊ 4┊ 4┊import { PartiesListComponent } from './parties/parties-list.component';
+ ┊ 5┊ 5┊import { PartyDetailsComponent } from './parties/party-details.component';
+ ┊ 6┊ 6┊import {LoginComponent} from "./auth/login.component";
++┊  ┊ 7┊import {SignupComponent} from "./auth/singup.component";
+ ┊ 7┊ 8┊
+ ┊ 8┊ 9┊export const routes: Route[] = [
+ ┊ 9┊10┊  { path: '', component: PartiesListComponent },
+ ┊10┊11┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
+-┊11┊  ┊  { path: 'login', component: LoginComponent }
++┊  ┊12┊  { path: 'login', component: LoginComponent },
++┊  ┊13┊  { path: 'signup', component: SignupComponent }
+ ┊12┊14┊];
+ ┊13┊15┊
+ ┊14┊16┊export const ROUTES_PROVIDERS = [{
+```
+[}]: #
+
+### Recover component
+
+This component is helfup when a user forgets his password. We'll use `Accounts.forgotPassword` method:
+
+[{]: <helper> (diff_step 19.22)
+#### Step 19.22: Create the recover component
+
+##### Added client/imports/app/auth/recover.component.ts
+```diff
+@@ -0,0 +1,41 @@
++┊  ┊ 1┊import {Component, OnInit, NgZone} from '@angular/core';
++┊  ┊ 2┊import { FormBuilder, FormGroup, Validators } from '@angular/forms';
++┊  ┊ 3┊import { Router } from '@angular/router';
++┊  ┊ 4┊import { Accounts } from 'meteor/accounts-base';
++┊  ┊ 5┊
++┊  ┊ 6┊import template from './recover.component.html';
++┊  ┊ 7┊
++┊  ┊ 8┊@Component({
++┊  ┊ 9┊  selector: 'recover',
++┊  ┊10┊  template
++┊  ┊11┊})
++┊  ┊12┊export class RecoverComponent implements OnInit {
++┊  ┊13┊  recoverForm: FormGroup;
++┊  ┊14┊  error: string;
++┊  ┊15┊
++┊  ┊16┊  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
++┊  ┊17┊
++┊  ┊18┊  ngOnInit() {
++┊  ┊19┊    this.recoverForm = this.formBuilder.group({
++┊  ┊20┊      email: ['', Validators.required]
++┊  ┊21┊    });
++┊  ┊22┊
++┊  ┊23┊    this.error = '';
++┊  ┊24┊  }
++┊  ┊25┊
++┊  ┊26┊  recover() {
++┊  ┊27┊    if (this.recoverForm.valid) {
++┊  ┊28┊      Accounts.forgotPassword({
++┊  ┊29┊        email: this.recoverForm.value.email
++┊  ┊30┊      }, (err) => {
++┊  ┊31┊        if (err) {
++┊  ┊32┊          this.zone.run(() => {
++┊  ┊33┊            this.error = err;
++┊  ┊34┊          });
++┊  ┊35┊        } else {
++┊  ┊36┊          this.router.navigate(['/']);
++┊  ┊37┊        }
++┊  ┊38┊      });
++┊  ┊39┊    }
++┊  ┊40┊  }
++┊  ┊41┊}🚫↵
+```
+[}]: #
+
+Create the view:
+
+[{]: <helper> (diff_step 19.23)
+#### Step 19.23: Create the recover component view
+
+##### Added client/imports/app/auth/recover.component.html
+```diff
+@@ -0,0 +1,31 @@
++┊  ┊ 1┊<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
++┊  ┊ 2┊  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
++┊  ┊ 3┊    <md-toolbar class="md-primary" color="primary">
++┊  ┊ 4┊      Recover Your Password
++┊  ┊ 5┊    </md-toolbar>
++┊  ┊ 6┊
++┊  ┊ 7┊    <div layout="column" layout-fill layout-margin layout-padding>
++┊  ┊ 8┊      <form [formGroup]="recoverForm" #f="ngForm" (ngSubmit)="recover()"
++┊  ┊ 9┊            layout="column" layout-fill layout-padding layout-margin>
++┊  ┊10┊
++┊  ┊11┊        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
++┊  ┊12┊
++┊  ┊13┊        <div layout="row" layout-align="space-between center">
++┊  ┊14┊          <button md-raised-button class="md-primary" type="submit" aria-label="Recover">Recover</button>
++┊  ┊15┊        </div>
++┊  ┊16┊      </form>
++┊  ┊17┊
++┊  ┊18┊      <div [hidden]="error == ''">
++┊  ┊19┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
++┊  ┊20┊          <p class="md-body-1">undefined</p>
++┊  ┊21┊        </md-toolbar>
++┊  ┊22┊      </div>
++┊  ┊23┊
++┊  ┊24┊      <md-divider></md-divider>
++┊  ┊25┊
++┊  ┊26┊      <div layout="row" layout-align="center">
++┊  ┊27┊        <a md-button [routerLink]="['/login']">Remember your password?</a>
++┊  ┊28┊      </div>
++┊  ┊29┊    </div>
++┊  ┊30┊  </div>
++┊  ┊31┊</divt>🚫↵
+```
+[}]: #
+
+And add it to the index file:
+
+[{]: <helper> (diff_step 19.24)
+#### Step 19.24: Added the recover component to the index file
+
+##### Changed client/imports/app/auth/index.ts
+```diff
+@@ -1,7 +1,9 @@
+ ┊1┊1┊import {LoginComponent} from "./login.component";
+ ┊2┊2┊import {SignupComponent} from "./singup.component";
++┊ ┊3┊import {RecoverComponent} from "./recover.component";
+ ┊3┊4┊
+ ┊4┊5┊export const AUTH_DECLARATIONS = [
+ ┊5┊6┊  LoginComponent,
+-┊6┊ ┊  SignupComponent
++┊ ┊7┊  SignupComponent,
++┊ ┊8┊  RecoverComponent
+ ┊7┊9┊];
+```
+[}]: #
+
+And add the `/reset` route:
+
+[{]: <helper> (diff_step 19.25)
+#### Step 19.25: Added the recover route
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -5,12 +5,14 @@
+ ┊ 5┊ 5┊import { PartyDetailsComponent } from './parties/party-details.component';
+ ┊ 6┊ 6┊import {LoginComponent} from "./auth/login.component";
+ ┊ 7┊ 7┊import {SignupComponent} from "./auth/singup.component";
++┊  ┊ 8┊import {RecoverComponent} from "./auth/recover.component";
+ ┊ 8┊ 9┊
+ ┊ 9┊10┊export const routes: Route[] = [
+ ┊10┊11┊  { path: '', component: PartiesListComponent },
+ ┊11┊12┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
+ ┊12┊13┊  { path: 'login', component: LoginComponent },
+-┊13┊  ┊  { path: 'signup', component: SignupComponent }
++┊  ┊14┊  { path: 'signup', component: SignupComponent },
++┊  ┊15┊  { path: 'recover', component: RecoverComponent }
+ ┊14┊16┊];
+ ┊15┊17┊
+ ┊16┊18┊export const ROUTES_PROVIDERS = [{
+```
+[}]: #
+
+That's it! we just implemented our own authentication components using Meteor's Accounts API and Angular2-Material!
+
+# Summary
+
+In this chapter we replaced Boostrap4 with Angular2-Material, and updated all the view and layout to match the component we got from it.
+
+We also learnt how to use Meteor's Accounts API and how to implement authentication view and components, and how to connect them to our app.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step18.md) | [Next Step >](step20.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 3a288d8041b30f56cea2d8ba371823724ad8421a Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 16:00:25 -0200
Subject: [PATCH 200/292] Step 20: 3rdParty Libraries

---
 steps/step20.md | 99 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 99 insertions(+)
 create mode 100644 steps/step20.md

diff --git a/steps/step20.md b/steps/step20.md
new file mode 100644
index 0000000..d98912a
--- /dev/null
+++ b/steps/step20.md
@@ -0,0 +1,99 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# 3rdParty Libraries
+
+This part of the tutorial will cover the usage of third-party libraries with angular2-meteor.
+
+Parts of this tutorial are also relevant for users who uses only Meteor, without angular2-meteor, because the solution for third-party libraries comes from Meteor packaging manager - **Atmosphere**.
+
+With release of Meteor 1.3 it is also possible to use **NPM**! It opens a lot of new opportunities. In fact, if it possible you should always use packages from NPM instead of Atmosphere.
+
+In this part of the tutorial we will show multiple solution for the same problem - using third-party libraries with Meteor and angular2-meteor.
+
+
+Every Angular 2 developer knows and uses third-party libraries, but because we do not have the ability to easily include the ".js" file on our "head" tag - we need another solutions.
+
+# NPM
+
+To use third-party libraries in your Meteor project - you can easily use
+
+    meteor npm install PACKAGE_NAME --save
+
+command to add the new package.
+
+For example, in order to use **[ng2-pagination](https://www.npmjs.com/package/ng2-pagination)** in your project, easily run this command:
+
+    meteor npm install ng2-pagination --save
+
+You need to import the external module into your own `NgModule`, like we did in the previous steps.
+
+And then just use the ng2-pagination on your angular2-meteor project:
+
+```js
+import {
+  Component,
+} from '@angular/core';
+
+import {
+  PaginatePipe,
+  PaginationControlsCmp,
+  PaginationService,
+} from 'ng2-pagination';
+
+@Component({
+  selector: 'my-component',
+  template: `
+    <ul>
+      <li *ngFor="let item of collection | paginate: { itemsPerPage: 10, currentPage: p }"> ... </li>
+    </ul>
+
+    <pagination-controls (pageChange)="p = $event"></pagination-controls>
+  `
+})
+export class MyComponent {
+  public collection: any[] = someArrayOfThings;  
+}
+
+```
+
+# Atmosphere
+
+In order to add third-party libraries to your Meteor project - you can use the `meteor add PACKAGE_NAME` command to add the package.
+
+Also, for **most** of the Angular 2 third-party libraries - there's already a Meteor package (which is an equivalent to bower or NPM).
+
+You can search for those packages using the [Atmosphere](https://atmospherejs.com/) website.
+
+But as we said before, the most recommended practice is to use a package from NPM, instead of its equivalent in Atmopshere which in the most cases is just a wrapper package.
+
+For example, in order to use **[ng2-pagination](https://atmospherejs.com/barbatus/ng2-pagination)** in your project, easily run this command:
+
+```
+meteor add barbatus:ng2-pagination
+```
+
+And then just use the ng2-pagination on your angular2-meteor project:
+
+```js
+import {
+  PaginatePipe,
+  PaginationControlsCmp,
+  PaginationService,
+} from 'meteor/barbatus:ng2-pagination';
+```
+
+# More about packages
+
+Atmosphere packages has few advantages over node modules. The most important one is that you cannot specify in node module which files should be on the client-side and which will be used on the server-side. You can always create two packages with -client and -server suffixes.
+
+We recommend you to read more about packages in [Meteor Docs](http://docs.meteor.com/#/full/packagejs).
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step19.md) | [Next Step >](step21.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 54a511e6a99b704fcbfa6d543a8939fb2a42846a Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:57:57 +0300
Subject: [PATCH 201/292] Step 21.1: Added jalik:ufs and jalik:ufs-gridfs

---
 .meteor/packages | 2 ++
 .meteor/versions | 3 +++
 2 files changed, 5 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 6c5c67f..2d94ff6 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -25,3 +25,5 @@ accounts-password
 tmeasday:publish-counts
 check
 email
+jalik:ufs
+jalik:ufs-gridfs
diff --git a/.meteor/versions b/.meteor/versions
index f90fa45..c3f660f 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -42,11 +42,14 @@ htmljs@1.0.11
 http@1.1.8
 hwillson:stub-collections@1.0.1
 id-map@1.0.8
+jalik:ufs@0.6.9_1
+jalik:ufs-gridfs@0.1.2
 jquery@1.11.9
 launch-screen@1.0.12
 livedata@1.0.18
 localstorage@1.0.11
 logging@1.1.15
+matb33:collection-hooks@0.7.15
 meteor@1.2.17
 meteor-base@1.0.4
 minifier-css@1.2.14
-- 
2.7.4


From 7fb45638d2873d831fa09b2ef7d9a2ea8cf1e901 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:59:30 +0300
Subject: [PATCH 202/292] Step 21.2: Create Images and Thumbs collections

---
 both/collections/images.collection.ts | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)
 create mode 100644 both/collections/images.collection.ts

diff --git a/both/collections/images.collection.ts b/both/collections/images.collection.ts
new file mode 100644
index 0000000..b4b56a7
--- /dev/null
+++ b/both/collections/images.collection.ts
@@ -0,0 +1,21 @@
+import { MongoObservable } from 'meteor-rxjs';
+import { Meteor } from 'meteor/meteor';
+
+export const Images = new MongoObservable.Collection('images');
+export const Thumbs = new MongoObservable.Collection('thumbs');
+
+function loggedIn(userId) {
+  return !!userId;
+}
+
+Thumbs.collection.allow({
+  insert: loggedIn,
+  update: loggedIn,
+  remove: loggedIn
+});
+
+Images.collection.allow({
+  insert: loggedIn,
+  update: loggedIn,
+  remove: loggedIn
+});
\ No newline at end of file
-- 
2.7.4


From e0fc83f1d98974381bdff7412fccbabbb4a8a225 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 13:59:58 +0300
Subject: [PATCH 203/292] Step 21.3: Define Image interface

---
 both/models/image.model.ts | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 both/models/image.model.ts

diff --git a/both/models/image.model.ts b/both/models/image.model.ts
new file mode 100644
index 0000000..c4918e1
--- /dev/null
+++ b/both/models/image.model.ts
@@ -0,0 +1,15 @@
+export interface Image {
+  _id?: string;
+  complete: boolean;
+  extension: string;
+  name: string;
+  progress: number;
+  size: number;
+  store: string;
+  token: string;
+  type: string;
+  uploadedAt: Date;
+  uploading: boolean;
+  url: string;
+  userId?: string;
+}
\ No newline at end of file
-- 
2.7.4


From d2f9233645bacabe2a9d02c0fe45f084ec8c56dd Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:00:20 +0300
Subject: [PATCH 204/292] Step 21.4: Define Thumbs interface

---
 both/models/image.model.ts | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/both/models/image.model.ts b/both/models/image.model.ts
index c4918e1..9464d8a 100644
--- a/both/models/image.model.ts
+++ b/both/models/image.model.ts
@@ -12,4 +12,9 @@ export interface Image {
   uploading: boolean;
   url: string;
   userId?: string;
+}
+
+export interface Thumb extends Image  {
+  originalStore?: string;
+  originalId?: string;
 }
\ No newline at end of file
-- 
2.7.4


From 2ac4c0462ee34a5c93faaa8a2587316b401a6acc Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:00:46 +0300
Subject: [PATCH 205/292] Step 21.5: Add interfaces to Mongo Collections

---
 both/collections/images.collection.ts | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/both/collections/images.collection.ts b/both/collections/images.collection.ts
index b4b56a7..29844fd 100644
--- a/both/collections/images.collection.ts
+++ b/both/collections/images.collection.ts
@@ -1,8 +1,9 @@
 import { MongoObservable } from 'meteor-rxjs';
 import { Meteor } from 'meteor/meteor';
+import {Thumb, Image} from "../models/image.model";
 
-export const Images = new MongoObservable.Collection('images');
-export const Thumbs = new MongoObservable.Collection('thumbs');
+export const Images = new MongoObservable.Collection<Image>('images');
+export const Thumbs = new MongoObservable.Collection<Thumb>('thumbs');
 
 function loggedIn(userId) {
   return !!userId;
-- 
2.7.4


From e0dc0382158b9bf239c9c3ccd5db4ae2edd3786a Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:01:42 +0300
Subject: [PATCH 206/292] Step 21.6: Create stores for Images and Thumbs

---
 both/collections/images.collection.ts | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/both/collections/images.collection.ts b/both/collections/images.collection.ts
index 29844fd..d40cdee 100644
--- a/both/collections/images.collection.ts
+++ b/both/collections/images.collection.ts
@@ -1,10 +1,27 @@
 import { MongoObservable } from 'meteor-rxjs';
 import { Meteor } from 'meteor/meteor';
 import {Thumb, Image} from "../models/image.model";
+import { UploadFS } from 'meteor/jalik:ufs';
 
 export const Images = new MongoObservable.Collection<Image>('images');
 export const Thumbs = new MongoObservable.Collection<Thumb>('thumbs');
 
+export const ThumbsStore = new UploadFS.store.GridFS({
+  collection: Thumbs.collection,
+  name: 'thumbs'
+});
+
+export const ImagesStore = new UploadFS.store.GridFS({
+  collection: Images.collection,
+  name: 'images',
+  filter: new UploadFS.Filter({
+    contentTypes: ['image/*']
+  }),
+  copyTo: [
+    ThumbsStore
+  ]
+});
+
 function loggedIn(userId) {
   return !!userId;
 }
-- 
2.7.4


From 63dc24d3a6ca82e971a8a72ffebe851fe94b9c50 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:02:18 +0300
Subject: [PATCH 207/292] Step 21.7: Resize images

---
 both/collections/images.collection.ts | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/both/collections/images.collection.ts b/both/collections/images.collection.ts
index d40cdee..259aa85 100644
--- a/both/collections/images.collection.ts
+++ b/both/collections/images.collection.ts
@@ -8,7 +8,19 @@ export const Thumbs = new MongoObservable.Collection<Thumb>('thumbs');
 
 export const ThumbsStore = new UploadFS.store.GridFS({
   collection: Thumbs.collection,
-  name: 'thumbs'
+  name: 'thumbs',
+  transformWrite(from, to, fileId, file) {
+    // Resize to 32x32
+    const gm = require('gm');
+
+    gm(from, file.name)
+      .resize(32, 32)
+      .gravity('Center')
+      .extent(32, 32)
+      .quality(75)
+      .stream()
+      .pipe(to);
+  }
 });
 
 export const ImagesStore = new UploadFS.store.GridFS({
-- 
2.7.4


From 0f49b79a410e3f00c1f9ccf7c13f37d46b926c5d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:02:54 +0300
Subject: [PATCH 208/292] Step 21.8: Install gm

---
 package.json | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/package.json b/package.json
index f04c79f..a491878 100644
--- a/package.json
+++ b/package.json
@@ -34,11 +34,13 @@
     "angular2-meteor-accounts-ui": "0.8.0",
     "angular2-meteor-polyfills": "^0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
+    "gm": "^1.23.0",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
     "ng2-pagination": "0.4.1",
     "reflect-metadata": "^0.1.8",
     "rxjs": "5.0.0-beta.12",
+    "spawn-sync": "^1.0.15",
     "zone.js": "0.6.21"
   },
   "devDependencies": {
-- 
2.7.4


From 1bdee921981e821ef8ca98c82acb50ba86648ccb Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:24:07 +0300
Subject: [PATCH 209/292] Step 21.9: Install angular2-file-drop

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index a491878..bbac80b 100644
--- a/package.json
+++ b/package.json
@@ -29,6 +29,7 @@
     "@angular2-material/input": "2.0.0-alpha.8-2",
     "@angular2-material/list": "2.0.0-alpha.8-2",
     "@angular2-material/toolbar": "2.0.0-alpha.8-2",
+    "angular2-file-drop": "github:dotansimha/angular2-file-drop#a3569f1abdb6c61739d93456758479901bc41557",
     "angular2-google-maps": "0.15.0",
     "angular2-meteor": "0.7.0",
     "angular2-meteor-accounts-ui": "0.8.0",
-- 
2.7.4


From 4ebcddb9d8b8b943a2818e5cd7d6c4914db4e18c Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:24:19 +0300
Subject: [PATCH 210/292] Step 21.10: Include file drop module

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 32d4df7..7faa03b 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -18,6 +18,7 @@ import { MdCoreModule } from "@angular2-material/core";
 import { MdCheckboxModule } from "@angular2-material/checkbox";
 import {MdListModule} from "@angular2-material/list";
 import {AUTH_DECLARATIONS} from "./auth/index";
+import {FileDropModule} from "angular2-file-drop";
 
 @NgModule({
   imports: [
@@ -36,7 +37,8 @@ import {AUTH_DECLARATIONS} from "./auth/index";
     MdInputModule.forRoot(),
     MdCardModule.forRoot(),
     MdCheckboxModule.forRoot(),
-    MdListModule.forRoot()
+    MdListModule.forRoot(),
+    FileDropModule
   ],
   declarations: [
     AppComponent,
-- 
2.7.4


From c1b1a95dbf50a4708c76cf4b057eaad95d659bec Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:25:01 +0300
Subject: [PATCH 211/292] Step 21.11: Create a view for an upload

---
 client/imports/app/parties/parties-upload.component.html | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 client/imports/app/parties/parties-upload.component.html

diff --git a/client/imports/app/parties/parties-upload.component.html b/client/imports/app/parties/parties-upload.component.html
new file mode 100644
index 0000000..936b188
--- /dev/null
+++ b/client/imports/app/parties/parties-upload.component.html
@@ -0,0 +1,5 @@
+<div layout="column">
+  <div>
+    <div>Drop an image to here</div>
+  </div>
+</div>
\ No newline at end of file
-- 
2.7.4


From e8052bc9ce805e76ef2abeeba09533c606f8b5d4 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:25:46 +0300
Subject: [PATCH 212/292] Step 21.12: Create a PartiesUpload component

---
 client/imports/app/parties/parties-upload.component.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 client/imports/app/parties/parties-upload.component.ts

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
new file mode 100644
index 0000000..36a61be
--- /dev/null
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -0,0 +1,11 @@
+import { Component } from '@angular/core';
+
+import template from './parties-upload.component.html';
+
+@Component({
+  selector: 'parties-upload',
+  template
+})
+export class PartiesUploadComponent {
+  constructor() {}
+}
\ No newline at end of file
-- 
2.7.4


From ceae7a03000a469c9f70eeb2ad25ff46b8edadfe Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:25:59 +0300
Subject: [PATCH 213/292] Step 21.13: Added  PartiesUpload component to the
 index file

---
 client/imports/app/parties/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/index.ts b/client/imports/app/parties/index.ts
index ae09066..7a1b315 100644
--- a/client/imports/app/parties/index.ts
+++ b/client/imports/app/parties/index.ts
@@ -1,9 +1,11 @@
 import { PartiesFormComponent } from './parties-form.component';
 import { PartiesListComponent } from './parties-list.component';
 import { PartyDetailsComponent } from './party-details.component';
+import {PartiesUploadComponent} from "./parties-upload.component";
 
 export const PARTIES_DECLARATIONS = [
   PartiesFormComponent,
   PartiesListComponent,
-  PartyDetailsComponent
+  PartyDetailsComponent,
+  PartiesUploadComponent
 ];
-- 
2.7.4


From 2e399546c8094743ea163c8ae5917efde9995c4b Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:26:53 +0300
Subject: [PATCH 214/292] Step 21.14: Use PartiesUploadComponent inside the
 form

---
 client/imports/app/parties/parties-form.component.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index 0318fa5..82e2f51 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -8,6 +8,8 @@
       <md-checkbox formControlName="public">Public</md-checkbox>
     </div>
 
+    <parties-upload></parties-upload>
+
     <button md-raised-button type="submit">Add</button>
   </fieldset>
 </form>
\ No newline at end of file
-- 
2.7.4


From 70b343209749f0f3f6d74be88258d9c7a5aa893e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:27:41 +0300
Subject: [PATCH 215/292] Step 21.15: Add bindings to FileDrop

---
 client/imports/app/parties/parties-upload.component.html | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-upload.component.html b/client/imports/app/parties/parties-upload.component.html
index 936b188..b71c11c 100644
--- a/client/imports/app/parties/parties-upload.component.html
+++ b/client/imports/app/parties/parties-upload.component.html
@@ -1,5 +1,8 @@
 <div layout="column">
-  <div>
+  <div fileDrop
+       [ngClass]="{'file-is-over': fileIsOver}"
+       (fileOver)="fileOver($event)"
+       (onFileDrop)="onFileDrop($event)">
     <div>Drop an image to here</div>
   </div>
 </div>
\ No newline at end of file
-- 
2.7.4


From 7ee83421e464a09fa3142f08bbc8b380b5569b3d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:28:09 +0300
Subject: [PATCH 216/292] Step 21.16: Handle fileIsOver

---
 client/imports/app/parties/parties-upload.component.ts | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index 36a61be..48d42e0 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -7,5 +7,11 @@ import template from './parties-upload.component.html';
   template
 })
 export class PartiesUploadComponent {
+  fileIsOver: boolean = false;
+
   constructor() {}
+
+  fileOver(fileIsOver: boolean): void {
+    this.fileIsOver = fileIsOver;
+  }
 }
\ No newline at end of file
-- 
2.7.4


From 3d05d129d416263e43f2682366f2ed8fe9801b9e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:28:34 +0300
Subject: [PATCH 217/292] Step 21.17: Implement onFileDrop method

---
 client/imports/app/parties/parties-upload.component.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index 48d42e0..1e95a62 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -14,4 +14,8 @@ export class PartiesUploadComponent {
   fileOver(fileIsOver: boolean): void {
     this.fileIsOver = fileIsOver;
   }
+
+  onFileDrop(file: File): void {
+    console.log('Got file');
+  }
 }
\ No newline at end of file
-- 
2.7.4


From cbcfc13345d29b54470273f2c5918bfa4b98d953 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:30:38 +0300
Subject: [PATCH 218/292] Step 21.18: Implement the upload method

---
 both/methods/images.methods.ts | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)
 create mode 100644 both/methods/images.methods.ts

diff --git a/both/methods/images.methods.ts b/both/methods/images.methods.ts
new file mode 100644
index 0000000..8bfb27e
--- /dev/null
+++ b/both/methods/images.methods.ts
@@ -0,0 +1,23 @@
+import { UploadFS } from 'meteor/jalik:ufs';
+import { ImagesStore } from '../collections/images.collection';
+
+export function upload(data: File): Promise<any> {
+  return new Promise((resolve, reject) => {
+    // pick from an object only: name, type and size
+    const file = {
+      name: data.name,
+      type: data.type,
+      size: data.size,
+    };
+
+    const upload = new UploadFS.Uploader({
+      data,
+      file,
+      store: ImagesStore,
+      onError: reject,
+      onComplete: resolve
+    });
+
+    upload.start();
+  });
+}
\ No newline at end of file
-- 
2.7.4


From 9bd82ccd978964260d3ef48ca6cd101098b88eaa Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:31:37 +0300
Subject: [PATCH 219/292] Step 21.19: Use the upload function

---
 client/imports/app/parties/parties-upload.component.ts | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index 1e95a62..8e6180b 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -2,12 +2,15 @@ import { Component } from '@angular/core';
 
 import template from './parties-upload.component.html';
 
+import { upload } from '../../../../both/methods/images.methods';
+
 @Component({
   selector: 'parties-upload',
   template
 })
 export class PartiesUploadComponent {
   fileIsOver: boolean = false;
+  uploading: boolean = false;
 
   constructor() {}
 
@@ -16,6 +19,15 @@ export class PartiesUploadComponent {
   }
 
   onFileDrop(file: File): void {
-    console.log('Got file');
+    this.uploading = true;
+
+    upload(file)
+      .then(() => {
+        this.uploading = false;
+      })
+      .catch((error) => {
+        this.uploading = false;
+        console.log(`Something went wrong!`, error);
+      });
   }
 }
\ No newline at end of file
-- 
2.7.4


From 85f97190f4fce0d0b883ae573242bac792e2fad9 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:32:31 +0300
Subject: [PATCH 220/292] Step 21.20: Declare meteor/jalik:ufs module

---
 typings/jalik-ufs.d.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 typings/jalik-ufs.d.ts

diff --git a/typings/jalik-ufs.d.ts b/typings/jalik-ufs.d.ts
new file mode 100644
index 0000000..f2d4383
--- /dev/null
+++ b/typings/jalik-ufs.d.ts
@@ -0,0 +1,11 @@
+declare module "meteor/jalik:ufs" {
+  interface Uploader {
+    start: () => void;
+  }
+
+  interface UploadFS {
+    Uploader: (options: any) => Uploader;
+  }
+
+  export var UploadFS;
+}
\ No newline at end of file
-- 
2.7.4


From 77503900bde4be8e72348fa5a0d3092c5c01d46b Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:33:39 +0300
Subject: [PATCH 221/292] Step 21.21: Install definitions of NodeJS

---
 typings.json | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/typings.json b/typings.json
index 4a62321..d57f625 100644
--- a/typings.json
+++ b/typings.json
@@ -5,6 +5,7 @@
     "chai-spies": "registry:npm/chai-spies#0.7.1+20160614064916"
   },
   "globalDependencies": {
-    "meteor": "github:meteor-typings/meteor/1.3#955b89a4e2af892d1736bc570b490a97e860d5b7"
+    "meteor": "github:meteor-typings/meteor/1.3#955b89a4e2af892d1736bc570b490a97e860d5b7",
+    "node": "registry:dt/node#6.0.0+20160925070332"
   }
 }
-- 
2.7.4


From bf8ee1b4915e8b5003aa71bf6ae5feac527d52fd Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:34:11 +0300
Subject: [PATCH 222/292] Step 21.22: Implement classes

---
 client/imports/app/parties/parties-upload.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-upload.component.html b/client/imports/app/parties/parties-upload.component.html
index b71c11c..1dad975 100644
--- a/client/imports/app/parties/parties-upload.component.html
+++ b/client/imports/app/parties/parties-upload.component.html
@@ -1,6 +1,6 @@
 <div layout="column">
   <div fileDrop
-       [ngClass]="{'file-is-over': fileIsOver}"
+       [ngClass]="{'file-is-over': fileIsOver, 'file-uploading': uploading}"
        (fileOver)="fileOver($event)"
        (onFileDrop)="onFileDrop($event)">
     <div>Drop an image to here</div>
-- 
2.7.4


From e842407f4fd0610e3cc57b729bf2d1f03ed6c519 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:34:51 +0300
Subject: [PATCH 223/292] Step 21.23: Implement publications of Images and
 Thumbs

---
 server/imports/publications/images.ts | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 server/imports/publications/images.ts

diff --git a/server/imports/publications/images.ts b/server/imports/publications/images.ts
new file mode 100644
index 0000000..1367a0c
--- /dev/null
+++ b/server/imports/publications/images.ts
@@ -0,0 +1,15 @@
+import { Meteor } from 'meteor/meteor';
+import { Thumbs, Images } from '../../../both/collections/images.collection';
+
+Meteor.publish('thumbs', function(ids: string[]) {
+  return Thumbs.collection.find({
+    originalStore: 'images',
+    originalId: {
+      $in: ids
+    }
+  });
+});
+
+Meteor.publish('images', function() {
+  return Images.collection.find({});
+});
\ No newline at end of file
-- 
2.7.4


From d42c3ec0ddc0358da1eda589327acdc2f10ad943 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:35:15 +0300
Subject: [PATCH 224/292] Step 21.24: Import those publications in the server
 entry point

---
 server/main.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/server/main.ts b/server/main.ts
index 7979c05..92ff846 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -5,6 +5,7 @@ import { loadParties } from './imports/fixtures/parties';
 import './imports/publications/parties';
 import './imports/publications/users';
 import '../both/methods/parties.methods';
+import './imports/publications/images';
 
 Meteor.startup(() => {
   loadParties();
-- 
2.7.4


From eee80cff3eec536af8657debb18cdc85694cd9ae Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:41:14 +0300
Subject: [PATCH 225/292] Step 21.25: Use RxJS to keep track of files

---
 client/imports/app/parties/parties-upload.component.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index 8e6180b..f51ae47 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -1,9 +1,11 @@
-import { Component } from '@angular/core';
+import {Component} from '@angular/core';
 
 import template from './parties-upload.component.html';
 
 import { upload } from '../../../../both/methods/images.methods';
 
+import {Subject, Subscription} from "rxjs";
+
 @Component({
   selector: 'parties-upload',
   template
@@ -11,6 +13,7 @@ import { upload } from '../../../../both/methods/images.methods';
 export class PartiesUploadComponent {
   fileIsOver: boolean = false;
   uploading: boolean = false;
+  files: Subject<string[]> = new Subject<string[]>();
 
   constructor() {}
 
-- 
2.7.4


From 35796156451290528486129dc6bd25d65360283a Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:41:55 +0300
Subject: [PATCH 226/292] Step 21.26: Subscribe to the thumbs publication

---
 .../imports/app/parties/parties-upload.component.ts  | 20 +++++++++++++++++---
 1 file changed, 17 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index f51ae47..33a0c75 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -1,22 +1,36 @@
-import {Component} from '@angular/core';
+import {Component, OnInit} from '@angular/core';
 
 import template from './parties-upload.component.html';
 
 import { upload } from '../../../../both/methods/images.methods';
-
 import {Subject, Subscription} from "rxjs";
+import {MeteorObservable} from "meteor-rxjs";
 
 @Component({
   selector: 'parties-upload',
   template
 })
-export class PartiesUploadComponent {
+export class PartiesUploadComponent implements OnInit {
   fileIsOver: boolean = false;
   uploading: boolean = false;
   files: Subject<string[]> = new Subject<string[]>();
+  thumbsSubscription: Subscription;
 
   constructor() {}
 
+  ngOnInit() {
+    this.files.subscribe((filesArray) => {
+      MeteorObservable.autorun().subscribe(() => {
+        if (this.thumbsSubscription) {
+          this.thumbsSubscription.unsubscribe();
+          this.thumbsSubscription = undefined;
+        }
+
+        this.thumbsSubscription = MeteorObservable.subscribe("thumbs", filesArray).subscribe();
+      });
+    });
+  }
+
   fileOver(fileIsOver: boolean): void {
     this.fileIsOver = fileIsOver;
   }
-- 
2.7.4


From 56da366194432eeeb67a010f5f669dce71985973 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:45:34 +0300
Subject: [PATCH 227/292] Step 21.27: Look for the thumbnails

---
 client/imports/app/parties/parties-upload.component.ts | 14 ++++++++++++--
 1 file changed, 12 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index 33a0c75..cdba392 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -3,8 +3,10 @@ import {Component, OnInit} from '@angular/core';
 import template from './parties-upload.component.html';
 
 import { upload } from '../../../../both/methods/images.methods';
-import {Subject, Subscription} from "rxjs";
+import {Subject, Subscription, Observable} from "rxjs";
 import {MeteorObservable} from "meteor-rxjs";
+import {Thumb} from "../../../../both/models/image.model";
+import {Thumbs} from "../../../../both/collections/images.collection";
 
 @Component({
   selector: 'parties-upload',
@@ -15,6 +17,7 @@ export class PartiesUploadComponent implements OnInit {
   uploading: boolean = false;
   files: Subject<string[]> = new Subject<string[]>();
   thumbsSubscription: Subscription;
+  thumbs: Observable<Thumb[]>;
 
   constructor() {}
 
@@ -26,7 +29,14 @@ export class PartiesUploadComponent implements OnInit {
           this.thumbsSubscription = undefined;
         }
 
-        this.thumbsSubscription = MeteorObservable.subscribe("thumbs", filesArray).subscribe();
+        this.thumbsSubscription = MeteorObservable.subscribe("thumbs", filesArray).subscribe(() => {
+          this.thumbs = Thumbs.find({
+            originalStore: 'images',
+            originalId: {
+              $in: filesArray
+            }
+          }).zone();
+        });
       });
     });
   }
-- 
2.7.4


From ba314312e6c72dc8cd37b3ca43e139c1b0098657 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:46:04 +0300
Subject: [PATCH 228/292] Step 21.28: Implement the thumbnails in the view

---
 client/imports/app/parties/parties-upload.component.html | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/imports/app/parties/parties-upload.component.html b/client/imports/app/parties/parties-upload.component.html
index 1dad975..d2d7f22 100644
--- a/client/imports/app/parties/parties-upload.component.html
+++ b/client/imports/app/parties/parties-upload.component.html
@@ -5,4 +5,10 @@
        (onFileDrop)="onFileDrop($event)">
     <div>Drop an image to here</div>
   </div>
+
+  <div layout="row" *ngIf="thumbs">
+    <div *ngFor="let thumb of thumbs | async">
+      <img [src]="thumb.url"/>
+    </div>
+  </div>
 </div>
\ No newline at end of file
-- 
2.7.4


From 667b7bfa3e4703c0922c1fd03a6913319c77bf1f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:46:34 +0300
Subject: [PATCH 229/292] Step 21.29: Basic styles

---
 client/imports/app/parties/parties-upload.component.scss | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)
 create mode 100644 client/imports/app/parties/parties-upload.component.scss

diff --git a/client/imports/app/parties/parties-upload.component.scss b/client/imports/app/parties/parties-upload.component.scss
new file mode 100644
index 0000000..1f53d72
--- /dev/null
+++ b/client/imports/app/parties/parties-upload.component.scss
@@ -0,0 +1,16 @@
+.file-uploading {
+  opacity: 0.3;
+}
+
+.file-is-over {
+  opacity: 0.7;
+}
+
+[filedrop] {
+  width: 100%;
+  height: 100px;
+  line-height: 100px;
+  text-align: center;
+  background-color: #f1f1f1;
+  margin: 10px 0;
+}
\ No newline at end of file
-- 
2.7.4


From 8b0fb92c80607699d4f69da04ffc03faf501e459 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:46:59 +0300
Subject: [PATCH 230/292] Step 21.30: Import styles inside main.scss

---
 client/main.scss | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/main.scss b/client/main.scss
index d86c9f5..40113ec 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -44,4 +44,5 @@ body {
 }
 
 @import "./imports/app/parties/parties-list.component";
-@import "./imports/app/parties/party-details.component";
\ No newline at end of file
+@import "./imports/app/parties/party-details.component";
+@import "./imports/app/parties/parties-upload.component";
\ No newline at end of file
-- 
2.7.4


From a1b49890705c4daf5cc4cee83b806197c6f98856 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 14:49:01 +0300
Subject: [PATCH 231/292] Step 21.31: Handle file upload

---
 client/imports/app/parties/parties-upload.component.ts | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index cdba392..382653a 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -15,6 +15,7 @@ import {Thumbs} from "../../../../both/collections/images.collection";
 export class PartiesUploadComponent implements OnInit {
   fileIsOver: boolean = false;
   uploading: boolean = false;
+  filesArray: string[] = [];
   files: Subject<string[]> = new Subject<string[]>();
   thumbsSubscription: Subscription;
   thumbs: Observable<Thumb[]>;
@@ -49,12 +50,18 @@ export class PartiesUploadComponent implements OnInit {
     this.uploading = true;
 
     upload(file)
-      .then(() => {
+      .then((result) => {
         this.uploading = false;
+        this.addFile(result);
       })
       .catch((error) => {
         this.uploading = false;
         console.log(`Something went wrong!`, error);
       });
   }
+
+  addFile(file) {
+    this.filesArray.push(file._id);
+    this.files.next(this.filesArray);
+  }
 }
\ No newline at end of file
-- 
2.7.4


From 940dd022a8f4ecd8c99afea732049045152df390 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:10:26 +0300
Subject: [PATCH 232/292] Step 21.32: Emit event with the new file

---
 client/imports/app/parties/parties-upload.component.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index 382653a..a1ba82b 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -1,4 +1,4 @@
-import {Component, OnInit} from '@angular/core';
+import {Component, OnInit, EventEmitter, Output} from '@angular/core';
 
 import template from './parties-upload.component.html';
 
@@ -19,6 +19,7 @@ export class PartiesUploadComponent implements OnInit {
   files: Subject<string[]> = new Subject<string[]>();
   thumbsSubscription: Subscription;
   thumbs: Observable<Thumb[]>;
+  @Output() onFile: EventEmitter<string> = new EventEmitter<string>();
 
   constructor() {}
 
@@ -63,5 +64,6 @@ export class PartiesUploadComponent implements OnInit {
   addFile(file) {
     this.filesArray.push(file._id);
     this.files.next(this.filesArray);
+    this.onFile.emit(file._id);
   }
 }
\ No newline at end of file
-- 
2.7.4


From 9bcfe14192425cf2409d4bea0fb5605948633272 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:11:01 +0300
Subject: [PATCH 233/292] Step 21.33: Add images to the PartiesForm component

---
 client/imports/app/parties/parties-form.component.ts | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/imports/app/parties/parties-form.component.ts b/client/imports/app/parties/parties-form.component.ts
index 3a213f0..ccd2ed1 100644
--- a/client/imports/app/parties/parties-form.component.ts
+++ b/client/imports/app/parties/parties-form.component.ts
@@ -12,6 +12,7 @@ import template from './parties-form.component.html';
 })
 export class PartiesFormComponent implements OnInit {
   addForm: FormGroup;
+  images: string[] = [];
 
   constructor(
     private formBuilder: FormBuilder
@@ -39,6 +40,7 @@ export class PartiesFormComponent implements OnInit {
         location: {
           name: this.addForm.value.location
         },
+        images: this.images,
         public: this.addForm.value.public,
         owner: Meteor.userId()
       });
@@ -46,4 +48,8 @@ export class PartiesFormComponent implements OnInit {
       this.addForm.reset();
     }
   }
+
+  onImage(imageId: string) {
+    this.images.push(imageId);
+  }
 }
-- 
2.7.4


From 880266014638187173586e5e0f2a5838d3a83b06 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:11:29 +0300
Subject: [PATCH 234/292] Step 21.34: Add images property to the Party
 interface

---
 both/models/party.model.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/both/models/party.model.ts b/both/models/party.model.ts
index 5e62f1b..eb4b3e4 100644
--- a/both/models/party.model.ts
+++ b/both/models/party.model.ts
@@ -8,6 +8,7 @@ export interface Party extends CollectionObject {
   public: boolean;
   invited?: string[];
   rsvps?: RSVP[];
+  images?: string[];
 }
 
 interface RSVP {
-- 
2.7.4


From c271f4ddaf72c871f4caa6b86cf303c1c5462b6d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:11:51 +0300
Subject: [PATCH 235/292] Step 21.35: Bind the onFile event

---
 client/imports/app/parties/parties-form.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index 82e2f51..a4f1fc4 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -8,7 +8,7 @@
       <md-checkbox formControlName="public">Public</md-checkbox>
     </div>
 
-    <parties-upload></parties-upload>
+    <parties-upload (onFile)="onImage($event)"></parties-upload>
 
     <button md-raised-button type="submit">Add</button>
   </fieldset>
-- 
2.7.4


From fc73da6613fa5b154c7c16159a9529291f3be8c2 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:14:00 +0300
Subject: [PATCH 236/292] Step 21.36: Create DisplayMainImage pipe

---
 .../imports/app/shared/display-main-image.pipe.ts  | 25 ++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 client/imports/app/shared/display-main-image.pipe.ts

diff --git a/client/imports/app/shared/display-main-image.pipe.ts b/client/imports/app/shared/display-main-image.pipe.ts
new file mode 100644
index 0000000..c98e952
--- /dev/null
+++ b/client/imports/app/shared/display-main-image.pipe.ts
@@ -0,0 +1,25 @@
+import {Pipe, PipeTransform} from '@angular/core';
+import { Images } from '../../../../both/collections/images.collection';
+import { Party } from '../../../../both/models/party.model';
+
+@Pipe({
+  name: 'displayMainImage'
+})
+export class DisplayMainImagePipe implements PipeTransform {
+  transform(party: Party) {
+    if (!party) {
+      return;
+    }
+
+    let imageUrl: string;
+    let imageId: string = (party.images || [])[0];
+
+    const found = Images.findOne(imageId);
+
+    if (found) {
+      imageUrl = found.url;
+    }
+
+    return imageUrl;
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 66187b96f96552e2ffdebd11c4759eee6749938d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:14:26 +0300
Subject: [PATCH 237/292] Step 21.37: Add DisplayMainImage pipe

---
 client/imports/app/shared/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/shared/index.ts b/client/imports/app/shared/index.ts
index 12c7d64..37c6cf1 100644
--- a/client/imports/app/shared/index.ts
+++ b/client/imports/app/shared/index.ts
@@ -1,7 +1,9 @@
 import { DisplayNamePipe } from './display-name.pipe';
 import {RsvpPipe} from "./rsvp.pipe";
+import {DisplayMainImagePipe} from "./display-main-image.pipe";
 
 export const SHARED_DECLARATIONS: any[] = [
   DisplayNamePipe,
-  RsvpPipe
+  RsvpPipe,
+  DisplayMainImagePipe
 ];
-- 
2.7.4


From 760c5665549839ac36163b1960c03def70093193 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:15:56 +0300
Subject: [PATCH 238/292] Step 21.38: Subscribe to the images publication

---
 client/imports/app/parties/parties-list.component.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index 2e45027..abb965b 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -39,6 +39,7 @@ export class PartiesListComponent implements OnInit, OnDestroy {
   autorunSub: Subscription;
   location: Subject<string> = new Subject<string>();
   user: Meteor.User;
+  imagesSubs: Subscription;
 
   constructor(
     private paginationService: PaginationService
@@ -88,6 +89,8 @@ export class PartiesListComponent implements OnInit, OnDestroy {
       this.partiesSize = Counts.get('numberOfParties');
       this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
     });
+
+    this.imagesSubs = MeteorObservable.subscribe('images').subscribe();
   }
 
   removeParty(party: Party): void {
@@ -115,5 +118,6 @@ export class PartiesListComponent implements OnInit, OnDestroy {
     this.partiesSub.unsubscribe();
     this.optionsSub.unsubscribe();
     this.autorunSub.unsubscribe();
+    this.imagesSubs.unsubscribe();
   }
 }
-- 
2.7.4


From a3f729886b706601211a6a2a238e68f69051d74c Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:16:31 +0300
Subject: [PATCH 239/292] Step 21.39: Implement the pipe

---
 client/imports/app/parties/parties-list.component.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/imports/app/parties/parties-list.component.html b/client/imports/app/parties/parties-list.component.html
index 8ca6bf0..b742f88 100644
--- a/client/imports/app/parties/parties-list.component.html
+++ b/client/imports/app/parties/parties-list.component.html
@@ -27,6 +27,7 @@
           <div *ngFor="let party of parties | async">
             <md-card>
               <md-card-content>
+                <img *ngIf="party.images" class="party-main-image" [src]="party | displayMainImage">
                 <h2 class="md-title ma-name">
                   <a [routerLink]="['/party', party._id]">{{party.name}}</a>
                 </h2>
-- 
2.7.4


From 27207bee77f6e1f92f167a9491454e50a2aa9677 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:16:52 +0300
Subject: [PATCH 240/292] Step 21.40: Add some styles

---
 client/imports/app/parties/parties-list.component.scss | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/client/imports/app/parties/parties-list.component.scss b/client/imports/app/parties/parties-list.component.scss
index 60f77b1..788e78d 100644
--- a/client/imports/app/parties/parties-list.component.scss
+++ b/client/imports/app/parties/parties-list.component.scss
@@ -58,4 +58,9 @@
 
 .search-form {
   margin-bottom: 1em;
+}
+
+img.party-main-image {
+  max-width: 100%;
+  max-height: 100%;
 }
\ No newline at end of file
-- 
2.7.4


From 5a2f3181f0b0ea9f0ff238af3fc34fa1f7082ea7 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:17:53 +0300
Subject: [PATCH 241/292] Step 21.41: Add the reset method to PartiesUpload
 component

---
 client/imports/app/parties/parties-upload.component.ts | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/client/imports/app/parties/parties-upload.component.ts b/client/imports/app/parties/parties-upload.component.ts
index a1ba82b..7db9c2e 100644
--- a/client/imports/app/parties/parties-upload.component.ts
+++ b/client/imports/app/parties/parties-upload.component.ts
@@ -66,4 +66,9 @@ export class PartiesUploadComponent implements OnInit {
     this.files.next(this.filesArray);
     this.onFile.emit(file._id);
   }
+
+  reset() {
+    this.filesArray = [];
+    this.files.next(this.filesArray);
+  }
 }
\ No newline at end of file
-- 
2.7.4


From e72d146f9df83d68c738b7b40169c9584dafb41a Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:18:33 +0300
Subject: [PATCH 242/292] Step 21.42: Reset files on ngSubmit

---
 client/imports/app/parties/parties-form.component.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/parties/parties-form.component.html b/client/imports/app/parties/parties-form.component.html
index a4f1fc4..a5caa3f 100644
--- a/client/imports/app/parties/parties-form.component.html
+++ b/client/imports/app/parties/parties-form.component.html
@@ -1,4 +1,4 @@
-<form [formGroup]="addForm" (ngSubmit)="addParty()">
+<form [formGroup]="addForm" (ngSubmit)="addParty(); upload.reset()">
   <fieldset class="form-group">
     <md-input formControlName="name" placeholder="Party name"></md-input>
     <md-input formControlName="description" placeholder="Description"></md-input>
@@ -8,7 +8,7 @@
       <md-checkbox formControlName="public">Public</md-checkbox>
     </div>
 
-    <parties-upload (onFile)="onImage($event)"></parties-upload>
+    <parties-upload #upload (onFile)="onImage($event)"></parties-upload>
 
     <button md-raised-button type="submit">Add</button>
   </fieldset>
-- 
2.7.4


From f6737b6be6f7962144ffc7e9b7621f0f1ba96325 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 16:18:23 -0200
Subject: [PATCH 243/292] Step 21: Handling Files with CollectionFS

---
 steps/step21.md | 1137 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 1137 insertions(+)
 create mode 100644 steps/step21.md

diff --git a/steps/step21.md b/steps/step21.md
new file mode 100644
index 0000000..619aef3
--- /dev/null
+++ b/steps/step21.md
@@ -0,0 +1,1137 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Handling Files with CollectionFS
+
+In this step we are going to add the ability to upload images into our app, and also sorting and naming them.
+
+Angular-Meteor can use Meteor [UploadFS](https://github.com/jalik/jalik-ufs) which is a suite of Meteor packages that together provide a complete file management solution including uploading, downloading, storage, synchronization, manipulation, and copying.
+
+It supports several storage adapters for saving files to the local filesystem, GridFS and additional storage adapters can be created.
+
+The process is very similar for handling any other MongoDB Collection!
+
+So let's add image upload to our app!
+
+
+We will start by adding UploadFS to our project, by running the following command:
+
+    $ meteor add jalik:ufs
+
+Now, we will decide the storage adapter we want to use.
+In this example, we will use the GridFS as storage adapters, so we will add the adapter by running this command:
+
+    $ meteor add jalik:ufs-gridfs
+
+Note: you can find more information about Stores and Storage Adapters on the [UploadFS](https://github.com/jalik/jalik-ufs)'s GitHub repository.
+
+So now we have the UploadFS support and the storage adapter installed - we still need to create a UploadFS object to handle our files.
+Note that you will need to define the collection as shared resource because you will need to use the collection in both client and server side.
+
+### Creating the Mongo Collection and UploadFS Store
+
+Let's start by creating `both/collections/images.collection.ts` file, and define a Mongo Collection object called "Images". Since we want to be able to make thumbnails we have to create another Collection called "Thumbs".
+
+Also we will use the stadard Mongo Collection API that allows us to defined auth-rules.
+
+[{]: <helper> (diff_step 21.2)
+#### Step 21.29: Basic styles
+
+##### Added client/imports/app/parties/parties-upload.component.scss
+```diff
+@@ -0,0 +1,16 @@
++┊  ┊ 1┊.file-uploading {
++┊  ┊ 2┊  opacity: 0.3;
++┊  ┊ 3┊}
++┊  ┊ 4┊
++┊  ┊ 5┊.file-is-over {
++┊  ┊ 6┊  opacity: 0.7;
++┊  ┊ 7┊}
++┊  ┊ 8┊
++┊  ┊ 9┊[filedrop] {
++┊  ┊10┊  width: 100%;
++┊  ┊11┊  height: 100px;
++┊  ┊12┊  line-height: 100px;
++┊  ┊13┊  text-align: center;
++┊  ┊14┊  background-color: #f1f1f1;
++┊  ┊15┊  margin: 10px 0;
++┊  ┊16┊}🚫↵
+```
+[}]: #
+
+Let's now create interfaces for both collections:
+
+[{]: <helper> (diff_step 21.3)
+#### Step 21.39: Implement the pipe
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -27,6 +27,7 @@
+ ┊27┊27┊          <div *ngFor="let party of parties | async">
+ ┊28┊28┊            <md-card>
+ ┊29┊29┊              <md-card-content>
++┊  ┊30┊                <img *ngIf="party.images" class="party-main-image" [src]="party | displayMainImage">
+ ┊30┊31┊                <h2 class="md-title ma-name">
+ ┊31┊32┊                  <a [routerLink]="['/party', party._id]">undefined</a>
+ ┊32┊33┊                </h2>
+```
+[}]: #
+
+[{]: <helper> (diff_step 21.4)
+#### Step 21.42: Reset files on ngSubmit
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -1,4 +1,4 @@
+-┊1┊ ┊<form [formGroup]="addForm" (ngSubmit)="addParty()">
++┊ ┊1┊<form [formGroup]="addForm" (ngSubmit)="addParty(); upload.reset()">
+ ┊2┊2┊  <fieldset class="form-group">
+ ┊3┊3┊    <md-input formControlName="name" placeholder="Party name"></md-input>
+ ┊4┊4┊    <md-input formControlName="description" placeholder="Description"></md-input>
+```
+```diff
+@@ -8,7 +8,7 @@
+ ┊ 8┊ 8┊      <md-checkbox formControlName="public">Public</md-checkbox>
+ ┊ 9┊ 9┊    </div>
+ ┊10┊10┊
+-┊11┊  ┊    <parties-upload (onFile)="onImage($event)"></parties-upload>
++┊  ┊11┊    <parties-upload #upload (onFile)="onImage($event)"></parties-upload>
+ ┊12┊12┊
+ ┊13┊13┊    <button md-raised-button type="submit">Add</button>
+ ┊14┊14┊  </fieldset>
+```
+[}]: #
+
+And use them on Images and Thumbs collections:
+
+[{]: <helper> (diff_step 21.5)
+#### Step 21.5: Add interfaces to Mongo Collections
+
+##### Changed both/collections/images.collection.ts
+```diff
+@@ -1,8 +1,9 @@
+ ┊1┊1┊import { MongoObservable } from 'meteor-rxjs';
+ ┊2┊2┊import { Meteor } from 'meteor/meteor';
++┊ ┊3┊import {Thumb, Image} from "../models/image.model";
+ ┊3┊4┊
+-┊4┊ ┊export const Images = new MongoObservable.Collection('images');
+-┊5┊ ┊export const Thumbs = new MongoObservable.Collection('thumbs');
++┊ ┊5┊export const Images = new MongoObservable.Collection<Image>('images');
++┊ ┊6┊export const Thumbs = new MongoObservable.Collection<Thumb>('thumbs');
+ ┊6┊7┊
+ ┊7┊8┊function loggedIn(userId) {
+ ┊8┊9┊  return !!userId;
+```
+[}]: #
+
+We have to create Stores for Images and Thumbs.
+
+[{]: <helper> (diff_step 21.6)
+#### Step 21.6: Create stores for Images and Thumbs
+
+##### Changed both/collections/images.collection.ts
+```diff
+@@ -1,10 +1,27 @@
+ ┊ 1┊ 1┊import { MongoObservable } from 'meteor-rxjs';
+ ┊ 2┊ 2┊import { Meteor } from 'meteor/meteor';
+ ┊ 3┊ 3┊import {Thumb, Image} from "../models/image.model";
++┊  ┊ 4┊import { UploadFS } from 'meteor/jalik:ufs';
+ ┊ 4┊ 5┊
+ ┊ 5┊ 6┊export const Images = new MongoObservable.Collection<Image>('images');
+ ┊ 6┊ 7┊export const Thumbs = new MongoObservable.Collection<Thumb>('thumbs');
+ ┊ 7┊ 8┊
++┊  ┊ 9┊export const ThumbsStore = new UploadFS.store.GridFS({
++┊  ┊10┊  collection: Thumbs.collection,
++┊  ┊11┊  name: 'thumbs'
++┊  ┊12┊});
++┊  ┊13┊
++┊  ┊14┊export const ImagesStore = new UploadFS.store.GridFS({
++┊  ┊15┊  collection: Images.collection,
++┊  ┊16┊  name: 'images',
++┊  ┊17┊  filter: new UploadFS.Filter({
++┊  ┊18┊    contentTypes: ['image/*']
++┊  ┊19┊  }),
++┊  ┊20┊  copyTo: [
++┊  ┊21┊    ThumbsStore
++┊  ┊22┊  ]
++┊  ┊23┊});
++┊  ┊24┊
+ ┊ 8┊25┊function loggedIn(userId) {
+ ┊ 9┊26┊  return !!userId;
+ ┊10┊27┊}
+```
+[}]: #
+
+Let's explain a bit what happened.
+
+* We assigned Stores to their Collections, which is required.
+* We defined names of these Stores.
+* We added filter to ImagesStore so it can receive only images.
+* Every file will be copied to ThumbsStore.
+
+There is a reason why we called one of the Collections the `Thumbs`!
+
+Since we transfer every uploaded file to ThumbsStore, we can now easily add file manipulations.
+
+Let's resize every file to 32x32:
+
+[{]: <helper> (diff_step 21.7)
+#### Step 21.7: Resize images
+
+##### Changed both/collections/images.collection.ts
+```diff
+@@ -8,7 +8,19 @@
+ ┊ 8┊ 8┊
+ ┊ 9┊ 9┊export const ThumbsStore = new UploadFS.store.GridFS({
+ ┊10┊10┊  collection: Thumbs.collection,
+-┊11┊  ┊  name: 'thumbs'
++┊  ┊11┊  name: 'thumbs',
++┊  ┊12┊  transformWrite(from, to, fileId, file) {
++┊  ┊13┊    // Resize to 32x32
++┊  ┊14┊    const gm = require('gm');
++┊  ┊15┊
++┊  ┊16┊    gm(from, file.name)
++┊  ┊17┊      .resize(32, 32)
++┊  ┊18┊      .gravity('Center')
++┊  ┊19┊      .extent(32, 32)
++┊  ┊20┊      .quality(75)
++┊  ┊21┊      .stream()
++┊  ┊22┊      .pipe(to);
++┊  ┊23┊  }
+ ┊12┊24┊});
+ ┊13┊25┊
+ ┊14┊26┊export const ImagesStore = new UploadFS.store.GridFS({
+```
+[}]: #
+
+We used [`gm`](https://github.com/aheckmann/gm) module, let's install it:
+
+    $ meteor npm install gm --save
+
+> Note: To use this module, you need download and install [GraphicsMagick](http://www.graphicsmagick.org/) or [ImageMagick](http://www.imagemagick.org/). In Mac OS X, you can use [Homebrew](http://brew.sh/) and do: `brew install graphicsmagick` or `brew install imagemagick`.
+
+
+### Image upload
+
+Note that for file upload you can use basic HTML `<input type="file">` or any other package - you only need the HTML5 File object to be provided.
+
+For our application, we would like to add ability to drag-and-drop images, so we use Angular2 directive that handles file upload and gives us more abilities such as drag & drop, on the client side. In this example, We used [`angular2-file-drop`](https://github.com/jellyjs/angular2-file-drop), which is still in develop. In order to do this, let's add the package to our project:
+
+    $ meteor npm install angular2-file-drop --save
+
+And let's add it's module to ours:
+
+[{]: <helper> (diff_step 21.10)
+#### Step 21.10: Include file drop module
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -18,6 +18,7 @@
+ ┊18┊18┊import { MdCheckboxModule } from "@angular2-material/checkbox";
+ ┊19┊19┊import {MdListModule} from "@angular2-material/list";
+ ┊20┊20┊import {AUTH_DECLARATIONS} from "./auth/index";
++┊  ┊21┊import {FileDropModule} from "angular2-file-drop";
+ ┊21┊22┊
+ ┊22┊23┊@NgModule({
+ ┊23┊24┊  imports: [
+```
+```diff
+@@ -36,7 +37,8 @@
+ ┊36┊37┊    MdInputModule.forRoot(),
+ ┊37┊38┊    MdCardModule.forRoot(),
+ ┊38┊39┊    MdCheckboxModule.forRoot(),
+-┊39┊  ┊    MdListModule.forRoot()
++┊  ┊40┊    MdListModule.forRoot(),
++┊  ┊41┊    FileDropModule
+ ┊40┊42┊  ],
+ ┊41┊43┊  declarations: [
+ ┊42┊44┊    AppComponent,
+```
+[}]: #
+
+Now, let's create the `PartiesUpload` component. It will be responsible for uploading photos, starting with a stub of the view:
+
+[{]: <helper> (diff_step 21.11)
+#### Step 21.11: Create a view for an upload
+
+##### Added client/imports/app/parties/parties-upload.component.html
+```diff
+@@ -0,0 +1,5 @@
++┊ ┊1┊<div layout="column">
++┊ ┊2┊  <div>
++┊ ┊3┊    <div>Drop an image to here</div>
++┊ ┊4┊  </div>
++┊ ┊5┊</div>🚫↵
+```
+[}]: #
+
+And the `Component`:
+
+[{]: <helper> (diff_step 21.12)
+#### Step 21.12: Create a PartiesUpload component
+
+##### Added client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -0,0 +1,11 @@
++┊  ┊ 1┊import { Component } from '@angular/core';
++┊  ┊ 2┊
++┊  ┊ 3┊import template from './parties-upload.component.html';
++┊  ┊ 4┊
++┊  ┊ 5┊@Component({
++┊  ┊ 6┊  selector: 'parties-upload',
++┊  ┊ 7┊  template
++┊  ┊ 8┊})
++┊  ┊ 9┊export class PartiesUploadComponent {
++┊  ┊10┊  constructor() {}
++┊  ┊11┊}🚫↵
+```
+[}]: #
+
+And let's add it to our declarations file:
+
+[{]: <helper> (diff_step 21.13)
+#### Step 21.13: Added PartiesUpload component to the index file
+
+##### Changed client/imports/app/parties/index.ts
+```diff
+@@ -1,9 +1,11 @@
+ ┊ 1┊ 1┊import { PartiesFormComponent } from './parties-form.component';
+ ┊ 2┊ 2┊import { PartiesListComponent } from './parties-list.component';
+ ┊ 3┊ 3┊import { PartyDetailsComponent } from './party-details.component';
++┊  ┊ 4┊import {PartiesUploadComponent} from "./parties-upload.component";
+ ┊ 4┊ 5┊
+ ┊ 5┊ 6┊export const PARTIES_DECLARATIONS = [
+ ┊ 6┊ 7┊  PartiesFormComponent,
+ ┊ 7┊ 8┊  PartiesListComponent,
+-┊ 8┊  ┊  PartyDetailsComponent
++┊  ┊ 9┊  PartyDetailsComponent,
++┊  ┊10┊  PartiesUploadComponent
+ ┊ 9┊11┊];
+```
+[}]: #
+
+We want to use it in `PartiesForm`:
+
+[{]: <helper> (diff_step 21.14)
+#### Step 21.14: Use PartiesUploadComponent inside the form
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -8,6 +8,8 @@
+ ┊ 8┊ 8┊      <md-checkbox formControlName="public">Public</md-checkbox>
+ ┊ 9┊ 9┊    </div>
+ ┊10┊10┊
++┊  ┊11┊    <parties-upload></parties-upload>
++┊  ┊12┊
+ ┊11┊13┊    <button md-raised-button type="submit">Add</button>
+ ┊12┊14┊  </fieldset>
+ ┊13┊15┊</form>🚫↵
+```
+[}]: #
+
+Now, let's implement `fileDrop` directive:
+
+[{]: <helper> (diff_step 21.15)
+#### Step 21.15: Add bindings to FileDrop
+
+##### Changed client/imports/app/parties/parties-upload.component.html
+```diff
+@@ -1,5 +1,8 @@
+ ┊1┊1┊<div layout="column">
+-┊2┊ ┊  <div>
++┊ ┊2┊  <div fileDrop
++┊ ┊3┊       [ngClass]="{'file-is-over': fileIsOver}"
++┊ ┊4┊       (fileOver)="fileOver($event)"
++┊ ┊5┊       (onFileDrop)="onFileDrop($event)">
+ ┊3┊6┊    <div>Drop an image to here</div>
+ ┊4┊7┊  </div>
+ ┊5┊8┊</div>🚫↵
+```
+[}]: #
+
+As you can see we used `fileOver` event. It tells the component if file is over the drop zone.
+
+We can now handle it inside the component:
+
+[{]: <helper> (diff_step 21.16)
+#### Step 21.16: Handle fileIsOver
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -7,5 +7,11 @@
+ ┊ 7┊ 7┊  template
+ ┊ 8┊ 8┊})
+ ┊ 9┊ 9┊export class PartiesUploadComponent {
++┊  ┊10┊  fileIsOver: boolean = false;
++┊  ┊11┊
+ ┊10┊12┊  constructor() {}
++┊  ┊13┊
++┊  ┊14┊  fileOver(fileIsOver: boolean): void {
++┊  ┊15┊    this.fileIsOver = fileIsOver;
++┊  ┊16┊  }
+ ┊11┊17┊}🚫↵
+```
+[}]: #
+
+Second thing is to handle `onFileDrop` event:
+
+[{]: <helper> (diff_step 21.17)
+#### Step 21.17: Implement onFileDrop method
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -14,4 +14,8 @@
+ ┊14┊14┊  fileOver(fileIsOver: boolean): void {
+ ┊15┊15┊    this.fileIsOver = fileIsOver;
+ ┊16┊16┊  }
++┊  ┊17┊
++┊  ┊18┊  onFileDrop(file: File): void {
++┊  ┊19┊    console.log('Got file');
++┊  ┊20┊  }
+ ┊17┊21┊}🚫↵
+```
+[}]: #
+
+Now our component is able to catch any dropped file, so let's create a function to upload that file into server.
+
+[{]: <helper> (diff_step 21.18)
+#### Step 21.18: Implement the upload method
+
+##### Added both/methods/images.methods.ts
+```diff
+@@ -0,0 +1,23 @@
++┊  ┊ 1┊import { UploadFS } from 'meteor/jalik:ufs';
++┊  ┊ 2┊import { ImagesStore } from '../collections/images.collection';
++┊  ┊ 3┊
++┊  ┊ 4┊export function upload(data: File): Promise<any> {
++┊  ┊ 5┊  return new Promise((resolve, reject) => {
++┊  ┊ 6┊    // pick from an object only: name, type and size
++┊  ┊ 7┊    const file = {
++┊  ┊ 8┊      name: data.name,
++┊  ┊ 9┊      type: data.type,
++┊  ┊10┊      size: data.size,
++┊  ┊11┊    };
++┊  ┊12┊
++┊  ┊13┊    const upload = new UploadFS.Uploader({
++┊  ┊14┊      data,
++┊  ┊15┊      file,
++┊  ┊16┊      store: ImagesStore,
++┊  ┊17┊      onError: reject,
++┊  ┊18┊      onComplete: resolve
++┊  ┊19┊    });
++┊  ┊20┊
++┊  ┊21┊    upload.start();
++┊  ┊22┊  });
++┊  ┊23┊}🚫↵
+```
+[}]: #
+
+Quick explanation. We need to know the name, the type and also the size of file we want to upload. We can get it from `data` object.
+
+Now we can move on to use that function in `PartiesUpload` component:
+
+[{]: <helper> (diff_step 21.19)
+#### Step 21.19: Use the upload function
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -2,12 +2,15 @@
+ ┊ 2┊ 2┊
+ ┊ 3┊ 3┊import template from './parties-upload.component.html';
+ ┊ 4┊ 4┊
++┊  ┊ 5┊import { upload } from '../../../../both/methods/images.methods';
++┊  ┊ 6┊
+ ┊ 5┊ 7┊@Component({
+ ┊ 6┊ 8┊  selector: 'parties-upload',
+ ┊ 7┊ 9┊  template
+ ┊ 8┊10┊})
+ ┊ 9┊11┊export class PartiesUploadComponent {
+ ┊10┊12┊  fileIsOver: boolean = false;
++┊  ┊13┊  uploading: boolean = false;
+ ┊11┊14┊
+ ┊12┊15┊  constructor() {}
+ ┊13┊16┊
+```
+```diff
+@@ -16,6 +19,15 @@
+ ┊16┊19┊  }
+ ┊17┊20┊
+ ┊18┊21┊  onFileDrop(file: File): void {
+-┊19┊  ┊    console.log('Got file');
++┊  ┊22┊    this.uploading = true;
++┊  ┊23┊
++┊  ┊24┊    upload(file)
++┊  ┊25┊      .then(() => {
++┊  ┊26┊        this.uploading = false;
++┊  ┊27┊      })
++┊  ┊28┊      .catch((error) => {
++┊  ┊29┊        this.uploading = false;
++┊  ┊30┊        console.log(`Something went wrong!`, error);
++┊  ┊31┊      });
+ ┊20┊32┊  }
+ ┊21┊33┊}🚫↵
+```
+[}]: #
+
+Now let's take a little break and solve those annoying missing modules errors. Since the uploading packages we used in the `upload` method are package that comes from Meteor Atmosphere and they not provide Typings (`.d.ts` files), we need to create one for them.
+
+Let's add it:
+
+[{]: <helper> (diff_step 21.20)
+#### Step 21.20: Declare meteor/jalik:ufs module
+
+##### Added typings/jalik-ufs.d.ts
+```diff
+@@ -0,0 +1,11 @@
++┊  ┊ 1┊declare module "meteor/jalik:ufs" {
++┊  ┊ 2┊  interface Uploader {
++┊  ┊ 3┊    start: () => void;
++┊  ┊ 4┊  }
++┊  ┊ 5┊
++┊  ┊ 6┊  interface UploadFS {
++┊  ┊ 7┊    Uploader: (options: any) => Uploader;
++┊  ┊ 8┊  }
++┊  ┊ 9┊
++┊  ┊10┊  export var UploadFS;
++┊  ┊11┊}🚫↵
+```
+[}]: #
+
+And you might see more errors because we used NodeJS API and we need to install it's `.d.ts` as well - this can be downloaded using `typings`:
+
+    $ typings install env~node --save --global
+
+Let's also add the `file-uploading` css class:
+
+[{]: <helper> (diff_step 21.22)
+#### Step 21.22: Implement classes
+
+##### Changed client/imports/app/parties/parties-upload.component.html
+```diff
+@@ -1,6 +1,6 @@
+ ┊1┊1┊<div layout="column">
+ ┊2┊2┊  <div fileDrop
+-┊3┊ ┊       [ngClass]="{'file-is-over': fileIsOver}"
++┊ ┊3┊       [ngClass]="{'file-is-over': fileIsOver, 'file-uploading': uploading}"
+ ┊4┊4┊       (fileOver)="fileOver($event)"
+ ┊5┊5┊       (onFileDrop)="onFileDrop($event)">
+ ┊6┊6┊    <div>Drop an image to here</div>
+```
+[}]: #
+
+### Display Uploaded Images
+
+Let's create a simple gallery to list the images in the new party form.
+
+First thing to do is to create a Publication for thumbnails:
+
+[{]: <helper> (diff_step 21.23)
+#### Step 21.23: Implement publications of Images and Thumbs
+
+##### Added server/imports/publications/images.ts
+```diff
+@@ -0,0 +1,15 @@
++┊  ┊ 1┊import { Meteor } from 'meteor/meteor';
++┊  ┊ 2┊import { Thumbs, Images } from '../../../both/collections/images.collection';
++┊  ┊ 3┊
++┊  ┊ 4┊Meteor.publish('thumbs', function(ids: string[]) {
++┊  ┊ 5┊  return Thumbs.collection.find({
++┊  ┊ 6┊    originalStore: 'images',
++┊  ┊ 7┊    originalId: {
++┊  ┊ 8┊      $in: ids
++┊  ┊ 9┊    }
++┊  ┊10┊  });
++┊  ┊11┊});
++┊  ┊12┊
++┊  ┊13┊Meteor.publish('images', function() {
++┊  ┊14┊  return Images.collection.find({});
++┊  ┊15┊});🚫↵
+```
+[}]: #
+
+As you can see we also created a Publication for images. We will use it later.
+
+We still need to add it on the server-side:
+
+[{]: <helper> (diff_step 21.24)
+#### Step 21.24: Import those publications in the server entry point
+
+##### Changed server/main.ts
+```diff
+@@ -5,6 +5,7 @@
+ ┊ 5┊ 5┊import './imports/publications/parties';
+ ┊ 6┊ 6┊import './imports/publications/users';
+ ┊ 7┊ 7┊import '../both/methods/parties.methods';
++┊  ┊ 8┊import './imports/publications/images';
+ ┊ 8┊ 9┊
+ ┊ 9┊10┊Meteor.startup(() => {
+ ┊10┊11┊  loadParties();
+```
+[}]: #
+
+Now let's take care of UI. This will need to be reactive, so we will use again the `MeteorObservable` wrapper and RxJS.
+
+Let's create a `Subject` that will be in charge of notification regarding files actions:
+
+[{]: <helper> (diff_step 21.25)
+#### Step 21.25: Use RxJS to keep track of files
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -1,9 +1,11 @@
+-┊ 1┊  ┊import { Component } from '@angular/core';
++┊  ┊ 1┊import {Component} from '@angular/core';
+ ┊ 2┊ 2┊
+ ┊ 3┊ 3┊import template from './parties-upload.component.html';
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊import { upload } from '../../../../both/methods/images.methods';
+ ┊ 6┊ 6┊
++┊  ┊ 7┊import {Subject, Subscription} from "rxjs";
++┊  ┊ 8┊
+ ┊ 7┊ 9┊@Component({
+ ┊ 8┊10┊  selector: 'parties-upload',
+ ┊ 9┊11┊  template
+```
+```diff
+@@ -11,6 +13,7 @@
+ ┊11┊13┊export class PartiesUploadComponent {
+ ┊12┊14┊  fileIsOver: boolean = false;
+ ┊13┊15┊  uploading: boolean = false;
++┊  ┊16┊  files: Subject<string[]> = new Subject<string[]>();
+ ┊14┊17┊
+ ┊15┊18┊  constructor() {}
+```
+[}]: #
+
+Let's now subscribe to `thumbs` publication with an array of those ids we created in the previous step:
+
+[{]: <helper> (diff_step 21.26)
+#### Step 21.26: Subscribe to the thumbs publication
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -1,22 +1,36 @@
+-┊ 1┊  ┊import {Component} from '@angular/core';
++┊  ┊ 1┊import {Component, OnInit} from '@angular/core';
+ ┊ 2┊ 2┊
+ ┊ 3┊ 3┊import template from './parties-upload.component.html';
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊import { upload } from '../../../../both/methods/images.methods';
+-┊ 6┊  ┊
+ ┊ 7┊ 6┊import {Subject, Subscription} from "rxjs";
++┊  ┊ 7┊import {MeteorObservable} from "meteor-rxjs";
+ ┊ 8┊ 8┊
+ ┊ 9┊ 9┊@Component({
+ ┊10┊10┊  selector: 'parties-upload',
+ ┊11┊11┊  template
+ ┊12┊12┊})
+-┊13┊  ┊export class PartiesUploadComponent {
++┊  ┊13┊export class PartiesUploadComponent implements OnInit {
+ ┊14┊14┊  fileIsOver: boolean = false;
+ ┊15┊15┊  uploading: boolean = false;
+ ┊16┊16┊  files: Subject<string[]> = new Subject<string[]>();
++┊  ┊17┊  thumbsSubscription: Subscription;
+ ┊17┊18┊
+ ┊18┊19┊  constructor() {}
+ ┊19┊20┊
++┊  ┊21┊  ngOnInit() {
++┊  ┊22┊    this.files.subscribe((filesArray) => {
++┊  ┊23┊      MeteorObservable.autorun().subscribe(() => {
++┊  ┊24┊        if (this.thumbsSubscription) {
++┊  ┊25┊          this.thumbsSubscription.unsubscribe();
++┊  ┊26┊          this.thumbsSubscription = undefined;
++┊  ┊27┊        }
++┊  ┊28┊
++┊  ┊29┊        this.thumbsSubscription = MeteorObservable.subscribe("thumbs", filesArray).subscribe();
++┊  ┊30┊      });
++┊  ┊31┊    });
++┊  ┊32┊  }
++┊  ┊33┊
+ ┊20┊34┊  fileOver(fileIsOver: boolean): void {
+ ┊21┊35┊    this.fileIsOver = fileIsOver;
+ ┊22┊36┊  }
+```
+[}]: #
+
+Now we can look for thumbnails that come from `ImagesStore`:
+
+[{]: <helper> (diff_step 21.27)
+#### Step 21.27: Look for the thumbnails
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -3,8 +3,10 @@
+ ┊ 3┊ 3┊import template from './parties-upload.component.html';
+ ┊ 4┊ 4┊
+ ┊ 5┊ 5┊import { upload } from '../../../../both/methods/images.methods';
+-┊ 6┊  ┊import {Subject, Subscription} from "rxjs";
++┊  ┊ 6┊import {Subject, Subscription, Observable} from "rxjs";
+ ┊ 7┊ 7┊import {MeteorObservable} from "meteor-rxjs";
++┊  ┊ 8┊import {Thumb} from "../../../../both/models/image.model";
++┊  ┊ 9┊import {Thumbs} from "../../../../both/collections/images.collection";
+ ┊ 8┊10┊
+ ┊ 9┊11┊@Component({
+ ┊10┊12┊  selector: 'parties-upload',
+```
+```diff
+@@ -15,6 +17,7 @@
+ ┊15┊17┊  uploading: boolean = false;
+ ┊16┊18┊  files: Subject<string[]> = new Subject<string[]>();
+ ┊17┊19┊  thumbsSubscription: Subscription;
++┊  ┊20┊  thumbs: Observable<Thumb[]>;
+ ┊18┊21┊
+ ┊19┊22┊  constructor() {}
+ ┊20┊23┊
+```
+```diff
+@@ -26,7 +29,14 @@
+ ┊26┊29┊          this.thumbsSubscription = undefined;
+ ┊27┊30┊        }
+ ┊28┊31┊
+-┊29┊  ┊        this.thumbsSubscription = MeteorObservable.subscribe("thumbs", filesArray).subscribe();
++┊  ┊32┊        this.thumbsSubscription = MeteorObservable.subscribe("thumbs", filesArray).subscribe(() => {
++┊  ┊33┊          this.thumbs = Thumbs.find({
++┊  ┊34┊            originalStore: 'images',
++┊  ┊35┊            originalId: {
++┊  ┊36┊              $in: filesArray
++┊  ┊37┊            }
++┊  ┊38┊          }).zone();
++┊  ┊39┊        });
+ ┊30┊40┊      });
+ ┊31┊41┊    });
+ ┊32┊42┊  }
+```
+[}]: #
+
+We still don't see any thumbnails, so let's add a view for the thumbs:
+
+[{]: <helper> (diff_step 21.28)
+#### Step 21.28: Implement the thumbnails in the view
+
+##### Changed client/imports/app/parties/parties-upload.component.html
+```diff
+@@ -5,4 +5,10 @@
+ ┊ 5┊ 5┊       (onFileDrop)="onFileDrop($event)">
+ ┊ 6┊ 6┊    <div>Drop an image to here</div>
+ ┊ 7┊ 7┊  </div>
++┊  ┊ 8┊
++┊  ┊ 9┊  <div layout="row" *ngIf="thumbs">
++┊  ┊10┊    <div *ngFor="let thumb of thumbs | async">
++┊  ┊11┊      <img [src]="thumb.url"/>
++┊  ┊12┊    </div>
++┊  ┊13┊  </div>
+ ┊ 8┊14┊</div>🚫↵
+```
+[}]: #
+
+Since we are working on a view right now, let's add some style.
+
+We need to create `parties-upload.component.scss` file:
+
+[{]: <helper> (diff_step 21.29)
+#### Step 21.29: Basic styles
+
+##### Added client/imports/app/parties/parties-upload.component.scss
+```diff
+@@ -0,0 +1,16 @@
++┊  ┊ 1┊.file-uploading {
++┊  ┊ 2┊  opacity: 0.3;
++┊  ┊ 3┊}
++┊  ┊ 4┊
++┊  ┊ 5┊.file-is-over {
++┊  ┊ 6┊  opacity: 0.7;
++┊  ┊ 7┊}
++┊  ┊ 8┊
++┊  ┊ 9┊[filedrop] {
++┊  ┊10┊  width: 100%;
++┊  ┊11┊  height: 100px;
++┊  ┊12┊  line-height: 100px;
++┊  ┊13┊  text-align: center;
++┊  ┊14┊  background-color: #f1f1f1;
++┊  ┊15┊  margin: 10px 0;
++┊  ┊16┊}🚫↵
+```
+[}]: #
+
+and to import that file in `client/main.scss`:
+
+[{]: <helper> (diff_step 21.30)
+#### Step 21.30: Import styles inside main.scss
+
+##### Changed client/main.scss
+```diff
+@@ -44,4 +44,5 @@
+ ┊44┊44┊}
+ ┊45┊45┊
+ ┊46┊46┊@import "./imports/app/parties/parties-list.component";
+-┊47┊  ┊@import "./imports/app/parties/party-details.component";🚫↵
++┊  ┊47┊@import "./imports/app/parties/party-details.component";
++┊  ┊48┊@import "./imports/app/parties/parties-upload.component";🚫↵
+```
+[}]: #
+
+Great! We can move on to the next step. Let's do something with the result of the `upload` function.
+
+We will create the `addFile` method that updates the `files` property, and we will add the actual array the in charge of the notifications in `files` (which is a `Subject` and only in charge of the notifications, not the actual data):
+
+[{]: <helper> (diff_step 21.31)
+#### Step 21.31: Handle file upload
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -15,6 +15,7 @@
+ ┊15┊15┊export class PartiesUploadComponent implements OnInit {
+ ┊16┊16┊  fileIsOver: boolean = false;
+ ┊17┊17┊  uploading: boolean = false;
++┊  ┊18┊  filesArray: string[] = [];
+ ┊18┊19┊  files: Subject<string[]> = new Subject<string[]>();
+ ┊19┊20┊  thumbsSubscription: Subscription;
+ ┊20┊21┊  thumbs: Observable<Thumb[]>;
+```
+```diff
+@@ -49,12 +50,18 @@
+ ┊49┊50┊    this.uploading = true;
+ ┊50┊51┊
+ ┊51┊52┊    upload(file)
+-┊52┊  ┊      .then(() => {
++┊  ┊53┊      .then((result) => {
+ ┊53┊54┊        this.uploading = false;
++┊  ┊55┊        this.addFile(result);
+ ┊54┊56┊      })
+ ┊55┊57┊      .catch((error) => {
+ ┊56┊58┊        this.uploading = false;
+ ┊57┊59┊        console.log(`Something went wrong!`, error);
+ ┊58┊60┊      });
+ ┊59┊61┊  }
++┊  ┊62┊
++┊  ┊63┊  addFile(file) {
++┊  ┊64┊    this.filesArray.push(file._id);
++┊  ┊65┊    this.files.next(this.filesArray);
++┊  ┊66┊  }
+ ┊60┊67┊}🚫↵
+```
+[}]: #
+
+We want a communication between PartiesUpload and PartiesForm. Let's use `Output` decorator and the `EventEmitter` to notify PartiesForm component about every new file.
+
+[{]: <helper> (diff_step 21.32)
+#### Step 21.32: Emit event with the new file
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -1,4 +1,4 @@
+-┊1┊ ┊import {Component, OnInit} from '@angular/core';
++┊ ┊1┊import {Component, OnInit, EventEmitter, Output} from '@angular/core';
+ ┊2┊2┊
+ ┊3┊3┊import template from './parties-upload.component.html';
+ ┊4┊4┊
+```
+```diff
+@@ -19,6 +19,7 @@
+ ┊19┊19┊  files: Subject<string[]> = new Subject<string[]>();
+ ┊20┊20┊  thumbsSubscription: Subscription;
+ ┊21┊21┊  thumbs: Observable<Thumb[]>;
++┊  ┊22┊  @Output() onFile: EventEmitter<string> = new EventEmitter<string>();
+ ┊22┊23┊
+ ┊23┊24┊  constructor() {}
+ ┊24┊25┊
+```
+```diff
+@@ -63,5 +64,6 @@
+ ┊63┊64┊  addFile(file) {
+ ┊64┊65┊    this.filesArray.push(file._id);
+ ┊65┊66┊    this.files.next(this.filesArray);
++┊  ┊67┊    this.onFile.emit(file._id);
+ ┊66┊68┊  }
+ ┊67┊69┊}🚫↵
+```
+[}]: #
+
+On the receiving side of this connection we have the PartiesForm component.
+
+Create a method that handles an event with the new file and put images inside the FormBuilder.
+
+[{]: <helper> (diff_step 21.33)
+#### Step 21.33: Add images to the PartiesForm component
+
+##### Changed client/imports/app/parties/parties-form.component.ts
+```diff
+@@ -12,6 +12,7 @@
+ ┊12┊12┊})
+ ┊13┊13┊export class PartiesFormComponent implements OnInit {
+ ┊14┊14┊  addForm: FormGroup;
++┊  ┊15┊  images: string[] = [];
+ ┊15┊16┊
+ ┊16┊17┊  constructor(
+ ┊17┊18┊    private formBuilder: FormBuilder
+```
+```diff
+@@ -39,6 +40,7 @@
+ ┊39┊40┊        location: {
+ ┊40┊41┊          name: this.addForm.value.location
+ ┊41┊42┊        },
++┊  ┊43┊        images: this.images,
+ ┊42┊44┊        public: this.addForm.value.public,
+ ┊43┊45┊        owner: Meteor.userId()
+ ┊44┊46┊      });
+```
+```diff
+@@ -46,4 +48,8 @@
+ ┊46┊48┊      this.addForm.reset();
+ ┊47┊49┊    }
+ ┊48┊50┊  }
++┊  ┊51┊
++┊  ┊52┊  onImage(imageId: string) {
++┊  ┊53┊    this.images.push(imageId);
++┊  ┊54┊  }
+ ┊49┊55┊}
+```
+[}]: #
+
+To keep Party interface up to date, we need to add `images` to it:
+
+[{]: <helper> (diff_step 21.34)
+#### Step 21.34: Add images property to the Party interface
+
+##### Changed both/models/party.model.ts
+```diff
+@@ -8,6 +8,7 @@
+ ┊ 8┊ 8┊  public: boolean;
+ ┊ 9┊ 9┊  invited?: string[];
+ ┊10┊10┊  rsvps?: RSVP[];
++┊  ┊11┊  images?: string[];
+ ┊11┊12┊}
+ ┊12┊13┊
+ ┊13┊14┊interface RSVP {
+```
+[}]: #
+
+The last step will be to create an event binding for `onFile`.
+
+[{]: <helper> (diff_step 21.35)
+#### Step 21.35: Bind the onFile event
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -8,7 +8,7 @@
+ ┊ 8┊ 8┊      <md-checkbox formControlName="public">Public</md-checkbox>
+ ┊ 9┊ 9┊    </div>
+ ┊10┊10┊
+-┊11┊  ┊    <parties-upload></parties-upload>
++┊  ┊11┊    <parties-upload (onFile)="onImage($event)"></parties-upload>
+ ┊12┊12┊
+ ┊13┊13┊    <button md-raised-button type="submit">Add</button>
+ ┊14┊14┊  </fieldset>
+```
+[}]: #
+
+### Display the main image of each party on the list
+
+We will use Pipes to achieve this.
+
+Let's create the `DisplayMainImagePipe` inside `client/imports/app/shared/display-main-image.pipe.ts`:
+
+[{]: <helper> (diff_step 21.36)
+#### Step 21.36: Create DisplayMainImage pipe
+
+##### Added client/imports/app/shared/display-main-image.pipe.ts
+```diff
+@@ -0,0 +1,25 @@
++┊  ┊ 1┊import {Pipe, PipeTransform} from '@angular/core';
++┊  ┊ 2┊import { Images } from '../../../../both/collections/images.collection';
++┊  ┊ 3┊import { Party } from '../../../../both/models/party.model';
++┊  ┊ 4┊
++┊  ┊ 5┊@Pipe({
++┊  ┊ 6┊  name: 'displayMainImage'
++┊  ┊ 7┊})
++┊  ┊ 8┊export class DisplayMainImagePipe implements PipeTransform {
++┊  ┊ 9┊  transform(party: Party) {
++┊  ┊10┊    if (!party) {
++┊  ┊11┊      return;
++┊  ┊12┊    }
++┊  ┊13┊
++┊  ┊14┊    let imageUrl: string;
++┊  ┊15┊    let imageId: string = (party.images || [])[0];
++┊  ┊16┊
++┊  ┊17┊    const found = Images.findOne(imageId);
++┊  ┊18┊
++┊  ┊19┊    if (found) {
++┊  ┊20┊      imageUrl = found.url;
++┊  ┊21┊    }
++┊  ┊22┊
++┊  ┊23┊    return imageUrl;
++┊  ┊24┊  }
++┊  ┊25┊}🚫↵
+```
+[}]: #
+
+Since we have it done, let's add it to PartiesList:
+
+[{]: <helper> (diff_step 21.37)
+#### Step 21.37: Add DisplayMainImage pipe
+
+##### Changed client/imports/app/shared/index.ts
+```diff
+@@ -1,7 +1,9 @@
+ ┊1┊1┊import { DisplayNamePipe } from './display-name.pipe';
+ ┊2┊2┊import {RsvpPipe} from "./rsvp.pipe";
++┊ ┊3┊import {DisplayMainImagePipe} from "./display-main-image.pipe";
+ ┊3┊4┊
+ ┊4┊5┊export const SHARED_DECLARATIONS: any[] = [
+ ┊5┊6┊  DisplayNamePipe,
+-┊6┊ ┊  RsvpPipe
++┊ ┊7┊  RsvpPipe,
++┊ ┊8┊  DisplayMainImagePipe
+ ┊7┊9┊];
+```
+[}]: #
+
+We also need to subscribe to `images`:
+
+[{]: <helper> (diff_step 21.38)
+#### Step 21.38: Subscribe to the images publication
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -39,6 +39,7 @@
+ ┊39┊39┊  autorunSub: Subscription;
+ ┊40┊40┊  location: Subject<string> = new Subject<string>();
+ ┊41┊41┊  user: Meteor.User;
++┊  ┊42┊  imagesSubs: Subscription;
+ ┊42┊43┊
+ ┊43┊44┊  constructor(
+ ┊44┊45┊    private paginationService: PaginationService
+```
+```diff
+@@ -88,6 +89,8 @@
+ ┊88┊89┊      this.partiesSize = Counts.get('numberOfParties');
+ ┊89┊90┊      this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
+ ┊90┊91┊    });
++┊  ┊92┊
++┊  ┊93┊    this.imagesSubs = MeteorObservable.subscribe('images').subscribe();
+ ┊91┊94┊  }
+ ┊92┊95┊
+ ┊93┊96┊  removeParty(party: Party): void {
+```
+```diff
+@@ -115,5 +118,6 @@
+ ┊115┊118┊    this.partiesSub.unsubscribe();
+ ┊116┊119┊    this.optionsSub.unsubscribe();
+ ┊117┊120┊    this.autorunSub.unsubscribe();
++┊   ┊121┊    this.imagesSubs.unsubscribe();
+ ┊118┊122┊  }
+ ┊119┊123┊}
+```
+[}]: #
+
+We can now just implement it:
+
+[{]: <helper> (diff_step 21.39)
+#### Step 21.39: Implement the pipe
+
+##### Changed client/imports/app/parties/parties-list.component.html
+```diff
+@@ -27,6 +27,7 @@
+ ┊27┊27┊          <div *ngFor="let party of parties | async">
+ ┊28┊28┊            <md-card>
+ ┊29┊29┊              <md-card-content>
++┊  ┊30┊                <img *ngIf="party.images" class="party-main-image" [src]="party | displayMainImage">
+ ┊30┊31┊                <h2 class="md-title ma-name">
+ ┊31┊32┊                  <a [routerLink]="['/party', party._id]">undefined</a>
+ ┊32┊33┊                </h2>
+```
+[}]: #
+
+Add some css rules to keep the control of images:
+
+[{]: <helper> (diff_step 21.40)
+#### Step 21.40: Add some styles
+
+##### Changed client/imports/app/parties/parties-list.component.scss
+```diff
+@@ -58,4 +58,9 @@
+ ┊58┊58┊
+ ┊59┊59┊.search-form {
+ ┊60┊60┊  margin-bottom: 1em;
++┊  ┊61┊}
++┊  ┊62┊
++┊  ┊63┊img.party-main-image {
++┊  ┊64┊  max-width: 100%;
++┊  ┊65┊  max-height: 100%;
+ ┊61┊66┊}🚫↵
+```
+[}]: #
+
+We still need to add the reset functionality to the component, since we want to manage what happens after images were added:
+
+[{]: <helper> (diff_step 21.41)
+#### Step 21.41: Add the reset method to PartiesUpload component
+
+##### Changed client/imports/app/parties/parties-upload.component.ts
+```diff
+@@ -66,4 +66,9 @@
+ ┊66┊66┊    this.files.next(this.filesArray);
+ ┊67┊67┊    this.onFile.emit(file._id);
+ ┊68┊68┊  }
++┊  ┊69┊
++┊  ┊70┊  reset() {
++┊  ┊71┊    this.filesArray = [];
++┊  ┊72┊    this.files.next(this.filesArray);
++┊  ┊73┊  }
+ ┊69┊74┊}🚫↵
+```
+[}]: #
+
+By using `#upload` we get access to the PartiesUpload component's API. We can now use the `reset()`` method:
+
+[{]: <helper> (diff_step 21.42)
+#### Step 21.42: Reset files on ngSubmit
+
+##### Changed client/imports/app/parties/parties-form.component.html
+```diff
+@@ -1,4 +1,4 @@
+-┊1┊ ┊<form [formGroup]="addForm" (ngSubmit)="addParty()">
++┊ ┊1┊<form [formGroup]="addForm" (ngSubmit)="addParty(); upload.reset()">
+ ┊2┊2┊  <fieldset class="form-group">
+ ┊3┊3┊    <md-input formControlName="name" placeholder="Party name"></md-input>
+ ┊4┊4┊    <md-input formControlName="description" placeholder="Description"></md-input>
+```
+```diff
+@@ -8,7 +8,7 @@
+ ┊ 8┊ 8┊      <md-checkbox formControlName="public">Public</md-checkbox>
+ ┊ 9┊ 9┊    </div>
+ ┊10┊10┊
+-┊11┊  ┊    <parties-upload (onFile)="onImage($event)"></parties-upload>
++┊  ┊11┊    <parties-upload #upload (onFile)="onImage($event)"></parties-upload>
+ ┊12┊12┊
+ ┊13┊13┊    <button md-raised-button type="submit">Add</button>
+ ┊14┊14┊  </fieldset>
+```
+[}]: #
+
+And that's it!
+
+### Cloud Storage
+
+By storing files in the cloud you can reduce your costs and get a lot of other benefits.
+
+Since this chapter is all about uploading files and UploadFS doesn't have built-in support for cloud services we should mention another library for that.
+
+We recommend you to use [Slingshot](https://github.com/CulturalMe/meteor-slingshot/). You can install it by running:
+
+    $ meteor add edgee:slingshot
+
+It's very easy to use with AWS S3, Google Cloud and other cloud storage services.
+
+From slignshot's repository:
+
+> meteor-slingshot uploads the files directly to the cloud service from the browser without ever exposing your secret access key or any other sensitive data to the client and without requiring public write access to cloud storage to the entire public.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step20.md) | [Next Step >](step22.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From ef320a79978443fdfd4a034d2d4df7a5fc25177d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:34:29 +0300
Subject: [PATCH 244/292] Step 22.1: Add mobile platform

---
 .meteor/platforms | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/.meteor/platforms b/.meteor/platforms
index efeba1b..2d49a85 100644
--- a/.meteor/platforms
+++ b/.meteor/platforms
@@ -1,2 +1,4 @@
-server
+android
 browser
+ios
+server
-- 
2.7.4


From 4b816a094662d3a29b5e191a3f2849b3bbceefa0 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 11:26:49 +0300
Subject: [PATCH 245/292] Step 22.2: Wrapped Angular 2 bootstrap with Meteor
 startup

---
 client/main.ts | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/client/main.ts b/client/main.ts
index 45d1530..7c00907 100644
--- a/client/main.ts
+++ b/client/main.ts
@@ -6,5 +6,7 @@ import { AppModule } from './imports/app/app.module';
 
 import '../both/methods/parties.methods';
 
-const platform = platformBrowserDynamic();
-platform.bootstrapModule(AppModule);
\ No newline at end of file
+Meteor.startup(() => {
+  const platform = platformBrowserDynamic();
+  platform.bootstrapModule(AppModule);
+});
\ No newline at end of file
-- 
2.7.4


From ac6c22b3488d12c1c1f9327b7c72d1a9f701d2a4 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:34:43 +0300
Subject: [PATCH 246/292] Step 22.3: Rename to login.web.component.html

---
 client/imports/app/auth/login.component.html     | 37 ------------------------
 client/imports/app/auth/login.component.web.html | 37 ++++++++++++++++++++++++
 2 files changed, 37 insertions(+), 37 deletions(-)
 delete mode 100644 client/imports/app/auth/login.component.html
 create mode 100644 client/imports/app/auth/login.component.web.html

diff --git a/client/imports/app/auth/login.component.html b/client/imports/app/auth/login.component.html
deleted file mode 100644
index 04fe11c..0000000
--- a/client/imports/app/auth/login.component.html
+++ /dev/null
@@ -1,37 +0,0 @@
-<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
-  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
-    <md-toolbar class="md-primary" color="primary">
-      Sign in
-    </md-toolbar>
-
-    <div layout="column" layout-fill layout-margin layout-padding>
-      <div layout="row" layout-fill layout-margin>
-        <p class="md-body-2"> Sign in with your email</p>
-      </div>
-
-      <form [formGroup]="loginForm" #f="ngForm" (ngSubmit)="login()"
-            layout="column" layout-fill layout-padding layout-margin>
-
-        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
-        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
-
-        <div layout="row" layout-align="space-between center">
-          <a md-button [routerLink]="['/recover']">Forgot password?</a>
-          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign In</button>
-        </div>
-      </form>
-
-      <div [hidden]="error == ''">
-        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
-          <p class="md-body-1">{{ error }}</p>
-        </md-toolbar>
-      </div>
-
-      <md-divider></md-divider>
-
-      <div layout="row" layout-align="center">
-        <a md-button [routerLink]="['/signup']">Need an account?</a>
-      </div>
-    </div>
-  </div>
-</div>
\ No newline at end of file
diff --git a/client/imports/app/auth/login.component.web.html b/client/imports/app/auth/login.component.web.html
new file mode 100644
index 0000000..04fe11c
--- /dev/null
+++ b/client/imports/app/auth/login.component.web.html
@@ -0,0 +1,37 @@
+<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
+  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
+    <md-toolbar class="md-primary" color="primary">
+      Sign in
+    </md-toolbar>
+
+    <div layout="column" layout-fill layout-margin layout-padding>
+      <div layout="row" layout-fill layout-margin>
+        <p class="md-body-2"> Sign in with your email</p>
+      </div>
+
+      <form [formGroup]="loginForm" #f="ngForm" (ngSubmit)="login()"
+            layout="column" layout-fill layout-padding layout-margin>
+
+        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
+        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
+
+        <div layout="row" layout-align="space-between center">
+          <a md-button [routerLink]="['/recover']">Forgot password?</a>
+          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign In</button>
+        </div>
+      </form>
+
+      <div [hidden]="error == ''">
+        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+          <p class="md-body-1">{{ error }}</p>
+        </md-toolbar>
+      </div>
+
+      <md-divider></md-divider>
+
+      <div layout="row" layout-align="center">
+        <a md-button [routerLink]="['/signup']">Need an account?</a>
+      </div>
+    </div>
+  </div>
+</div>
\ No newline at end of file
-- 
2.7.4


From 77bdbb86270aebcc88322e9dc3ad95b894f80664 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:34:55 +0300
Subject: [PATCH 247/292] Step 22.4: Do the same for login.component.ts

---
 client/imports/app/auth/login.component.ts     | 40 --------------------------
 client/imports/app/auth/login.component.web.ts | 40 ++++++++++++++++++++++++++
 2 files changed, 40 insertions(+), 40 deletions(-)
 delete mode 100644 client/imports/app/auth/login.component.ts
 create mode 100644 client/imports/app/auth/login.component.web.ts

diff --git a/client/imports/app/auth/login.component.ts b/client/imports/app/auth/login.component.ts
deleted file mode 100644
index ed740de..0000000
--- a/client/imports/app/auth/login.component.ts
+++ /dev/null
@@ -1,40 +0,0 @@
-import {Component, OnInit, NgZone} from '@angular/core';
-import { FormBuilder, FormGroup, Validators } from '@angular/forms';
-import { Router } from '@angular/router';
-import { Meteor } from 'meteor/meteor';
-
-import template from './login.component.html';
-
-@Component({
-  selector: 'login',
-  template
-})
-export class LoginComponent implements OnInit {
-  loginForm: FormGroup;
-  error: string;
-
-  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
-
-  ngOnInit() {
-    this.loginForm = this.formBuilder.group({
-      email: ['', Validators.required],
-      password: ['', Validators.required]
-    });
-
-    this.error = '';
-  }
-
-  login() {
-    if (this.loginForm.valid) {
-      Meteor.loginWithPassword(this.loginForm.value.email, this.loginForm.value.password, (err) => {
-        if (err) {
-          this.zone.run(() => {
-            this.error = err;
-          });
-        } else {
-          this.router.navigate(['/']);
-        }
-      });
-    }
-  }
-}
\ No newline at end of file
diff --git a/client/imports/app/auth/login.component.web.ts b/client/imports/app/auth/login.component.web.ts
new file mode 100644
index 0000000..ed740de
--- /dev/null
+++ b/client/imports/app/auth/login.component.web.ts
@@ -0,0 +1,40 @@
+import {Component, OnInit, NgZone} from '@angular/core';
+import { FormBuilder, FormGroup, Validators } from '@angular/forms';
+import { Router } from '@angular/router';
+import { Meteor } from 'meteor/meteor';
+
+import template from './login.component.html';
+
+@Component({
+  selector: 'login',
+  template
+})
+export class LoginComponent implements OnInit {
+  loginForm: FormGroup;
+  error: string;
+
+  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
+
+  ngOnInit() {
+    this.loginForm = this.formBuilder.group({
+      email: ['', Validators.required],
+      password: ['', Validators.required]
+    });
+
+    this.error = '';
+  }
+
+  login() {
+    if (this.loginForm.valid) {
+      Meteor.loginWithPassword(this.loginForm.value.email, this.loginForm.value.password, (err) => {
+        if (err) {
+          this.zone.run(() => {
+            this.error = err;
+          });
+        } else {
+          this.router.navigate(['/']);
+        }
+      });
+    }
+  }
+}
\ No newline at end of file
-- 
2.7.4


From a61d26b4b9ef66092e751896adadaa98ef02443f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:35:10 +0300
Subject: [PATCH 248/292] Step 22.5: Update the template

---
 client/imports/app/auth/login.component.web.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/auth/login.component.web.ts b/client/imports/app/auth/login.component.web.ts
index ed740de..81d0e24 100644
--- a/client/imports/app/auth/login.component.web.ts
+++ b/client/imports/app/auth/login.component.web.ts
@@ -3,7 +3,7 @@ import { FormBuilder, FormGroup, Validators } from '@angular/forms';
 import { Router } from '@angular/router';
 import { Meteor } from 'meteor/meteor';
 
-import template from './login.component.html';
+import template from './login.component.web.html';
 
 @Component({
   selector: 'login',
-- 
2.7.4


From edc86c797e18681e1c2106e83a7f2414784165bf Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:37:42 +0300
Subject: [PATCH 249/292] Step 22.6: Update the index file

---
 client/imports/app/auth/index.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/auth/index.ts b/client/imports/app/auth/index.ts
index 7e5754e..228cb9c 100644
--- a/client/imports/app/auth/index.ts
+++ b/client/imports/app/auth/index.ts
@@ -1,4 +1,4 @@
-import {LoginComponent} from "./login.component";
+import {LoginComponent} from "./login.component.web";
 import {SignupComponent} from "./singup.component";
 import {RecoverComponent} from "./recover.component";
 
-- 
2.7.4


From 4c1b986f60de59d79b0b5f39b99744552e2a6e43 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:38:00 +0300
Subject: [PATCH 250/292] Step 22.7: Add accounts-phone package

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 2d94ff6..0f19195 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -27,3 +27,4 @@ check
 email
 jalik:ufs
 jalik:ufs-gridfs
+mys:accounts-phone
diff --git a/.meteor/versions b/.meteor/versions
index c3f660f..a17bd5a 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -61,6 +61,7 @@ modules@0.7.6
 modules-runtime@0.7.6
 mongo@1.1.12
 mongo-id@1.0.5
+mys:accounts-phone@0.0.21
 npm-bcrypt@0.9.1
 npm-mongo@1.5.49
 observe-sequence@1.0.12
-- 
2.7.4


From 7e4094fadacc0fe80d7a63c50e77283ac63669ca Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:39:01 +0300
Subject: [PATCH 251/292] Step 22.8: Create a view for the mobile login

---
 client/imports/app/auth/login.component.mobile.html | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)
 create mode 100644 client/imports/app/auth/login.component.mobile.html

diff --git a/client/imports/app/auth/login.component.mobile.html b/client/imports/app/auth/login.component.mobile.html
new file mode 100644
index 0000000..cd71ab3
--- /dev/null
+++ b/client/imports/app/auth/login.component.mobile.html
@@ -0,0 +1,19 @@
+<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
+  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
+    <md-toolbar class="md-primary" color="primary">
+      Sign in
+    </md-toolbar>
+
+    <div layout="column" layout-fill layout-margin layout-padding>
+      <div layout="row" layout-fill layout-margin>
+        <p class="md-body-2"> Sign in with SMS</p>
+      </div>
+
+      <div [hidden]="error == ''">
+        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+          <p class="md-body-1">{{ error }}</p>
+        </md-toolbar>
+      </div>
+    </div>
+  </div>
+</div>
\ No newline at end of file
-- 
2.7.4


From f63ac93ec5dc9f69a782260473eb155816dc404e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:40:04 +0300
Subject: [PATCH 252/292] Step 22.9: Create mobile version of Login component

---
 client/imports/app/auth/login.component.mobile.ts | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 client/imports/app/auth/login.component.mobile.ts

diff --git a/client/imports/app/auth/login.component.mobile.ts b/client/imports/app/auth/login.component.mobile.ts
new file mode 100644
index 0000000..75a6e78
--- /dev/null
+++ b/client/imports/app/auth/login.component.mobile.ts
@@ -0,0 +1,17 @@
+import { Component, OnInit } from '@angular/core';
+import { FormBuilder, FormGroup, Validators } from '@angular/forms';
+import { Router } from '@angular/router';
+
+import template from './login.component.mobile.html';
+
+@Component({
+  selector: 'login',
+  template
+})
+export class MobileLoginComponent implements OnInit {
+  error: string = '';
+
+  constructor(private router: Router, private formBuilder: FormBuilder) {}
+
+  ngOnInit() {}
+}
\ No newline at end of file
-- 
2.7.4


From 5cc708265319abe9410fa1afbd834b1794a8332f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:40:42 +0300
Subject: [PATCH 253/292] Step 22.10: Add a form with phone number to provide

---
 client/imports/app/auth/login.component.mobile.html | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/imports/app/auth/login.component.mobile.html b/client/imports/app/auth/login.component.mobile.html
index cd71ab3..2154629 100644
--- a/client/imports/app/auth/login.component.mobile.html
+++ b/client/imports/app/auth/login.component.mobile.html
@@ -9,6 +9,16 @@
         <p class="md-body-2"> Sign in with SMS</p>
       </div>
 
+      <form [formGroup]="phoneForm" #f="ngForm" (ngSubmit)="send()"
+            layout="column" layout-fill layout-padding layout-margin>
+
+        <md-input formControlName="phone" type="text" placeholder="Phone"></md-input>
+
+        <div layout="row" layout-align="space-between center">
+          <button md-raised-button class="md-primary" type="submit" aria-label="send">Send SMS</button>
+        </div>
+      </form>
+
       <div [hidden]="error == ''">
         <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
           <p class="md-body-1">{{ error }}</p>
-- 
2.7.4


From c462c1a4ac3e7f18e8c1907066ac40efa5e9debd Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:42:13 +0300
Subject: [PATCH 254/292] Step 22.11: Implement a phone number verification

---
 client/imports/app/auth/login.component.mobile.ts | 28 ++++++++++++++++++++---
 1 file changed, 25 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/auth/login.component.mobile.ts b/client/imports/app/auth/login.component.mobile.ts
index 75a6e78..651abdc 100644
--- a/client/imports/app/auth/login.component.mobile.ts
+++ b/client/imports/app/auth/login.component.mobile.ts
@@ -1,6 +1,7 @@
-import { Component, OnInit } from '@angular/core';
+import {Component, OnInit, NgZone} from '@angular/core';
 import { FormBuilder, FormGroup, Validators } from '@angular/forms';
 import { Router } from '@angular/router';
+import { Accounts } from 'meteor/accounts-base';
 
 import template from './login.component.mobile.html';
 
@@ -10,8 +11,29 @@ import template from './login.component.mobile.html';
 })
 export class MobileLoginComponent implements OnInit {
   error: string = '';
+  phoneForm: FormGroup;
+  phone: string;
 
-  constructor(private router: Router, private formBuilder: FormBuilder) {}
+  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
 
-  ngOnInit() {}
+  ngOnInit() {
+    this.phoneForm = this.formBuilder.group({
+      phone: ['', Validators.required]
+    });
+  }
+
+  send() {
+    if (this.phoneForm.valid) {
+      Accounts.requestPhoneVerification(this.phoneForm.value.phone, (err) => {
+        this.zone.run(() => {
+          if (err) {
+            this.error = err.reason || err;
+          } else {
+            this.phone = this.phoneForm.value.phone;
+            this.error = '';
+          }
+        });
+      });
+    }
+  }
 }
\ No newline at end of file
-- 
2.7.4


From 734345580dfaf3d24949337bd82937e7d7d1f024 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:43:17 +0300
Subject: [PATCH 255/292] Step 22.12: Implement a code verification

---
 client/imports/app/auth/login.component.mobile.ts | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)

diff --git a/client/imports/app/auth/login.component.mobile.ts b/client/imports/app/auth/login.component.mobile.ts
index 651abdc..4695bda 100644
--- a/client/imports/app/auth/login.component.mobile.ts
+++ b/client/imports/app/auth/login.component.mobile.ts
@@ -13,6 +13,8 @@ export class MobileLoginComponent implements OnInit {
   error: string = '';
   phoneForm: FormGroup;
   phone: string;
+  verifyForm: FormGroup;
+  isStepTwo: boolean = false;
 
   constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
 
@@ -20,6 +22,10 @@ export class MobileLoginComponent implements OnInit {
     this.phoneForm = this.formBuilder.group({
       phone: ['', Validators.required]
     });
+
+    this.verifyForm = this.formBuilder.group({
+        code: ['', Validators.required]
+    });
   }
 
   send() {
@@ -31,6 +37,23 @@ export class MobileLoginComponent implements OnInit {
           } else {
             this.phone = this.phoneForm.value.phone;
             this.error = '';
+            this.isStepTwo = true;
+          }
+        });
+      });
+    }
+  }
+
+
+  verify() {
+    if (this.verifyForm.valid) {
+      Accounts.verifyPhone(this.phone, this.verifyForm.value.code, (err) => {
+        this.zone.run(() => {
+          if (err) {
+            this.error = err.reason || err;
+          }
+          else {
+            this.router.navigate(['/']);
           }
         });
       });
-- 
2.7.4


From cb48799bfe4e276947341bc179868ec111868f43 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:44:00 +0300
Subject: [PATCH 256/292] Step 22.13: Create a form with code verification

---
 client/imports/app/auth/login.component.mobile.html | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/auth/login.component.mobile.html b/client/imports/app/auth/login.component.mobile.html
index 2154629..f6dc6b7 100644
--- a/client/imports/app/auth/login.component.mobile.html
+++ b/client/imports/app/auth/login.component.mobile.html
@@ -9,7 +9,7 @@
         <p class="md-body-2"> Sign in with SMS</p>
       </div>
 
-      <form [formGroup]="phoneForm" #f="ngForm" (ngSubmit)="send()"
+      <form [formGroup]="phoneForm" *ngIf="!isStepTwo" #f="ngForm" (ngSubmit)="send()"
             layout="column" layout-fill layout-padding layout-margin>
 
         <md-input formControlName="phone" type="text" placeholder="Phone"></md-input>
@@ -19,6 +19,16 @@
         </div>
       </form>
 
+      <form *ngIf="isStepTwo" [formGroup]="verifyForm" #f="ngForm" (ngSubmit)="verify()"
+            layout="column" layout-fill layout-padding layout-margin>
+
+        <md-input formControlName="code" type="text" placeholder="Code"></md-input>
+
+        <div layout="row" layout-align="space-between center">
+          <button md-raised-button class="md-primary" type="submit" aria-label="verify">Verify code</button>
+        </div>
+      </form>
+
       <div [hidden]="error == ''">
         <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
           <p class="md-body-1">{{ error }}</p>
-- 
2.7.4


From d465d6e2cc21a389a84630cd3eed27ec78950191 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:46:50 +0300
Subject: [PATCH 257/292] Step 22.14: Added MobileLoginComponent to the index
 file

---
 client/imports/app/auth/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/auth/index.ts b/client/imports/app/auth/index.ts
index 228cb9c..dbca5ff 100644
--- a/client/imports/app/auth/index.ts
+++ b/client/imports/app/auth/index.ts
@@ -1,9 +1,11 @@
 import {LoginComponent} from "./login.component.web";
 import {SignupComponent} from "./singup.component";
 import {RecoverComponent} from "./recover.component";
+import {MobileLoginComponent} from "./login.component.mobile";
 
 export const AUTH_DECLARATIONS = [
   LoginComponent,
   SignupComponent,
-  RecoverComponent
+  RecoverComponent,
+  MobileLoginComponent
 ];
-- 
2.7.4


From a3bf8c90df26ff8fe0258b73353a50acd3567365 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Tue, 27 Sep 2016 16:47:36 +0300
Subject: [PATCH 258/292] Step 22.15: Choose mobile or web version

---
 client/imports/app/app.routes.ts | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
index efefd60..bb84cb5 100644
--- a/client/imports/app/app.routes.ts
+++ b/client/imports/app/app.routes.ts
@@ -3,14 +3,15 @@ import { Meteor } from 'meteor/meteor';
 
 import { PartiesListComponent } from './parties/parties-list.component';
 import { PartyDetailsComponent } from './parties/party-details.component';
-import {LoginComponent} from "./auth/login.component";
 import {SignupComponent} from "./auth/singup.component";
 import {RecoverComponent} from "./auth/recover.component";
+import {MobileLoginComponent} from "./auth/login.component.mobile";
+import {LoginComponent} from "./auth/login.component.web";
 
 export const routes: Route[] = [
   { path: '', component: PartiesListComponent },
   { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
-  { path: 'login', component: LoginComponent },
+  { path: 'login', component: Meteor.isCordova ? MobileLoginComponent : LoginComponent },
   { path: 'signup', component: SignupComponent },
   { path: 'recover', component: RecoverComponent }
 ];
-- 
2.7.4


From 9a2c574dff53be8f7da8b219a574ceb799c0c83e Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 16:37:55 -0200
Subject: [PATCH 259/292] Step 22: Mobile Support & Packages Isolation

---
 steps/step22.md | 610 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 610 insertions(+)
 create mode 100644 steps/step22.md

diff --git a/steps/step22.md b/steps/step22.md
new file mode 100644
index 0000000..8698a7b
--- /dev/null
+++ b/steps/step22.md
@@ -0,0 +1,610 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Mobile Support & Packages Isolation
+
+This step of the tutorial teaches us how to add mobile support for iOS and Android and how to elegantly reuse code using the es2015 modules.
+
+In this tutorial's example we will differentiate the login part of the project: in the browser users will login using email and password and in the mobile app users will login with SMS verification.
+
+### Adding mobile support for the project:
+
+To add mobile support, select the platform(s) you want and run the following command:
+
+    $ meteor add-platform ios
+    # OR / AND
+    $ meteor add-platform android
+
+And now to run in the emulator, run:
+
+    $ meteor run ios
+    # OR
+    $ meteor run android
+
+You can also run in a real mobile device, for more instructions, read the ["Mobile" chapter](http://guide.meteor.com/mobile.html) of the Official Meteor Guide.
+
+Before we can run Meteor and Angular 2 on mobile platform, we need to make sure that our Angular 2 NgModule initialized only when Meteor platform declares that it's ready, to do so, let's wrap the `bootstrapModule` with `Meteor.startup`:
+
+[{]: <helper> (diff_step 22.2)
+#### Step 22.2: Wrapped Angular 2 bootstrap with Meteor startup
+
+##### Changed client/main.ts
+```diff
+@@ -6,5 +6,7 @@
+ ┊ 6┊ 6┊
+ ┊ 7┊ 7┊import '../both/methods/parties.methods';
+ ┊ 8┊ 8┊
+-┊ 9┊  ┊const platform = platformBrowserDynamic();
+-┊10┊  ┊platform.bootstrapModule(AppModule);🚫↵
++┊  ┊ 9┊Meteor.startup(() => {
++┊  ┊10┊  const platform = platformBrowserDynamic();
++┊  ┊11┊  platform.bootstrapModule(AppModule);
++┊  ┊12┊});🚫↵
+```
+[}]: #
+
+### Creating Mobile/Web Separation
+
+We're going to keep the view and the component for the web under `*.component.web.html` and `*.component.web.ts` and doing the same for `*.component.mobile.html` and `*.component.mobile.ts`.
+
+First thing to do is to rename `login.component.html` to `login.component.web.html`:
+
+[{]: <helper> (diff_step 22.3)
+#### Step 22.3: Rename to login.web.component.html
+
+##### Deleted client/imports/app/auth/login.component.html
+```diff
+@@ -1,37 +0,0 @@
+-┊ 1┊  ┊<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
+-┊ 2┊  ┊  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
+-┊ 3┊  ┊    <md-toolbar class="md-primary" color="primary">
+-┊ 4┊  ┊      Sign in
+-┊ 5┊  ┊    </md-toolbar>
+-┊ 6┊  ┊
+-┊ 7┊  ┊    <div layout="column" layout-fill layout-margin layout-padding>
+-┊ 8┊  ┊      <div layout="row" layout-fill layout-margin>
+-┊ 9┊  ┊        <p class="md-body-2"> Sign in with your email</p>
+-┊10┊  ┊      </div>
+-┊11┊  ┊
+-┊12┊  ┊      <form [formGroup]="loginForm" #f="ngForm" (ngSubmit)="login()"
+-┊13┊  ┊            layout="column" layout-fill layout-padding layout-margin>
+-┊14┊  ┊
+-┊15┊  ┊        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
+-┊16┊  ┊        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
+-┊17┊  ┊
+-┊18┊  ┊        <div layout="row" layout-align="space-between center">
+-┊19┊  ┊          <a md-button [routerLink]="['/recover']">Forgot password?</a>
+-┊20┊  ┊          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign In</button>
+-┊21┊  ┊        </div>
+-┊22┊  ┊      </form>
+-┊23┊  ┊
+-┊24┊  ┊      <div [hidden]="error == ''">
+-┊25┊  ┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+-┊26┊  ┊          <p class="md-body-1">undefined</p>
+-┊27┊  ┊        </md-toolbar>
+-┊28┊  ┊      </div>
+-┊29┊  ┊
+-┊30┊  ┊      <md-divider></md-divider>
+-┊31┊  ┊
+-┊32┊  ┊      <div layout="row" layout-align="center">
+-┊33┊  ┊        <a md-button [routerLink]="['/signup']">Need an account?</a>
+-┊34┊  ┊      </div>
+-┊35┊  ┊    </div>
+-┊36┊  ┊  </div>
+-┊37┊  ┊</div>🚫↵
+```
+
+##### Added client/imports/app/auth/login.component.web.html
+```diff
+@@ -0,0 +1,37 @@
++┊  ┊ 1┊<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
++┊  ┊ 2┊  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
++┊  ┊ 3┊    <md-toolbar class="md-primary" color="primary">
++┊  ┊ 4┊      Sign in
++┊  ┊ 5┊    </md-toolbar>
++┊  ┊ 6┊
++┊  ┊ 7┊    <div layout="column" layout-fill layout-margin layout-padding>
++┊  ┊ 8┊      <div layout="row" layout-fill layout-margin>
++┊  ┊ 9┊        <p class="md-body-2"> Sign in with your email</p>
++┊  ┊10┊      </div>
++┊  ┊11┊
++┊  ┊12┊      <form [formGroup]="loginForm" #f="ngForm" (ngSubmit)="login()"
++┊  ┊13┊            layout="column" layout-fill layout-padding layout-margin>
++┊  ┊14┊
++┊  ┊15┊        <md-input formControlName="email" type="email" placeholder="Email"></md-input>
++┊  ┊16┊        <md-input formControlName="password" type="password" placeholder="Password"></md-input>
++┊  ┊17┊
++┊  ┊18┊        <div layout="row" layout-align="space-between center">
++┊  ┊19┊          <a md-button [routerLink]="['/recover']">Forgot password?</a>
++┊  ┊20┊          <button md-raised-button class="md-primary" type="submit" aria-label="login">Sign In</button>
++┊  ┊21┊        </div>
++┊  ┊22┊      </form>
++┊  ┊23┊
++┊  ┊24┊      <div [hidden]="error == ''">
++┊  ┊25┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
++┊  ┊26┊          <p class="md-body-1">undefined</p>
++┊  ┊27┊        </md-toolbar>
++┊  ┊28┊      </div>
++┊  ┊29┊
++┊  ┊30┊      <md-divider></md-divider>
++┊  ┊31┊
++┊  ┊32┊      <div layout="row" layout-align="center">
++┊  ┊33┊        <a md-button [routerLink]="['/signup']">Need an account?</a>
++┊  ┊34┊      </div>
++┊  ┊35┊    </div>
++┊  ┊36┊  </div>
++┊  ┊37┊</div>🚫↵
+```
+[}]: #
+
+Let's do the same with `login.component.ts` file:
+
+[{]: <helper> (diff_step 22.4)
+#### Step 22.4: Do the same for login.component.ts
+
+##### Deleted client/imports/app/auth/login.component.ts
+```diff
+@@ -1,40 +0,0 @@
+-┊ 1┊  ┊import {Component, OnInit, NgZone} from '@angular/core';
+-┊ 2┊  ┊import { FormBuilder, FormGroup, Validators } from '@angular/forms';
+-┊ 3┊  ┊import { Router } from '@angular/router';
+-┊ 4┊  ┊import { Meteor } from 'meteor/meteor';
+-┊ 5┊  ┊
+-┊ 6┊  ┊import template from './login.component.html';
+-┊ 7┊  ┊
+-┊ 8┊  ┊@Component({
+-┊ 9┊  ┊  selector: 'login',
+-┊10┊  ┊  template
+-┊11┊  ┊})
+-┊12┊  ┊export class LoginComponent implements OnInit {
+-┊13┊  ┊  loginForm: FormGroup;
+-┊14┊  ┊  error: string;
+-┊15┊  ┊
+-┊16┊  ┊  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
+-┊17┊  ┊
+-┊18┊  ┊  ngOnInit() {
+-┊19┊  ┊    this.loginForm = this.formBuilder.group({
+-┊20┊  ┊      email: ['', Validators.required],
+-┊21┊  ┊      password: ['', Validators.required]
+-┊22┊  ┊    });
+-┊23┊  ┊
+-┊24┊  ┊    this.error = '';
+-┊25┊  ┊  }
+-┊26┊  ┊
+-┊27┊  ┊  login() {
+-┊28┊  ┊    if (this.loginForm.valid) {
+-┊29┊  ┊      Meteor.loginWithPassword(this.loginForm.value.email, this.loginForm.value.password, (err) => {
+-┊30┊  ┊        if (err) {
+-┊31┊  ┊          this.zone.run(() => {
+-┊32┊  ┊            this.error = err;
+-┊33┊  ┊          });
+-┊34┊  ┊        } else {
+-┊35┊  ┊          this.router.navigate(['/']);
+-┊36┊  ┊        }
+-┊37┊  ┊      });
+-┊38┊  ┊    }
+-┊39┊  ┊  }
+-┊40┊  ┊}🚫↵
+```
+
+##### Added client/imports/app/auth/login.component.web.ts
+```diff
+@@ -0,0 +1,40 @@
++┊  ┊ 1┊import {Component, OnInit, NgZone} from '@angular/core';
++┊  ┊ 2┊import { FormBuilder, FormGroup, Validators } from '@angular/forms';
++┊  ┊ 3┊import { Router } from '@angular/router';
++┊  ┊ 4┊import { Meteor } from 'meteor/meteor';
++┊  ┊ 5┊
++┊  ┊ 6┊import template from './login.component.html';
++┊  ┊ 7┊
++┊  ┊ 8┊@Component({
++┊  ┊ 9┊  selector: 'login',
++┊  ┊10┊  template
++┊  ┊11┊})
++┊  ┊12┊export class LoginComponent implements OnInit {
++┊  ┊13┊  loginForm: FormGroup;
++┊  ┊14┊  error: string;
++┊  ┊15┊
++┊  ┊16┊  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
++┊  ┊17┊
++┊  ┊18┊  ngOnInit() {
++┊  ┊19┊    this.loginForm = this.formBuilder.group({
++┊  ┊20┊      email: ['', Validators.required],
++┊  ┊21┊      password: ['', Validators.required]
++┊  ┊22┊    });
++┊  ┊23┊
++┊  ┊24┊    this.error = '';
++┊  ┊25┊  }
++┊  ┊26┊
++┊  ┊27┊  login() {
++┊  ┊28┊    if (this.loginForm.valid) {
++┊  ┊29┊      Meteor.loginWithPassword(this.loginForm.value.email, this.loginForm.value.password, (err) => {
++┊  ┊30┊        if (err) {
++┊  ┊31┊          this.zone.run(() => {
++┊  ┊32┊            this.error = err;
++┊  ┊33┊          });
++┊  ┊34┊        } else {
++┊  ┊35┊          this.router.navigate(['/']);
++┊  ┊36┊        }
++┊  ┊37┊      });
++┊  ┊38┊    }
++┊  ┊39┊  }
++┊  ┊40┊}🚫↵
+```
+[}]: #
+
+with one small change which is a new `template` property:
+
+[{]: <helper> (diff_step 22.5)
+#### Step 22.5: Update the template
+
+##### Changed client/imports/app/auth/login.component.web.ts
+```diff
+@@ -3,7 +3,7 @@
+ ┊3┊3┊import { Router } from '@angular/router';
+ ┊4┊4┊import { Meteor } from 'meteor/meteor';
+ ┊5┊5┊
+-┊6┊ ┊import template from './login.component.html';
++┊ ┊6┊import template from './login.component.web.html';
+ ┊7┊7┊
+ ┊8┊8┊@Component({
+ ┊9┊9┊  selector: 'login',
+```
+[}]: #
+
+And let's update the imports in the index file:
+
+[{]: <helper> (diff_step 22.6)
+#### Step 22.6: Update the index file
+
+##### Changed client/imports/app/auth/index.ts
+```diff
+@@ -1,4 +1,4 @@
+-┊1┊ ┊import {LoginComponent} from "./login.component";
++┊ ┊1┊import {LoginComponent} from "./login.component.web";
+ ┊2┊2┊import {SignupComponent} from "./singup.component";
+ ┊3┊3┊import {RecoverComponent} from "./recover.component";
+```
+[}]: #
+
+### SMS verification
+
+As I mentioned before, we're going to use SMS verification to log in a user on the mobile application.
+
+There is a package for that!
+
+We will use an external package that extends Meteor's Accounts, called [accounts-phone](https://atmospherejs.com/okland/accounts-phone) that verifies phone number with SMS message, so let's add it:
+
+    $ meteor add mys:accounts-phone
+
+> Note that in development mode - the SMS will not be sent - and the verification code will be printed to the Meteor log.
+
+**We can now move on to create a mobile version Login Component.**
+
+A template of a mobile version will be pretty much the same as for browsers:
+
+[{]: <helper> (diff_step 22.8)
+#### Step 22.8: Create a view for the mobile login
+
+##### Added client/imports/app/auth/login.component.mobile.html
+```diff
+@@ -0,0 +1,19 @@
++┊  ┊ 1┊<div class="md-content" layout="row" layout-align="center start" layout-fill layout-margin>
++┊  ┊ 2┊  <div layout="column" flex flex-md="50" flex-lg="50" flex-gt-lg="33" class="md-whiteframe-z2" layout-fill>
++┊  ┊ 3┊    <md-toolbar class="md-primary" color="primary">
++┊  ┊ 4┊      Sign in
++┊  ┊ 5┊    </md-toolbar>
++┊  ┊ 6┊
++┊  ┊ 7┊    <div layout="column" layout-fill layout-margin layout-padding>
++┊  ┊ 8┊      <div layout="row" layout-fill layout-margin>
++┊  ┊ 9┊        <p class="md-body-2"> Sign in with SMS</p>
++┊  ┊10┊      </div>
++┊  ┊11┊
++┊  ┊12┊      <div [hidden]="error == ''">
++┊  ┊13┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
++┊  ┊14┊          <p class="md-body-1">undefined</p>
++┊  ┊15┊        </md-toolbar>
++┊  ┊16┊      </div>
++┊  ┊17┊    </div>
++┊  ┊18┊  </div>
++┊  ┊19┊</div>🚫↵
+```
+[}]: #
+
+We can use the same directives in the component as in Web version, so let's create a basic component without any functionality:
+
+[{]: <helper> (diff_step 22.9)
+#### Step 22.9: Create mobile version of Login component
+
+##### Added client/imports/app/auth/login.component.mobile.ts
+```diff
+@@ -0,0 +1,17 @@
++┊  ┊ 1┊import { Component, OnInit } from '@angular/core';
++┊  ┊ 2┊import { FormBuilder, FormGroup, Validators } from '@angular/forms';
++┊  ┊ 3┊import { Router } from '@angular/router';
++┊  ┊ 4┊
++┊  ┊ 5┊import template from './login.component.mobile.html';
++┊  ┊ 6┊
++┊  ┊ 7┊@Component({
++┊  ┊ 8┊  selector: 'login',
++┊  ┊ 9┊  template
++┊  ┊10┊})
++┊  ┊11┊export class MobileLoginComponent implements OnInit {
++┊  ┊12┊  error: string = '';
++┊  ┊13┊
++┊  ┊14┊  constructor(private router: Router, private formBuilder: FormBuilder) {}
++┊  ┊15┊
++┊  ┊16┊  ngOnInit() {}
++┊  ┊17┊}🚫↵
+```
+[}]: #
+
+SMS verification is a two-step process. First thing to do is to verify a phone number.
+
+Let's create a form for that:
+
+[{]: <helper> (diff_step 22.10)
+#### Step 22.10: Add a form with phone number to provide
+
+##### Changed client/imports/app/auth/login.component.mobile.html
+```diff
+@@ -9,6 +9,16 @@
+ ┊ 9┊ 9┊        <p class="md-body-2"> Sign in with SMS</p>
+ ┊10┊10┊      </div>
+ ┊11┊11┊
++┊  ┊12┊      <form [formGroup]="phoneForm" #f="ngForm" (ngSubmit)="send()"
++┊  ┊13┊            layout="column" layout-fill layout-padding layout-margin>
++┊  ┊14┊
++┊  ┊15┊        <md-input formControlName="phone" type="text" placeholder="Phone"></md-input>
++┊  ┊16┊
++┊  ┊17┊        <div layout="row" layout-align="space-between center">
++┊  ┊18┊          <button md-raised-button class="md-primary" type="submit" aria-label="send">Send SMS</button>
++┊  ┊19┊        </div>
++┊  ┊20┊      </form>
++┊  ┊21┊
+ ┊12┊22┊      <div [hidden]="error == ''">
+ ┊13┊23┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+ ┊14┊24┊          <p class="md-body-1">undefined</p>
+```
+[}]: #
+
+It's a simple form, basically the same as the form with Email and password verification we did in previous chapters.
+
+We can now take care of the logic. Let's create a `send` method:
+
+[{]: <helper> (diff_step 22.11)
+#### Step 22.11: Implement a phone number verification
+
+##### Changed client/imports/app/auth/login.component.mobile.ts
+```diff
+@@ -1,6 +1,7 @@
+-┊1┊ ┊import { Component, OnInit } from '@angular/core';
++┊ ┊1┊import {Component, OnInit, NgZone} from '@angular/core';
+ ┊2┊2┊import { FormBuilder, FormGroup, Validators } from '@angular/forms';
+ ┊3┊3┊import { Router } from '@angular/router';
++┊ ┊4┊import { Accounts } from 'meteor/accounts-base';
+ ┊4┊5┊
+ ┊5┊6┊import template from './login.component.mobile.html';
+ ┊6┊7┊
+```
+```diff
+@@ -10,8 +11,29 @@
+ ┊10┊11┊})
+ ┊11┊12┊export class MobileLoginComponent implements OnInit {
+ ┊12┊13┊  error: string = '';
++┊  ┊14┊  phoneForm: FormGroup;
++┊  ┊15┊  phone: string;
+ ┊13┊16┊
+-┊14┊  ┊  constructor(private router: Router, private formBuilder: FormBuilder) {}
++┊  ┊17┊  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
+ ┊15┊18┊
+-┊16┊  ┊  ngOnInit() {}
++┊  ┊19┊  ngOnInit() {
++┊  ┊20┊    this.phoneForm = this.formBuilder.group({
++┊  ┊21┊      phone: ['', Validators.required]
++┊  ┊22┊    });
++┊  ┊23┊  }
++┊  ┊24┊
++┊  ┊25┊  send() {
++┊  ┊26┊    if (this.phoneForm.valid) {
++┊  ┊27┊      Accounts.requestPhoneVerification(this.phoneForm.value.phone, (err) => {
++┊  ┊28┊        this.zone.run(() => {
++┊  ┊29┊          if (err) {
++┊  ┊30┊            this.error = err.reason || err;
++┊  ┊31┊          } else {
++┊  ┊32┊            this.phone = this.phoneForm.value.phone;
++┊  ┊33┊            this.error = '';
++┊  ┊34┊          }
++┊  ┊35┊        });
++┊  ┊36┊      });
++┊  ┊37┊    }
++┊  ┊38┊  }
+ ┊17┊39┊}🚫↵
+```
+[}]: #
+
+What we did? Few things:
+
+* form called `phoneForm` with one field `phone`.
+* `send` method that calls `Accounts.requestPhoneVerification` to verify phone number and to send SMS with verification code.
+* we're also keeping phone number outside the form's scope.
+
+Great, we're half way there!
+
+Now we need to verify that code. We will keep all the logic under `verify` method:
+
+[{]: <helper> (diff_step 22.12)
+#### Step 22.12: Implement a code verification
+
+##### Changed client/imports/app/auth/login.component.mobile.ts
+```diff
+@@ -13,6 +13,8 @@
+ ┊13┊13┊  error: string = '';
+ ┊14┊14┊  phoneForm: FormGroup;
+ ┊15┊15┊  phone: string;
++┊  ┊16┊  verifyForm: FormGroup;
++┊  ┊17┊  isStepTwo: boolean = false;
+ ┊16┊18┊
+ ┊17┊19┊  constructor(private router: Router, private zone: NgZone, private formBuilder: FormBuilder) {}
+ ┊18┊20┊
+```
+```diff
+@@ -20,6 +22,10 @@
+ ┊20┊22┊    this.phoneForm = this.formBuilder.group({
+ ┊21┊23┊      phone: ['', Validators.required]
+ ┊22┊24┊    });
++┊  ┊25┊
++┊  ┊26┊    this.verifyForm = this.formBuilder.group({
++┊  ┊27┊        code: ['', Validators.required]
++┊  ┊28┊    });
+ ┊23┊29┊  }
+ ┊24┊30┊
+ ┊25┊31┊  send() {
+```
+```diff
+@@ -31,6 +37,23 @@
+ ┊31┊37┊          } else {
+ ┊32┊38┊            this.phone = this.phoneForm.value.phone;
+ ┊33┊39┊            this.error = '';
++┊  ┊40┊            this.isStepTwo = true;
++┊  ┊41┊          }
++┊  ┊42┊        });
++┊  ┊43┊      });
++┊  ┊44┊    }
++┊  ┊45┊  }
++┊  ┊46┊
++┊  ┊47┊
++┊  ┊48┊  verify() {
++┊  ┊49┊    if (this.verifyForm.valid) {
++┊  ┊50┊      Accounts.verifyPhone(this.phone, this.verifyForm.value.code, (err) => {
++┊  ┊51┊        this.zone.run(() => {
++┊  ┊52┊          if (err) {
++┊  ┊53┊            this.error = err.reason || err;
++┊  ┊54┊          }
++┊  ┊55┊          else {
++┊  ┊56┊            this.router.navigate(['/']);
+ ┊34┊57┊          }
+ ┊35┊58┊        });
+ ┊36┊59┊      });
+```
+[}]: #
+
+As you can see, we used `Accounts.verifyPhone` with proper arguments to call the verification process.
+
+There are two more things that you should notice.
+
+* New property `isStepTwo` that holds the status of sign in process. Based on that property we can tell if someone is still in the first phase or he already wants to verify code sent via SMS.
+* Redirection to `PartiesList` if verification succeed.
+
+We have all the logic, we still need to create a view for it:
+
+[{]: <helper> (diff_step 22.13)
+#### Step 22.13: Create a form with code verification
+
+##### Changed client/imports/app/auth/login.component.mobile.html
+```diff
+@@ -9,7 +9,7 @@
+ ┊ 9┊ 9┊        <p class="md-body-2"> Sign in with SMS</p>
+ ┊10┊10┊      </div>
+ ┊11┊11┊
+-┊12┊  ┊      <form [formGroup]="phoneForm" #f="ngForm" (ngSubmit)="send()"
++┊  ┊12┊      <form [formGroup]="phoneForm" *ngIf="!isStepTwo" #f="ngForm" (ngSubmit)="send()"
+ ┊13┊13┊            layout="column" layout-fill layout-padding layout-margin>
+ ┊14┊14┊
+ ┊15┊15┊        <md-input formControlName="phone" type="text" placeholder="Phone"></md-input>
+```
+```diff
+@@ -19,6 +19,16 @@
+ ┊19┊19┊        </div>
+ ┊20┊20┊      </form>
+ ┊21┊21┊
++┊  ┊22┊      <form *ngIf="isStepTwo" [formGroup]="verifyForm" #f="ngForm" (ngSubmit)="verify()"
++┊  ┊23┊            layout="column" layout-fill layout-padding layout-margin>
++┊  ┊24┊
++┊  ┊25┊        <md-input formControlName="code" type="text" placeholder="Code"></md-input>
++┊  ┊26┊
++┊  ┊27┊        <div layout="row" layout-align="space-between center">
++┊  ┊28┊          <button md-raised-button class="md-primary" type="submit" aria-label="verify">Verify code</button>
++┊  ┊29┊        </div>
++┊  ┊30┊      </form>
++┊  ┊31┊
+ ┊22┊32┊      <div [hidden]="error == ''">
+ ┊23┊33┊        <md-toolbar class="md-warn" layout="row" layout-fill layout-padding layout-margin>
+ ┊24┊34┊          <p class="md-body-1">undefined</p>
+```
+[}]: #
+
+And let's add the mobile version of the Component to the index file:
+
+[{]: <helper> (diff_step 22.14)
+#### Step 22.14: Added MobileLoginComponent to the index file
+
+##### Changed client/imports/app/auth/index.ts
+```diff
+@@ -1,9 +1,11 @@
+ ┊ 1┊ 1┊import {LoginComponent} from "./login.component.web";
+ ┊ 2┊ 2┊import {SignupComponent} from "./singup.component";
+ ┊ 3┊ 3┊import {RecoverComponent} from "./recover.component";
++┊  ┊ 4┊import {MobileLoginComponent} from "./login.component.mobile";
+ ┊ 4┊ 5┊
+ ┊ 5┊ 6┊export const AUTH_DECLARATIONS = [
+ ┊ 6┊ 7┊  LoginComponent,
+ ┊ 7┊ 8┊  SignupComponent,
+-┊ 8┊  ┊  RecoverComponent
++┊  ┊ 9┊  RecoverComponent,
++┊  ┊10┊  MobileLoginComponent
+ ┊ 9┊11┊];
+```
+[}]: #
+
+It seems like both versions are ready.
+
+We can now move on to `client/app.routes.ts`.
+
+Just as you can use `Meteor.isServer` and `Meteor.isClient` to separate your client-side and server-side code, you can use `Meteor.isCordova` to separate your Cordova-specific code from the rest of your code.
+
+[{]: <helper> (diff_step 22.15)
+#### Step 22.15: Choose mobile or web version
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -3,14 +3,15 @@
+ ┊ 3┊ 3┊
+ ┊ 4┊ 4┊import { PartiesListComponent } from './parties/parties-list.component';
+ ┊ 5┊ 5┊import { PartyDetailsComponent } from './parties/party-details.component';
+-┊ 6┊  ┊import {LoginComponent} from "./auth/login.component";
+ ┊ 7┊ 6┊import {SignupComponent} from "./auth/singup.component";
+ ┊ 8┊ 7┊import {RecoverComponent} from "./auth/recover.component";
++┊  ┊ 8┊import {MobileLoginComponent} from "./auth/login.component.mobile";
++┊  ┊ 9┊import {LoginComponent} from "./auth/login.component.web";
+ ┊ 9┊10┊
+ ┊10┊11┊export const routes: Route[] = [
+ ┊11┊12┊  { path: '', component: PartiesListComponent },
+ ┊12┊13┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
+-┊13┊  ┊  { path: 'login', component: LoginComponent },
++┊  ┊14┊  { path: 'login', component: Meteor.isCordova ? MobileLoginComponent : LoginComponent },
+ ┊14┊15┊  { path: 'signup', component: SignupComponent },
+ ┊15┊16┊  { path: 'recover', component: RecoverComponent }
+ ┊16┊17┊];
+```
+[}]: #
+
+As you can see, we're importing both version of Login Component. But only one is being used, depending on Meteor.isCordova value.
+
+If we would run Socially in a browser `LoginComponent` for web platform will be used.
+
+And that's it!
+
+
+## Summary
+
+In this tutorial we showed how to make our code behave differently in mobile and web platforms. We did this by creating separate es2015 modules with specific code for mobile and web, and using them based on the platform that runs the application.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step21.md) | [Next Step >](step23.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 3bf6e93fa878b990a75badc4b8fbbd50ea74fd58 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:06:32 +0300
Subject: [PATCH 260/292] Step 23.1: Install ionic-angular and missing angular
 dependencis

---
 package.json | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/package.json b/package.json
index bbac80b..bb1070e 100644
--- a/package.json
+++ b/package.json
@@ -19,8 +19,10 @@
     "@angular/compiler": "2.0.1",
     "@angular/core": "2.0.1",
     "@angular/forms": "2.0.1",
+    "@angular/http": "2.0.1",
     "@angular/platform-browser": "2.0.1",
     "@angular/platform-browser-dynamic": "2.0.1",
+    "@angular/platform-server": "2.0.1",
     "@angular/router": "3.0.1",
     "@angular2-material/button": "2.0.0-alpha.8-2",
     "@angular2-material/card": "2.0.0-alpha.8-2",
@@ -36,6 +38,7 @@
     "angular2-meteor-polyfills": "^0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
     "gm": "^1.23.0",
+    "ionic-angular": "2.0.0-rc.0",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
     "ng2-pagination": "0.4.1",
-- 
2.7.4


From 9173d598cf088a602d77ee5bd6c4ddef1d63d6c4 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:08:01 +0300
Subject: [PATCH 261/292] Step 23.2: Rename to app.component.web.ts

---
 client/imports/app/app.component.ts     | 19 -------------------
 client/imports/app/app.component.web.ts | 19 +++++++++++++++++++
 2 files changed, 19 insertions(+), 19 deletions(-)
 delete mode 100644 client/imports/app/app.component.ts
 create mode 100644 client/imports/app/app.component.web.ts

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
deleted file mode 100644
index ba12be4..0000000
--- a/client/imports/app/app.component.ts
+++ /dev/null
@@ -1,19 +0,0 @@
-import { Component } from '@angular/core';
-
-import template from './app.component.html';
-import {InjectUser} from "angular2-meteor-accounts-ui";
-
-@Component({
-  selector: 'app',
-  template
-})
-@InjectUser('user')
-export class AppComponent {
-  constructor() {
-
-  }
-
-  logout() {
-    Meteor.logout();
-  }
-}
diff --git a/client/imports/app/app.component.web.ts b/client/imports/app/app.component.web.ts
new file mode 100644
index 0000000..ba12be4
--- /dev/null
+++ b/client/imports/app/app.component.web.ts
@@ -0,0 +1,19 @@
+import { Component } from '@angular/core';
+
+import template from './app.component.html';
+import {InjectUser} from "angular2-meteor-accounts-ui";
+
+@Component({
+  selector: 'app',
+  template
+})
+@InjectUser('user')
+export class AppComponent {
+  constructor() {
+
+  }
+
+  logout() {
+    Meteor.logout();
+  }
+}
-- 
2.7.4


From cbd6c2334562de8150033f351b6ac7e33e6c8ecf Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:08:11 +0300
Subject: [PATCH 262/292] Step 23.3: Rename to app.component.web.html

---
 client/imports/app/app.component.html     | 13 -------------
 client/imports/app/app.component.web.html | 13 +++++++++++++
 2 files changed, 13 insertions(+), 13 deletions(-)
 delete mode 100644 client/imports/app/app.component.html
 create mode 100644 client/imports/app/app.component.web.html

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
deleted file mode 100644
index f6c5855..0000000
--- a/client/imports/app/app.component.html
+++ /dev/null
@@ -1,13 +0,0 @@
-<md-toolbar color="primary">
-  <a routerLink="/" class="md-title">Socially</a>
-  <span class="fill-remaining-space"></span>
-  <div [hidden]="user">
-    <a md-button [routerLink]="['/login']" >Login</a>
-    <a md-button [routerLink]="['/signup']">Sign up</a>
-  </div>
-  <div [hidden]="!user">
-    <span>{{ user | displayName }}</span>
-    <button md-button (click)="logout()">Logout</button>
-  </div>
-</md-toolbar>
-<router-outlet></router-outlet>
\ No newline at end of file
diff --git a/client/imports/app/app.component.web.html b/client/imports/app/app.component.web.html
new file mode 100644
index 0000000..f6c5855
--- /dev/null
+++ b/client/imports/app/app.component.web.html
@@ -0,0 +1,13 @@
+<md-toolbar color="primary">
+  <a routerLink="/" class="md-title">Socially</a>
+  <span class="fill-remaining-space"></span>
+  <div [hidden]="user">
+    <a md-button [routerLink]="['/login']" >Login</a>
+    <a md-button [routerLink]="['/signup']">Sign up</a>
+  </div>
+  <div [hidden]="!user">
+    <span>{{ user | displayName }}</span>
+    <button md-button (click)="logout()">Logout</button>
+  </div>
+</md-toolbar>
+<router-outlet></router-outlet>
\ No newline at end of file
-- 
2.7.4


From 8dffe491a43d94f11971653bc87941b836c2ff1f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:08:40 +0300
Subject: [PATCH 263/292] Step 23.4: Updated the template import

---
 client/imports/app/app.component.web.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.web.ts b/client/imports/app/app.component.web.ts
index ba12be4..71fdeed 100644
--- a/client/imports/app/app.component.web.ts
+++ b/client/imports/app/app.component.web.ts
@@ -1,6 +1,6 @@
 import { Component } from '@angular/core';
 
-import template from './app.component.html';
+import template from './app.component.web.html';
 import {InjectUser} from "angular2-meteor-accounts-ui";
 
 @Component({
-- 
2.7.4


From f201619ffe7d7efc081204203375df9872ba25e8 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:09:49 +0300
Subject: [PATCH 264/292] Step 23.5: Updated the main component import

---
 client/imports/app/app.module.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 7faa03b..d8c4fb2 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -6,7 +6,7 @@ import { AccountsModule } from 'angular2-meteor-accounts-ui';
 import { Ng2PaginationModule } from 'ng2-pagination';
 import { AgmCoreModule } from 'angular2-google-maps/core';
 
-import { AppComponent } from './app.component';
+import { AppComponent } from "./app.component.web";
 import { routes, ROUTES_PROVIDERS } from './app.routes';
 import { PARTIES_DECLARATIONS } from './parties';
 import { SHARED_DECLARATIONS } from './shared';
-- 
2.7.4


From ecdd02514d269f00f73cc04610cd84cd17b5e763 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:10:36 +0300
Subject: [PATCH 265/292] Step 23.6: Use web version of Login component in
 routing

---
 client/imports/app/app.routes.ts | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/client/imports/app/app.routes.ts b/client/imports/app/app.routes.ts
index bb84cb5..85f5669 100644
--- a/client/imports/app/app.routes.ts
+++ b/client/imports/app/app.routes.ts
@@ -5,13 +5,12 @@ import { PartiesListComponent } from './parties/parties-list.component';
 import { PartyDetailsComponent } from './parties/party-details.component';
 import {SignupComponent} from "./auth/singup.component";
 import {RecoverComponent} from "./auth/recover.component";
-import {MobileLoginComponent} from "./auth/login.component.mobile";
 import {LoginComponent} from "./auth/login.component.web";
 
 export const routes: Route[] = [
   { path: '', component: PartiesListComponent },
   { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
-  { path: 'login', component: Meteor.isCordova ? MobileLoginComponent : LoginComponent },
+  { path: 'login', component: LoginComponent },
   { path: 'signup', component: SignupComponent },
   { path: 'recover', component: RecoverComponent }
 ];
-- 
2.7.4


From 034e131a6284165e59c89060fd6770ccc931378c Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:16:31 +0300
Subject: [PATCH 266/292] Step 23.7: Created the main mobile component

---
 client/imports/app/mobile/app.component.mobile.ts | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 client/imports/app/mobile/app.component.mobile.ts

diff --git a/client/imports/app/mobile/app.component.mobile.ts b/client/imports/app/mobile/app.component.mobile.ts
new file mode 100644
index 0000000..ae661d6
--- /dev/null
+++ b/client/imports/app/mobile/app.component.mobile.ts
@@ -0,0 +1,13 @@
+import {Component} from "@angular/core";
+import template from "./app.component.mobile.html";
+import {MenuController, Platform, App} from "ionic-angular";
+
+@Component({
+  selector: "app",
+  template
+})
+export class AppMobileComponent {
+  constructor(app: App, platform: Platform, menu: MenuController) {
+
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 7686a4bcc5d948fc3c0fe46db57712541294b11e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:16:41 +0300
Subject: [PATCH 267/292] Step 23.8: Created the main mobile component view

---
 client/imports/app/mobile/app.component.mobile.html | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 client/imports/app/mobile/app.component.mobile.html

diff --git a/client/imports/app/mobile/app.component.mobile.html b/client/imports/app/mobile/app.component.mobile.html
new file mode 100644
index 0000000..a94744b
--- /dev/null
+++ b/client/imports/app/mobile/app.component.mobile.html
@@ -0,0 +1 @@
+<ion-nav [root]="rootPage" swipe-back-enabled="true"></ion-nav>
\ No newline at end of file
-- 
2.7.4


From 12c9e80af541a42a013ba6cf90e8110f3cfcf89b Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:17:03 +0300
Subject: [PATCH 268/292] Step 23.9: Created index file for mobile declarations

---
 client/imports/app/mobile/index.ts | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 client/imports/app/mobile/index.ts

diff --git a/client/imports/app/mobile/index.ts b/client/imports/app/mobile/index.ts
new file mode 100644
index 0000000..b92e848
--- /dev/null
+++ b/client/imports/app/mobile/index.ts
@@ -0,0 +1,5 @@
+import {AppMobileComponent} from "./app.component.mobile";
+
+export const MOBILE_DECLARATIONS = [
+  AppMobileComponent
+];
\ No newline at end of file
-- 
2.7.4


From b763ec80816e2d1eaff84d64e1427c57f470db9d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:17:32 +0300
Subject: [PATCH 269/292] Step 23.10: Imported mobile declarations and added
 conditional main component bootstrap

---
 client/imports/app/app.module.ts | 94 ++++++++++++++++++++++++++--------------
 1 file changed, 61 insertions(+), 33 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index d8c4fb2..c512dd7 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -19,38 +19,66 @@ import { MdCheckboxModule } from "@angular2-material/checkbox";
 import {MdListModule} from "@angular2-material/list";
 import {AUTH_DECLARATIONS} from "./auth/index";
 import {FileDropModule} from "angular2-file-drop";
+import {MOBILE_DECLARATIONS} from "./mobile/index";
+import {AppMobileComponent} from "./mobile/app.component.mobile";
+import {IonicModule, IonicApp} from "ionic-angular";
 
-@NgModule({
-  imports: [
-    BrowserModule,
-    FormsModule,
-    ReactiveFormsModule,
-    RouterModule.forRoot(routes),
-    AccountsModule,
-    Ng2PaginationModule,
-    AgmCoreModule.forRoot({
-      apiKey: 'AIzaSyAWoBdZHCNh5R-hB5S5ZZ2oeoYyfdDgniA'
-    }),
-    MdCoreModule.forRoot(),
-    MdButtonModule.forRoot(),
-    MdToolbarModule.forRoot(),
-    MdInputModule.forRoot(),
-    MdCardModule.forRoot(),
-    MdCheckboxModule.forRoot(),
-    MdListModule.forRoot(),
-    FileDropModule
-  ],
-  declarations: [
-    AppComponent,
-    ...PARTIES_DECLARATIONS,
-    ...SHARED_DECLARATIONS,
-    ...AUTH_DECLARATIONS
-  ],
-  providers: [
-    ...ROUTES_PROVIDERS
-  ],
-  bootstrap: [
-    AppComponent
-  ]
-})
+let moduleDefinition;
+
+if (Meteor.isCordova) {
+  moduleDefinition = {
+    imports: [
+      IonicModule.forRoot(AppMobileComponent)
+    ],
+    declarations: [
+      ...SHARED_DECLARATIONS,
+      ...MOBILE_DECLARATIONS
+    ],
+    providers: [
+    ],
+    bootstrap: [
+      IonicApp
+    ],
+    entryComponents: [
+      AppMobileComponent
+    ]
+  }
+}
+else {
+  moduleDefinition = {
+    imports: [
+      BrowserModule,
+      FormsModule,
+      ReactiveFormsModule,
+      RouterModule.forRoot(routes),
+      AccountsModule,
+      Ng2PaginationModule,
+      AgmCoreModule.forRoot({
+        apiKey: 'AIzaSyAWoBdZHCNh5R-hB5S5ZZ2oeoYyfdDgniA'
+      }),
+      MdCoreModule.forRoot(),
+      MdButtonModule.forRoot(),
+      MdToolbarModule.forRoot(),
+      MdInputModule.forRoot(),
+      MdCardModule.forRoot(),
+      MdCheckboxModule.forRoot(),
+      MdListModule.forRoot(),
+      FileDropModule
+    ],
+    declarations: [
+      AppComponent,
+      ...PARTIES_DECLARATIONS,
+      ...SHARED_DECLARATIONS,
+      ...AUTH_DECLARATIONS
+    ],
+    providers: [
+      ...ROUTES_PROVIDERS
+    ],
+    bootstrap: [
+      AppComponent
+    ]
+  }
+}
+
+@NgModule(moduleDefinition)
 export class AppModule {}
\ No newline at end of file
-- 
2.7.4


From 8a8200ce70ca525a0e5da7f1c90b086558379031 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:38:32 +0300
Subject: [PATCH 270/292] Step 23.11: Added ionic-selector package

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index bb1070e..69795b9 100644
--- a/package.json
+++ b/package.json
@@ -39,6 +39,7 @@
     "angular2-meteor-tests-polyfills": "0.0.2",
     "gm": "^1.23.0",
     "ionic-angular": "2.0.0-rc.0",
+    "ionic-selector": "0.0.2",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
     "ng2-pagination": "0.4.1",
-- 
2.7.4


From 804daddf871ab05420f85157ece9878829e5c76d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:39:16 +0300
Subject: [PATCH 271/292] Step 23.12: Use ionic-selector package

---
 client/main.ts | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/main.ts b/client/main.ts
index 7c00907..5cbb885 100644
--- a/client/main.ts
+++ b/client/main.ts
@@ -6,7 +6,13 @@ import { AppModule } from './imports/app/app.module';
 
 import '../both/methods/parties.methods';
 
+import ionicSelector from 'ionic-selector';
+
 Meteor.startup(() => {
+  if (Meteor.isCordova) {
+    ionicSelector("app");
+  }
+
   const platform = platformBrowserDynamic();
   platform.bootstrapModule(AppModule);
 });
\ No newline at end of file
-- 
2.7.4


From 1a07fb6fe6b67c3dd74bf6bf6b20dff9a66a709c Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:42:58 +0300
Subject: [PATCH 272/292] Step 23.13: Install ionicons

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index 69795b9..de01d32 100644
--- a/package.json
+++ b/package.json
@@ -40,6 +40,7 @@
     "gm": "^1.23.0",
     "ionic-angular": "2.0.0-rc.0",
     "ionic-selector": "0.0.2",
+    "ionicons": "^3.0.0",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.3.0",
     "ng2-pagination": "0.4.1",
-- 
2.7.4


From 447cae9749703447fb131bf3fdfbda28aa715b11 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:43:51 +0300
Subject: [PATCH 273/292] Step 23.14: Create ionic.scss and add ionicons to it

---
 client/imports/app/mobile/ionic.scss | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 client/imports/app/mobile/ionic.scss

diff --git a/client/imports/app/mobile/ionic.scss b/client/imports/app/mobile/ionic.scss
new file mode 100644
index 0000000..0dec7a3
--- /dev/null
+++ b/client/imports/app/mobile/ionic.scss
@@ -0,0 +1 @@
+@import "{}/node_modules/ionicons/dist/scss/ionicons";
\ No newline at end of file
-- 
2.7.4


From 83a20f24954630f7d2608306d43acd188c6ab75c Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:48:45 +0300
Subject: [PATCH 274/292] Step 23.15: Import ionic.scss to main file

---
 client/main.scss | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/main.scss b/client/main.scss
index 40113ec..35d0575 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -1,4 +1,5 @@
 @import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
+@import "imports/app/mobile/ionic.scss";
 
 $color1 : #2F2933;
 $color2 : #01A2A6;
-- 
2.7.4


From d831b71724cd359265e228a8c022db9898867313 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:59:06 +0300
Subject: [PATCH 275/292] Step 23.16: Imported the main css file of ionic

---
 client/imports/app/mobile/app.component.mobile.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/imports/app/mobile/app.component.mobile.ts b/client/imports/app/mobile/app.component.mobile.ts
index ae661d6..212bc29 100644
--- a/client/imports/app/mobile/app.component.mobile.ts
+++ b/client/imports/app/mobile/app.component.mobile.ts
@@ -2,6 +2,10 @@ import {Component} from "@angular/core";
 import template from "./app.component.mobile.html";
 import {MenuController, Platform, App} from "ionic-angular";
 
+if (Meteor.isCordova) {
+  require("ionic-angular/css/ionic.css");
+}
+
 @Component({
   selector: "app",
   template
-- 
2.7.4


From 69d07a10578d958701429834094665d34806b9f0 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:49:15 +0300
Subject: [PATCH 276/292] Step 23.17: Add two classes to fix an issue with
 overflow

---
 client/main.scss | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/client/main.scss b/client/main.scss
index 35d0575..685e517 100644
--- a/client/main.scss
+++ b/client/main.scss
@@ -22,6 +22,15 @@ body {
   font-family: 'Muli', sans-serif;
 }
 
+body.mobile {
+  overflow: hidden;
+}
+
+body.web {
+  overflow: visible;
+  position: initial;
+}
+
 .sebm-google-map-container {
   width: 450px;
   height: 450px;
-- 
2.7.4


From 6ec3d2125d09130d0f66dd1a728f5580904852e0 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 12:50:18 +0300
Subject: [PATCH 277/292] Step 23.18: Set the proper class on body

---
 client/main.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/client/main.ts b/client/main.ts
index 5cbb885..26bd39d 100644
--- a/client/main.ts
+++ b/client/main.ts
@@ -8,9 +8,20 @@ import '../both/methods/parties.methods';
 
 import ionicSelector from 'ionic-selector';
 
+function setClass(css) {
+  if (!document.body.className) {
+    document.body.className = "";
+  }
+  document.body.className += " " + css;
+}
+
 Meteor.startup(() => {
   if (Meteor.isCordova) {
     ionicSelector("app");
+    setClass('mobile');
+  }
+  else {
+    setClass('web');
   }
 
   const platform = platformBrowserDynamic();
-- 
2.7.4


From a34521d9d54bd71a29d0abb7ac88a376ba6c9ae8 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:04:53 +0300
Subject: [PATCH 278/292] Step 23.19: Take the logic of parties list to
 external class

---
 .../app/shared-components/parties-list.class.ts    | 112 +++++++++++++++++++++
 1 file changed, 112 insertions(+)
 create mode 100644 client/imports/app/shared-components/parties-list.class.ts

diff --git a/client/imports/app/shared-components/parties-list.class.ts b/client/imports/app/shared-components/parties-list.class.ts
new file mode 100644
index 0000000..dd4887d
--- /dev/null
+++ b/client/imports/app/shared-components/parties-list.class.ts
@@ -0,0 +1,112 @@
+import {OnDestroy, OnInit} from "@angular/core";
+import {Observable, Subscription, Subject} from "rxjs";
+import {Party} from "../../../../both/models/party.model";
+import {PaginationService} from "ng2-pagination";
+import {MeteorObservable} from "meteor-rxjs";
+import {Parties} from "../../../../both/collections/parties.collection";
+import {Counts} from "meteor/tmeasday:publish-counts";
+import {InjectUser} from "angular2-meteor-accounts-ui";
+
+interface Pagination {
+  limit: number;
+  skip: number;
+}
+
+interface Options extends Pagination {
+  [key: string]: any
+}
+
+@InjectUser('user')
+export class PartiesList implements OnInit, OnDestroy {
+  parties: Observable<Party[]>;
+  partiesSub: Subscription;
+  pageSize: Subject<number> = new Subject<number>();
+  curPage: Subject<number> = new Subject<number>();
+  nameOrder: Subject<number> = new Subject<number>();
+  optionsSub: Subscription;
+  partiesSize: number = 0;
+  autorunSub: Subscription;
+  location: Subject<string> = new Subject<string>();
+  user: Meteor.User;
+  imagesSubs: Subscription;
+
+  constructor(private paginationService: PaginationService) {
+
+  }
+
+  ngOnInit() {
+    this.optionsSub = Observable.combineLatest(
+      this.pageSize,
+      this.curPage,
+      this.nameOrder,
+      this.location
+    ).subscribe(([pageSize, curPage, nameOrder, location]) => {
+      const options: Options = {
+        limit: pageSize as number,
+        skip: ((curPage as number) - 1) * (pageSize as number),
+        sort: { name: nameOrder as number }
+      };
+
+      this.paginationService.setCurrentPage(this.paginationService.defaultId, curPage as number);
+
+      if (this.partiesSub) {
+        this.partiesSub.unsubscribe();
+      }
+
+      this.partiesSub = MeteorObservable.subscribe('parties', options, location).subscribe(() => {
+        this.parties = Parties.find({}, {
+          sort: {
+            name: nameOrder
+          }
+        }).zone();
+      });
+    });
+
+    this.paginationService.register({
+      id: this.paginationService.defaultId,
+      itemsPerPage: 10,
+      currentPage: 1,
+      totalItems: this.partiesSize
+    });
+
+    this.pageSize.next(10);
+    this.curPage.next(1);
+    this.nameOrder.next(1);
+    this.location.next('');
+
+    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
+      this.partiesSize = Counts.get('numberOfParties');
+      this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
+    });
+
+    this.imagesSubs = MeteorObservable.subscribe('images').subscribe();
+  }
+
+  removeParty(party: Party): void {
+    Parties.remove(party._id);
+  }
+
+  search(value: string): void {
+    this.curPage.next(1);
+    this.location.next(value);
+  }
+
+  onPageChanged(page: number): void {
+    this.curPage.next(page);
+  }
+
+  changeSortOrder(nameOrder: string): void {
+    this.nameOrder.next(parseInt(nameOrder));
+  }
+
+  isOwner(party: Party): boolean {
+    return this.user && this.user._id === party.owner;
+  }
+
+  ngOnDestroy() {
+    this.partiesSub.unsubscribe();
+    this.optionsSub.unsubscribe();
+    this.autorunSub.unsubscribe();
+    this.imagesSubs.unsubscribe();
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 73b76bdca4e07cf5578dda1ec04900a422a4da1f Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:05:07 +0300
Subject: [PATCH 279/292] Step 23.20: Create a clean parties list for web
 display

---
 .../imports/app/parties/parties-list.component.ts  | 118 +--------------------
 1 file changed, 5 insertions(+), 113 deletions(-)

diff --git a/client/imports/app/parties/parties-list.component.ts b/client/imports/app/parties/parties-list.component.ts
index abb965b..cc5cfcb 100644
--- a/client/imports/app/parties/parties-list.component.ts
+++ b/client/imports/app/parties/parties-list.component.ts
@@ -1,123 +1,15 @@
-import { Component, OnInit, OnDestroy } from '@angular/core';
-import { Observable } from 'rxjs/Observable';
-import { Subject } from 'rxjs/Subject';
-import { Subscription } from 'rxjs/Subscription';
-import { MeteorObservable } from 'meteor-rxjs';
+import { Component } from '@angular/core';
 import { PaginationService } from 'ng2-pagination';
-import { Counts } from 'meteor/tmeasday:publish-counts';
-import { InjectUser } from "angular2-meteor-accounts-ui";
-
-import 'rxjs/add/operator/combineLatest';
-
-import { Parties } from '../../../../both/collections/parties.collection';
-import { Party } from '../../../../both/models/party.model';
+import { PartiesList } from "../shared-components/parties-list.class";
 
 import template from './parties-list.component.html';
 
-interface Pagination {
-  limit: number;
-  skip: number;
-}
-
-interface Options extends Pagination {
-  [key: string]: any
-}
-
 @Component({
   selector: 'parties-list',
   template
 })
-@InjectUser('user')
-export class PartiesListComponent implements OnInit, OnDestroy {
-  parties: Observable<Party[]>;
-  partiesSub: Subscription;
-  pageSize: Subject<number> = new Subject<number>();
-  curPage: Subject<number> = new Subject<number>();
-  nameOrder: Subject<number> = new Subject<number>();
-  optionsSub: Subscription;
-  partiesSize: number = 0;
-  autorunSub: Subscription;
-  location: Subject<string> = new Subject<string>();
-  user: Meteor.User;
-  imagesSubs: Subscription;
-
-  constructor(
-    private paginationService: PaginationService
-  ) {}
-
-  ngOnInit() {
-    this.optionsSub = Observable.combineLatest(
-      this.pageSize,
-      this.curPage,
-      this.nameOrder,
-      this.location
-    ).subscribe(([pageSize, curPage, nameOrder, location]) => {
-      const options: Options = {
-        limit: pageSize as number,
-        skip: ((curPage as number) - 1) * (pageSize as number),
-        sort: { name: nameOrder as number }
-      };
-
-      this.paginationService.setCurrentPage(this.paginationService.defaultId, curPage as number);
-
-      if (this.partiesSub) {
-        this.partiesSub.unsubscribe();
-      }
-      
-      this.partiesSub = MeteorObservable.subscribe('parties', options, location).subscribe(() => {
-        this.parties = Parties.find({}, {
-          sort: {
-            name: nameOrder
-          }
-        }).zone();
-      });
-    });
-
-    this.paginationService.register({
-      id: this.paginationService.defaultId,
-      itemsPerPage: 10,
-      currentPage: 1,
-      totalItems: this.partiesSize
-    });
-
-    this.pageSize.next(10);
-    this.curPage.next(1);
-    this.nameOrder.next(1);
-    this.location.next('');
-
-    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
-      this.partiesSize = Counts.get('numberOfParties');
-      this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
-    });
-
-    this.imagesSubs = MeteorObservable.subscribe('images').subscribe();
-  }
-
-  removeParty(party: Party): void {
-    Parties.remove(party._id);
-  }
-
-  search(value: string): void {
-    this.curPage.next(1);
-    this.location.next(value);
-  }
-
-  onPageChanged(page: number): void {
-    this.curPage.next(page);
-  }
-
-  changeSortOrder(nameOrder: string): void {
-    this.nameOrder.next(parseInt(nameOrder));
-  }
-
-  isOwner(party: Party): boolean {
-    return this.user && this.user._id === party.owner;
-  }
-
-  ngOnDestroy() {
-    this.partiesSub.unsubscribe();
-    this.optionsSub.unsubscribe();
-    this.autorunSub.unsubscribe();
-    this.imagesSubs.unsubscribe();
+export class PartiesListComponent extends PartiesList {
+  constructor(paginationService: PaginationService) {
+    super(paginationService);
   }
 }
-- 
2.7.4


From e24746f31ddabb37202ee3383ea8da4dc8870926 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:06:01 +0300
Subject: [PATCH 280/292] Step 23.21: Create a basic view of the mobile version

---
 client/imports/app/mobile/parties-list.component.mobile.html | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 client/imports/app/mobile/parties-list.component.mobile.html

diff --git a/client/imports/app/mobile/parties-list.component.mobile.html b/client/imports/app/mobile/parties-list.component.mobile.html
new file mode 100644
index 0000000..36c6831
--- /dev/null
+++ b/client/imports/app/mobile/parties-list.component.mobile.html
@@ -0,0 +1,8 @@
+<ion-header>
+  <ion-navbar>
+    <ion-title>Socially</ion-title>
+  </ion-navbar>
+</ion-header>
+<ion-content>
+  Parties!
+</ion-content>
-- 
2.7.4


From 9ec77aab41f5d767617d2406ef4a3b9989b11b66 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:07:44 +0300
Subject: [PATCH 281/292] Step 23.22: Create the mobile version of PartiesList
 component

---
 .../imports/app/mobile/parties-list.component.mobile.ts   | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 client/imports/app/mobile/parties-list.component.mobile.ts

diff --git a/client/imports/app/mobile/parties-list.component.mobile.ts b/client/imports/app/mobile/parties-list.component.mobile.ts
new file mode 100644
index 0000000..34b7ee1
--- /dev/null
+++ b/client/imports/app/mobile/parties-list.component.mobile.ts
@@ -0,0 +1,15 @@
+import { Component } from '@angular/core';
+import { PaginationService } from 'ng2-pagination';
+import { PartiesList } from "../shared-components/parties-list.class";
+
+import template from './parties-list.component.mobile.html';
+
+@Component({
+  selector: 'parties-list',
+  template
+})
+export class PartiesListMobileComponent extends PartiesList {
+  constructor(paginationService: PaginationService) {
+    super(paginationService);
+  }
+}
-- 
2.7.4


From 783eb050435a01b5c7aae02fa4c52c649d90efdf Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:08:28 +0300
Subject: [PATCH 282/292] Step 23.23: Added PartiesListMobile component to the
 index file

---
 client/imports/app/mobile/index.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/mobile/index.ts b/client/imports/app/mobile/index.ts
index b92e848..e6203fc 100644
--- a/client/imports/app/mobile/index.ts
+++ b/client/imports/app/mobile/index.ts
@@ -1,5 +1,7 @@
 import {AppMobileComponent} from "./app.component.mobile";
+import {PartiesListMobileComponent} from "./parties-list.component.mobile";
 
 export const MOBILE_DECLARATIONS = [
-  AppMobileComponent
+  AppMobileComponent,
+  PartiesListMobileComponent
 ];
\ No newline at end of file
-- 
2.7.4


From b669685d6308025d06414558f8a9ad1bc96d804e Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:14:30 +0300
Subject: [PATCH 283/292] Step 23.24: Added the rootPage

---
 client/imports/app/mobile/app.component.mobile.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/mobile/app.component.mobile.ts b/client/imports/app/mobile/app.component.mobile.ts
index 212bc29..2b70422 100644
--- a/client/imports/app/mobile/app.component.mobile.ts
+++ b/client/imports/app/mobile/app.component.mobile.ts
@@ -1,6 +1,7 @@
 import {Component} from "@angular/core";
 import template from "./app.component.mobile.html";
 import {MenuController, Platform, App} from "ionic-angular";
+import {PartiesListMobileComponent} from "./parties-list.component.mobile";
 
 if (Meteor.isCordova) {
   require("ionic-angular/css/ionic.css");
@@ -11,7 +12,9 @@ if (Meteor.isCordova) {
   template
 })
 export class AppMobileComponent {
-  constructor(app: App, platform: Platform, menu: MenuController) {
+  rootPage: any;
 
+  constructor(app: App, platform: Platform, menu: MenuController) {
+    this.rootPage = PartiesListMobileComponent;
   }
 }
\ No newline at end of file
-- 
2.7.4


From 429632c4dfcfac865be8c30fe437edea8b292e91 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:15:32 +0300
Subject: [PATCH 284/292] Step 23.25: Update the module imports and entry point

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index c512dd7..2f8aac9 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -22,12 +22,14 @@ import {FileDropModule} from "angular2-file-drop";
 import {MOBILE_DECLARATIONS} from "./mobile/index";
 import {AppMobileComponent} from "./mobile/app.component.mobile";
 import {IonicModule, IonicApp} from "ionic-angular";
+import {PartiesListMobileComponent} from "./mobile/parties-list.component.mobile";
 
 let moduleDefinition;
 
 if (Meteor.isCordova) {
   moduleDefinition = {
     imports: [
+      Ng2PaginationModule,
       IonicModule.forRoot(AppMobileComponent)
     ],
     declarations: [
@@ -40,7 +42,7 @@ if (Meteor.isCordova) {
       IonicApp
     ],
     entryComponents: [
-      AppMobileComponent
+      PartiesListMobileComponent
     ]
   }
 }
-- 
2.7.4


From 1cb943253a3ade19afd561d66c9b0ffa257d6009 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:26:29 +0300
Subject: [PATCH 285/292] Step 23.26: Add name, description ad RSVPs to the
 view

---
 .../app/mobile/parties-list.component.mobile.html  | 25 +++++++++++++++++++++-
 1 file changed, 24 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/mobile/parties-list.component.mobile.html b/client/imports/app/mobile/parties-list.component.mobile.html
index 36c6831..fc0c5b3 100644
--- a/client/imports/app/mobile/parties-list.component.mobile.html
+++ b/client/imports/app/mobile/parties-list.component.mobile.html
@@ -4,5 +4,28 @@
   </ion-navbar>
 </ion-header>
 <ion-content>
-  Parties!
+  <ion-card *ngFor="let party of parties | async">
+    <ion-card-content>
+      <ion-card-title>
+        {{party.name}}
+      </ion-card-title>
+      <p>
+        {{party.description}}
+      </p>
+    </ion-card-content>
+
+    <ion-row no-padding>
+      <ion-col text-right>
+        <ion-badge>
+          yes {{party | rsvp:'yes'}}
+        </ion-badge>
+        <ion-badge item-center dark>
+          maybe {{party | rsvp:'maybe'}}
+        </ion-badge>
+        <ion-badge item-center danger>
+          no {{party | rsvp:'no'}}
+        </ion-badge>
+      </ion-col>
+    </ion-row>
+  </ion-card>
 </ion-content>
-- 
2.7.4


From dddda2a103ff3e193a104eb0fdf1a987f8b8b9b5 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:28:06 +0300
Subject: [PATCH 286/292] Step 23.27: Fix an issuewith a absolute path of an
 image

---
 client/imports/app/shared/display-main-image.pipe.ts | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/shared/display-main-image.pipe.ts b/client/imports/app/shared/display-main-image.pipe.ts
index c98e952..dda5f05 100644
--- a/client/imports/app/shared/display-main-image.pipe.ts
+++ b/client/imports/app/shared/display-main-image.pipe.ts
@@ -1,6 +1,7 @@
 import {Pipe, PipeTransform} from '@angular/core';
 import { Images } from '../../../../both/collections/images.collection';
 import { Party } from '../../../../both/models/party.model';
+import { Meteor } from "meteor/meteor";
 
 @Pipe({
   name: 'displayMainImage'
@@ -17,7 +18,12 @@ export class DisplayMainImagePipe implements PipeTransform {
     const found = Images.findOne(imageId);
 
     if (found) {
-      imageUrl = found.url;
+      if (!Meteor.isCordova) {
+        imageUrl = found.url;
+      } else {
+        const path = `ufs/${found.store}/${found._id}/${found.name}`;
+        imageUrl = Meteor.absoluteUrl(path);
+      }
     }
 
     return imageUrl;
-- 
2.7.4


From 8b25ae905fc6b6f59d4e7cf5f646a16dc90124e4 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:28:57 +0300
Subject: [PATCH 287/292] Step 23.28: Use the main image pipe

---
 client/imports/app/mobile/parties-list.component.mobile.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/imports/app/mobile/parties-list.component.mobile.html b/client/imports/app/mobile/parties-list.component.mobile.html
index fc0c5b3..02e5489 100644
--- a/client/imports/app/mobile/parties-list.component.mobile.html
+++ b/client/imports/app/mobile/parties-list.component.mobile.html
@@ -5,6 +5,7 @@
 </ion-header>
 <ion-content>
   <ion-card *ngFor="let party of parties | async">
+    <img *ngIf="party.images" [src]="party | displayMainImage">
     <ion-card-content>
       <ion-card-title>
         {{party.name}}
-- 
2.7.4


From fbb0e26f18ed4b60c2bcbe6d38bb1e819e35bf6d Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:30:25 +0300
Subject: [PATCH 288/292] Step 23.29: Add mys:fonts

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 0f19195..94f1344 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -28,3 +28,4 @@ email
 jalik:ufs
 jalik:ufs-gridfs
 mys:accounts-phone
+mys:fonts
diff --git a/.meteor/versions b/.meteor/versions
index a17bd5a..4f10af6 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -62,6 +62,7 @@ modules-runtime@0.7.6
 mongo@1.1.12
 mongo-id@1.0.5
 mys:accounts-phone@0.0.21
+mys:fonts@0.0.2
 npm-bcrypt@0.9.1
 npm-mongo@1.5.49
 observe-sequence@1.0.12
-- 
2.7.4


From 0201bc77e6c6db80cfeb1f7bb69e3c0731c3e832 Mon Sep 17 00:00:00 2001
From: dotansimha <dotansimha@gmail.com>
Date: Wed, 28 Sep 2016 13:30:57 +0300
Subject: [PATCH 289/292] Step 23.30: Define fonts.json

---
 fonts.json | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 fonts.json

diff --git a/fonts.json b/fonts.json
new file mode 100644
index 0000000..311eb9c
--- /dev/null
+++ b/fonts.json
@@ -0,0 +1,8 @@
+{
+  "map": {
+    "node_modules/ionic-angular/fonts/roboto-medium.ttf": "fonts/roboto-medium.ttf",
+    "node_modules/ionic-angular/fonts/roboto-regular.ttf": "fonts/roboto-regular.ttf",
+    "node_modules/ionic-angular/fonts/roboto-medium.woff": "fonts/roboto-medium.woff",
+    "node_modules/ionic-angular/fonts/roboto-regular.woff": "fonts/roboto-regular.woff"
+  }
+}
\ No newline at end of file
-- 
2.7.4


From 77c88de206444965d2e699a4b09dbb7b42ca1f43 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 16:44:21 -0200
Subject: [PATCH 290/292] Step 23: Ionic

---
 steps/step23.md | 973 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 973 insertions(+)
 create mode 100644 steps/step23.md

diff --git a/steps/step23.md b/steps/step23.md
new file mode 100644
index 0000000..d68dbdf
--- /dev/null
+++ b/steps/step23.md
@@ -0,0 +1,973 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Ionic
+
+Ionic is a CSS and JavaScript framework. It is highly recommended that before starting this step you will get yourself familiar with its [documentation](http://ionicframework.com/docs/v2).
+
+In this step we will learn how to add Ionic library into our project, and use its powerful directives to create cross platform mobile (Android & iOS) applications.
+
+We will achieve this by creating separate views for web and for mobile  so be creating a separate view for the mobile applications, but we will keep the shared code parts as common code!
+
+### Adding Ionic
+
+Using ionic is pretty simple - first, we need to install it:
+
+    $ meteor npm install ionic-angular --save
+
+We also have to install missing packages that required by Ionic:
+
+    $ meteor npm install @angular/http @angular/platform-server --save
+
+### Separate web and mobile things
+
+We are going to have two different `NgModule`s, because of the differences in the imports and declarations between the two platforms (web and Ionic).
+
+We will also separate the main `Component` that in use.
+
+So let's start with the `AppComponent` that needed to be change to `app.component.web.ts`, and it's template that ness to be called `app.component.web.html`.
+
+Now update the usage of the template in the Component:
+
+[{]: <helper> (diff_step 23.4)
+#### Step 23.4: Updated the template import
+
+##### Changed client/imports/app/app.component.web.ts
+```diff
+@@ -1,6 +1,6 @@
+ ┊1┊1┊import { Component } from '@angular/core';
+ ┊2┊2┊
+-┊3┊ ┊import template from './app.component.html';
++┊ ┊3┊import template from './app.component.web.html';
+ ┊4┊4┊import {InjectUser} from "angular2-meteor-accounts-ui";
+ ┊5┊5┊
+ ┊6┊6┊@Component({
+```
+[}]: #
+
+And modify the import path in the module file:
+
+[{]: <helper> (diff_step 23.5)
+#### Step 23.5: Updated the main component import
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -6,7 +6,7 @@
+ ┊ 6┊ 6┊import { Ng2PaginationModule } from 'ng2-pagination';
+ ┊ 7┊ 7┊import { AgmCoreModule } from 'angular2-google-maps/core';
+ ┊ 8┊ 8┊
+-┊ 9┊  ┊import { AppComponent } from './app.component';
++┊  ┊ 9┊import { AppComponent } from "./app.component.web";
+ ┊10┊10┊import { routes, ROUTES_PROVIDERS } from './app.routes';
+ ┊11┊11┊import { PARTIES_DECLARATIONS } from './parties';
+ ┊12┊12┊import { SHARED_DECLARATIONS } from './shared';
+```
+[}]: #
+
+Now let's take back the code we modified in the previous step (#21) and use only the original version of the Login component, because we do not want to have login in our Ionic version (it will be read only):
+
+[{]: <helper> (diff_step 23.6)
+#### Step 23.6: Use web version of Login component in routing
+
+##### Changed client/imports/app/app.routes.ts
+```diff
+@@ -5,13 +5,12 @@
+ ┊ 5┊ 5┊import { PartyDetailsComponent } from './parties/party-details.component';
+ ┊ 6┊ 6┊import {SignupComponent} from "./auth/singup.component";
+ ┊ 7┊ 7┊import {RecoverComponent} from "./auth/recover.component";
+-┊ 8┊  ┊import {MobileLoginComponent} from "./auth/login.component.mobile";
+ ┊ 9┊ 8┊import {LoginComponent} from "./auth/login.component.web";
+ ┊10┊ 9┊
+ ┊11┊10┊export const routes: Route[] = [
+ ┊12┊11┊  { path: '', component: PartiesListComponent },
+ ┊13┊12┊  { path: 'party/:partyId', component: PartyDetailsComponent, canActivate: ['canActivateForLoggedIn'] },
+-┊14┊  ┊  { path: 'login', component: Meteor.isCordova ? MobileLoginComponent : LoginComponent },
++┊  ┊13┊  { path: 'login', component: LoginComponent },
+ ┊15┊14┊  { path: 'signup', component: SignupComponent },
+ ┊16┊15┊  { path: 'recover', component: RecoverComponent }
+ ┊17┊16┊];
+```
+[}]: #
+
+Create a root Component for the mobile, and call it `AppMobileComponent`:
+
+[{]: <helper> (diff_step 23.7)
+#### Step 23.7: Created the main mobile component
+
+##### Added client/imports/app/mobile/app.component.mobile.ts
+```diff
+@@ -0,0 +1,13 @@
++┊  ┊ 1┊import {Component} from "@angular/core";
++┊  ┊ 2┊import template from "./app.component.mobile.html";
++┊  ┊ 3┊import {MenuController, Platform, App} from "ionic-angular";
++┊  ┊ 4┊
++┊  ┊ 5┊@Component({
++┊  ┊ 6┊  selector: "app",
++┊  ┊ 7┊  template
++┊  ┊ 8┊})
++┊  ┊ 9┊export class AppMobileComponent {
++┊  ┊10┊  constructor(app: App, platform: Platform, menu: MenuController) {
++┊  ┊11┊
++┊  ┊12┊  }
++┊  ┊13┊}🚫↵
+```
+[}]: #
+
+And let's create it's view:
+
+[{]: <helper> (diff_step 23.8)
+#### Step 23.8: Created the main mobile component view
+
+##### Added client/imports/app/mobile/app.component.mobile.html
+```diff
+@@ -0,0 +1 @@
++┊ ┊1┊<ion-nav [root]="rootPage" swipe-back-enabled="true"></ion-nav>🚫↵
+```
+[}]: #
+
+We used `ion-nav` which is the navigation bar of Ionic, we also declared that our root page is `rootPage` which we will add later.
+
+Now let's create an index file for the ionic component declarations:
+
+[{]: <helper> (diff_step 23.9)
+#### Step 23.9: Created index file for mobile declarations
+
+##### Added client/imports/app/mobile/index.ts
+```diff
+@@ -0,0 +1,5 @@
++┊ ┊1┊import {AppMobileComponent} from "./app.component.mobile";
++┊ ┊2┊
++┊ ┊3┊export const MOBILE_DECLARATIONS = [
++┊ ┊4┊  AppMobileComponent
++┊ ┊5┊];🚫↵
+```
+[}]: #
+
+## Modules Separation
+
+In order to create two different versions of `NgModule` - one for each platform, we need to identify which platform are we running now - we already know how to do this from the previous step - we will use `Meteor.isCordova`.
+
+We will have a single `NgModule` called `AppModule`, but it's declaration will be different according to the platform.
+
+So we already know how the web module looks like, we just need to understand how mobile module defined when working with Ionic.
+
+First - we need to import `IonicModule` and declare our root Component there.
+
+We also need to declare `IonicApp` as our `bootstrap` Component, and add every Ionic `page` to the `entryComponents`.
+
+So let's create it and differ the platform:
+
+[{]: <helper> (diff_step 23.10)
+#### Step 23.10: Imported mobile declarations and added conditional main component bootstrap
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -19,38 +19,66 @@
+ ┊19┊19┊import {MdListModule} from "@angular2-material/list";
+ ┊20┊20┊import {AUTH_DECLARATIONS} from "./auth/index";
+ ┊21┊21┊import {FileDropModule} from "angular2-file-drop";
++┊  ┊22┊import {MOBILE_DECLARATIONS} from "./mobile/index";
++┊  ┊23┊import {AppMobileComponent} from "./mobile/app.component.mobile";
++┊  ┊24┊import {IonicModule, IonicApp} from "ionic-angular";
+ ┊22┊25┊
+-┊23┊  ┊@NgModule({
+-┊24┊  ┊  imports: [
+-┊25┊  ┊    BrowserModule,
+-┊26┊  ┊    FormsModule,
+-┊27┊  ┊    ReactiveFormsModule,
+-┊28┊  ┊    RouterModule.forRoot(routes),
+-┊29┊  ┊    AccountsModule,
+-┊30┊  ┊    Ng2PaginationModule,
+-┊31┊  ┊    AgmCoreModule.forRoot({
+-┊32┊  ┊      apiKey: 'AIzaSyAWoBdZHCNh5R-hB5S5ZZ2oeoYyfdDgniA'
+-┊33┊  ┊    }),
+-┊34┊  ┊    MdCoreModule.forRoot(),
+-┊35┊  ┊    MdButtonModule.forRoot(),
+-┊36┊  ┊    MdToolbarModule.forRoot(),
+-┊37┊  ┊    MdInputModule.forRoot(),
+-┊38┊  ┊    MdCardModule.forRoot(),
+-┊39┊  ┊    MdCheckboxModule.forRoot(),
+-┊40┊  ┊    MdListModule.forRoot(),
+-┊41┊  ┊    FileDropModule
+-┊42┊  ┊  ],
+-┊43┊  ┊  declarations: [
+-┊44┊  ┊    AppComponent,
+-┊45┊  ┊    ...PARTIES_DECLARATIONS,
+-┊46┊  ┊    ...SHARED_DECLARATIONS,
+-┊47┊  ┊    ...AUTH_DECLARATIONS
+-┊48┊  ┊  ],
+-┊49┊  ┊  providers: [
+-┊50┊  ┊    ...ROUTES_PROVIDERS
+-┊51┊  ┊  ],
+-┊52┊  ┊  bootstrap: [
+-┊53┊  ┊    AppComponent
+-┊54┊  ┊  ]
+-┊55┊  ┊})
++┊  ┊26┊let moduleDefinition;
++┊  ┊27┊
++┊  ┊28┊if (Meteor.isCordova) {
++┊  ┊29┊  moduleDefinition = {
++┊  ┊30┊    imports: [
++┊  ┊31┊      IonicModule.forRoot(AppMobileComponent)
++┊  ┊32┊    ],
++┊  ┊33┊    declarations: [
++┊  ┊34┊      ...SHARED_DECLARATIONS,
++┊  ┊35┊      ...MOBILE_DECLARATIONS
++┊  ┊36┊    ],
++┊  ┊37┊    providers: [
++┊  ┊38┊    ],
++┊  ┊39┊    bootstrap: [
++┊  ┊40┊      IonicApp
++┊  ┊41┊    ],
++┊  ┊42┊    entryComponents: [
++┊  ┊43┊      AppMobileComponent
++┊  ┊44┊    ]
++┊  ┊45┊  }
++┊  ┊46┊}
++┊  ┊47┊else {
++┊  ┊48┊  moduleDefinition = {
++┊  ┊49┊    imports: [
++┊  ┊50┊      BrowserModule,
++┊  ┊51┊      FormsModule,
++┊  ┊52┊      ReactiveFormsModule,
++┊  ┊53┊      RouterModule.forRoot(routes),
++┊  ┊54┊      AccountsModule,
++┊  ┊55┊      Ng2PaginationModule,
++┊  ┊56┊      AgmCoreModule.forRoot({
++┊  ┊57┊        apiKey: 'AIzaSyAWoBdZHCNh5R-hB5S5ZZ2oeoYyfdDgniA'
++┊  ┊58┊      }),
++┊  ┊59┊      MdCoreModule.forRoot(),
++┊  ┊60┊      MdButtonModule.forRoot(),
++┊  ┊61┊      MdToolbarModule.forRoot(),
++┊  ┊62┊      MdInputModule.forRoot(),
++┊  ┊63┊      MdCardModule.forRoot(),
++┊  ┊64┊      MdCheckboxModule.forRoot(),
++┊  ┊65┊      MdListModule.forRoot(),
++┊  ┊66┊      FileDropModule
++┊  ┊67┊    ],
++┊  ┊68┊    declarations: [
++┊  ┊69┊      AppComponent,
++┊  ┊70┊      ...PARTIES_DECLARATIONS,
++┊  ┊71┊      ...SHARED_DECLARATIONS,
++┊  ┊72┊      ...AUTH_DECLARATIONS
++┊  ┊73┊    ],
++┊  ┊74┊    providers: [
++┊  ┊75┊      ...ROUTES_PROVIDERS
++┊  ┊76┊    ],
++┊  ┊77┊    bootstrap: [
++┊  ┊78┊      AppComponent
++┊  ┊79┊    ]
++┊  ┊80┊  }
++┊  ┊81┊}
++┊  ┊82┊
++┊  ┊83┊@NgModule(moduleDefinition)
+ ┊56┊84┊export class AppModule {}🚫↵
+```
+[}]: #
+
+Our next step is to change our selector of the root Component.
+
+As we already know, the root Component of the web platform uses `<app>` tag as the selector, but in our case the root Component has to be `IonicApp` that uses `<ion-app>` tag.
+
+So we need to have the ability to switch `<app>` to `<ion-app>` when using mobile platform.
+
+There is a package called `ionic-selector` we can use in order to get this done, so let's add it:
+
+    $ meteor npm install --save ionic-selector
+
+Now let's use in before bootstrapping our module:
+
+[{]: <helper> (diff_step 23.12)
+#### Step 23.12: Use ionic-selector package
+
+##### Changed client/main.ts
+```diff
+@@ -6,7 +6,13 @@
+ ┊ 6┊ 6┊
+ ┊ 7┊ 7┊import '../both/methods/parties.methods';
+ ┊ 8┊ 8┊
++┊  ┊ 9┊import ionicSelector from 'ionic-selector';
++┊  ┊10┊
+ ┊ 9┊11┊Meteor.startup(() => {
++┊  ┊12┊  if (Meteor.isCordova) {
++┊  ┊13┊    ionicSelector("app");
++┊  ┊14┊  }
++┊  ┊15┊
+ ┊10┊16┊  const platform = platformBrowserDynamic();
+ ┊11┊17┊  platform.bootstrapModule(AppModule);
+ ┊12┊18┊});🚫↵
+```
+[}]: #
+
+What it does? It's changing tag name of the main component (`app` by default but you can specify any selector you want) to `ion-app`.
+
+An example:
+
+```html
+<body>
+  <app class="main"></app>
+</body>
+```
+
+will be changed to:
+
+```html
+<body>
+  <ion-app class="main"></ion-app>
+</body>
+```
+
+## Ionic styles & icons
+
+Our next step is to load Ionic style and icons (called `ionicons`) only to the mobile platform.
+
+Start by adding the icons package:
+
+    $ meteor npm install --save ionicons
+
+Also, let's create a style file for the mobile and Ionic styles, and load the icons package to it:
+
+[{]: <helper> (diff_step 23.14)
+#### Step 23.14: Create ionic.scss and add ionicons to it
+
+##### Added client/imports/app/mobile/ionic.scss
+```diff
+@@ -0,0 +1 @@
++┊ ┊1┊@import "{}/node_modules/ionicons/dist/scss/ionicons";🚫↵
+```
+[}]: #
+
+And let's imports this file into our main styles file:
+
+[{]: <helper> (diff_step 23.15)
+#### Step 23.15: Import ionic.scss to main file
+
+##### Changed client/main.scss
+```diff
+@@ -1,4 +1,5 @@
+ ┊1┊1┊@import "{}/node_modules/angular2-meteor-accounts-ui/build/login-buttons.scss";
++┊ ┊2┊@import "imports/app/mobile/ionic.scss";
+ ┊2┊3┊
+ ┊3┊4┊$color1 : #2F2933;
+ ┊4┊5┊$color2 : #01A2A6;
+```
+[}]: #
+
+Now we need to load Ionic stylesheet into our project - but we need to load it only to the mobile platform, without loading it to the web platform (otherwise, it will override our styles):
+
+[{]: <helper> (diff_step 23.16)
+#### Step 23.16: Imported the main css file of ionic
+
+##### Changed client/imports/app/mobile/app.component.mobile.ts
+```diff
+@@ -2,6 +2,10 @@
+ ┊ 2┊ 2┊import template from "./app.component.mobile.html";
+ ┊ 3┊ 3┊import {MenuController, Platform, App} from "ionic-angular";
+ ┊ 4┊ 4┊
++┊  ┊ 5┊if (Meteor.isCordova) {
++┊  ┊ 6┊  require("ionic-angular/css/ionic.css");
++┊  ┊ 7┊}
++┊  ┊ 8┊
+ ┊ 5┊ 9┊@Component({
+ ┊ 6┊10┊  selector: "app",
+ ┊ 7┊11┊  template
+```
+[}]: #
+
+We also need to add some CSS classes in order to get a good result:
+
+[{]: <helper> (diff_step 23.17)
+#### Step 23.17: Add two classes to fix an issue with overflow
+
+##### Changed client/main.scss
+```diff
+@@ -22,6 +22,15 @@
+ ┊22┊22┊  font-family: 'Muli', sans-serif;
+ ┊23┊23┊}
+ ┊24┊24┊
++┊  ┊25┊body.mobile {
++┊  ┊26┊  overflow: hidden;
++┊  ┊27┊}
++┊  ┊28┊
++┊  ┊29┊body.web {
++┊  ┊30┊  overflow: visible;
++┊  ┊31┊  position: initial;
++┊  ┊32┊}
++┊  ┊33┊
+ ┊25┊34┊.sebm-google-map-container {
+ ┊26┊35┊  width: 450px;
+ ┊27┊36┊  height: 450px;
+```
+[}]: #
+
+And let's add the correct class to the `body`:
+
+[{]: <helper> (diff_step 23.18)
+#### Step 23.18: Set the proper class on body
+
+##### Changed client/main.ts
+```diff
+@@ -8,9 +8,20 @@
+ ┊ 8┊ 8┊
+ ┊ 9┊ 9┊import ionicSelector from 'ionic-selector';
+ ┊10┊10┊
++┊  ┊11┊function setClass(css) {
++┊  ┊12┊  if (!document.body.className) {
++┊  ┊13┊    document.body.className = "";
++┊  ┊14┊  }
++┊  ┊15┊  document.body.className += " " + css;
++┊  ┊16┊}
++┊  ┊17┊
+ ┊11┊18┊Meteor.startup(() => {
+ ┊12┊19┊  if (Meteor.isCordova) {
+ ┊13┊20┊    ionicSelector("app");
++┊  ┊21┊    setClass('mobile');
++┊  ┊22┊  }
++┊  ┊23┊  else {
++┊  ┊24┊    setClass('web');
+ ┊14┊25┊  }
+ ┊15┊26┊
+ ┊16┊27┊  const platform = platformBrowserDynamic();
+```
+[}]: #
+
+> We created a mechanism that adds `web` or `mobile` class to `<body/>` element depends on environment.
+
+## Share logic between platforms
+
+We want to share the logic of `PartiesListComponent` without sharing it's styles and template - because we want a different looks between the platforms.
+
+In order to do so, let's take all of the logic we have in `PartiesListComponent` and take it to an external file that won't contain the Component decorator:
+
+[{]: <helper> (diff_step 23.19)
+#### Step 23.19: Take the logic of parties list to external class
+
+##### Added client/imports/app/shared-components/parties-list.class.ts
+```diff
+@@ -0,0 +1,112 @@
++┊   ┊  1┊import {OnDestroy, OnInit} from "@angular/core";
++┊   ┊  2┊import {Observable, Subscription, Subject} from "rxjs";
++┊   ┊  3┊import {Party} from "../../../../both/models/party.model";
++┊   ┊  4┊import {PaginationService} from "ng2-pagination";
++┊   ┊  5┊import {MeteorObservable} from "meteor-rxjs";
++┊   ┊  6┊import {Parties} from "../../../../both/collections/parties.collection";
++┊   ┊  7┊import {Counts} from "meteor/tmeasday:publish-counts";
++┊   ┊  8┊import {InjectUser} from "angular2-meteor-accounts-ui";
++┊   ┊  9┊
++┊   ┊ 10┊interface Pagination {
++┊   ┊ 11┊  limit: number;
++┊   ┊ 12┊  skip: number;
++┊   ┊ 13┊}
++┊   ┊ 14┊
++┊   ┊ 15┊interface Options extends Pagination {
++┊   ┊ 16┊  [key: string]: any
++┊   ┊ 17┊}
++┊   ┊ 18┊
++┊   ┊ 19┊@InjectUser('user')
++┊   ┊ 20┊export class PartiesList implements OnInit, OnDestroy {
++┊   ┊ 21┊  parties: Observable<Party[]>;
++┊   ┊ 22┊  partiesSub: Subscription;
++┊   ┊ 23┊  pageSize: Subject<number> = new Subject<number>();
++┊   ┊ 24┊  curPage: Subject<number> = new Subject<number>();
++┊   ┊ 25┊  nameOrder: Subject<number> = new Subject<number>();
++┊   ┊ 26┊  optionsSub: Subscription;
++┊   ┊ 27┊  partiesSize: number = 0;
++┊   ┊ 28┊  autorunSub: Subscription;
++┊   ┊ 29┊  location: Subject<string> = new Subject<string>();
++┊   ┊ 30┊  user: Meteor.User;
++┊   ┊ 31┊  imagesSubs: Subscription;
++┊   ┊ 32┊
++┊   ┊ 33┊  constructor(private paginationService: PaginationService) {
++┊   ┊ 34┊
++┊   ┊ 35┊  }
++┊   ┊ 36┊
++┊   ┊ 37┊  ngOnInit() {
++┊   ┊ 38┊    this.optionsSub = Observable.combineLatest(
++┊   ┊ 39┊      this.pageSize,
++┊   ┊ 40┊      this.curPage,
++┊   ┊ 41┊      this.nameOrder,
++┊   ┊ 42┊      this.location
++┊   ┊ 43┊    ).subscribe(([pageSize, curPage, nameOrder, location]) => {
++┊   ┊ 44┊      const options: Options = {
++┊   ┊ 45┊        limit: pageSize as number,
++┊   ┊ 46┊        skip: ((curPage as number) - 1) * (pageSize as number),
++┊   ┊ 47┊        sort: { name: nameOrder as number }
++┊   ┊ 48┊      };
++┊   ┊ 49┊
++┊   ┊ 50┊      this.paginationService.setCurrentPage(this.paginationService.defaultId, curPage as number);
++┊   ┊ 51┊
++┊   ┊ 52┊      if (this.partiesSub) {
++┊   ┊ 53┊        this.partiesSub.unsubscribe();
++┊   ┊ 54┊      }
++┊   ┊ 55┊
++┊   ┊ 56┊      this.partiesSub = MeteorObservable.subscribe('parties', options, location).subscribe(() => {
++┊   ┊ 57┊        this.parties = Parties.find({}, {
++┊   ┊ 58┊          sort: {
++┊   ┊ 59┊            name: nameOrder
++┊   ┊ 60┊          }
++┊   ┊ 61┊        }).zone();
++┊   ┊ 62┊      });
++┊   ┊ 63┊    });
++┊   ┊ 64┊
++┊   ┊ 65┊    this.paginationService.register({
++┊   ┊ 66┊      id: this.paginationService.defaultId,
++┊   ┊ 67┊      itemsPerPage: 10,
++┊   ┊ 68┊      currentPage: 1,
++┊   ┊ 69┊      totalItems: this.partiesSize
++┊   ┊ 70┊    });
++┊   ┊ 71┊
++┊   ┊ 72┊    this.pageSize.next(10);
++┊   ┊ 73┊    this.curPage.next(1);
++┊   ┊ 74┊    this.nameOrder.next(1);
++┊   ┊ 75┊    this.location.next('');
++┊   ┊ 76┊
++┊   ┊ 77┊    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
++┊   ┊ 78┊      this.partiesSize = Counts.get('numberOfParties');
++┊   ┊ 79┊      this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
++┊   ┊ 80┊    });
++┊   ┊ 81┊
++┊   ┊ 82┊    this.imagesSubs = MeteorObservable.subscribe('images').subscribe();
++┊   ┊ 83┊  }
++┊   ┊ 84┊
++┊   ┊ 85┊  removeParty(party: Party): void {
++┊   ┊ 86┊    Parties.remove(party._id);
++┊   ┊ 87┊  }
++┊   ┊ 88┊
++┊   ┊ 89┊  search(value: string): void {
++┊   ┊ 90┊    this.curPage.next(1);
++┊   ┊ 91┊    this.location.next(value);
++┊   ┊ 92┊  }
++┊   ┊ 93┊
++┊   ┊ 94┊  onPageChanged(page: number): void {
++┊   ┊ 95┊    this.curPage.next(page);
++┊   ┊ 96┊  }
++┊   ┊ 97┊
++┊   ┊ 98┊  changeSortOrder(nameOrder: string): void {
++┊   ┊ 99┊    this.nameOrder.next(parseInt(nameOrder));
++┊   ┊100┊  }
++┊   ┊101┊
++┊   ┊102┊  isOwner(party: Party): boolean {
++┊   ┊103┊    return this.user && this.user._id === party.owner;
++┊   ┊104┊  }
++┊   ┊105┊
++┊   ┊106┊  ngOnDestroy() {
++┊   ┊107┊    this.partiesSub.unsubscribe();
++┊   ┊108┊    this.optionsSub.unsubscribe();
++┊   ┊109┊    this.autorunSub.unsubscribe();
++┊   ┊110┊    this.imagesSubs.unsubscribe();
++┊   ┊111┊  }
++┊   ┊112┊}🚫↵
+```
+[}]: #
+
+And let's clean up the `PartiesListComponent`, and use the new class `PartiesList` as base class for this Component:
+
+[{]: <helper> (diff_step 23.20)
+#### Step 23.20: Create a clean parties list for web display
+
+##### Changed client/imports/app/parties/parties-list.component.ts
+```diff
+@@ -1,123 +1,15 @@
+-┊  1┊   ┊import { Component, OnInit, OnDestroy } from '@angular/core';
+-┊  2┊   ┊import { Observable } from 'rxjs/Observable';
+-┊  3┊   ┊import { Subject } from 'rxjs/Subject';
+-┊  4┊   ┊import { Subscription } from 'rxjs/Subscription';
+-┊  5┊   ┊import { MeteorObservable } from 'meteor-rxjs';
++┊   ┊  1┊import { Component } from '@angular/core';
+ ┊  6┊  2┊import { PaginationService } from 'ng2-pagination';
+-┊  7┊   ┊import { Counts } from 'meteor/tmeasday:publish-counts';
+-┊  8┊   ┊import { InjectUser } from "angular2-meteor-accounts-ui";
+-┊  9┊   ┊
+-┊ 10┊   ┊import 'rxjs/add/operator/combineLatest';
+-┊ 11┊   ┊
+-┊ 12┊   ┊import { Parties } from '../../../../both/collections/parties.collection';
+-┊ 13┊   ┊import { Party } from '../../../../both/models/party.model';
++┊   ┊  3┊import { PartiesList } from "../shared-components/parties-list.class";
+ ┊ 14┊  4┊
+ ┊ 15┊  5┊import template from './parties-list.component.html';
+ ┊ 16┊  6┊
+-┊ 17┊   ┊interface Pagination {
+-┊ 18┊   ┊  limit: number;
+-┊ 19┊   ┊  skip: number;
+-┊ 20┊   ┊}
+-┊ 21┊   ┊
+-┊ 22┊   ┊interface Options extends Pagination {
+-┊ 23┊   ┊  [key: string]: any
+-┊ 24┊   ┊}
+-┊ 25┊   ┊
+ ┊ 26┊  7┊@Component({
+ ┊ 27┊  8┊  selector: 'parties-list',
+ ┊ 28┊  9┊  template
+ ┊ 29┊ 10┊})
+-┊ 30┊   ┊@InjectUser('user')
+-┊ 31┊   ┊export class PartiesListComponent implements OnInit, OnDestroy {
+-┊ 32┊   ┊  parties: Observable<Party[]>;
+-┊ 33┊   ┊  partiesSub: Subscription;
+-┊ 34┊   ┊  pageSize: Subject<number> = new Subject<number>();
+-┊ 35┊   ┊  curPage: Subject<number> = new Subject<number>();
+-┊ 36┊   ┊  nameOrder: Subject<number> = new Subject<number>();
+-┊ 37┊   ┊  optionsSub: Subscription;
+-┊ 38┊   ┊  partiesSize: number = 0;
+-┊ 39┊   ┊  autorunSub: Subscription;
+-┊ 40┊   ┊  location: Subject<string> = new Subject<string>();
+-┊ 41┊   ┊  user: Meteor.User;
+-┊ 42┊   ┊  imagesSubs: Subscription;
+-┊ 43┊   ┊
+-┊ 44┊   ┊  constructor(
+-┊ 45┊   ┊    private paginationService: PaginationService
+-┊ 46┊   ┊  ) {}
+-┊ 47┊   ┊
+-┊ 48┊   ┊  ngOnInit() {
+-┊ 49┊   ┊    this.optionsSub = Observable.combineLatest(
+-┊ 50┊   ┊      this.pageSize,
+-┊ 51┊   ┊      this.curPage,
+-┊ 52┊   ┊      this.nameOrder,
+-┊ 53┊   ┊      this.location
+-┊ 54┊   ┊    ).subscribe(([pageSize, curPage, nameOrder, location]) => {
+-┊ 55┊   ┊      const options: Options = {
+-┊ 56┊   ┊        limit: pageSize as number,
+-┊ 57┊   ┊        skip: ((curPage as number) - 1) * (pageSize as number),
+-┊ 58┊   ┊        sort: { name: nameOrder as number }
+-┊ 59┊   ┊      };
+-┊ 60┊   ┊
+-┊ 61┊   ┊      this.paginationService.setCurrentPage(this.paginationService.defaultId, curPage as number);
+-┊ 62┊   ┊
+-┊ 63┊   ┊      if (this.partiesSub) {
+-┊ 64┊   ┊        this.partiesSub.unsubscribe();
+-┊ 65┊   ┊      }
+-┊ 66┊   ┊      
+-┊ 67┊   ┊      this.partiesSub = MeteorObservable.subscribe('parties', options, location).subscribe(() => {
+-┊ 68┊   ┊        this.parties = Parties.find({}, {
+-┊ 69┊   ┊          sort: {
+-┊ 70┊   ┊            name: nameOrder
+-┊ 71┊   ┊          }
+-┊ 72┊   ┊        }).zone();
+-┊ 73┊   ┊      });
+-┊ 74┊   ┊    });
+-┊ 75┊   ┊
+-┊ 76┊   ┊    this.paginationService.register({
+-┊ 77┊   ┊      id: this.paginationService.defaultId,
+-┊ 78┊   ┊      itemsPerPage: 10,
+-┊ 79┊   ┊      currentPage: 1,
+-┊ 80┊   ┊      totalItems: this.partiesSize
+-┊ 81┊   ┊    });
+-┊ 82┊   ┊
+-┊ 83┊   ┊    this.pageSize.next(10);
+-┊ 84┊   ┊    this.curPage.next(1);
+-┊ 85┊   ┊    this.nameOrder.next(1);
+-┊ 86┊   ┊    this.location.next('');
+-┊ 87┊   ┊
+-┊ 88┊   ┊    this.autorunSub = MeteorObservable.autorun().subscribe(() => {
+-┊ 89┊   ┊      this.partiesSize = Counts.get('numberOfParties');
+-┊ 90┊   ┊      this.paginationService.setTotalItems(this.paginationService.defaultId, this.partiesSize);
+-┊ 91┊   ┊    });
+-┊ 92┊   ┊
+-┊ 93┊   ┊    this.imagesSubs = MeteorObservable.subscribe('images').subscribe();
+-┊ 94┊   ┊  }
+-┊ 95┊   ┊
+-┊ 96┊   ┊  removeParty(party: Party): void {
+-┊ 97┊   ┊    Parties.remove(party._id);
+-┊ 98┊   ┊  }
+-┊ 99┊   ┊
+-┊100┊   ┊  search(value: string): void {
+-┊101┊   ┊    this.curPage.next(1);
+-┊102┊   ┊    this.location.next(value);
+-┊103┊   ┊  }
+-┊104┊   ┊
+-┊105┊   ┊  onPageChanged(page: number): void {
+-┊106┊   ┊    this.curPage.next(page);
+-┊107┊   ┊  }
+-┊108┊   ┊
+-┊109┊   ┊  changeSortOrder(nameOrder: string): void {
+-┊110┊   ┊    this.nameOrder.next(parseInt(nameOrder));
+-┊111┊   ┊  }
+-┊112┊   ┊
+-┊113┊   ┊  isOwner(party: Party): boolean {
+-┊114┊   ┊    return this.user && this.user._id === party.owner;
+-┊115┊   ┊  }
+-┊116┊   ┊
+-┊117┊   ┊  ngOnDestroy() {
+-┊118┊   ┊    this.partiesSub.unsubscribe();
+-┊119┊   ┊    this.optionsSub.unsubscribe();
+-┊120┊   ┊    this.autorunSub.unsubscribe();
+-┊121┊   ┊    this.imagesSubs.unsubscribe();
++┊   ┊ 11┊export class PartiesListComponent extends PartiesList {
++┊   ┊ 12┊  constructor(paginationService: PaginationService) {
++┊   ┊ 13┊    super(paginationService);
+ ┊122┊ 14┊  }
+ ┊123┊ 15┊}
+```
+[}]: #
+
+Now let's create a basic view and layout for the mobile platform, be creating a new Component called `PartiesListMobile`, starting with the view:
+
+[{]: <helper> (diff_step 23.21)
+#### Step 23.21: Create a basic view of the mobile version
+
+##### Added client/imports/app/mobile/parties-list.component.mobile.html
+```diff
+@@ -0,0 +1,8 @@
++┊ ┊1┊<ion-header>
++┊ ┊2┊  <ion-navbar>
++┊ ┊3┊    <ion-title>Socially</ion-title>
++┊ ┊4┊  </ion-navbar>
++┊ ┊5┊</ion-header>
++┊ ┊6┊<ion-content>
++┊ ┊7┊  Parties!
++┊ ┊8┊</ion-content>
+```
+[}]: #
+
+And it's Component, which is very similar to the web version, only it uses different template:
+
+[{]: <helper> (diff_step 23.22)
+#### Step 23.22: Create the mobile version of PartiesList component
+
+##### Added client/imports/app/mobile/parties-list.component.mobile.ts
+```diff
+@@ -0,0 +1,15 @@
++┊  ┊ 1┊import { Component } from '@angular/core';
++┊  ┊ 2┊import { PaginationService } from 'ng2-pagination';
++┊  ┊ 3┊import { PartiesList } from "../shared-components/parties-list.class";
++┊  ┊ 4┊
++┊  ┊ 5┊import template from './parties-list.component.mobile.html';
++┊  ┊ 6┊
++┊  ┊ 7┊@Component({
++┊  ┊ 8┊  selector: 'parties-list',
++┊  ┊ 9┊  template
++┊  ┊10┊})
++┊  ┊11┊export class PartiesListMobileComponent extends PartiesList {
++┊  ┊12┊  constructor(paginationService: PaginationService) {
++┊  ┊13┊    super(paginationService);
++┊  ┊14┊  }
++┊  ┊15┊}
+```
+[}]: #
+
+Now let's add the mobile Component of the parties list to the index file:
+
+[{]: <helper> (diff_step 23.23)
+#### Step 23.23: Added PartiesListMobile component to the index file
+
+##### Changed client/imports/app/mobile/index.ts
+```diff
+@@ -1,5 +1,7 @@
+ ┊1┊1┊import {AppMobileComponent} from "./app.component.mobile";
++┊ ┊2┊import {PartiesListMobileComponent} from "./parties-list.component.mobile";
+ ┊2┊3┊
+ ┊3┊4┊export const MOBILE_DECLARATIONS = [
+-┊4┊ ┊  AppMobileComponent
++┊ ┊5┊  AppMobileComponent,
++┊ ┊6┊  PartiesListMobileComponent
+ ┊5┊7┊];🚫↵
+```
+[}]: #
+
+And let's add the Component we just created as `rootPage` for our Ionic application:
+
+[{]: <helper> (diff_step 23.24)
+#### Step 23.24: Added the rootPage
+
+##### Changed client/imports/app/mobile/app.component.mobile.ts
+```diff
+@@ -1,6 +1,7 @@
+ ┊1┊1┊import {Component} from "@angular/core";
+ ┊2┊2┊import template from "./app.component.mobile.html";
+ ┊3┊3┊import {MenuController, Platform, App} from "ionic-angular";
++┊ ┊4┊import {PartiesListMobileComponent} from "./parties-list.component.mobile";
+ ┊4┊5┊
+ ┊5┊6┊if (Meteor.isCordova) {
+ ┊6┊7┊  require("ionic-angular/css/ionic.css");
+```
+```diff
+@@ -11,7 +12,9 @@
+ ┊11┊12┊  template
+ ┊12┊13┊})
+ ┊13┊14┊export class AppMobileComponent {
+-┊14┊  ┊  constructor(app: App, platform: Platform, menu: MenuController) {
++┊  ┊15┊  rootPage: any;
+ ┊15┊16┊
++┊  ┊17┊  constructor(app: App, platform: Platform, menu: MenuController) {
++┊  ┊18┊    this.rootPage = PartiesListMobileComponent;
+ ┊16┊19┊  }
+ ┊17┊20┊}🚫↵
+```
+[}]: #
+
+Now we just need declare this Component as `entryComponents` in the `NgModule` definition, and make sure we have all the required external modules in the `NgModule` that loaded for the mobile:
+
+[{]: <helper> (diff_step 23.25)
+#### Step 23.25: Update the module imports and entry point
+
+##### Changed client/imports/app/app.module.ts
+```diff
+@@ -22,12 +22,14 @@
+ ┊22┊22┊import {MOBILE_DECLARATIONS} from "./mobile/index";
+ ┊23┊23┊import {AppMobileComponent} from "./mobile/app.component.mobile";
+ ┊24┊24┊import {IonicModule, IonicApp} from "ionic-angular";
++┊  ┊25┊import {PartiesListMobileComponent} from "./mobile/parties-list.component.mobile";
+ ┊25┊26┊
+ ┊26┊27┊let moduleDefinition;
+ ┊27┊28┊
+ ┊28┊29┊if (Meteor.isCordova) {
+ ┊29┊30┊  moduleDefinition = {
+ ┊30┊31┊    imports: [
++┊  ┊32┊      Ng2PaginationModule,
+ ┊31┊33┊      IonicModule.forRoot(AppMobileComponent)
+ ┊32┊34┊    ],
+ ┊33┊35┊    declarations: [
+```
+```diff
+@@ -40,7 +42,7 @@
+ ┊40┊42┊      IonicApp
+ ┊41┊43┊    ],
+ ┊42┊44┊    entryComponents: [
+-┊43┊  ┊      AppMobileComponent
++┊  ┊45┊      PartiesListMobileComponent
+ ┊44┊46┊    ]
+ ┊45┊47┊  }
+ ┊46┊48┊}
+```
+[}]: #
+
+Now we want to add the actual view to the mobile Component, so let's do it:
+
+[{]: <helper> (diff_step 23.26)
+#### Step 23.26: Add name, description ad RSVPs to the view
+
+##### Changed client/imports/app/mobile/parties-list.component.mobile.html
+```diff
+@@ -4,5 +4,28 @@
+ ┊ 4┊ 4┊  </ion-navbar>
+ ┊ 5┊ 5┊</ion-header>
+ ┊ 6┊ 6┊<ion-content>
+-┊ 7┊  ┊  Parties!
++┊  ┊ 7┊  <ion-card *ngFor="let party of parties | async">
++┊  ┊ 8┊    <ion-card-content>
++┊  ┊ 9┊      <ion-card-title>
++┊  ┊10┊        undefined
++┊  ┊11┊      </ion-card-title>
++┊  ┊12┊      <p>
++┊  ┊13┊        undefined
++┊  ┊14┊      </p>
++┊  ┊15┊    </ion-card-content>
++┊  ┊16┊
++┊  ┊17┊    <ion-row no-padding>
++┊  ┊18┊      <ion-col text-right>
++┊  ┊19┊        <ion-badge>
++┊  ┊20┊          yes undefined
++┊  ┊21┊        </ion-badge>
++┊  ┊22┊        <ion-badge item-center dark>
++┊  ┊23┊          maybe undefined
++┊  ┊24┊        </ion-badge>
++┊  ┊25┊        <ion-badge item-center danger>
++┊  ┊26┊          no undefined
++┊  ┊27┊        </ion-badge>
++┊  ┊28┊      </ion-col>
++┊  ┊29┊    </ion-row>
++┊  ┊30┊  </ion-card>
+ ┊ 8┊31┊</ion-content>
+```
+[}]: #
+
+> We used `ion-card` which is an Ionic Component.
+
+And in order to have the ability to load images in the mobile platform, we need to add some logic to the `displayMainImage` Pipe, because Meteor's absolute URL is not the same in mobile:
+
+[{]: <helper> (diff_step 23.27)
+#### Step 23.27: Fix an issuewith a absolute path of an image
+
+##### Changed client/imports/app/shared/display-main-image.pipe.ts
+```diff
+@@ -1,6 +1,7 @@
+ ┊1┊1┊import {Pipe, PipeTransform} from '@angular/core';
+ ┊2┊2┊import { Images } from '../../../../both/collections/images.collection';
+ ┊3┊3┊import { Party } from '../../../../both/models/party.model';
++┊ ┊4┊import { Meteor } from "meteor/meteor";
+ ┊4┊5┊
+ ┊5┊6┊@Pipe({
+ ┊6┊7┊  name: 'displayMainImage'
+```
+```diff
+@@ -17,7 +18,12 @@
+ ┊17┊18┊    const found = Images.findOne(imageId);
+ ┊18┊19┊
+ ┊19┊20┊    if (found) {
+-┊20┊  ┊      imageUrl = found.url;
++┊  ┊21┊      if (!Meteor.isCordova) {
++┊  ┊22┊        imageUrl = found.url;
++┊  ┊23┊      } else {
++┊  ┊24┊        const path = `ufs/${found.store}/${found._id}/${found.name}`;
++┊  ┊25┊        imageUrl = Meteor.absoluteUrl(path);
++┊  ┊26┊      }
+ ┊21┊27┊    }
+ ┊22┊28┊
+ ┊23┊29┊    return imageUrl;
+```
+[}]: #
+
+And let's add the image to the view:
+
+[{]: <helper> (diff_step 23.28)
+#### Step 23.28: Use the main image pipe
+
+##### Changed client/imports/app/mobile/parties-list.component.mobile.html
+```diff
+@@ -5,6 +5,7 @@
+ ┊ 5┊ 5┊</ion-header>
+ ┊ 6┊ 6┊<ion-content>
+ ┊ 7┊ 7┊  <ion-card *ngFor="let party of parties | async">
++┊  ┊ 8┊    <img *ngIf="party.images" [src]="party | displayMainImage">
+ ┊ 8┊ 9┊    <ion-card-content>
+ ┊ 9┊10┊      <ion-card-title>
+ ┊10┊11┊        undefined
+```
+[}]: #
+
+### Fixing fonts
+
+As you probably notice, there are many warnings about missing fonts. We can easily fix it with the help of a package called [`mys:fonts`](https://github.com/jellyjs/meteor-fonts).
+
+    $ meteor add mys:fonts
+
+That plugin needs to know which font we want to use and where it should be available.
+
+Configuration is pretty easy, you will catch it by just looking on an example:
+
+[{]: <helper> (diff_step 23.30)
+#### Step 23.30: Define fonts.json
+
+##### Added fonts.json
+```diff
+@@ -0,0 +1,8 @@
++┊ ┊1┊{
++┊ ┊2┊  "map": {
++┊ ┊3┊    "node_modules/ionic-angular/fonts/roboto-medium.ttf": "fonts/roboto-medium.ttf",
++┊ ┊4┊    "node_modules/ionic-angular/fonts/roboto-regular.ttf": "fonts/roboto-regular.ttf",
++┊ ┊5┊    "node_modules/ionic-angular/fonts/roboto-medium.woff": "fonts/roboto-medium.woff",
++┊ ┊6┊    "node_modules/ionic-angular/fonts/roboto-regular.woff": "fonts/roboto-regular.woff"
++┊ ┊7┊  }
++┊ ┊8┊}🚫↵
+```
+[}]: #
+
+Now `roboto-regular.ttf` is available under `http://localhost:3000/fonts/roboto-regular.ttf`.
+
+And... You have an app that works with Ionic!
+
+## Summary
+
+In this tutorial we showed how to use Ionic and how to separate the whole view for both, web and mobile.
+
+We also learned how to share component between platforms, and change the view only!
+
+We also used Ionic directives in order to provide user-experience of mobile platform instead of regular responsive layout of website.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step22.md) | [Next Step >](step24.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 9b5c876cc4d8061554bdb67e76f1d03e16f0fd07 Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 16:45:26 -0200
Subject: [PATCH 291/292] Step 24: ngUpgrade and Migration to Angular2

---
 steps/step24.md | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 steps/step24.md

diff --git a/steps/step24.md b/steps/step24.md
new file mode 100644
index 0000000..da8b1b8
--- /dev/null
+++ b/steps/step24.md
@@ -0,0 +1,17 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# ngUpgrade and Migration to Angular2
+
+## ngUpgrade
+
+[Click here](angular-meteor.com/tutorials/socially/angular1/migration-to-angular2) for the chapter explaining how to use both Angular 1.x and 2.0 in the same app and migrate gradually.
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step23.md) | [Next Step >](step25.md) |
+|:--------------------------------|--------------------------------:|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4


From 430f6c6b3d150783541f6a96d378df19033adcec Mon Sep 17 00:00:00 2001
From: DAB0mB <emanor6@gmail.com>
Date: Tue, 11 Oct 2016 16:51:23 -0200
Subject: [PATCH 292/292] Step 25: Next Steps

---
 steps/step25.md | 26 ++++++++++++++++++++++++++
 1 file changed, 26 insertions(+)
 create mode 100644 steps/step25.md

diff --git a/steps/step25.md b/steps/step25.md
new file mode 100644
index 0000000..6b70334
--- /dev/null
+++ b/steps/step25.md
@@ -0,0 +1,26 @@
+[__prod__]: #
+[{]: <region> (header)
+
+[}]: #
+[{]: <region> (body)
+# Next Steps
+
+Congratulations on your newly built angular-meteor app! Don't forget to deploy it again so your friends can use the new features.
+
+# What's next?
+
+Here are some options for where you can go next:
+
+1. [Full API reference](angular-meteor.com/api).
+2. [Contribute to our project](https://github.com/Urigo/angular-meteor#contributing).
+3. Follow and comment on our [Roadmap](https://trello.com/b/Wj9U0ulk/angular-meteor).
+4. Join other developers on the [Meteor forum](https://forums.meteor.com/).
+5. If you'd like to deploy this app to a production server, we recommend you check out [Meteor Galaxy](https://www.meteor.com/why-meteor/pricing), the cloud service for hosting and managing Meteor apps.
+6. Try the [WhatsApp clone tutorial](angular-meteor.com/tutorials/whatsapp2/).
+[}]: #
+[{]: <region> (footer)
+[{]: <helper> (nav_step)
+| [< Previous Step](step24.md) |
+|:----------------------|
+[}]: #
+[}]: #
\ No newline at end of file
-- 
2.7.4

